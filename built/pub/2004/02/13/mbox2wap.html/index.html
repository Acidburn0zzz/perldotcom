<!DOCTYPE html>
<html lang="en-us">
  <head>
  <title> Mail to WAP Gateways </title>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="It&#39;s coming up to Valentine&#39;s day again, and invariably my thoughts turn back to last year&#39;s rather memorable weekend-break to Stockholm, in which I learned two things: Stockholm makes a great Valentine&#39;s destination. My girlfriend of the time was not..."/>
  <meta name="robots" content="index, follow">
  <meta name="google-site-verification" content="TZowffo_LX2mmsw2DbeNNbukCMnIOA8T-6CMJPiYllI" />

<meta property="twitter:card" content="summary">
<meta property="twitter:site" content="@PerlFoundation">
<meta property="og:url" content="http://localhost:1313/pub/2004/02/13/mbox2wap.html/" />
<meta property="og:title" content="Mail to WAP Gateways" />
<meta property="og:description" content="It&#39;s coming up to Valentine&#39;s day again, and invariably my thoughts turn back to last year&#39;s rather memorable weekend-break to Stockholm, in which I learned two things: Stockholm makes a great Valentine&#39;s destination. My girlfriend of the time was not...">
<meta property="og:site_name" content="Perl.com" />

<meta property="og:type" content="article" />
<meta property="og:article:published_time" content="2004-02-02T02:02:02Z" />
<meta property="og:image" content="http://localhost:1313/images/_pub_2004_02_13_mbox2wap/111-wap_gate.gif" />
<meta property="og:article:tag" content="cellphone-email" />
<meta property="og:article:tag" content="cellphone-mail" />
<meta property="og:article:tag" content="email-wap" />
<meta property="og:article:tag" content="mail-to-wap-gateway" />
<meta property="og:article:tag" content="mobile-mail" />
<meta property="og:article:tag" content="wap" />
<meta property="og:article:tag" content="mail-and-usenet-news" />


  <link rel="icon" href="/favicon.ico">
  <link href="/article/index.xml" rel="alternate" type="application/rss+xml" title="Perl.com - programming news, code and culture" />
  <link href="/article/index.xml" rel="feed" type="application/rss+xml" title="Perl.com - programming news, code and culture" />
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" type="text/css" href="/css/perldotcom.css"/>


<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-50555-22', 'auto');
ga('create', 'UA-85734801-2', 'auto', 'editor');
ga('send', 'pageview');
ga('editor.send', 'pageview');
</script>

</head>
<body>

<div class="container-fluid full-wdith antonio">
 <div class="row">
  <div class="navbar-inverse" style="border-radius:none !important" role="navigation">
    <div class="container-fluid">
      <ul class="nav navbar-nav pull-right follow">
          <li>MORE:</li>
          <li><a href="https://perl.org">
              <img src="/images/site/perl-onion_20.png" alt="Perl Onion"></a><li>
          <li><a href="https://twitter.com/intent/follow?screen_name=perlfoundation">
              <img src="/images/site/twitter_20.png" alt="twitter"></a><li>
          <li><a href="/article/index.xml" />
              <img src="/images/site/rss_20.png" alt="rss"></a></li>
          <li><a href="https://github.com/tpf/perldotcom" />
              <img src="/images/site/github_light_20.png" alt="GitHub logo"></a></li>
      </ul>
      <div class="navbar-header">
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
          <a class="navbar-nav" href="/">
            <div class="header-logo">Perl.com</div>
          </a>
      </div>
      <div class="navbar-collapse collapse">
        <ul class="nav navbar-nav">
          <li><a href="/about">
              <div class="circle">
                <img src="/images/site/perl-camel.png" alt="" />
              </div>
                  &nbsp;&nbsp;ABOUT</a>
          </li>
          <li><a href="/authors">
              <div class="circle">
                  <span class="glyphicon glyphicon-user txt-blue-major" aria-hidden="true"></span>
              </div>
                  &nbsp;&nbsp;AUTHORS</a>
          </li>
          <li><a href="/categories">
              <div class="circle">
                  <span class="glyphicon glyphicon-folder-open txt-blue-major" aria-hidden="true"></span>
              </div>
                  &nbsp;&nbsp;CATEGORIES</a>
          </li>
          <li><a href="/tags">
              <div class="circle">
                <span class="txt-blue-major" aria-hidden="true"><strong>#</strong></span>
              </div>
                  &nbsp;&nbsp;TAGS</a>
          </li>
          <li>
            <form class="search" name="ddg" action="https://duckduckgo.com/" method="get">
              <input type="text" name ="q" placeholder="SEARCH" />
              <input type="hidden" value="perl.com" name="sites" />
            </form>
          </li>
        </ul>
      </div>
    </div>
  </div>
 </div>
</div>


  <section id="content" role="main">
    <section class="entry-content">
      <div class="container">
        <div class="row">
          <div class="col-md-9">
            <div class="row">
              <article class="fulltext">
              <h1 class="blog-post-title">Mail to WAP Gateways</h1>
              <p class="blog-post-meta">Feb 13, 2004 by
              
              
                
                
                <a href="#author-bio-pete-sergeant">Pete Sergeant</a>
              
              </p>
              <img alt="" src=""/>
                

<p>It&rsquo;s coming up to Valentine&rsquo;s day again, and invariably my thoughts turn back to last year&rsquo;s rather memorable weekend-break to Stockholm, in which I learned two things:</p>

<ol>
<li>Stockholm makes a great Valentine&rsquo;s destination.</li>
<li>My girlfriend of the time was not happy with me cracking out my iBook and checking my email halfway into the break.</li>
</ol>

<p>The relationship, predictably, didn&rsquo;t last much longer, but it did occur to me that a quick and easy way to check my email when away from my computer would be very useful. One of the items that travels everywhere with me, and has some limited Internet access is my phone &ndash; although admittedly this has only WAP access. WAP access, it seemed, would have to do&hellip;</p>

<p>The tool I ended up building fills <strong>my</strong> needs very well, but possibly won&rsquo;t be such a great match for others. This article looks at considerations when rendering email for display online, especially when space is very limited.</p>

<h3 id="span-id-overview-of-messages-overview-of-messages-span"><span id="Overview_of_messages">Overview of Messages</span></h3>

<p>The first challenge is reading the contents of our target mailbox. For this, we turn to the Perl Email Project&rsquo;s <a href="https://metacpan.org/pod/Email::Folder"><code>Email::Folder</code></a>:</p>

<pre><code> use Email::Folder;

 my $folder = Email::Folder-&gt;new( '/home/sheriff/mbox' );

 for my $message ( $folder-&gt;messages ) {

        ...
</code></pre>

<p><a href="https://metacpan.org/pod/Email::Folder"><code>Email::Folder</code></a>&rsquo;s messages() function returns <a href="https://metacpan.org/pod/Email::Simple"><code>Email::Simple</code></a> objects. For my folder-view, I chose to group messages by date, and use the sender&rsquo;s &ldquo;real name&rdquo; as the subject. Something like:</p>

<pre><code> 30 Jan 2004
    Michael Roberts
  * Paul Makepeace
    Uri Guttman
 29 Jan 2004
    Kate Pugh
</code></pre>

<p>Extracting header fields from <a href="https://metacpan.org/pod/Email::Simple"><code>Email::Simple</code></a> objects couldn&rsquo;t be simpler:</p>

<pre><code> my $from = $message-&gt;header('from')
</code></pre>

<p>But people familiar with the various email RFCs will know that since email headers have to use only printable US-ASCII, they&rsquo;re very often encoded: your header field might well look like:</p>

<pre><code>  =?iso-8859-1?q?Pete=20Sergeant?= &lt;pete@clueball.com&gt;
</code></pre>

<p>This will not look pretty if you use it literally. Thankfully, <a href="https://metacpan.org/pod/MIME::WordDecoder"><code>MIME::WordDecoder</code></a> exports the function <code>unmime</code> &ndash; rendering the above as &ldquo;Pete Sergeant &lt;pete@clueball.com&gt;.&rdquo;</p>

<p>Getting the date from an email is also somewhat nontrivial &ndash; an example &ldquo;Date&rdquo; header looks like:</p>

<pre><code> Fri, 30 Jan 2004 14:09:51 -0000
</code></pre>

<p>And that&rsquo;s if you&rsquo;re lucky, and it&rsquo;s well-formed, without starting to think about time zones. If we want to do anything useful with dates, we&rsquo;re going to want the date as an epoch time. Luckily, <a href="https://metacpan.org/pod/DateTime::Format::Mail"><code>DateTime::Format::Mail</code></a> steps in, and not only parses our date, but returns a highly useful <a href="https://metacpan.org/pod/DateTime"><code>DateTime</code></a> object, allowing us to do all kinds of fun date stuff. To simply reformat the date as Day/Month/Year:</p>

<pre><code> my $datetime = DateTime::Format::Mail-&gt;new( loose =&gt; 1 );
 my $time = $datetime-&gt;parse_datetime( $message-&gt;header('date') );
 my $day_month_year = $time-&gt;dmy;
</code></pre>

<p>Finally, we&rsquo;re going to want to know if an email is new or not. Luckily, most MUAs will set/edit an email&rsquo;s status header. Rather than checking if an email is new, we check if it&rsquo;s been read &ndash; denoted by a <code>R</code> in the status header:</p>

<pre><code> $new_flag++ if $message-&gt;header('Status') !~ m/R/;
</code></pre>

<p>Now let&rsquo;s put this all together to produce a listing of a folder. We&rsquo;ll use the well-known Schwartzian transform to make the sorting efficient, but unlike the usual practice, we keep the array reference around, as we&rsquo;ll be using the date as well.</p>

<pre><code> use Email::Folder;
 use MIME::WordDecoder qw( unmime );
 use DateTime::Format::Mail;

 my $folder = Email::Folder-&gt;new( '/home/sheriff/mbox' );
 my @to_sort;
 my $prev_date = &quot;&quot;;
 for (sort { $a-&gt;[1] cmp $b-&gt;[1]    }
      map  { [$_, message2dmy($_) ] } 
      $folder-&gt;messages) {
     my ($message, $date) = @$_;
     if ($date ne $prev_date) { print $date, &quot;\n&quot;; $prev_date = $date; }
     print $message-&gt;header('Status') =~ m/R/ ? &quot;   &quot; : &quot; * &quot;;
     print unmime($message-&gt;header('from')), &quot;\n&quot;;
 }

 sub message2dmy {
     my $message = shift;
     my $datetime = DateTime::Format::Mail-&gt;new( loose =&gt; 1 );
     my $time = $datetime-&gt;parse_datetime( $message-&gt;header('date') );
     my $day_month_year = $time-&gt;dmy;
 }
</code></pre>

<h3 id="span-id-displaying-individual-messages-displaying-individual-messages-span"><span id="Displaying_individual_messages">Displaying Individual Messages</span></h3>

<p>Those are the main challenges of a folder-view. Viewing an individual message presents a different set of challenges.</p>

<p>First and foremost is the appalling habit people have of sending each other HTML-&ldquo;enriched&rdquo; emails, with all sorts of attachments. If you&rsquo;re trying to read the email on a cell phone over a slow connection, you don&rsquo;t want to be battling with this &ndash; you want a nice plain-text representation of the email. So, <a href="https://metacpan.org/pod/Email::StripMIME"><code>Email::StripMIME</code></a> is your friend. Assuming we have an <a href="https://metacpan.org/pod/Email::Simple"><code>Email::Simple</code></a> object, we can simply:</p>

<pre><code> my $string = $email_simple_object-&gt;as_string();
 $string = Email::StripMIME::strip_mime( $string );
 $email_simple_object = Email::Simple-&gt;new( $string );
</code></pre>

<p>Of course, if we really wanted to cut down on the amount of content we&rsquo;re receiving, and we&rsquo;re only using this tool to get an overview of our messages, we can cut out quoted text, remnants of the email that the sender was replying to, and so on. <a href="https://metacpan.org/pod/Text::Original"><code>Text::Original</code></a> does just this for us, as well as stripping out attribution lines:</p>

<pre><code> my $body = $email_simple_object-&gt;body();
 $body = first_lines( $body, 20);
 $email_simple_object-&gt;body( $body );
</code></pre>

<p>The final problem is in creating actual real WML. Sadly, this is nontrivial, and in the past, I&rsquo;ve tended to resort to outputting it by hand. But it doesn&rsquo;t have to be that way &ndash;; <a href="https://metacpan.org/pod/CGI::WML"><code>CGI::WML</code></a> just about handles the task for us. <a href="https://metacpan.org/pod/CGI::WML"><code>CGI::WML</code></a> is a subclass of <a href="https://metacpan.org/pod/CGI"><code>CGI</code></a>, with methods specific to WAP.</p>

<h3 id="span-id-conclusion-conclusion-span"><span id="Conclusion">Conclusion</span></h3>

<p>There is no fully working demo at the end of this article. My personal tool works in a way that&rsquo;s probably a little too specific for most people&rsquo;s needs. Hopefully however, it&rsquo;s introduced you to one or more modules you didn&rsquo;t know existed, and given you some inspiration to tinker around with Perl and email-handling.</p>

              </article>
              <p><strong>Tags</strong></p>
              <div class="tags">
                <div class="category"><a href="/categories/email">email</a></div>
                
                  <div class="tag"><a href="/tags/cellphone-email">cellphone-email</a></div>
                
                  <div class="tag"><a href="/tags/cellphone-mail">cellphone-mail</a></div>
                
                  <div class="tag"><a href="/tags/email-wap">email-wap</a></div>
                
                  <div class="tag"><a href="/tags/mail-to-wap-gateway">mail-to-wap-gateway</a></div>
                
                  <div class="tag"><a href="/tags/mobile-mail">mobile-mail</a></div>
                
                  <div class="tag"><a href="/tags/wap">wap</a></div>
                
                  <div class="tag"><a href="/tags/mail-and-usenet-news">mail-and-usenet-news</a></div>
                
              </div>
            </div>
            
              
                
<div class="row" id="author-bio-pete-sergeant">
  <div class="col-sm-2">
    
    <a href="/authors/pete-sergeant/"><div class="circle-avatar" style="background-image:url(/images/author/pete-sergeant.jpg)"></div></a>
  </div>
  <div class="col-sm-10">
    <a href="/authors/pete-sergeant/"><h3>Pete Sergeant</h3></a>
    <p>Pete is a CPAN <a href="https://metacpan.org/author/SARGIE">author</a> &amp; contributor. He also runs <a href="https://perl.careers">Perl Jobs by Perl Careers</a>.</p>
    <h5><a href="/authors/pete-sergeant/">Browse their articles</a></h5>
  </div>
</div>

            
            <div class="row">
              <h3>Feedback</h3>
              <p>Something wrong with this article? Help us out by opening an issue or pull request on <a href="https://github.com/tpf/perldotcom/blob/master/content/legacy/_pub_2004_02_13_mbox2wap.md">GitHub</a></p>
            </div>
          </div>
          <div class="col-md-3">
            <div class="latest-sidebar">

  <div class="row">
    <div class="col-sm-12 centering">
      <span style="font-size:1.8em" class="antonio txt-blue-major">OUR LATEST ARTICLES</span>
    </div>
  </div>
  
    
    
    <div class="row">
        <a href="http://localhost:1313/article/the-perl-admbassador-curtis-poe/">
      <div class="col-sm-3">
        <div class="circle-avatar" style="background-image:url(/images/the-perl-ambassador-curtis-poe/curtis-poe.jpg)"></div>
      </div>
      <div class="col-sm-9">
          <h6>The Perl Ambassador: Curtis &#39;Ovid&#39; Poe</h6>
          <p style="line-height:1"><small>The person behind the news of Perl</small></p>
      </div>
        </a>
    </div>
  
    
    
    <div class="row">
        <a href="http://localhost:1313/article/a-tour-with-net-ftp/">
      <div class="col-sm-3">
        <div class="circle-avatar" style="background-image:url(/images/a-tour-with-net-ftp/thumb_kidyes.jpg)"></div>
      </div>
      <div class="col-sm-9">
          <h6>A tour with Net::FTP</h6>
          <p style="line-height:1"><small>How to write an FTP client in Perl</small></p>
      </div>
        </a>
    </div>
  
    
    
    <div class="row">
        <a href="http://localhost:1313/article/shortcode_test/">
      <div class="col-sm-3">
        <div class="circle-avatar" style="background-image:url(/images/author/brian-d-foy.jpg)"></div>
      </div>
      <div class="col-sm-9">
          <h6>shortcode_test</h6>
          <p style="line-height:1"><small></small></p>
      </div>
        </a>
    </div>
  
    
    
    <div class="row">
        <a href="http://localhost:1313/article/listen-to-larry-wall-s-state-of-the-onion-2000-on-youtube/">
      <div class="col-sm-3">
        <div class="circle-avatar" style="background-image:url(/images/listen-to-larry-wall-s-state-of-the-onion-2000-on-youtube/thumb_larry-wall.jpg)"></div>
      </div>
      <div class="col-sm-9">
          <h6>Listen to Larry Wall&#39;s State of the Onion 2000 on YouTube</h6>
          <p style="line-height:1"><small></small></p>
      </div>
        </a>
    </div>
  
    
    
    <div class="row">
        <a href="http://localhost:1313/article/announcing-perl-7/">
      <div class="col-sm-3">
        <div class="circle-avatar" style="background-image:url(/images/announcing-perl-7/thumb_seven_on_blue_wall.jpg)"></div>
      </div>
      <div class="col-sm-9">
          <h6>Announcing Perl 7</h6>
          <p style="line-height:1"><small>Perl 5 with modern defaults</small></p>
      </div>
        </a>
    </div>
  
</div>
<div class="row" style="margin-top:20px">
  <div class="col-sm-12 centering">
  <script async src="/widget/toplinks/toplinks.js" type="text/javascript"></script>
    <div id="toplinks"></div>
  </div>
</div>

<div class="row" style="margin-top:20px">
  <div class="col-sm-12 centering">
    <a class="twitter-timeline" data-height="640" data-dnt="true" data-theme="dark" href="https://twitter.com/perlfoundation?ref_src=twsrc%5Etfw">Tweets by perlfoundation</a> <script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>
  </div>
</div>

<div class="row" style="margin-top:20px">
  <div class="col-sm-12 centering">
    <script src="https://www.reddit.com/r/perl/hot/.embed?limit=10&t=all" type="text/javascript"></script>
  </div>
</div>



          </div>
        </div>
      </div>
    </section>
  </section>
<script>
 
var tables, i;
tables = document.getElementsByTagName('table');
for (i=0;i<tables.length;i++) {
  tables[i].className = 'table table-striped';
}
</script>
<div class="push"></div>
<div class="footer">
  <div class="container">
    <div class="row">
      <div class="col-md-1">
        <h5>Site Map</h5>
        <ul>
        <li><a href="/">Home</a></li>
        <hr>
        <li><a href="/about">About</a></li>
        <hr>
        <li><a href="/authors">Authors</a></li>
        <hr>
        <li><a href="/categories">Categories</a></li>
        <hr>
        <li><a href="/tags">Tags</a></li>
        <hr>
        </ul>
      </div>
      <div class="col-md-3">
        <h5>Contact Us</h5>
        <p>To get in touch, send an email to: perl.com-editor@perl.org</p>
        <p><a href="https://perl.org">
              <img src="/images/site/perl-onion_20.png" alt="Perl Onion"></a>
          <a href="https://twitter.com/intent/follow?screen_name=perlfoundation">
              <img src="/images/site/twitter_20.png" alt="twitter"></a>
          <a href="/index.xml" /><img src="/images/site/rss_20.png" alt="rss"></a>
          <a href="https://github.com/tpf/perldotcom">
              <img src="/images/site/github_light_20.png" alt="GitHub logo"></a></p>
      </div>
      <div class="col-md-2">
          <h5>License</h5>
          <p>This work is licensed under a <a rel="license" href="https://creativecommons.org/licenses/by-nc/3.0/">Creative Commons Attribution-NonCommercial 3.0 Unported License</a>.</p>
          <p><a rel="license" href="https://creativecommons.org/licenses/by-nc/3.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc/3.0/88x31.png" /></a></p>
      </div>
      <div class="col-md-5">
          <h5>Legal</h5>
          <p>Perl.com and the authors make no representations with respect to the accuracy or completeness of the contents of all work on this website and specifically disclaim all warranties, including without limitation warranties of fitness for a particular purpose. The information published on this website may not be suitable for every situation. All work on this website is provided with the understanding that Perl.com and the authors are not engaged in rendering professional services. Neither Perl.com nor the authors shall be liable for damages arising herefrom.</p>
      </div>
    </div>
  </div>
</div>
<script src="/javascript/jquery.min.js"></script>
<script src="/javascript/bootstrap.min.js"></script>
<script data-no-instant>document.write('<script src="/livereload.js?port=1313&mindelay=10"></' + 'script>')</script></body>
</html>

