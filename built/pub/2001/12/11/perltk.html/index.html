<!DOCTYPE html>
<html lang="en-us">
  <head>
  <title> A Drag-and-Drop Primer for Perl/Tk </title>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content=" As it happens, no matter how much I write about Perl/Tk, there&#39;s always something left unsaid. A case in point is the topic of drag and drop, which didn&#39;t make it into our book, Mastering Perl/Tk. This article describes..."/>
  <meta name="robots" content="index, follow">
  <meta name="google-site-verification" content="TZowffo_LX2mmsw2DbeNNbukCMnIOA8T-6CMJPiYllI" />

<meta property="twitter:card" content="summary">
<meta property="twitter:site" content="@PerlFoundation">
<meta property="og:url" content="http://localhost:1313/pub/2001/12/11/perltk.html/" />
<meta property="og:title" content="A Drag-and-Drop Primer for Perl/Tk" />
<meta property="og:description" content=" As it happens, no matter how much I write about Perl/Tk, there&#39;s always something left unsaid. A case in point is the topic of drag and drop, which didn&#39;t make it into our book, Mastering Perl/Tk. This article describes...">
<meta property="og:site_name" content="Perl.com" />

<meta property="og:type" content="article" />
<meta property="og:article:published_time" content="2001-12-12T12:12:12Z" />
<meta property="og:image" content="http://localhost:1313/images/_pub_2001_12_11_perltk/111-dragndrop.gif" />
<meta property="og:article:tag" content="drag-drop-tk" />
<meta property="og:article:tag" content="perl" />
<meta property="og:article:tag" content="perl-tk" />


  <link rel="icon" href="/favicon.ico">
  <link href="/article/index.xml" rel="alternate" type="application/rss+xml" title="Perl.com - programming news, code and culture" />
  <link href="/article/index.xml" rel="feed" type="application/rss+xml" title="Perl.com - programming news, code and culture" />
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" type="text/css" href="/css/perldotcom.css"/>


<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-50555-22', 'auto');
ga('create', 'UA-85734801-2', 'auto', 'editor');
ga('send', 'pageview');
ga('editor.send', 'pageview');
</script>

</head>
<body>

<div class="container-fluid full-wdith antonio">
 <div class="row">
  <div class="navbar-inverse" style="border-radius:none !important" role="navigation">
    <div class="container-fluid">
      <ul class="nav navbar-nav pull-right follow">
          <li>MORE:</li>
          <li><a href="https://perl.org">
              <img src="/images/site/perl-onion_20.png" alt="Perl Onion"></a><li>
          <li><a href="https://twitter.com/intent/follow?screen_name=perlfoundation">
              <img src="/images/site/twitter_20.png" alt="twitter"></a><li>
          <li><a href="/article/index.xml" />
              <img src="/images/site/rss_20.png" alt="rss"></a></li>
          <li><a href="https://github.com/tpf/perldotcom" />
              <img src="/images/site/github_light_20.png" alt="GitHub logo"></a></li>
      </ul>
      <div class="navbar-header">
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
          <a class="navbar-nav" href="/">
            <div class="header-logo">Perl.com</div>
          </a>
      </div>
      <div class="navbar-collapse collapse">
        <ul class="nav navbar-nav">
          <li><a href="/about">
              <div class="circle">
                <img src="/images/site/perl-camel.png" alt="" />
              </div>
                  &nbsp;&nbsp;ABOUT</a>
          </li>
          <li><a href="/authors">
              <div class="circle">
                  <span class="glyphicon glyphicon-user txt-blue-major" aria-hidden="true"></span>
              </div>
                  &nbsp;&nbsp;AUTHORS</a>
          </li>
          <li><a href="/categories">
              <div class="circle">
                  <span class="glyphicon glyphicon-folder-open txt-blue-major" aria-hidden="true"></span>
              </div>
                  &nbsp;&nbsp;CATEGORIES</a>
          </li>
          <li><a href="/tags">
              <div class="circle">
                <span class="txt-blue-major" aria-hidden="true"><strong>#</strong></span>
              </div>
                  &nbsp;&nbsp;TAGS</a>
          </li>
          <li>
            <form class="search" name="ddg" action="https://duckduckgo.com/" method="get">
              <input type="text" name ="q" placeholder="SEARCH" />
              <input type="hidden" value="perl.com" name="sites" />
            </form>
          </li>
        </ul>
      </div>
    </div>
  </div>
 </div>
</div>


  <section id="content" role="main">
    <section class="entry-content">
      <div class="container">
        <div class="row">
          <div class="col-md-9">
            <div class="row">
              <article class="fulltext">
              <h1 class="blog-post-title">A Drag-and-Drop Primer for Perl/Tk</h1>
              <p class="blog-post-meta">Dec 11, 2001 by
              
              
                
                
                <a href="#author-bio-steve-lidie">Steve Lidie</a>
              
              </p>
              <img alt="" src=""/>
                

<p>As it happens, no matter how much I write about Perl/Tk, there&rsquo;s always something left unsaid. A case in point is the topic of drag and drop, which didn&rsquo;t make it into our book, <em>Mastering Perl/Tk</em>.</p>

<p>This article describes the Perl/Tk drag-and-drop mechanism, often referred to as DND. We&rsquo;ll illustrate DND operations local to a single application, where we drag items from one Canvas to another.</p>

<p>There are two basic types of DND operations, local (intra-application) and remote (inter-application). Local drops are fully supported, but there is no standard for remote drops. For this reason, this article describes only local DND operations. Note: Perl/Tk supports Sun, XDND, KDE, and Win32 remote DND protocols.</p>

<p>To write DND code you should be comfortable with these concepts:</p>

<ol>
<li>The drag source is the widget that we drag. In the case of a Canvas widget, we can arrange for an individual item to be the drag source.</li>
<li>The drop destination is the widget upon which we drop the source widget.</li>
<li>The DND token is a <code>Label</code> widget that tracks the cursor as it moves from the drag source to the drop destination. We can configure the DND token with a text string or an image.</li>
</ol>

<p><img src="/images/_pub_2001_12_11_perltk/drag.jpg" alt="" /></p>

<p>This figure shows what we will end up with&ndash;one Canvas populated by various types of objects, which we can drag around the application and drop onto another Canvas. Let&rsquo;s now look at the code.</p>

<p>Here we have a rather typical Perl/Tk prologue. <code>Tk::DragDrop</code> is required if coding a program with a drag source, while <code>Tk::DropSite</code> is required for programs declaring a drop destination.</p>

<pre><code>    use Tk;
    use strict;
    use Tk::DragDrop;
    use Tk::DropSite;
    use subs qw/make_bindings move_bbox move_image/;
</code></pre>

<h3 id="global-variables">Global variables</h3>

<p>A drag begins with a <code>&lt;ButtonPress-1&gt;</code> event, where we record the ID of the specified Canvas item in the variable <code>$drag_id</code>. <code>$mw</code> is, of course, a reference to the program&rsquo;s MainWindow.</p>

<pre><code>    our (
         $drag_id,              # Canvas item id of drag source
         $mw,                   # Perl/Tk MainWindow reference
    );

$mw = MainWindow-&gt;new(-background =&gt; 'green');
</code></pre>

<p>Define the drag source&ndash;a Canvas full of items. Here we declare that a <code>&lt;B1-Motion&gt;</code> event over the source Canvas signals the start of a local drag operation.</p>

<p><code>$drag_source</code> is a <code>Tk::DragDrop</code> object, sometimes called a DND token. It&rsquo;s really a disguised <code>Label</code> widget, which we can configure in the standard fashion. For our purposes, we set the <code>-text</code> option to describe the <code>Canvas</code> item we are dragging, rather than the default text of the source widget&rsquo;s class name. But you can assign an image to the DND token if desired.</p>

<p>When performing a DND operation, notice that the DND token has a flat relief over the source, and a sunken relief over the destination.</p>

<pre><code>    my $c_src = $mw-&gt;Canvas(qw/-background yellow/)-&gt;pack;

    my $drag_source = $c_src-&gt;DragDrop(
        -event     =&gt; '&lt;B1-Motion&gt;',
        -sitetypes =&gt; [qw/Local/],
    );
</code></pre>

<p>Every <code>Canvas</code> source item has a <code>&lt;ButtonPress-1&gt;</code> binding associated with it. The callback bound to this event serves to record the item&rsquo;s ID in the global variable <code>$drag_id</code>, and to configure the drag <code>Label</code>&rsquo;s <code>-text</code>/ option with the item&rsquo;s ID and type.</p>

<pre><code>    my $press = sub {
        my ($c_src, $c_src_id, $drag_source) = @_;
        $drag_id = $c_src_id;
        my $type = $c_src-&gt;type($drag_id);
        $drag_source-&gt;configure(-text =&gt; $c_src_id . &quot; = $type&quot;);
    };
</code></pre>

<p>OK, let&rsquo;s populate the source Canvas with items of various types. For this demonstration, we limit the choices to ovals, rectangles, and all the GIF files in the current directory. As noted earlier, every item gets a <code>&lt;ButtonPress-1&gt;</code> binding.</p>

<pre><code>    my ($x, $y) = (30, 30);
    foreach (&lt;*.gif&gt;) {

        my $id = $c_src-&gt;createImage($x, $y,
            -image =&gt; $mw-&gt;Photo(-file =&gt; $_));
        $x += 80;
        $c_src-&gt;bind($id, '&lt;ButtonPress-1&gt;' =&gt; [$press, $id, $drag_source]);

    } # forend

    $x = 30;
    $y = 80;

    foreach (qw/oval rectangle/) {

        my $method = 'create' . ucfirst $_;
        my $id = $c_src-&gt;$method($x, $y, $x + 40, $y + 40, -fill =&gt; 'orange');
        $x += 80;
        $c_src-&gt;bind($id, '&lt;ButtonPress-1&gt;' =&gt; [$press, $id, $drag_source]);

    } # forend
</code></pre>

<p>Define the drop-site destination&ndash;another <code>Canvas</code>. As a source <code>Canvas</code> item is dropped here, create an identical item in the destination at the drop coordinates.</p>

<pre><code>    my $c_dest = $mw-&gt;Canvas(qw/-background cyan/)-&gt;pack;
    $c_dest-&gt;DropSite(
        -droptypes   =&gt; [qw/Local/],
        -dropcommand =&gt; [\&amp;move_items, $c_src, $c_dest],
    );
</code></pre>

<p>Build the obligatory Quit Button, and enter the main event loop.</p>

<pre><code>    my $quit = $mw-&gt;Button(-text =&gt; 'Quit', -command =&gt; [$mw =&gt; 'destroy']);
    $quit-&gt;pack;

    MainLoop;
</code></pre>

<p>These subroutines are invoked when a <code>Canvas</code> source item is dropped on the destination <code>Canvas</code>. Callback &ldquo;<code>move_items</code>&rdquo; is invoked first, with these arguments:</p>

<blockquote>
<pre><code>$c_src  = source Canvas widget reference
$c_dest = destination Canvas widget reference
$sel    = selection type, here &quot;XdndSelection&quot;
$dest_x = Canvas drop site X coordinate
$dest_y = Canvas drop site Y coordinate
</code></pre>
</blockquote>

<p>The first two arguments we supplied on the <code>-dropcommand</code> option. The remaining arguments are implicitly supplied by Perl/Tk.</p>

<p>&ldquo;<code>move_items</code>&rdquo; simply branches according to the item&rsquo;s type, throwing an error for <code>Canvas</code> items we are not prepared to handle. Each type handler receives the preceding arguments plus the item&rsquo;s type.</p>

<pre><code>    sub move_items {

        $_ = $_[0]-&gt;type($drag_id);
        return unless defined $_;

      CASE: {

        /image/      and do {move_image $_, @_; last CASE};
        /oval/       and do {move_bbox  $_, @_; last CASE};
        /rectangle/  and do {move_bbox  $_, @_; last CASE};
        warn &quot;Unknown Canvas item type '$_'.&quot;;

      }# casend

    } # end move_items
</code></pre>

<p>Subroutine &ldquo;<code>move_bbox</code>&rdquo; handles all <code>Canvas</code> item types described by a bounding box. (For this demonstration, we only propagate the <code>-fill</code> attribute from the <code>Canvas</code> source item to the new item.) It uses the subroutine &ldquo;<code>make_bindings</code>&rdquo; given below to establish local bindings on the newly created destination item, so it can be dragged about the destination Canvas.</p>

<pre><code>    sub move_bbox {

        my ($item_type, $c_src, $c_dest, $sel, $dest_x, $dest_y) = @_;

        my $fill = $c_src-&gt;itemcget($drag_id, -fill);
        my $method = 'create' . ucfirst $item_type;
        my $id = $c_dest-&gt;$method($dest_x, $dest_y,
            $dest_x + 40, $dest_y + 40, -fill =&gt; $fill,
        );

        make_bindings $c_dest, $id;

    } # end move_bbox
</code></pre>

<p>Subroutine &ldquo;<code>move_image</code>&rdquo; handles a <code>Canvas</code> image item type. It uses the &ldquo;<code>make_bindings</code>&rdquo; subroutine just described.</p>

<pre><code>    sub move_image {

        my ($item_type, $c_src, $c_dest, $sel, $dest_x, $dest_y) = @_;

        my $image = $c_src-&gt;itemcget($drag_id, -image);
        my $id = $c_dest-&gt;createImage($dest_x, $dest_y, -image =&gt; $image);

        make_bindings $c_dest, $id;

    } # end move_image
</code></pre>

<p>&ldquo;<code>make_bindings</code>&rdquo; itself adds drag behavior to our newly dropped <code>Canvas</code> items, but without using the DND mechanism. The basic idea is as follows:</p>

<ul>
<li>On a <code>&lt;ButtonPress-1&gt;</code> event, record the <code>Canvas</code> item&rsquo;s (x,y) coordinates in instance variables of the form <code>&quot;x&quot; . $id</code> and <code>&quot;y&quot; . $id</code>, where <code>$id</code> is the item&rsquo;s <code>Canvas</code> ID. This ensures that each item&rsquo;s position is uniquely maintained.</li>
<li>On a <code>&lt;ButtonRelease-1&gt;</code> event, compute an (x,y) delta from the item&rsquo;s original position (stored in instance variables) and the new position, and use the <code>Canvas</code> &ldquo;<code>move</code>&rdquo; method to relocate it.</li>
</ul>

<!-- -->

<pre><code>    sub make_bindings {

        my ($c_dest, $id) = @_;

        $c_dest-&gt;bind($id, '&lt;ButtonPress-1&gt;' =&gt; [sub {
        my ($c, $id) = @_;
        ($c_dest-&gt;{'x' . $id}, $c_dest-&gt;{'y' . $id}) =
            ($Tk::event-&gt;x, $Tk::event-&gt;y);
        }, $id]);

        $c_dest-&gt;bind($id, '$lt;ButtonRelease-1&gt;' =&gt; [sub {
        my ($c, $id) = @_;
        my($x, $y) = ($Tk::event-&gt;x, $Tk::event-&gt;y);
        $c-&gt;move($id, $x - $c_dest-&gt;{'x' . $id}, $y - $c_dest-&gt;{'y' . $id});
        }, $id]);

    } # end make_bindings
</code></pre>

<p>The entire source code to this program is available <a href="/media/_pub_2001_12_11_perltk/drag.pl">here</a>, and for more information about Perl/Tk programming, check out <a href="http://www.oreilly.com/catalog/mastperltk/">Mastering Perl/Tk</a>.</p>

<hr />

<p>O&rsquo;Reilly &amp; Associates will soon release (January 2002) <a href="http://www.oreilly.com/catalog/mastperltk/">Mastering Perl/Tk</a>.</p>

<ul>
<li><p>You can also look at the <a href="http://oreilly.com/catalog/mastperltk/desc.html">Full Description</a> of the book.</p></li>

<li><p>For more information, or to order the book, <a href="http://www.oreilly.com/catalog/mastperltk/">click here</a>.</p></li>
</ul>

              </article>
              <p><strong>Tags</strong></p>
              <div class="tags">
                <div class="category"><a href="/categories/graphics">graphics</a></div>
                
                  <div class="tag"><a href="/tags/drag-drop-tk">drag-drop-tk</a></div>
                
                  <div class="tag"><a href="/tags/perl">perl</a></div>
                
                  <div class="tag"><a href="/tags/perl-tk">perl-tk</a></div>
                
              </div>
            </div>
            
              
                
<div class="row" id="author-bio-steve-lidie">
  <div class="col-sm-2">
    
    <a href="/authors/steve-lidie/"><div class="circle-avatar" style="background-image:url(/images/site/avatar.png)"></div></a>
  </div>
  <div class="col-sm-10">
    <a href="/authors/steve-lidie/"><h3>Steve Lidie</h3></a>
    <p></p>
    <h5><a href="/authors/steve-lidie/">Browse their articles</a></h5>
  </div>
</div>

            
            <div class="row">
              <h3>Feedback</h3>
              <p>Something wrong with this article? Help us out by opening an issue or pull request on <a href="https://github.com/tpf/perldotcom/blob/master/content/legacy/_pub_2001_12_11_perltk.md">GitHub</a></p>
            </div>
          </div>
          <div class="col-md-3">
            <div class="latest-sidebar">

  <div class="row">
    <div class="col-sm-12 centering">
      <span style="font-size:1.8em" class="antonio txt-blue-major">OUR LATEST ARTICLES</span>
    </div>
  </div>
  
    
    
    <div class="row">
        <a href="http://localhost:1313/article/the-perl-admbassador-curtis-poe/">
      <div class="col-sm-3">
        <div class="circle-avatar" style="background-image:url(/images/the-perl-ambassador-curtis-poe/curtis-poe.jpg)"></div>
      </div>
      <div class="col-sm-9">
          <h6>The Perl Ambassador: Curtis &#39;Ovid&#39; Poe</h6>
          <p style="line-height:1"><small>The person behind the news of Perl</small></p>
      </div>
        </a>
    </div>
  
    
    
    <div class="row">
        <a href="http://localhost:1313/article/a-tour-with-net-ftp/">
      <div class="col-sm-3">
        <div class="circle-avatar" style="background-image:url(/images/a-tour-with-net-ftp/thumb_kidyes.jpg)"></div>
      </div>
      <div class="col-sm-9">
          <h6>A tour with Net::FTP</h6>
          <p style="line-height:1"><small>How to write an FTP client in Perl</small></p>
      </div>
        </a>
    </div>
  
    
    
    <div class="row">
        <a href="http://localhost:1313/article/shortcode_test/">
      <div class="col-sm-3">
        <div class="circle-avatar" style="background-image:url(/images/author/brian-d-foy.jpg)"></div>
      </div>
      <div class="col-sm-9">
          <h6>shortcode_test</h6>
          <p style="line-height:1"><small></small></p>
      </div>
        </a>
    </div>
  
    
    
    <div class="row">
        <a href="http://localhost:1313/article/listen-to-larry-wall-s-state-of-the-onion-2000-on-youtube/">
      <div class="col-sm-3">
        <div class="circle-avatar" style="background-image:url(/images/listen-to-larry-wall-s-state-of-the-onion-2000-on-youtube/thumb_larry-wall.jpg)"></div>
      </div>
      <div class="col-sm-9">
          <h6>Listen to Larry Wall&#39;s State of the Onion 2000 on YouTube</h6>
          <p style="line-height:1"><small></small></p>
      </div>
        </a>
    </div>
  
    
    
    <div class="row">
        <a href="http://localhost:1313/article/announcing-perl-7/">
      <div class="col-sm-3">
        <div class="circle-avatar" style="background-image:url(/images/announcing-perl-7/thumb_seven_on_blue_wall.jpg)"></div>
      </div>
      <div class="col-sm-9">
          <h6>Announcing Perl 7</h6>
          <p style="line-height:1"><small>Perl 5 with modern defaults</small></p>
      </div>
        </a>
    </div>
  
</div>
<div class="row" style="margin-top:20px">
  <div class="col-sm-12 centering">
  <script async src="/widget/toplinks/toplinks.js" type="text/javascript"></script>
    <div id="toplinks"></div>
  </div>
</div>

<div class="row" style="margin-top:20px">
  <div class="col-sm-12 centering">
    <a class="twitter-timeline" data-height="640" data-dnt="true" data-theme="dark" href="https://twitter.com/perlfoundation?ref_src=twsrc%5Etfw">Tweets by perlfoundation</a> <script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>
  </div>
</div>

<div class="row" style="margin-top:20px">
  <div class="col-sm-12 centering">
    <script src="https://www.reddit.com/r/perl/hot/.embed?limit=10&t=all" type="text/javascript"></script>
  </div>
</div>



          </div>
        </div>
      </div>
    </section>
  </section>
<script>
 
var tables, i;
tables = document.getElementsByTagName('table');
for (i=0;i<tables.length;i++) {
  tables[i].className = 'table table-striped';
}
</script>
<div class="push"></div>
<div class="footer">
  <div class="container">
    <div class="row">
      <div class="col-md-1">
        <h5>Site Map</h5>
        <ul>
        <li><a href="/">Home</a></li>
        <hr>
        <li><a href="/about">About</a></li>
        <hr>
        <li><a href="/authors">Authors</a></li>
        <hr>
        <li><a href="/categories">Categories</a></li>
        <hr>
        <li><a href="/tags">Tags</a></li>
        <hr>
        </ul>
      </div>
      <div class="col-md-3">
        <h5>Contact Us</h5>
        <p>To get in touch, send an email to: perl.com-editor@perl.org</p>
        <p><a href="https://perl.org">
              <img src="/images/site/perl-onion_20.png" alt="Perl Onion"></a>
          <a href="https://twitter.com/intent/follow?screen_name=perlfoundation">
              <img src="/images/site/twitter_20.png" alt="twitter"></a>
          <a href="/index.xml" /><img src="/images/site/rss_20.png" alt="rss"></a>
          <a href="https://github.com/tpf/perldotcom">
              <img src="/images/site/github_light_20.png" alt="GitHub logo"></a></p>
      </div>
      <div class="col-md-2">
          <h5>License</h5>
          <p>This work is licensed under a <a rel="license" href="https://creativecommons.org/licenses/by-nc/3.0/">Creative Commons Attribution-NonCommercial 3.0 Unported License</a>.</p>
          <p><a rel="license" href="https://creativecommons.org/licenses/by-nc/3.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc/3.0/88x31.png" /></a></p>
      </div>
      <div class="col-md-5">
          <h5>Legal</h5>
          <p>Perl.com and the authors make no representations with respect to the accuracy or completeness of the contents of all work on this website and specifically disclaim all warranties, including without limitation warranties of fitness for a particular purpose. The information published on this website may not be suitable for every situation. All work on this website is provided with the understanding that Perl.com and the authors are not engaged in rendering professional services. Neither Perl.com nor the authors shall be liable for damages arising herefrom.</p>
      </div>
    </div>
  </div>
</div>
<script src="/javascript/jquery.min.js"></script>
<script src="/javascript/bootstrap.min.js"></script>
<script data-no-instant>document.write('<script src="/livereload.js?port=1313&mindelay=10"></' + 'script>')</script></body>
</html>

