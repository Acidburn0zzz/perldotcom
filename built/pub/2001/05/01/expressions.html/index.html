<!DOCTYPE html>
<html lang="en-us">
  <head>
  <title> Reversing Regular Expressions </title>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content=" Regular Expressions are arguably one of Perl&#39;s most useful and powerful tools. The ability to match complex strings is one of the things that makes Perl the effective &#34;Practical Extraction and Reporting Language&#34; that it is. The regular expression..."/>
  <meta name="robots" content="index, follow">
  <meta name="google-site-verification" content="TZowffo_LX2mmsw2DbeNNbukCMnIOA8T-6CMJPiYllI" />

<meta property="twitter:card" content="summary">
<meta property="twitter:site" content="@PerlFoundation">
<meta property="og:url" content="http://localhost:1313/pub/2001/05/01/expressions.html/" />
<meta property="og:title" content="Reversing Regular Expressions" />
<meta property="og:description" content=" Regular Expressions are arguably one of Perl&#39;s most useful and powerful tools. The ability to match complex strings is one of the things that makes Perl the effective &#34;Practical Extraction and Reporting Language&#34; that it is. The regular expression...">
<meta property="og:site_name" content="Perl.com" />

<meta property="og:type" content="article" />
<meta property="og:article:published_time" content="2001-05-05T05:05:05Z" />
<meta property="og:image" content="http://localhost:1313/images/author/pete-sergeant.jpg" />


  <link rel="icon" href="/favicon.ico">
  <link href="/article/index.xml" rel="alternate" type="application/rss+xml" title="Perl.com - programming news, code and culture" />
  <link href="/article/index.xml" rel="feed" type="application/rss+xml" title="Perl.com - programming news, code and culture" />
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" type="text/css" href="/css/perldotcom.css"/>


<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-50555-22', 'auto');
ga('create', 'UA-85734801-2', 'auto', 'editor');
ga('send', 'pageview');
ga('editor.send', 'pageview');
</script>

</head>
<body>

<div class="container-fluid full-wdith antonio">
 <div class="row">
  <div class="navbar-inverse" style="border-radius:none !important" role="navigation">
    <div class="container-fluid">
      <ul class="nav navbar-nav pull-right follow">
          <li>MORE:</li>
          <li><a href="https://perl.org">
              <img src="/images/site/perl-onion_20.png" alt="Perl Onion"></a><li>
          <li><a href="https://twitter.com/intent/follow?screen_name=perlfoundation">
              <img src="/images/site/twitter_20.png" alt="twitter"></a><li>
          <li><a href="/article/index.xml" />
              <img src="/images/site/rss_20.png" alt="rss"></a></li>
          <li><a href="https://github.com/tpf/perldotcom" />
              <img src="/images/site/github_light_20.png" alt="GitHub logo"></a></li>
      </ul>
      <div class="navbar-header">
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
          <a class="navbar-nav" href="/">
            <div class="header-logo">Perl.com</div>
          </a>
      </div>
      <div class="navbar-collapse collapse">
        <ul class="nav navbar-nav">
          <li><a href="/about">
              <div class="circle">
                <img src="/images/site/perl-camel.png" alt="" />
              </div>
                  &nbsp;&nbsp;ABOUT</a>
          </li>
          <li><a href="/authors">
              <div class="circle">
                  <span class="glyphicon glyphicon-user txt-blue-major" aria-hidden="true"></span>
              </div>
                  &nbsp;&nbsp;AUTHORS</a>
          </li>
          <li><a href="/categories">
              <div class="circle">
                  <span class="glyphicon glyphicon-folder-open txt-blue-major" aria-hidden="true"></span>
              </div>
                  &nbsp;&nbsp;CATEGORIES</a>
          </li>
          <li><a href="/tags">
              <div class="circle">
                <span class="txt-blue-major" aria-hidden="true"><strong>#</strong></span>
              </div>
                  &nbsp;&nbsp;TAGS</a>
          </li>
          <li>
            <form class="search" name="ddg" action="https://duckduckgo.com/" method="get">
              <input type="text" name ="q" placeholder="SEARCH" />
              <input type="hidden" value="perl.com" name="sites" />
            </form>
          </li>
        </ul>
      </div>
    </div>
  </div>
 </div>
</div>


  <section id="content" role="main">
    <section class="entry-content">
      <div class="container">
        <div class="row">
          <div class="col-md-9">
            <div class="row">
              <article class="fulltext">
              <h1 class="blog-post-title">Reversing Regular Expressions</h1>
              <p class="blog-post-meta">May 1, 2001 by
              
              
                
                
                <a href="#author-bio-pete-sergeant">Pete Sergeant</a>
              
              </p>
              <img alt="" src=""/>
                <p>Regular Expressions are arguably one of Perl&rsquo;s most useful and powerful tools. The ability to match complex strings is one of the things that makes Perl the effective &ldquo;Practical Extraction and Reporting Language&rdquo; that it is. The regular expression engine is highly optimised and thus very fast, although in some situations people fail to use it in the most effective manner.</p>

<p>For example, imagine a case where you have a collection of very long lines from a log file, that each have a four digit year (starting with 19) somewhere near the end.</p>

<p>One would normally say something like:</p>

<pre><code># Match any occurrence of 19xx that's not followed by another one
if ($string =~ /(19\d\d)(?!.*19\d\d)/) {$date = $1}

or, better:

if ($string =~ /.*(19\d\d)/) {$date = $1}
</code></pre>

<p>However, in this situation, the regular expression engine has to go through all the string, remembering any matches it finds and discarding them any time it finds a new match, until it reaches the end of the string. If you have long log lines, this can be highly inefficient, and comparatively slow. But is there another way to do it? (Hint: With Perl, There&rsquo;s Always More Than One Way To Do It)</p>

<p>Unless you&rsquo;re a regular on IRC or <a href="http://www.perlmonks.com">perlmonks.com</a>, or attended <a href="http://yapc.org/Europe/">YAPC::Europe</a>, it&rsquo;s quite possible that you&rsquo;ve never heard of (a) Jeff Pinyan (aka Japhy) and (b) his simple and elegant solution to getting around this problem. He dubbed these solutions reversed regular expressions, or sexeger.</p>

<p>Instead of going through the whole string looking for the last match, wouldn&rsquo;t it be a better idea to work from the back of the string and take the first match that is found? At the moment, Perl doesn&rsquo;t provide a built in method for doing this, but it&rsquo;s surprisingly easy to emulate one. To quote the lightning talk Mr Pinyan wrote for me to give at YAPC::E &ldquo;Reverse the input! Reverse the regex! Reverse the match!&rdquo;.</p>

<p>And so that&rsquo;s exactly what we&rsquo;ll do:</p>

<pre><code>sub get_date {
    $_ = scalar reverse($_[0]); # Reverse whatever string we were passed
    /(\d\d91)/;                 # Look for the first occurrence of a xx91 (19xx reversed)
    return scalar reverse $1;   # Reverse back whatever we found and return it
}
</code></pre>

<p>Obviously, we&rsquo;re performing two more functions in this example, two calls of reverse. Reverse however appears to be very efficient, and in benchmarks that were run (details below), this seemed not to be a problem. To test if this really would be significantly faster, I used a 10,000 character string, and ran the regex 10000 times on it. Here&rsquo;s the code used to test it:</p>

<pre><code>$la = [our 10000 character string]
...
use Benchmark;
$t = timeit(&quot;10000&quot;,  sub { $_ = $la; /.*(19\d\d)/; });
print &quot;Greedy took:&quot;,timestr($t), &quot;\n&quot;;
$t = timeit(&quot;10000&quot;,  sub { $_ = $la; /(19\d\d)(?!.*19\d\d)/;});
print &quot;Lookahead took:&quot;,timestr($t), &quot;\n&quot;;
$t = timeit(&quot;10000&quot;,  sub { $_ = reverse($la); /(\d\d91)/;  });
print &quot;Sexeger took:&quot;,timestr($t), &quot;\n&quot;;
</code></pre>

<p>The first example, with its look ahead assertion, took four hundred seconds, as the look ahead assertion is a major time sink. The second example took 1.5 seconds. The reversed method managed however to shave three quarters of a second off that, and become 0.75 seconds. To summarise:</p>

<table>
<thead>
<tr>
<th>Method</th>
<th>Time</th>
</tr>
</thead>

<tbody>
<tr>
<td><code>/(19\d\d)(?!.*19\d\d)/</code></td>
<td>400</td>
</tr>

<tr>
<td><code>/.*(19\d\d)/</code></td>
<td>1.5</td>
</tr>

<tr>
<td>sexeger</td>
<td>0.75</td>
</tr>
</tbody>
</table>

<p>However, performance gains are not the only good use for reversed regular expression, as one can also use them to solve a few other common problems that Perl doesn&rsquo;t handle easily. If you&rsquo;ve all read the Frequently Asked Questions included with Perl, which I&rsquo;m <strong>sure</strong> you have, then you&rsquo;ll have seen a particularly good example in Section 5 (perldoc perlfaq5) by Andrew Johnson - &ldquo;How can I output my numbers with commas added?&rdquo;.</p>

<pre><code>sub commify {
my $input = shift;
$input = reverse $input;
$input =~ s&lt;(\d\d\d)(?=\d)(?!\d*\.)&gt;&lt;$1,&gt;g;
return scalar reverse $input;
}
</code></pre>

<p>One of my personal favourite regex tools is zero-width look ahead assertions, as in the very first example (it&rsquo;s worth noting that that&rsquo;s a <strong>negative</strong> zero-width look ahead assertion). For people who haven&rsquo;t scoured <em>perldoc perlre</em>, this allows you to state that a pattern has to exist in front of your position, without actually matching it. Perhaps an example would help illustrate: <code>/ab(?=.+e)cd/</code> will match <code>&quot;abcde&quot;</code> but not <code>&quot;abecd&quot;</code> or <code>&quot;abcd&quot;</code>. Sadly, it&rsquo;s not possible to do variable length zero-width look behind assertions with the current Regular Expression Engine. However, if we apply sexeger principles to it, as suggested by Anthony Guselnikov, it suddenly becomes easy. If we want to match the string <code>&quot;def&quot;</code>, as long as it was preceded by the letter &lsquo;a&rsquo;, we can say:</p>

<pre><code>sub nlba {
$_ = scalar reverse $_[0];
print &quot;Success\n&quot; if /fed(?=.*a)/;
}
</code></pre>

<p>Reversing Regular Expressions is a powerful and effective tool in any programmers arsenal. I hope that I&rsquo;ve managed to illustrate the utility that this simple and elegant solution offers. Some overhead in programmer time, and in processing time is required to use them, and so I&rsquo;d suggest that you evaluate using them on a case by case basis.</p>

<p>For more information, visit the homepage at <a href="http://www.pobox.com/~japhy/sexeger">http://www.pobox.com/~japhy/sexeg er</a></p>

              </article>
              <p><strong>Tags</strong></p>
              <div class="tags">
                <div class="category"><a href="/categories/development">development</a></div>
                
              </div>
            </div>
            
              
                
<div class="row" id="author-bio-pete-sergeant">
  <div class="col-sm-2">
    
    <a href="/authors/pete-sergeant/"><div class="circle-avatar" style="background-image:url(/images/author/pete-sergeant.jpg)"></div></a>
  </div>
  <div class="col-sm-10">
    <a href="/authors/pete-sergeant/"><h3>Pete Sergeant</h3></a>
    <p>Pete is a CPAN <a href="https://metacpan.org/author/SARGIE">author</a> &amp; contributor. He also runs <a href="https://perl.careers">Perl Jobs by Perl Careers</a>.</p>
    <h5><a href="/authors/pete-sergeant/">Browse their articles</a></h5>
  </div>
</div>

            
            <div class="row">
              <h3>Feedback</h3>
              <p>Something wrong with this article? Help us out by opening an issue or pull request on <a href="https://github.com/tpf/perldotcom/blob/master/content/legacy/_pub_2001_05_01_expressions.md">GitHub</a></p>
            </div>
          </div>
          <div class="col-md-3">
            <div class="latest-sidebar">

  <div class="row">
    <div class="col-sm-12 centering">
      <span style="font-size:1.8em" class="antonio txt-blue-major">OUR LATEST ARTICLES</span>
    </div>
  </div>
  
    
    
    <div class="row">
        <a href="http://localhost:1313/article/the-perl-admbassador-curtis-poe/">
      <div class="col-sm-3">
        <div class="circle-avatar" style="background-image:url(/images/the-perl-ambassador-curtis-poe/curtis-poe.jpg)"></div>
      </div>
      <div class="col-sm-9">
          <h6>The Perl Ambassador: Curtis &#39;Ovid&#39; Poe</h6>
          <p style="line-height:1"><small>The person behind the news of Perl</small></p>
      </div>
        </a>
    </div>
  
    
    
    <div class="row">
        <a href="http://localhost:1313/article/a-tour-with-net-ftp/">
      <div class="col-sm-3">
        <div class="circle-avatar" style="background-image:url(/images/a-tour-with-net-ftp/thumb_kidyes.jpg)"></div>
      </div>
      <div class="col-sm-9">
          <h6>A tour with Net::FTP</h6>
          <p style="line-height:1"><small>How to write an FTP client in Perl</small></p>
      </div>
        </a>
    </div>
  
    
    
    <div class="row">
        <a href="http://localhost:1313/article/shortcode_test/">
      <div class="col-sm-3">
        <div class="circle-avatar" style="background-image:url(/images/author/brian-d-foy.jpg)"></div>
      </div>
      <div class="col-sm-9">
          <h6>shortcode_test</h6>
          <p style="line-height:1"><small></small></p>
      </div>
        </a>
    </div>
  
    
    
    <div class="row">
        <a href="http://localhost:1313/article/listen-to-larry-wall-s-state-of-the-onion-2000-on-youtube/">
      <div class="col-sm-3">
        <div class="circle-avatar" style="background-image:url(/images/listen-to-larry-wall-s-state-of-the-onion-2000-on-youtube/thumb_larry-wall.jpg)"></div>
      </div>
      <div class="col-sm-9">
          <h6>Listen to Larry Wall&#39;s State of the Onion 2000 on YouTube</h6>
          <p style="line-height:1"><small></small></p>
      </div>
        </a>
    </div>
  
    
    
    <div class="row">
        <a href="http://localhost:1313/article/announcing-perl-7/">
      <div class="col-sm-3">
        <div class="circle-avatar" style="background-image:url(/images/announcing-perl-7/thumb_seven_on_blue_wall.jpg)"></div>
      </div>
      <div class="col-sm-9">
          <h6>Announcing Perl 7</h6>
          <p style="line-height:1"><small>Perl 5 with modern defaults</small></p>
      </div>
        </a>
    </div>
  
</div>
<div class="row" style="margin-top:20px">
  <div class="col-sm-12 centering">
  <script async src="/widget/toplinks/toplinks.js" type="text/javascript"></script>
    <div id="toplinks"></div>
  </div>
</div>

<div class="row" style="margin-top:20px">
  <div class="col-sm-12 centering">
    <a class="twitter-timeline" data-height="640" data-dnt="true" data-theme="dark" href="https://twitter.com/perlfoundation?ref_src=twsrc%5Etfw">Tweets by perlfoundation</a> <script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>
  </div>
</div>

<div class="row" style="margin-top:20px">
  <div class="col-sm-12 centering">
    <script src="https://www.reddit.com/r/perl/hot/.embed?limit=10&t=all" type="text/javascript"></script>
  </div>
</div>



          </div>
        </div>
      </div>
    </section>
  </section>
<script>
 
var tables, i;
tables = document.getElementsByTagName('table');
for (i=0;i<tables.length;i++) {
  tables[i].className = 'table table-striped';
}
</script>
<div class="push"></div>
<div class="footer">
  <div class="container">
    <div class="row">
      <div class="col-md-1">
        <h5>Site Map</h5>
        <ul>
        <li><a href="/">Home</a></li>
        <hr>
        <li><a href="/about">About</a></li>
        <hr>
        <li><a href="/authors">Authors</a></li>
        <hr>
        <li><a href="/categories">Categories</a></li>
        <hr>
        <li><a href="/tags">Tags</a></li>
        <hr>
        </ul>
      </div>
      <div class="col-md-3">
        <h5>Contact Us</h5>
        <p>To get in touch, send an email to: perl.com-editor@perl.org</p>
        <p><a href="https://perl.org">
              <img src="/images/site/perl-onion_20.png" alt="Perl Onion"></a>
          <a href="https://twitter.com/intent/follow?screen_name=perlfoundation">
              <img src="/images/site/twitter_20.png" alt="twitter"></a>
          <a href="/index.xml" /><img src="/images/site/rss_20.png" alt="rss"></a>
          <a href="https://github.com/tpf/perldotcom">
              <img src="/images/site/github_light_20.png" alt="GitHub logo"></a></p>
      </div>
      <div class="col-md-2">
          <h5>License</h5>
          <p>This work is licensed under a <a rel="license" href="https://creativecommons.org/licenses/by-nc/3.0/">Creative Commons Attribution-NonCommercial 3.0 Unported License</a>.</p>
          <p><a rel="license" href="https://creativecommons.org/licenses/by-nc/3.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc/3.0/88x31.png" /></a></p>
      </div>
      <div class="col-md-5">
          <h5>Legal</h5>
          <p>Perl.com and the authors make no representations with respect to the accuracy or completeness of the contents of all work on this website and specifically disclaim all warranties, including without limitation warranties of fitness for a particular purpose. The information published on this website may not be suitable for every situation. All work on this website is provided with the understanding that Perl.com and the authors are not engaged in rendering professional services. Neither Perl.com nor the authors shall be liable for damages arising herefrom.</p>
      </div>
    </div>
  </div>
</div>
<script src="/javascript/jquery.min.js"></script>
<script src="/javascript/bootstrap.min.js"></script>
<script data-no-instant>document.write('<script src="/livereload.js?port=1313&mindelay=10"></' + 'script>')</script></body>
</html>

