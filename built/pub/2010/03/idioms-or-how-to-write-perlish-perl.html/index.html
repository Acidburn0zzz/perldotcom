<!DOCTYPE html>
<html lang="en-us">
  <head>
  <title> Idioms, or How to Write Perlish Perl </title>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Any language&amp;mdash;programming or natural&amp;mdash;develops idioms, or common patterns of expression. The earth revolves, but we speak of the sun rising or setting. We talk of clever hacks and nasty hacks and slinging code. We ping each other on IRC to..."/>
  <meta name="robots" content="index, follow">
  <meta name="google-site-verification" content="TZowffo_LX2mmsw2DbeNNbukCMnIOA8T-6CMJPiYllI" />

<meta property="twitter:card" content="summary">
<meta property="twitter:site" content="@PerlFoundation">
<meta property="og:url" content="http://localhost:1313/pub/2010/03/idioms-or-how-to-write-perlish-perl.html/" />
<meta property="og:title" content="Idioms, or How to Write Perlish Perl" />
<meta property="og:description" content="Any language&amp;mdash;programming or natural&amp;mdash;develops idioms, or common patterns of expression. The earth revolves, but we speak of the sun rising or setting. We talk of clever hacks and nasty hacks and slinging code. We ping each other on IRC to...">
<meta property="og:site_name" content="Perl.com" />

<meta property="og:type" content="article" />
<meta property="og:article:published_time" content="2010-03-03T03:03:03Z" />
<meta property="og:image" content="http://localhost:1313/images/author/chromatic.jpg" />
<meta property="og:article:tag" content="idioms" />
<meta property="og:article:tag" content="objects" />
<meta property="og:article:tag" content="parameters" />
<meta property="og:article:tag" content="perl-5" />
<meta property="og:article:tag" content="perl-programming" />
<meta property="og:article:tag" content="schwartzian-transform" />


  <link rel="icon" href="/favicon.ico">
  <link href="/article/index.xml" rel="alternate" type="application/rss+xml" title="Perl.com - programming news, code and culture" />
  <link href="/article/index.xml" rel="feed" type="application/rss+xml" title="Perl.com - programming news, code and culture" />
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" type="text/css" href="/css/perldotcom.css"/>


<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-50555-22', 'auto');
ga('create', 'UA-85734801-2', 'auto', 'editor');
ga('send', 'pageview');
ga('editor.send', 'pageview');
</script>

</head>
<body>

<div class="container-fluid full-wdith antonio">
 <div class="row">
  <div class="navbar-inverse" style="border-radius:none !important" role="navigation">
    <div class="container-fluid">
      <ul class="nav navbar-nav pull-right follow">
          <li>MORE:</li>
          <li><a href="https://perl.org">
              <img src="/images/site/perl-onion_20.png" alt="Perl Onion"></a><li>
          <li><a href="https://twitter.com/intent/follow?screen_name=perlfoundation">
              <img src="/images/site/twitter_20.png" alt="twitter"></a><li>
          <li><a href="/article/index.xml" />
              <img src="/images/site/rss_20.png" alt="rss"></a></li>
          <li><a href="https://github.com/tpf/perldotcom" />
              <img src="/images/site/github_light_20.png" alt="GitHub logo"></a></li>
      </ul>
      <div class="navbar-header">
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
          <a class="navbar-nav" href="/">
            <div class="header-logo">Perl.com</div>
          </a>
      </div>
      <div class="navbar-collapse collapse">
        <ul class="nav navbar-nav">
          <li><a href="/about">
              <div class="circle">
                <img src="/images/site/perl-camel.png" alt="" />
              </div>
                  &nbsp;&nbsp;ABOUT</a>
          </li>
          <li><a href="/authors">
              <div class="circle">
                  <span class="glyphicon glyphicon-user txt-blue-major" aria-hidden="true"></span>
              </div>
                  &nbsp;&nbsp;AUTHORS</a>
          </li>
          <li><a href="/categories">
              <div class="circle">
                  <span class="glyphicon glyphicon-folder-open txt-blue-major" aria-hidden="true"></span>
              </div>
                  &nbsp;&nbsp;CATEGORIES</a>
          </li>
          <li><a href="/tags">
              <div class="circle">
                <span class="txt-blue-major" aria-hidden="true"><strong>#</strong></span>
              </div>
                  &nbsp;&nbsp;TAGS</a>
          </li>
          <li>
            <form class="search" name="ddg" action="https://duckduckgo.com/" method="get">
              <input type="text" name ="q" placeholder="SEARCH" />
              <input type="hidden" value="perl.com" name="sites" />
            </form>
          </li>
        </ul>
      </div>
    </div>
  </div>
 </div>
</div>


  <section id="content" role="main">
    <section class="entry-content">
      <div class="container">
        <div class="row">
          <div class="col-md-9">
            <div class="row">
              <article class="fulltext">
              <h1 class="blog-post-title">Idioms, or How to Write Perlish Perl</h1>
              <p class="blog-post-meta">Mar 16, 2010 by
              
              
                
                
                <a href="#author-bio-chromatic">chromatic</a>
              
              </p>
              <img alt="" src=""/>
                

<p>Any language—programming or natural—develops <em>idioms</em>, or common patterns of expression. The earth revolves, but we speak of the sun rising or setting. We talk of clever hacks and nasty hacks and slinging code. We ping each other on IRC to discuss spaghetti code, and we factor and refactor away the artifacts of copy pasta.</p>

<p>As you learn Perl 5 in more detail, you will begin to see and understand common idioms. They&rsquo;re not quite language features—you don&rsquo;t <em>have</em> to use them—and they&rsquo;re not quite large enough that you can encapsulate them away behind functions and methods. They&rsquo;re something more than habits. They&rsquo;re mannerisms. They&rsquo;re our shared jargon of code. They&rsquo;re ways of writing Perl with a Perlish accent.</p>

<h4 id="the-object-as-self"><strong>The Object as <code>$self</code></strong></h4>

<p><a href="http://learnperl.scratchcomputing.com/tutorials/objects/">Perl 5&rsquo;s object system</a> treats the invocant of a method as a mundane parameter. The invocant of a class method (a string containing the name of the class) is that method&rsquo;s first parameter. The invocant of an object or instance method, the object itself, is that method&rsquo;s first parameter. You are free to use or ignore it as you see fit.</p>

<p>Idiomatic Perl 5 uses <code>$class</code> as the name of the class method and <code>$self</code> for the name of the object invocant. This is a convention not enforced by the language itself, but it is a convention strong enough that useful extensions such as <a href="https://metacpan.org/pod/MooseX::Method::Signatures">MooseX::Method::Signatures</a> assume you will use <code>$self</code> as the name of the invocant by default.</p>

<p>This is true even if you use <a href="http://moose.perl.org/">Moose</a>.</p>

<h4 id="named-parameters"><strong>Named Parameters</strong></h4>

<p>Without a module such as <a href="https://metacpan.org/pod/signatures">signatures</a> or <a href="https://metacpan.org/pod/MooseX::MultiMethods">MooseX::Multimethods</a>, Perl 5&rsquo;s argument passing mechanism is simple: all arguments flatten into a single list accessible through <code>@_</code> (function_parameters). While this simplicity is occasionally too simple—named parameters can be very useful at times—it does not preclude the use of idioms to provide named parameters.</p>

<p>The list context evaluation and assignment of <code>@_</code> allows you to unpack named parameters pairwise. Even though this function call is equivalent to passing a comma-separated or <code>qw//</code>-created list, arranging the arguments as if they were true pairs of keys and values makes the caller-side look like the function supports named parameters:</p>

<pre><code>    make_ice_cream_sundae(
        whipped_cream =&gt; 1,
        sprinkles     =&gt; 1,
        banana        =&gt; 0,
        ice_cream     =&gt; 'mint chocolate chip',
    );
</code></pre>

<p>The callee side can unpack these parameters into a hash and treate the hash as if it were a single argument:</p>

<pre><code>    sub make_ice_cream_sundae
    {
        my %args = @_;

        my $ice_cream = get_ice_cream( $args{ice_cream}) );
        ...
    }
</code></pre>

<p><a href="http://books.google.com/books?id=yMMRnPQ7CSMC">Perl Best Practices</a> suggests passing a hash reference instead. This has one benefit of performing hash construction checking on the caller side, where it&rsquo;s most likely you&rsquo;ll make mistakes and another benefit of minimizing copying and memory use. The former benefit is compelling, if somewhat less common in practice.</p>

<p>This technique works well with <a href="https://perldoc.perl.org/functions/import.html">import()</a>; you can process as many parameters as you like before slurping the remainder into a hash:</p>

<pre><code>    sub import
    {
        my ($class, %args)  = @_;
        my $calling_package = caller();

        ...
    }
</code></pre>

<p>Note how this idiom falls naturally out of list assignment; that makes this idiom Perlish.</p>

<h4 id="the-schwartzian-transform"><strong>The Schwartzian Transform</strong></h4>

<p>People new to Perl sometimes overlook the importance of lists and list processing as a fundamental component of expression evaluation (footnote: People explaining its importance in this fashion do not help). Put more simply, the ability for Perl programmers to chain expressions which evaluate to variable-length lists gives them countless ways to manipulate data effectively.</p>

<p>The <em>Schwartzian transform</em> is an elegant demonstration of that principle as an idiom handily borrowed from the Lisp family of languages. (<a href="http://groups.google.com/group/comp.unix.shell/browse_frm/thread/31da%0A970cebb30c6d?hl=en&amp;pli=1">Randal Schwartz&rsquo;s initial posting of the Schwartzian transform</a> mentions &ldquo;Speak[ing] with a lisp in Perl.&ldquo;)</p>

<p>Suppose you have a Perl hash which associates the names of your co-workers with their phone extensions:</p>

<pre><code>    use 5.010;

    my %extensions =
    (
        1004 =&gt; 'Jerryd',
        1005 =&gt; 'Rudy',
        1006 =&gt; 'Juwan',
        1007 =&gt; 'Brandon',
        1010 =&gt; 'Joel',
        1012 =&gt; 'LaMarcus',
        1021 =&gt; 'Marcus',
        1024 =&gt; 'Andre',
        1023 =&gt; 'Martell',
        1052 =&gt; 'Greg',
        1088 =&gt; 'Nic',
    );
</code></pre>

<p>Suppose you want to print a list of extensions and co-workers sorted by their names, not their extensions. In other words, you need to sort a hash by its keys. Sorting the values of the hash in string order is easy:</p>

<pre><code>    my @sorted_names = sort values %extensions;
</code></pre>

<p>&hellip; but that loses the association of names with extensions. The beauty of the Schwartzian transform is that it solves this problem almost trivially. All you have to do is transform the data before and after sorting it to preserve the necessary information. This is most obvious when explained in multiple steps. First, convert the hash into a list of data structures which contain the vital information in sortable fashion. In this case, converting the hash pairs into two-element anonymous arrays will help:</p>

<pre><code>    my @pairs = map { [ $_, $extensions{$_} ] } keys %extensions;
</code></pre>

<p>Reversing the hash <em>in place</em> would work if no one had the same name. In this case, that is no problem, but defensive coding anticipates data changes.</p>

<p><code>sort</code> gets the list of anonymous arrays and can compare the second elements (the names) with a stringwise comparison:</p>

<pre><code>    my @sorted_pairs = sort { $a-&gt;[1] cmp $b-&gt;[1] } @pairs;
</code></pre>

<p>Given <code>@sorted_pairs</code>, a second <code>map</code> operation can convert the data structure to a more usable form:</p>

<pre><code>    my @formatted_exts = map { &quot;$_-&gt;[1], ext. $_-&gt;[0]&quot; } @sorted_pairs;
</code></pre>

<p>&hellip; and now you can print the whole thing:</p>

<pre><code>    say for @formatted_exts;
</code></pre>

<p>Of course, this uses several temporary variables (with admittedly bad names). It&rsquo;s a worthwhile technique and good to understand, but the real magic is in the combination:</p>

<pre><code>    say for
        map  { &quot; $_-&gt;[1], ext. $_-&gt;[0]&quot;          }
        sort {   $a-&gt;[1] cmp   $b-&gt;[1]           }
        map  { [ $_      =&gt;    $extensions{$_} ] }
            keys %extensions;
</code></pre>

<p>Read the expression from right to left, in the order of evaluation. For each key in the extensions hash, make a two-item anonymous array containing the key and the value from the hash. Sort that list of anonymous arrays by their second elements, the values from the hash. Create a nicely formatted string of output from those sorted arrays.</p>

<p>The Schwartzian transform is this pipeline of <code>map</code>-<code>sort</code>-<code>map</code> where you transform a data structure into another form easier for sorting and then transform it back into your preferred form for modification.</p>

<p>In this case the transformation is relatively simple. Consider the case where calculating the right value to sort is expensive in time or memory, such as calculating a cryptographic hash for a large file. In that case, the Schwartzian transform is also useful because you can perform those expensive operations once (in the rightmost <code>map</code>), compare them repeatedly from a de-facto cache in the <code>sort</code>, and then remove them in the leftmost <code>map</code>.</p>

<p>The original example in the comp.lang.perl.misc shows an effective use of the transform, and a good programming technique in general. When the data you have isn&rsquo;t in the optimal form for what you want to do with it, first transform it into that optimal form, then manipulate it.</p>

<p>Phrased that way, the technique is so obvious as to seem trivial&hellip; but what is an idiom but a brilliant idea made vulgar by its ubiquity?</p>

              </article>
              <p><strong>Tags</strong></p>
              <div class="tags">
                <div class="category"><a href="/categories/development">development</a></div>
                
                  <div class="tag"><a href="/tags/idioms">idioms</a></div>
                
                  <div class="tag"><a href="/tags/objects">objects</a></div>
                
                  <div class="tag"><a href="/tags/parameters">parameters</a></div>
                
                  <div class="tag"><a href="/tags/perl-5">perl-5</a></div>
                
                  <div class="tag"><a href="/tags/perl-programming">perl-programming</a></div>
                
                  <div class="tag"><a href="/tags/schwartzian-transform">schwartzian-transform</a></div>
                
              </div>
            </div>
            
              
                
<div class="row" id="author-bio-chromatic">
  <div class="col-sm-2">
    
    <a href="/authors/chromatic/"><div class="circle-avatar" style="background-image:url(/images/author/chromatic.jpg)"></div></a>
  </div>
  <div class="col-sm-10">
    <a href="/authors/chromatic/"><h3>chromatic</h3></a>
    <p></p>
    <h5><a href="/authors/chromatic/">Browse their articles</a></h5>
  </div>
</div>

            
            <div class="row">
              <h3>Feedback</h3>
              <p>Something wrong with this article? Help us out by opening an issue or pull request on <a href="https://github.com/tpf/perldotcom/blob/master/content/legacy/_pub_2010_03_idioms-or-how-to-write-perlish-perl.md">GitHub</a></p>
            </div>
          </div>
          <div class="col-md-3">
            <div class="latest-sidebar">

  <div class="row">
    <div class="col-sm-12 centering">
      <span style="font-size:1.8em" class="antonio txt-blue-major">OUR LATEST ARTICLES</span>
    </div>
  </div>
  
    
    
    <div class="row">
        <a href="http://localhost:1313/article/the-perl-admbassador-curtis-poe/">
      <div class="col-sm-3">
        <div class="circle-avatar" style="background-image:url(/images/the-perl-ambassador-curtis-poe/curtis-poe.jpg)"></div>
      </div>
      <div class="col-sm-9">
          <h6>The Perl Ambassador: Curtis &#39;Ovid&#39; Poe</h6>
          <p style="line-height:1"><small>The person behind the news of Perl</small></p>
      </div>
        </a>
    </div>
  
    
    
    <div class="row">
        <a href="http://localhost:1313/article/a-tour-with-net-ftp/">
      <div class="col-sm-3">
        <div class="circle-avatar" style="background-image:url(/images/a-tour-with-net-ftp/thumb_kidyes.jpg)"></div>
      </div>
      <div class="col-sm-9">
          <h6>A tour with Net::FTP</h6>
          <p style="line-height:1"><small>How to write an FTP client in Perl</small></p>
      </div>
        </a>
    </div>
  
    
    
    <div class="row">
        <a href="http://localhost:1313/article/shortcode_test/">
      <div class="col-sm-3">
        <div class="circle-avatar" style="background-image:url(/images/author/brian-d-foy.jpg)"></div>
      </div>
      <div class="col-sm-9">
          <h6>shortcode_test</h6>
          <p style="line-height:1"><small></small></p>
      </div>
        </a>
    </div>
  
    
    
    <div class="row">
        <a href="http://localhost:1313/article/listen-to-larry-wall-s-state-of-the-onion-2000-on-youtube/">
      <div class="col-sm-3">
        <div class="circle-avatar" style="background-image:url(/images/listen-to-larry-wall-s-state-of-the-onion-2000-on-youtube/thumb_larry-wall.jpg)"></div>
      </div>
      <div class="col-sm-9">
          <h6>Listen to Larry Wall&#39;s State of the Onion 2000 on YouTube</h6>
          <p style="line-height:1"><small></small></p>
      </div>
        </a>
    </div>
  
    
    
    <div class="row">
        <a href="http://localhost:1313/article/announcing-perl-7/">
      <div class="col-sm-3">
        <div class="circle-avatar" style="background-image:url(/images/announcing-perl-7/thumb_seven_on_blue_wall.jpg)"></div>
      </div>
      <div class="col-sm-9">
          <h6>Announcing Perl 7</h6>
          <p style="line-height:1"><small>Perl 5 with modern defaults</small></p>
      </div>
        </a>
    </div>
  
</div>
<div class="row" style="margin-top:20px">
  <div class="col-sm-12 centering">
  <script async src="/widget/toplinks/toplinks.js" type="text/javascript"></script>
    <div id="toplinks"></div>
  </div>
</div>

<div class="row" style="margin-top:20px">
  <div class="col-sm-12 centering">
    <a class="twitter-timeline" data-height="640" data-dnt="true" data-theme="dark" href="https://twitter.com/perlfoundation?ref_src=twsrc%5Etfw">Tweets by perlfoundation</a> <script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>
  </div>
</div>

<div class="row" style="margin-top:20px">
  <div class="col-sm-12 centering">
    <script src="https://www.reddit.com/r/perl/hot/.embed?limit=10&t=all" type="text/javascript"></script>
  </div>
</div>



          </div>
        </div>
      </div>
    </section>
  </section>
<script>
 
var tables, i;
tables = document.getElementsByTagName('table');
for (i=0;i<tables.length;i++) {
  tables[i].className = 'table table-striped';
}
</script>
<div class="push"></div>
<div class="footer">
  <div class="container">
    <div class="row">
      <div class="col-md-1">
        <h5>Site Map</h5>
        <ul>
        <li><a href="/">Home</a></li>
        <hr>
        <li><a href="/about">About</a></li>
        <hr>
        <li><a href="/authors">Authors</a></li>
        <hr>
        <li><a href="/categories">Categories</a></li>
        <hr>
        <li><a href="/tags">Tags</a></li>
        <hr>
        </ul>
      </div>
      <div class="col-md-3">
        <h5>Contact Us</h5>
        <p>To get in touch, send an email to: perl.com-editor@perl.org</p>
        <p><a href="https://perl.org">
              <img src="/images/site/perl-onion_20.png" alt="Perl Onion"></a>
          <a href="https://twitter.com/intent/follow?screen_name=perlfoundation">
              <img src="/images/site/twitter_20.png" alt="twitter"></a>
          <a href="/index.xml" /><img src="/images/site/rss_20.png" alt="rss"></a>
          <a href="https://github.com/tpf/perldotcom">
              <img src="/images/site/github_light_20.png" alt="GitHub logo"></a></p>
      </div>
      <div class="col-md-2">
          <h5>License</h5>
          <p>This work is licensed under a <a rel="license" href="https://creativecommons.org/licenses/by-nc/3.0/">Creative Commons Attribution-NonCommercial 3.0 Unported License</a>.</p>
          <p><a rel="license" href="https://creativecommons.org/licenses/by-nc/3.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc/3.0/88x31.png" /></a></p>
      </div>
      <div class="col-md-5">
          <h5>Legal</h5>
          <p>Perl.com and the authors make no representations with respect to the accuracy or completeness of the contents of all work on this website and specifically disclaim all warranties, including without limitation warranties of fitness for a particular purpose. The information published on this website may not be suitable for every situation. All work on this website is provided with the understanding that Perl.com and the authors are not engaged in rendering professional services. Neither Perl.com nor the authors shall be liable for damages arising herefrom.</p>
      </div>
    </div>
  </div>
</div>
<script src="/javascript/jquery.min.js"></script>
<script src="/javascript/bootstrap.min.js"></script>
<script data-no-instant>document.write('<script src="/livereload.js?port=1313&mindelay=10"></' + 'script>')</script></body>
</html>

