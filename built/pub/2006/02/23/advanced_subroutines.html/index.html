<!DOCTYPE html>
<html lang="en-us">
  <head>
  <title> Advanced Subroutine Techniques </title>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content=" In &#34;Making Sense of Subroutines,&#34; I wrote about what subroutines are and why you want to use them. This article expands on that topic, discussing some of the more common techniques for subroutines to make them even more useful...."/>
  <meta name="robots" content="index, follow">
  <meta name="google-site-verification" content="TZowffo_LX2mmsw2DbeNNbukCMnIOA8T-6CMJPiYllI" />

<meta property="twitter:card" content="summary">
<meta property="twitter:site" content="@PerlFoundation">
<meta property="og:url" content="http://localhost:1313/pub/2006/02/23/advanced_subroutines.html/" />
<meta property="og:title" content="Advanced Subroutine Techniques" />
<meta property="og:description" content=" In &#34;Making Sense of Subroutines,&#34; I wrote about what subroutines are and why you want to use them. This article expands on that topic, discussing some of the more common techniques for subroutines to make them even more useful....">
<meta property="og:site_name" content="Perl.com" />

<meta property="og:type" content="article" />
<meta property="og:article:published_time" content="2006-02-02T02:02:02Z" />
<meta property="og:image" content="http://localhost:1313/images/_pub_2006_02_23_advanced_subroutines/111-adv_subroutines.gif" />
<meta property="og:article:tag" content="perl-code-reuse" />
<meta property="og:article:tag" content="perl-functions" />
<meta property="og:article:tag" content="perl-subroutines" />
<meta property="og:article:tag" content="perl-tutorial" />


  <link rel="icon" href="/favicon.ico">
  <link href="/article/index.xml" rel="alternate" type="application/rss+xml" title="Perl.com - programming news, code and culture" />
  <link href="/article/index.xml" rel="feed" type="application/rss+xml" title="Perl.com - programming news, code and culture" />
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" type="text/css" href="/css/perldotcom.css"/>


<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-50555-22', 'auto');
ga('create', 'UA-85734801-2', 'auto', 'editor');
ga('send', 'pageview');
ga('editor.send', 'pageview');
</script>

</head>
<body>

<div class="container-fluid full-wdith antonio">
 <div class="row">
  <div class="navbar-inverse" style="border-radius:none !important" role="navigation">
    <div class="container-fluid">
      <ul class="nav navbar-nav pull-right follow">
          <li>MORE:</li>
          <li><a href="https://perl.org">
              <img src="/images/site/perl-onion_20.png" alt="Perl Onion"></a><li>
          <li><a href="https://twitter.com/intent/follow?screen_name=perlfoundation">
              <img src="/images/site/twitter_20.png" alt="twitter"></a><li>
          <li><a href="/article/index.xml" />
              <img src="/images/site/rss_20.png" alt="rss"></a></li>
          <li><a href="https://github.com/tpf/perldotcom" />
              <img src="/images/site/github_light_20.png" alt="GitHub logo"></a></li>
      </ul>
      <div class="navbar-header">
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
          <a class="navbar-nav" href="/">
            <div class="header-logo">Perl.com</div>
          </a>
      </div>
      <div class="navbar-collapse collapse">
        <ul class="nav navbar-nav">
          <li><a href="/about">
              <div class="circle">
                <img src="/images/site/perl-camel.png" alt="" />
              </div>
                  &nbsp;&nbsp;ABOUT</a>
          </li>
          <li><a href="/authors">
              <div class="circle">
                  <span class="glyphicon glyphicon-user txt-blue-major" aria-hidden="true"></span>
              </div>
                  &nbsp;&nbsp;AUTHORS</a>
          </li>
          <li><a href="/categories">
              <div class="circle">
                  <span class="glyphicon glyphicon-folder-open txt-blue-major" aria-hidden="true"></span>
              </div>
                  &nbsp;&nbsp;CATEGORIES</a>
          </li>
          <li><a href="/tags">
              <div class="circle">
                <span class="txt-blue-major" aria-hidden="true"><strong>#</strong></span>
              </div>
                  &nbsp;&nbsp;TAGS</a>
          </li>
          <li>
            <form class="search" name="ddg" action="https://duckduckgo.com/" method="get">
              <input type="text" name ="q" placeholder="SEARCH" />
              <input type="hidden" value="perl.com" name="sites" />
            </form>
          </li>
        </ul>
      </div>
    </div>
  </div>
 </div>
</div>


  <section id="content" role="main">
    <section class="entry-content">
      <div class="container">
        <div class="row">
          <div class="col-md-9">
            <div class="row">
              <article class="fulltext">
              <h1 class="blog-post-title">Advanced Subroutine Techniques</h1>
              <p class="blog-post-meta">Feb 23, 2006 by
              
              
                
                
                <a href="#author-bio-rob-kinyon">Rob Kinyon</a>
              
              </p>
              <img alt="" src=""/>
                

<p>In &ldquo;<a href="/pub/2005/11/03/subroutines.html">Making Sense of Subroutines</a>,&rdquo; I wrote about what subroutines are and why you want to use them. This article expands on that topic, discussing some of the more common techniques for subroutines to make them even more useful.</p>

<p>Several of these techniques are advanced, but you can use each one by itself without understanding the others. Furthermore, not every technique is useful in every situation. As with all techniques, consider these as tools in your toolbox, not things you have to do every time you open your editor.</p>

<h3 id="named-arguments">Named Arguments</h3>

<h4 id="positional-arguments">Positional Arguments</h4>

<p>Subroutines, by default, use &ldquo;positional arguments.&rdquo; This means that the arguments to the subroutine must occur in a specific order. For subroutines with a small argument list (three or fewer items), this isn&rsquo;t a problem.</p>

<pre><code>sub pretty_print {
    my ($filename, $text, $text_width) = @_;

    # Format $text to $text_width somehow.

    open my $fh, '&gt;', $filename
        or die &quot;Cannot open '$filename' for writing: $!\n&quot;;

    print $fh $text;

    close $fh;

    return;
}

pretty_print( 'filename', $long_text, 80 );
</code></pre>

<h4 id="the-problem">The Problem</h4>

<p>However, once everyone starts using your subroutine, it starts expanding what it can do. Argument lists tend to expand, making it harder and harder to remember the order of arguments.</p>

<pre><code>sub pretty_print {
    my (
        $filename, $text, $text_width, $justification, $indent,
        $sentence_lead
    ) = @_;

    # Format $text to $text_width somehow. If $justification is set, justify
    # appropriately. If $indent is set, indent the first line by one tab. If
    # $sentence_lead is set, make sure all sentences start with two spaces.

    open my $fh, '&gt;', $filename
        or die &quot;Cannot open '$filename' for writing: $!\n&quot;;

    print $fh $text;

    close $fh;

    return;
}

pretty_print( 'filename', $long_text, 80, 'full', undef, 1 );
</code></pre>

<p>Quick&ndash;what does that <code>1</code> at the end of the subroutine mean? If it took you more than five seconds to figure it out, then the subroutine call is unmaintainable. Now, imagine that the subroutine isn&rsquo;t right there, isn&rsquo;t documented or commented, and was written by someone who is quitting next week.</p>

<h4 id="the-solution">The Solution</h4>

<p>The most maintainable solution is to use &ldquo;named arguments.&rdquo; In Perl 5, the best way to implement this is by using a hash reference. Hashes also work, but they require additional work on the part of the subroutine author to verify that the argument list is even. A hashref makes any unmatched keys immediately obvious as a compile error.</p>

<pre><code>sub pretty_print {
    my ($args) = @_;

    # Format $args-&gt;{text} to $args-&gt;{text_width} somehow.
    # If $args-&gt;{justification} is set, justify appropriately.
    # If $args-&gt;{indent} is set, indent the first line by one tab.
    # If $args-&gt;{sentence_lead} is set, make sure all sentences start with
    # two spaces.

    open my $fh, '&gt;', $args-&gt;{filename}
        or die &quot;Cannot open '$args-&gt;{filename}' for writing: $!\n&quot;;

    print $fh $args-&gt;{text};

    close $fh;

    return;
}

pretty_print({
    filename      =&gt; 'filename',
    text          =&gt; $long_text,
    text_width    =&gt; 80,
    justification =&gt; 'full',
    sentence_lead =&gt; 1,
});
</code></pre>

<p>Now, the reader can immediately see exactly what the call to <code>pretty_print()</code> is doing.</p>

<h4 id="and-optional-arguments">And Optional Arguments</h4>

<p>By using named arguments, you gain the benefit that some or all of your arguments can be optional without forcing our users to put <code>undef</code> in all of the positions they don&rsquo;t want to specify.</p>

<h3 id="validation">Validation</h3>

<p>Argument validation is more difficult in Perl than in other languages. In C or Java, for instance, every variable has a type associated with it. This includes subroutine declarations, meaning that trying to pass the wrong type of variable to a subroutine gives a compile-time error. By contrast, because <code>perl</code> flattens everything to a single list, there is no compile-time checking at all. (Well, there kinda is with prototypes.)</p>

<p>This has been such a problem that there are dozens of modules on CPAN to address the problem. The most commonly recommended one is <a href="https://metacpan.org/pod/Params::Validate"><code>Params::Validate</code></a>.</p>

<h3 id="prototypes">Prototypes</h3>

<p>Prototypes in Perl are a way of letting Perl know exactly what to expect for a given subroutine, at compile time. If you&rsquo;ve ever tried to pass an array to the <code>vec()</code> built-in and you saw <code>Not enough arguments for vec</code>, you&rsquo;ve hit a prototype.</p>

<p>For the most part, prototypes are more trouble than they&rsquo;re worth. For one thing, Perl doesn&rsquo;t check prototypes for methods because that would require the ability to determine, at compile time, which class will handle the method. Because you can alter <code>@ISA</code> at runtime&ndash;you see the problem. The main reason, however, is that prototypes aren&rsquo;t very smart. If you specify <code>sub foo ($$$)</code>, you cannot pass it an array of three scalars (this is the problem with <code>vec()</code>). Instead, you have to say <code>foo( $x[0], $x[1], $x[2] )</code>, and that&rsquo;s just a pain.</p>

<p>Prototypes <em>can</em> be very useful for one reason&ndash;the ability to pass subroutines in as the first argument. <a href="https://metacpan.org/pod/Test::Exception"><code>Test::Exception</code></a> uses this to excellent advantage:</p>

<pre><code>sub do_this_to (&amp;;$) {
    my ($action, $name) = @_;

    $action-&gt;( $name );
}

do_this_to { print &quot;Hello, $_[0]\n&quot; } 'World';
do_this_to { print &quot;Goodbye, $_[0]\n&quot; } 'cruel world!';
</code></pre>

<h3 id="context-awareness">Context Awareness</h3>

<p>Using the <code>wantarray</code> built-in, a subroutine can determine its calling context. Context for subroutines, in Perl, is one of three things&ndash;list, scalar, or void. List context means that the return value will be used as a list, scalar context means that the return value will be used as a scalar, and void context means that the return value won&rsquo;t be used at all.</p>

<pre><code>sub check_context {
    # True
    if ( wantarray ) {
        print &quot;List context\n&quot;;
    }
    # False, but defined
    elsif ( defined wantarray ) {
        print &quot;Scalar context\n&quot;;
    }
    # False and undefined
    else {
        print &quot;Void context\n&quot;;
    }
}

my @x       = check_context();  # prints 'List context'
my %x       = check_context();  # prints 'List context'
my ($x, $y) = check_context();  # prints 'List context'

my $x       = check_context();  # prints 'Scalar context'

check_context();                # prints 'Void context'
</code></pre>

<p>For CPAN modules that implement or augment context awareness, look at <a href="https://metacpan.org/pod/Contextual::Return"><code>Contextual::Return</code></a>, <a href="https://metacpan.org/pod/Sub::Context"><code>Sub::Context</code></a>, and <a href="https://metacpan.org/pod/Return::Value"><code>Return::Value</code></a>.</p>

<p>Note: you can misuse context awareness heavily by having the subroutine do something completely different when called in scalar versus list context. Don&rsquo;t do that. A subroutine should be a single, easily identifiable unit of work. Not everyone understands all of the different permutations of context, including your standard Perl expert.</p>

<p>Instead, I recommend having a standard return value, except in void context. If your return value is expensive to calculate and is calculated only for the purposes of returning it, then knowing if you&rsquo;re in void context may be very helpful. This can be a premature optimization, however, so always measure (benchmarking and profiling) before and after to make sure you&rsquo;re optimizing what needs optimizing.</p>

<h3 id="mimicking-perl-s-internal-functions">Mimicking Perl&rsquo;s Internal Functions</h3>

<p>A lot of Perl&rsquo;s internal functions modify their arguments and/or use <code>$_</code> or <code>@_</code> as a default if no parameters are provided. A perfect example of this is <code>chomp()</code>. Here&rsquo;s a version of <code>chomp()</code> that illustrates some of these techniques:</p>

<pre><code>sub my_chomp {
    # This is a special case in the chomp documentation
    return if ref($/);

    # If a return value is expected ...
    if ( defined wantarray ) {
        my $count = 0;
        $count += (@_ ? (s!$/!!g for @_) : s!$/!!g);
        return $count;
    }
    # Otherwise, don't bother counting
    else {
        @_ ? do{ s!$/!!g for @_ } : s!$/!!g;
        return;
    }
}
</code></pre>

<ul>
<li>Use <code>return;</code> instead of <code>return undef;</code> if you want to return nothing. If someone assigns the return value to an array, the latter creates an array of one value (<code>undef</code>), which evaluates to true. The former will correctly handle all contexts.</li>
<li>If you want to modify <code>$_</code> if no parameters are given, you have to check <code>@_</code> explicitly. You cannot do something like <code>@_ = ($_) unless @_;</code> because <code>$_</code> will lose its magic.</li>
<li>This doesn&rsquo;t calculate <code>$count</code> unless <code>$count</code> is useful (using a check for void context).</li>
<li>The key is the aliasing of <code>@_</code>. If you modify <code>@_</code> directly (as opposed to assigning the values in <code>@_</code> to variables), then you modify the actual parameters passed in.</li>
</ul>

<h3 id="conclusion">Conclusion</h3>

<p>I hope I have introduced you to a few more tools in your toolbox. The art of writing a good subroutine is very complex. Each of the techniques I have presented is one tool in the programmer&rsquo;s toolbox. Just as a master woodworker wouldn&rsquo;t use a drill for every project, a master programmer doesn&rsquo;t make every subroutine use named arguments or mimic a built-in. You must evaluate each technique every time to see if it will make the code more maintainable. Overusing these techniques will make your code <em>less</em> maintainable. Using them appropriately will make your life easier.</p>

              </article>
              <p><strong>Tags</strong></p>
              <div class="tags">
                <div class="category"><a href="/categories/development">development</a></div>
                
                  <div class="tag"><a href="/tags/perl-code-reuse">perl-code-reuse</a></div>
                
                  <div class="tag"><a href="/tags/perl-functions">perl-functions</a></div>
                
                  <div class="tag"><a href="/tags/perl-subroutines">perl-subroutines</a></div>
                
                  <div class="tag"><a href="/tags/perl-tutorial">perl-tutorial</a></div>
                
              </div>
            </div>
            
              
                
<div class="row" id="author-bio-rob-kinyon">
  <div class="col-sm-2">
    
    <a href="/authors/rob-kinyon/"><div class="circle-avatar" style="background-image:url(/images/author/rob-kinyon.jpg)"></div></a>
  </div>
  <div class="col-sm-10">
    <a href="/authors/rob-kinyon/"><h3>Rob Kinyon</h3></a>
    <p></p>
    <h5><a href="/authors/rob-kinyon/">Browse their articles</a></h5>
  </div>
</div>

            
            <div class="row">
              <h3>Feedback</h3>
              <p>Something wrong with this article? Help us out by opening an issue or pull request on <a href="https://github.com/tpf/perldotcom/blob/master/content/legacy/_pub_2006_02_23_advanced_subroutines.md">GitHub</a></p>
            </div>
          </div>
          <div class="col-md-3">
            <div class="latest-sidebar">

  <div class="row">
    <div class="col-sm-12 centering">
      <span style="font-size:1.8em" class="antonio txt-blue-major">OUR LATEST ARTICLES</span>
    </div>
  </div>
  
    
    
    <div class="row">
        <a href="http://localhost:1313/article/the-perl-admbassador-curtis-poe/">
      <div class="col-sm-3">
        <div class="circle-avatar" style="background-image:url(/images/the-perl-ambassador-curtis-poe/curtis-poe.jpg)"></div>
      </div>
      <div class="col-sm-9">
          <h6>The Perl Ambassador: Curtis &#39;Ovid&#39; Poe</h6>
          <p style="line-height:1"><small>The person behind the news of Perl</small></p>
      </div>
        </a>
    </div>
  
    
    
    <div class="row">
        <a href="http://localhost:1313/article/a-tour-with-net-ftp/">
      <div class="col-sm-3">
        <div class="circle-avatar" style="background-image:url(/images/a-tour-with-net-ftp/thumb_kidyes.jpg)"></div>
      </div>
      <div class="col-sm-9">
          <h6>A tour with Net::FTP</h6>
          <p style="line-height:1"><small>How to write an FTP client in Perl</small></p>
      </div>
        </a>
    </div>
  
    
    
    <div class="row">
        <a href="http://localhost:1313/article/shortcode_test/">
      <div class="col-sm-3">
        <div class="circle-avatar" style="background-image:url(/images/author/brian-d-foy.jpg)"></div>
      </div>
      <div class="col-sm-9">
          <h6>shortcode_test</h6>
          <p style="line-height:1"><small></small></p>
      </div>
        </a>
    </div>
  
    
    
    <div class="row">
        <a href="http://localhost:1313/article/listen-to-larry-wall-s-state-of-the-onion-2000-on-youtube/">
      <div class="col-sm-3">
        <div class="circle-avatar" style="background-image:url(/images/listen-to-larry-wall-s-state-of-the-onion-2000-on-youtube/thumb_larry-wall.jpg)"></div>
      </div>
      <div class="col-sm-9">
          <h6>Listen to Larry Wall&#39;s State of the Onion 2000 on YouTube</h6>
          <p style="line-height:1"><small></small></p>
      </div>
        </a>
    </div>
  
    
    
    <div class="row">
        <a href="http://localhost:1313/article/announcing-perl-7/">
      <div class="col-sm-3">
        <div class="circle-avatar" style="background-image:url(/images/announcing-perl-7/thumb_seven_on_blue_wall.jpg)"></div>
      </div>
      <div class="col-sm-9">
          <h6>Announcing Perl 7</h6>
          <p style="line-height:1"><small>Perl 5 with modern defaults</small></p>
      </div>
        </a>
    </div>
  
</div>
<div class="row" style="margin-top:20px">
  <div class="col-sm-12 centering">
  <script async src="/widget/toplinks/toplinks.js" type="text/javascript"></script>
    <div id="toplinks"></div>
  </div>
</div>

<div class="row" style="margin-top:20px">
  <div class="col-sm-12 centering">
    <a class="twitter-timeline" data-height="640" data-dnt="true" data-theme="dark" href="https://twitter.com/perlfoundation?ref_src=twsrc%5Etfw">Tweets by perlfoundation</a> <script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>
  </div>
</div>

<div class="row" style="margin-top:20px">
  <div class="col-sm-12 centering">
    <script src="https://www.reddit.com/r/perl/hot/.embed?limit=10&t=all" type="text/javascript"></script>
  </div>
</div>



          </div>
        </div>
      </div>
    </section>
  </section>
<script>
 
var tables, i;
tables = document.getElementsByTagName('table');
for (i=0;i<tables.length;i++) {
  tables[i].className = 'table table-striped';
}
</script>
<div class="push"></div>
<div class="footer">
  <div class="container">
    <div class="row">
      <div class="col-md-1">
        <h5>Site Map</h5>
        <ul>
        <li><a href="/">Home</a></li>
        <hr>
        <li><a href="/about">About</a></li>
        <hr>
        <li><a href="/authors">Authors</a></li>
        <hr>
        <li><a href="/categories">Categories</a></li>
        <hr>
        <li><a href="/tags">Tags</a></li>
        <hr>
        </ul>
      </div>
      <div class="col-md-3">
        <h5>Contact Us</h5>
        <p>To get in touch, send an email to: perl.com-editor@perl.org</p>
        <p><a href="https://perl.org">
              <img src="/images/site/perl-onion_20.png" alt="Perl Onion"></a>
          <a href="https://twitter.com/intent/follow?screen_name=perlfoundation">
              <img src="/images/site/twitter_20.png" alt="twitter"></a>
          <a href="/index.xml" /><img src="/images/site/rss_20.png" alt="rss"></a>
          <a href="https://github.com/tpf/perldotcom">
              <img src="/images/site/github_light_20.png" alt="GitHub logo"></a></p>
      </div>
      <div class="col-md-2">
          <h5>License</h5>
          <p>This work is licensed under a <a rel="license" href="https://creativecommons.org/licenses/by-nc/3.0/">Creative Commons Attribution-NonCommercial 3.0 Unported License</a>.</p>
          <p><a rel="license" href="https://creativecommons.org/licenses/by-nc/3.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc/3.0/88x31.png" /></a></p>
      </div>
      <div class="col-md-5">
          <h5>Legal</h5>
          <p>Perl.com and the authors make no representations with respect to the accuracy or completeness of the contents of all work on this website and specifically disclaim all warranties, including without limitation warranties of fitness for a particular purpose. The information published on this website may not be suitable for every situation. All work on this website is provided with the understanding that Perl.com and the authors are not engaged in rendering professional services. Neither Perl.com nor the authors shall be liable for damages arising herefrom.</p>
      </div>
    </div>
  </div>
</div>
<script src="/javascript/jquery.min.js"></script>
<script src="/javascript/bootstrap.min.js"></script>
<script data-no-instant>document.write('<script src="/livereload.js?port=1313&mindelay=10"></' + 'script>')</script></body>
</html>

