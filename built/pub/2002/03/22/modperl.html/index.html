<!DOCTYPE html>
<html lang="en-us">
  <head>
  <title> mod_perl in 30 minutes </title>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content=" Introduction In the previous article, I&#39;ve shown quite amazing Web performance reports from companies that have deployed mod_perl heavily. You might be surprised but you can quite easily get similarly amazing results if you move your service to mod_perl..."/>
  <meta name="robots" content="index, follow">
  <meta name="google-site-verification" content="TZowffo_LX2mmsw2DbeNNbukCMnIOA8T-6CMJPiYllI" />

<meta property="twitter:card" content="summary">
<meta property="twitter:site" content="@PerlFoundation">
<meta property="og:url" content="http://localhost:1313/pub/2002/03/22/modperl.html/" />
<meta property="og:title" content="mod_perl in 30 minutes" />
<meta property="og:description" content=" Introduction In the previous article, I&#39;ve shown quite amazing Web performance reports from companies that have deployed mod_perl heavily. You might be surprised but you can quite easily get similarly amazing results if you move your service to mod_perl...">
<meta property="og:site_name" content="Perl.com" />

<meta property="og:type" content="article" />
<meta property="og:article:published_time" content="2002-03-03T03:03:03Z" />
<meta property="og:image" content="http://localhost:1313/images/_pub_2002_03_22_modperl/111-intro_modperl.gif" />
<meta property="og:article:tag" content="mod-perl" />


  <link rel="icon" href="/favicon.ico">
  <link href="/article/index.xml" rel="alternate" type="application/rss+xml" title="Perl.com - programming news, code and culture" />
  <link href="/article/index.xml" rel="feed" type="application/rss+xml" title="Perl.com - programming news, code and culture" />
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" type="text/css" href="/css/perldotcom.css"/>


<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-50555-22', 'auto');
ga('create', 'UA-85734801-2', 'auto', 'editor');
ga('send', 'pageview');
ga('editor.send', 'pageview');
</script>

</head>
<body>

<div class="container-fluid full-wdith antonio">
 <div class="row">
  <div class="navbar-inverse" style="border-radius:none !important" role="navigation">
    <div class="container-fluid">
      <ul class="nav navbar-nav pull-right follow">
          <li>MORE:</li>
          <li><a href="https://perl.org">
              <img src="/images/site/perl-onion_20.png" alt="Perl Onion"></a><li>
          <li><a href="https://twitter.com/intent/follow?screen_name=perlfoundation">
              <img src="/images/site/twitter_20.png" alt="twitter"></a><li>
          <li><a href="/article/index.xml" />
              <img src="/images/site/rss_20.png" alt="rss"></a></li>
          <li><a href="https://github.com/tpf/perldotcom" />
              <img src="/images/site/github_light_20.png" alt="GitHub logo"></a></li>
      </ul>
      <div class="navbar-header">
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
          <a class="navbar-nav" href="/">
            <div class="header-logo">Perl.com</div>
          </a>
      </div>
      <div class="navbar-collapse collapse">
        <ul class="nav navbar-nav">
          <li><a href="/about">
              <div class="circle">
                <img src="/images/site/perl-camel.png" alt="" />
              </div>
                  &nbsp;&nbsp;ABOUT</a>
          </li>
          <li><a href="/authors">
              <div class="circle">
                  <span class="glyphicon glyphicon-user txt-blue-major" aria-hidden="true"></span>
              </div>
                  &nbsp;&nbsp;AUTHORS</a>
          </li>
          <li><a href="/categories">
              <div class="circle">
                  <span class="glyphicon glyphicon-folder-open txt-blue-major" aria-hidden="true"></span>
              </div>
                  &nbsp;&nbsp;CATEGORIES</a>
          </li>
          <li><a href="/tags">
              <div class="circle">
                <span class="txt-blue-major" aria-hidden="true"><strong>#</strong></span>
              </div>
                  &nbsp;&nbsp;TAGS</a>
          </li>
          <li>
            <form class="search" name="ddg" action="https://duckduckgo.com/" method="get">
              <input type="text" name ="q" placeholder="SEARCH" />
              <input type="hidden" value="perl.com" name="sites" />
            </form>
          </li>
        </ul>
      </div>
    </div>
  </div>
 </div>
</div>


  <section id="content" role="main">
    <section class="entry-content">
      <div class="container">
        <div class="row">
          <div class="col-md-9">
            <div class="row">
              <article class="fulltext">
              <h1 class="blog-post-title">mod_perl in 30 minutes</h1>
              <p class="blog-post-meta">Mar 22, 2002 by
              
              
                
                
                <a href="#author-bio-stas-bekman">Stas Bekman</a>
              
              </p>
              <img alt="" src=""/>
                

<h3 id="span-id-introduction-introduction-span"><span id="introduction">Introduction</span></h3>

<p>In the <a href="/pub/2002/02/26/whatismodperl.html">previous article</a>, I&rsquo;ve shown quite amazing Web performance reports from companies that have deployed mod_perl heavily. You might be surprised but you can quite easily get similarly amazing results if you move your service to mod_perl as well. In fact, getting started with mod_perl shouldn&rsquo;t take you more than 30 minutes &ndash; the time it takes to compile and configure the server on a decent machine and get it running.</p>

<p>In this article I&rsquo;ll show step-by-step installation and configuration scenarios, and chances are you will be able to run the basic statically compiled mod_perl setup without reading any other documents. Of course, you will want and need to read the documentation later, but I think you will agree with me that it&rsquo;s ultimately cool to be able to get your feet wet without knowing much about the new technology up-front.</p>

<p>The mod_perl installation was tested on many mainstream Unix platforms, so unless you have a nonstandard system, you shouldn&rsquo;t have any problems building the basic mod_perl server.</p>

<p>If you are a Windows user, then the easiest way is to use the binary package available from <a href="http://perl.apache.org/distributions.html.">http://perl.apache.org/distributions.html.</a> From the same location, you can download the Linux RPM version and CVS snapshots. However, I always recommend to build the mod_perl from the source, and as you will see in a moment, it&rsquo;s an easy thing to do.</p>

<h3 id="span-id-installing-mod-perl-is-easy-installing-mod-perl-is-easy-span"><span id="installing mod_perl is easy">Installing mod_perl Is Easy</span></h3>

<p>So let&rsquo;s start with the installation process. If you are an experienced Unix user, then you need no explanation for the following commands. Just copy and paste them and you will get the server installed.</p>

<p>I&rsquo;ll use a <code>%</code> sign as the shell program&rsquo;s prompt.</p>

<pre><code>  % cd /usr/src
  % lwp-download http://www.apache.org/dist/httpd/apache_1.3.20.tar.gz
  % lwp-download http://perl.apache.org/dist/mod_perl-1.26.tar.gz
  % tar -zvxf apache_1.3.20.tar.gz
  % tar -zvxf mod_perl-1.26.tar.gz
  % cd mod_perl-1.26
  % perl Makefile.PL APACHE_SRC=../apache_1.3.20/src \
    DO_HTTPD=1 USE_APACI=1 EVERYTHING=1
  % make &amp;&amp; make test &amp;&amp; make install
  % cd ../apache_1.3.20
  % make install
</code></pre>

<p>That&rsquo;s all!</p>

<p>What&rsquo;s left is to add a few configuration lines to <em>httpd.conf</em>, an Apache configuration file, start the server and enjoy mod_perl.</p>

<p>If you have stumbled upon a problem at any of the above steps, then don&rsquo;t despair &ndash; the next section will explain in detail each step.</p>

<h3 id="span-id-installing-mod-perl-detailed-installing-mod-perl-detailed-span"><span id="installing mod_perl detailed">Installing mod_perl Detailed</span></h3>

<p>If you didn&rsquo;t have the courage to try the steps in the previous section or you simply want to understand more before you try, then let&rsquo;s go through the fine details of the installation process. If you have successfully installed mod_perl following the short scenario in the previous section, then you can skip this section and move on to the next one.</p>

<p>Before we proceed, I should note that you have to become a <em>root</em> user in order to install the files in a protected area. If you don&rsquo;t have <em>root</em> access, then you can install all the files under your home directory. We will talk about the nuances of this approach in a future articles. I&rsquo;ll also assume that you have <em>perl</em> and <em>gcc</em> or an equivalent C compiler installed.</p>

<p>I assume that all builds are being done in the <em>/home/stas/src</em> directory. So we go into this directory.</p>

<pre><code>  % cd /home/stas/src
</code></pre>

<p>Now we download the latest source distributions of Apache and mod_perl. If you have the <code>LWP</code> module installed (also known as <em>libwww</em> and available from CPAN), then you should have the <code>lwp-download</code> utility that partly imitates your favorite browser by allowing you to download files from the Internet. You can use any other method to retrieve these files. Just make sure that you save both files in the <em>/home/stas/src</em> directory, as this will make it easier for you to follow the example installation process. Of course, you can install both packages anywhere on your file system.</p>

<pre><code>  % lwp-download http://www.apache.org/dist/httpd/apache_1.3.20.tar.gz
  % lwp-download http://perl.apache.org/dist/mod_perl-1.26.tar.gz
</code></pre>

<p>You can make sure that you&rsquo;re downloading the latest stable versions by visiting the following distribution directories: <em><a href="http://www.apache.org/dist/httpd/">http://www.apache.org/dist/httpd/</a></em> and <em><a href="http://perl.apache.org/dist/">http://perl.apache.org/dist/</a></em>. As you have guessed already, the former URL is the main Apache distribution directory, the latter is the same thing for mod_perl.</p>

<p>Untar both sources. You have to uncompress and untar the files. In addition to its main usage for tarring and untarring files, the GNU <code>tar</code> utility is able to uncompress files compressed by the <code>gzip</code> utility, when the <code>-z</code> option is used.</p>

<pre><code>  % tar -zvxf apache_1.3.20.tar.gz
  % tar -zvxf mod_perl-1.26.tar.gz
</code></pre>

<p>If you have a non-GNU <code>tar</code> utility, then chances are that it will be unable to decompress, so you need to do it in two steps. First, uncompress the packages with:</p>

<pre><code>  % gzip -d apache_1.3.20.tar.gz
  % gzip -d mod_perl-1.26.tar.gz
</code></pre>

<p>Then untar them with:</p>

<pre><code>  % tar -xvf apache_1.3.20.tar
  % tar -xvf mod_perl-1.26.tar
</code></pre>

<p>If you don&rsquo;t have <code>tar</code> or <code>gzip</code> utilities available, then install them or use their equivalents.</p>

<p>Now go into the mod_perl source distribution directory.</p>

<pre><code>  % cd mod_perl-1.26
</code></pre>

<p>The next step is to create the <em>Makefile</em>.</p>

<pre><code>  % perl Makefile.PL APACHE_SRC=../apache_1.3.20/src \
    DO_HTTPD=1 USE_APACI=1 EVERYTHING=1
</code></pre>

<p>mod_perl accepts a variety of parameters, in this scenario we are going to use those that will allow you to do almost everything with mod_perl. Once you learn more about mod_perl, you will be able to fine-tune the list of parameters passed to <em>Makefile.PL</em>. In future articles, I&rsquo;ll go through all the available options.</p>

<p><code>perl Makefile.PL ...</code> execution will check for prerequisites and tell you which required software packages are missing from your system. If you don&rsquo;t have some of the Perl packages installed, then you will have to install these before you proceed. They all are available from CPAN and can be easily downloaded and installed.</p>

<p>If you choose to install mod_perl with help of the <code>CPAN.pm</code> module, then it will install all the missing modules for you. To do so, tell <code>CPAN.pm</code> to install the <code>Bundle::Apache</code> bundle.</p>

<p>This step also executes the <code>./configure</code> script from Apache&rsquo;s source distribution directory (absolutely transparently for you), which prepares the Apache build configuration files. If you need to pass parameters to Apache&rsquo;s <code>./configure</code> script, then pass them as options to <code>perl Makefile.PL ...</code>. In future articles we will talk about all the available options.</p>

<p>Now you should build the <em>httpd</em> executable by using the <code>make</code> utility.</p>

<pre><code>  % make
</code></pre>

<p>This command prepares mod_perl extension files, installs them in the Apache source tree and builds the <em>httpd</em> executable (the Web server itself) by compiling all the required files. Upon completion of the <code>make</code> process, you get returned to the mod_perl source distribution directory.</p>

<p><code>make test</code> executes various mod_perl tests on the freshly built <em>httpd</em> executable.</p>

<pre><code>  % make test
</code></pre>

<p>This command starts the server on a nonstandard port (8529) and tests whether all parts of the built server function correctly. If something goes wrong, then the process will report it to you.</p>

<p><code>make install</code> completes the installation process of mod_perl by installing all the Perl files required for mod_perl to run and, of course, the server documentation (man pages).</p>

<pre><code>  % make install
</code></pre>

<p>You can use the following commands concatenation style:</p>

<pre><code>  % make &amp;&amp; make test &amp;&amp; make install
</code></pre>

<p>It simplifies the installation, since you don&rsquo;t have to wait for each command to complete before starting the next one. When installing mod_perl for the first time, it&rsquo;s better to do it step by step.</p>

<p>If you choose the all-in-one approach, then you should know that if <code>make</code> fails, then neither <code>make test</code> nor <code>make install</code> will be executed. If <code>make test</code> fails, then <code>make install</code> will not be executed.</p>

<p>Finally, change to the Apache source distribution directory, run make install to create the Apache directory tree and install Apache header files (<em>*.h</em>), default configuration files (<em>*.conf</em>), the <em>httpd</em> executable and a few other programs.</p>

<pre><code>  % cd ../apache_1.3.20
  % make install
</code></pre>

<p>Note that, as with a plain Apache installation, any configuration files left from a previous installation won&rsquo;t be overwritten by this process. You don&rsquo;t need to back up your previously working configuration files before the installation.</p>

<p>When the <code>make install</code> process completes, it will tell you how to start a freshly built Web server (the path to the <code>apachectl</code> utility that is being used to control the server) and where the installed configuration files are. Remember or, even better, write down both of them, since you will need this information. On my machine the two important paths are:</p>

<pre><code>  /usr/local/apache/bin/apachectl
  /usr/local/apache/conf/httpd.conf
</code></pre>

<p>So far, we have completed the building and installation of the mod_perl enabled Apache. The next steps are to configure <em>httpd.conf</em>, write a little test script, start the server and check that the test script is working.</p>

<h3 id="span-id-configuring-and-starting-mod-perl-server-configuring-and-starting-mod-perl-server-span"><span id="configuring and starting mod_perl server">Configuring and Starting mod_perl Server</span></h3>

<p>First things first; we want to make sure that our Apache was built correctly and that we can serve plain HTML files with it. Why do that? To minimize the number of possible trouble makers, if we find out that mod_perl doesn&rsquo;t work. After you know that Apache can serve HTML files, you don&rsquo;t have to worry about it anymore. And if something goes wrong with mod_perl, you have eliminated the possibility that the <em>httpd</em> binary or basic configurations are broken, you know that you are allowed to bind to the port you have configured your server to listen to, and that the browser you&rsquo;re testing with is just fine. Again, you should follow these guidelines when installing mod_perl for the first time.</p>

<p>Configure Apache as you always do. Set <code>Port</code>, <code>User</code>, <code>Group</code>, <code>ErrorLog</code> and other directives in the <em>httpd.conf</em> file (remember I&rsquo;ve asked you to remember the location of this file at the end of the previous section?). Use the defaults as suggested, customize only when you have to. Values that you need to customize are <code>ServerName</code>, <code>Port</code>, <code>User</code>, <code>Group</code>, <code>ServerAdmin</code>, <code>DocumentRoot</code> and a few others. You will find helpful hints preceding each directive. Follow them if in doubt.</p>

<p>When you have edited the configuration file, it&rsquo;s time to start the server. One of the ways to start and stop the server is to use the <code>apachectl</code> utility. You start the server with:</p>

<pre><code>  % /usr/local/apache/bin/apachectl start
</code></pre>

<p>And stop it with:</p>

<pre><code>  % /usr/local/apache/bin/apachectl stop
</code></pre>

<p>Note that you have to be <em>root</em> when starting the server if the server is going to listen on port <code>80</code> or another privileged port (&lt;1024).</p>

<p>After you start the server, check in the <em>error_log</em> file (<em>/usr/local/apache/logs/error_log</em> is the file&rsquo;s default location) that the server has indeed started. Don&rsquo;t rely on the status <code>apachectl</code> reports. You should see something like this:</p>

<pre><code>  [Thu Jun 22 17:14:07 2000] [notice] Apache/1.3.20 (Unix) 
  mod_perl/1.26 configured -- resuming normal operations
</code></pre>

<p>Now point your browser to <em><a href="http://localhost/">http://localhost/</a></em> or <em><a href="http://your.server.name/">http://your.server.name/</a></em> as configured with the <code>ServerName</code> directive. If you have set a <code>Port</code> directive with a value different from <code>80</code>, then apply this port number at the end of the server name. If you have used port 8080, then test the server with <em><a href="http://localhost:8080/">http://localhost:8080/</a></em> or <em><a href="http://your.server.name:8080/">http://your.server.name:8080/</a></em>. You should see the infamous <em>``It worked&rdquo;</em> page, which is an <code>index.html</code> file that <code>make install</code> in the Apache source tree installs for you. If you don&rsquo;t see this page, then something is wrong and you should check the contents of the <em>error_log</em> file. You will find the path of the error log file by looking it up in the <code>ErrorLog</code> directive in <em>httpd.conf</em>.</p>

<p>If everything works as expected, then shut down the server, open <em>httpd.conf</em> in your favorite editor, and scroll to the end of the file, where we will add the mod_perl configuration directives (of course you can place them anywhere in the file).</p>

<p>Assuming that you put all scripts that should be executed by the mod_perl enabled server in the <em>/home/httpd/perl/</em> directory, add the following configuration directives:</p>

<pre><code>  Alias /perl/ /home/httpd/perl/

  PerlModule Apache::Registry
  &lt;Location /perl&gt;
    SetHandler perl-script
    PerlHandler Apache::Registry
    Options ExecCGI
    PerlSendHeader On
    allow from all
  &lt;/Location&gt;
</code></pre>

<p>Save the modified file.</p>

<p>This configuration causes each URI starting with <em>/perl</em> to be handled by the Apache mod_perl module. It will use the handler from the Perl module <code>Apache::Registry</code>.</p>

<h3 id="span-id-preparing-the-scripts-directory-preparing-the-scripts-directory-span"><span id="preparing the scripts directory">Preparing the Scripts Directory</span></h3>

<p>Now create a <em>/home/httpd/perl/</em> directory if it doesn&rsquo;t yet exist. In order for you and Apache to be able to read, write and execute files we have to set correct permissions. You could get away by simply doing:</p>

<pre><code>  % chmod 0777  /home/httpd/perl
</code></pre>

<p>This is very, very insecure and you <strong>should not</strong> follow this approach on the production machine. This is good enough when you just want to try things out and want to have as few obstacles as possible. Once you understand how things work, you should tighten the permissions of files served by Apache. In future articles, we will talk about setting proper file permissions.</p>

<h3 id="span-id-the-mod-perl-rules-apache-registry-script-the-mod-perl-rules-apache-registry-script-span"><span id="the mod_perl rules apache::registry script">The ``mod_perl rules&rdquo; Apache::Registry Script</span></h3>

<p>As you probably know, mod_perl allows you to reuse CGI scripts written in Perl that were previously used under mod_cgi. Therefore, our first test script can be as simple as:</p>

<pre><code>  mod_perl_rules1.pl
  ------------------
  print &quot;Content-type: text/plain\r\n\r\n&quot;;
  print &quot;mod_perl rules!\n&quot;;
</code></pre>

<p>Save this script in the <em>/home/httpd/perl/mod_perl_rules1.pl</em> file. Notice that the <em>shebang</em> line is not needed with mod_perl, but you can keep it if you want. So the following script can be used as well:</p>

<pre><code>  mod_perl_rules1.pl
  ------------------
  #!/usr/bin/perl
  print &quot;Content-type: text/plain\r\n\r\n&quot;;
  print &quot;mod_perl rules!\n&quot;;
</code></pre>

<p>Of course you can write the same script using the Apache Perl API:</p>

<pre><code>  mod_perl_rules2.pl
  ------------------
  my $r = shift;
  $r-&gt;send_http_header('text/plain');
  $r-&gt;print(&quot;mod_perl rules!\n&quot;);
</code></pre>

<p>Save this script in the <em>/home/httpd/perl/mod_perl_rules2.pl</em> file.</p>

<p>Now make both of the scripts executable and readable by the server. Remember that when you execute scripts from a shell, they are being executed by the user-name you are logged with. When instead you try to run the scripts by issuing requests, Apache needs to be able to read and execute them. So we make the script readable and executable by everybody:</p>

<pre><code>  % chmod 0755   /home/httpd/perl/mod_perl_rules1.pl \
                 /home/httpd/perl/mod_perl_rules2.pl
</code></pre>

<p>If you don&rsquo;t want other users to be able to read your script, then you should add yourself into the groupname the Web server is running with (as defined by the <code>Group</code> directive) and then make the script owned by that group and tighten the permissions. For example, on my machine I run the server under the group <em>httpd</em> and I&rsquo;m the only one who is in the same group, so I can do the following:</p>

<pre><code>  % chown stas.httpd /home/httpd/perl/mod_perl_rules1.pl \
                 /home/httpd/perl/mod_perl_rules2.pl

  % chmod 0750   /home/httpd/perl/mod_perl_rules1.pl \
                 /home/httpd/perl/mod_perl_rules2.pl
</code></pre>

<p>The first command makes the files belong to group <em>httpd</em>, the second sets the proper execution and read permissions.</p>

<p>That&rsquo;s secure, assuming that you have a dedicated groupname for your server.</p>

<p>Also, remember that all the directories that lead to the script should be readable and executable by the server.</p>

<p>You can test <em>mod_perl_rules1.pl</em> from the command line, since it is essentially a regular Perl script.</p>

<pre><code>  % perl /home/httpd/perl/mod_perl_rules1.pl
</code></pre>

<p>You should see the following output:</p>

<pre><code>  mod_perl rules!
</code></pre>

<p>You cannot test the second script by executing it from the command line since it uses the mod_perl API that is available only when run from within the mod_perl server.</p>

<p>Make sure the server is running and issue these requests using your favorite browser:</p>

<pre><code>  http://localhost/perl/mod_perl_rules1.pl
  http://localhost/perl/mod_perl_rules2.pl
</code></pre>

<p>In both cases you will see on the following response:</p>

<pre><code>  mod_perl rules!
</code></pre>

<p>If you see it&ndash;<strong>congratulations</strong>! You have a working mod_perl server.</p>

<p>If you&rsquo;re using port 8080 instead of 80, then you should use this number in the URL:</p>

<pre><code>  http://localhost:8080/perl/mod_perl_rules1.pl
  http://localhost:8080/perl/mod_perl_rules2.pl
</code></pre>

<p>The <code>localhost</code> approach will work only if the browser is running on the same machine as the server. If not, then use the real server name for this test. For example:</p>

<pre><code>  http://your.server.name/perl/mod_perl_rules1.pl
</code></pre>

<p>If there is any problem, then please refer to the <em>error_log</em> file for the error reports.</p>

<p>Now it&rsquo;s a time to move your CGI scripts from <em>/somewhere/cgi-bin</em> directory to <em>/home/httpd/perl/</em> and see them running much much faster, when requested from the newly configured base URL (<em>/perl/</em>). If you were accessing the script as <em>/cgi-bin/test.pl</em>, then it will now be accessed from <em>/perl/test.pl</em>.</p>

<p>Some of your scripts might not work immediately and will require some minor tweaking or even a partial rewrite to work properly with mod_perl. Chances are that if you are not practicing sloppy programming, then the scripts will work without any modifications.</p>

<p>If you have a problem with your scripts, then a good approach is to replace <code>Apache::Registry</code> with <code>Apache::PerlRun</code> in <em>httpd.conf</em>, as the latter can execute really badly written scripts. Put the following configuration directives instead in <em>httpd.conf</em> and restart the server:</p>

<pre><code>  PerlModule Apache::PerlRun
  &lt;Location /perl&gt;
    SetHandler perl-script
    PerlHandler Apache::PerlRun
    Options ExecCGI
    PerlSendHeader On
    allow from all
  &lt;/Location&gt;
</code></pre>

<p>Now your scripts should work, unless there is something in them mod_perl doesn&rsquo;t accept. We will discuss these nuances in future articles.</p>

<h3 id="span-id-the-mod-perl-rules-apache-perl-module-the-mod-perl-rules-apache-perl-module-span"><span id="the mod_perl rules apache perl module">The ``mod_perl rules&rdquo; Apache Perl Module</span></h3>

<p>mod_perl is about running both scripts and handlers. Although I have started to present mod_perl using scripts, because it&rsquo;s easier if you have written CGI scripts before, the more advanced use of mod_perl is about writing handlers. But have no fear. As you will see in a moment, writing handlers is almost as easy as writing scripts.</p>

<p>To create a mod_perl handler module, all I have to do is to wrap the code I have used for the script into a <code>handler</code> subroutine, add a statement to return the status to the server when the subroutine has successfully completed, and append a package declaration at the top of the code.</p>

<p>Just as with scripts you can use either the CGI API you are probably used to:</p>

<pre><code>  ModPerl/Rules1.pm
  ----------------
  package ModPerl::Rules1;
  use Apache::Constants qw(:common);

  sub handler{
    print &quot;Content-type: text/plain\r\n\r\n&quot;;
    print &quot;mod_perl rules!\n&quot;;
    return OK;
  }
  1; # satisfy require()
</code></pre>

<p>or the Apache Perl API that allows you to interact more intimately with the Apache core by providing an API unavailable under regular Perl. Of course, in the simple example that I show, using any of the approaches is fine, but when you need to use the API, this version of the code should be used.</p>

<pre><code>  ModPerl/Rules2.pm
  ----------------
  package ModPerl::Rules2;
  use Apache::Constants qw(:common);

  sub handler{
    my $r = shift;
    $r-&gt;send_http_header('text/plain');
    print &quot;mod_perl rules!\n&quot;;
    return OK;
  }
  1; # satisfy require()
</code></pre>

<p>Create a directory called <em>ModPerl</em> under one of the directories in <code>@INC</code> (e.g. <em>/usr/lib/perl5/site_perl/5.005</em>), and put <em>Rules1.pm</em> <em>Rules2.pm</em> into it, the files should include the code from the above examples.</p>

<p>To find out what the <code>@INC</code> directories are, execute:</p>

<pre><code>  % perl -le 'print join &quot;\n&quot;, @INC'
</code></pre>

<p>On my machine it reports:</p>

<pre><code>  /usr/lib/perl5/5.6.1/i386-linux
  /usr/lib/perl5/5.6.1
  /usr/lib/perl5/site_perl/5.6.1/i386-linux
  /usr/lib/perl5/site_perl/5.6.1
  /usr/lib/perl5/site_perl
  .
</code></pre>

<p>Now add the following snippet to <em>httpd.conf</em> to configure mod_perl to execute the <code>ModPerl::Rules::handler</code> subroutine whenever a request to <em>mod_perl_rules1</em> is made:</p>

<pre><code>  PerlModule ModPerl::Rules1
  &lt;Location /mod_perl_rules1&gt;
    SetHandler perl-script
    PerlHandler ModPerl::Rules1
  &lt;/Location&gt;
</code></pre>

<p>Now you can issue a request to:</p>

<pre><code>  http://localhost/mod_perl_rules1
</code></pre>

<p>and just as with our <em>mod_perl_rules.pl</em> scripts you will see:</p>

<pre><code>  mod_perl rules!
</code></pre>

<p>as the response.</p>

<p>To test the second module &lt;ModPerl::Rules2&gt; add the same configuration, while replacing all 1&rsquo;s with 2&rsquo;s:</p>

<pre><code>  PerlModule ModPerl::Rules2
  &lt;Location /mod_perl_rules2&gt;
    SetHandler perl-script
    PerlHandler ModPerl::Rules2
  &lt;/Location&gt;
</code></pre>

<p>And to test use the URI:</p>

<pre><code>  http://localhost/mod_perl_rules2
</code></pre>

<h3 id="span-id-is-this-all-i-need-to-know-about-mod-perl-is-this-all-i-need-to-know-about-mod-perl-span"><span id="is this all i need to know about mod_perl">Is This All I Need to Know About mod_perl?</span></h3>

<p>Obviously, the next question you&rsquo;ll ask is: <em>``Is this all I need to know about mod_perl?&rdquo;</em>.</p>

<p>The answer is: `yes and no.</p>

<p>The <em>yes</em> part:</p>

<ul>
<li>Just like with Perl, you have to know little about mod_perl to do really cool stuff. The presented setup allows you to run your visitor counters and guest book much faster, and amaze your friends, usually without changing a single line of code.</li>
</ul>

<p>The <em>No</em> part:</p>

<ul>
<li><p>A 50-fold improvement in guest book response times is great, but when you deploy a heavy service with thousands of concurrent users, taking into account a high-level competition between similar Web services, a delay of a few milliseconds might cost you a customer and probably many of them.</p>

<p>Of course, when you test a single script and you are the only user, you don&rsquo;t really care about squeezing yet another millisecond from response time, but it becomes a real issue when these milliseconds add up at the production site, with hundreds of users concurrently generating requests to various scripts on your site. Users aren&rsquo;t merciful nowadays &ndash; if there is another even less fancier site that provides the same service but a little bit faster, then chances are that they will go over there.</p>

<p>Testing your scripts on an unloaded machine can be misleading, Everything might seem so perfect. But when you move them into a production machine, things don&rsquo;t behave as well as they did on your development box. Many times you just run out of memory on busy services. You need to learn how to optimize your code to use less memory and how to make the memory shared.</p>

<p>Debugging is something people prefer not to talk about, since the process can be tedious. Learning how to make the debugging process simpler and efficient is a must if you consider yourself a Web programmer. This task is especially not so straightforward when debugging CGI scripts, and even more complicated with mod_perl &ndash; unless you know how, and then it suddenly becomes easy.</p>

<table>
<colgroup>
<col width="100%" />
</colgroup>
<tbody>
<tr class="odd">
<td></td>
</tr>
<tr class="even">
<td><p>References</p>
<p>The Apache site's URL: <a href="http://www.apache.org/" class="uri">http://www.apache.org/</a><br />
<br />
The mod_perl site's URL: <a href="http://perl.apache.org/" class="uri">http://perl.apache.org/</a><br />
<br />
CPAN is the Comprehensive Perl Archive Network. The Master site's URL is <a href="http://cpan.org/" class="uri">http://cpan.org/</a>. CPAN is mirrored at more than 100 sites worldwide. (http://cpan.org/SITES.html)</p></td>
</tr>
<tr class="odd">
<td></td>
</tr>
</tbody>
</table>

<p>mod_perl has many features unavailable under mod_cgi when working with databases. Among others the most important are persistent connections.</p>

<p>You have to know how to keep your service running nonstop and be able to recover fast if there are any problems.</p>

<p>Finally, the most important thing is the Apache-Perl API, which allows you to do anything with a received request, even intervene in every stage of request processing. This gives you great flexibility and allows you to create things you couldn&rsquo;t dream about with plain mod_cgi.</p></li>
</ul>

<p>There are many more things to learn about mod_perl and Web programming in general. In future articles, I&rsquo;ll talk in details about all these issues.</p>

<h4 id="span-id-acknowledgements-acknowledgements-span"><span id="acknowledgements">Acknowledgements</span></h4>

<p>Many thanks to Eric Cholet for reviewing this article.</p>

              </article>
              <p><strong>Tags</strong></p>
              <div class="tags">
                <div class="category"><a href="/categories/web">web</a></div>
                
                  <div class="tag"><a href="/tags/mod-perl">mod-perl</a></div>
                
              </div>
            </div>
            
              
                
<div class="row" id="author-bio-stas-bekman">
  <div class="col-sm-2">
    
    <a href="/authors/stas-bekman/"><div class="circle-avatar" style="background-image:url(/images/site/avatar.png)"></div></a>
  </div>
  <div class="col-sm-10">
    <a href="/authors/stas-bekman/"><h3>Stas Bekman</h3></a>
    <p></p>
    <h5><a href="/authors/stas-bekman/">Browse their articles</a></h5>
  </div>
</div>

            
            <div class="row">
              <h3>Feedback</h3>
              <p>Something wrong with this article? Help us out by opening an issue or pull request on <a href="https://github.com/tpf/perldotcom/blob/master/content/legacy/_pub_2002_03_22_modperl.md">GitHub</a></p>
            </div>
          </div>
          <div class="col-md-3">
            <div class="latest-sidebar">

  <div class="row">
    <div class="col-sm-12 centering">
      <span style="font-size:1.8em" class="antonio txt-blue-major">OUR LATEST ARTICLES</span>
    </div>
  </div>
  
    
    
    <div class="row">
        <a href="http://localhost:1313/article/the-perl-admbassador-curtis-poe/">
      <div class="col-sm-3">
        <div class="circle-avatar" style="background-image:url(/images/the-perl-ambassador-curtis-poe/curtis-poe.jpg)"></div>
      </div>
      <div class="col-sm-9">
          <h6>The Perl Ambassador: Curtis &#39;Ovid&#39; Poe</h6>
          <p style="line-height:1"><small>The person behind the news of Perl</small></p>
      </div>
        </a>
    </div>
  
    
    
    <div class="row">
        <a href="http://localhost:1313/article/a-tour-with-net-ftp/">
      <div class="col-sm-3">
        <div class="circle-avatar" style="background-image:url(/images/a-tour-with-net-ftp/thumb_kidyes.jpg)"></div>
      </div>
      <div class="col-sm-9">
          <h6>A tour with Net::FTP</h6>
          <p style="line-height:1"><small>How to write an FTP client in Perl</small></p>
      </div>
        </a>
    </div>
  
    
    
    <div class="row">
        <a href="http://localhost:1313/article/shortcode_test/">
      <div class="col-sm-3">
        <div class="circle-avatar" style="background-image:url(/images/author/brian-d-foy.jpg)"></div>
      </div>
      <div class="col-sm-9">
          <h6>shortcode_test</h6>
          <p style="line-height:1"><small></small></p>
      </div>
        </a>
    </div>
  
    
    
    <div class="row">
        <a href="http://localhost:1313/article/listen-to-larry-wall-s-state-of-the-onion-2000-on-youtube/">
      <div class="col-sm-3">
        <div class="circle-avatar" style="background-image:url(/images/listen-to-larry-wall-s-state-of-the-onion-2000-on-youtube/thumb_larry-wall.jpg)"></div>
      </div>
      <div class="col-sm-9">
          <h6>Listen to Larry Wall&#39;s State of the Onion 2000 on YouTube</h6>
          <p style="line-height:1"><small></small></p>
      </div>
        </a>
    </div>
  
    
    
    <div class="row">
        <a href="http://localhost:1313/article/announcing-perl-7/">
      <div class="col-sm-3">
        <div class="circle-avatar" style="background-image:url(/images/announcing-perl-7/thumb_seven_on_blue_wall.jpg)"></div>
      </div>
      <div class="col-sm-9">
          <h6>Announcing Perl 7</h6>
          <p style="line-height:1"><small>Perl 5 with modern defaults</small></p>
      </div>
        </a>
    </div>
  
</div>
<div class="row" style="margin-top:20px">
  <div class="col-sm-12 centering">
  <script async src="/widget/toplinks/toplinks.js" type="text/javascript"></script>
    <div id="toplinks"></div>
  </div>
</div>

<div class="row" style="margin-top:20px">
  <div class="col-sm-12 centering">
    <a class="twitter-timeline" data-height="640" data-dnt="true" data-theme="dark" href="https://twitter.com/perlfoundation?ref_src=twsrc%5Etfw">Tweets by perlfoundation</a> <script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>
  </div>
</div>

<div class="row" style="margin-top:20px">
  <div class="col-sm-12 centering">
    <script src="https://www.reddit.com/r/perl/hot/.embed?limit=10&t=all" type="text/javascript"></script>
  </div>
</div>



          </div>
        </div>
      </div>
    </section>
  </section>
<script>
 
var tables, i;
tables = document.getElementsByTagName('table');
for (i=0;i<tables.length;i++) {
  tables[i].className = 'table table-striped';
}
</script>
<div class="push"></div>
<div class="footer">
  <div class="container">
    <div class="row">
      <div class="col-md-1">
        <h5>Site Map</h5>
        <ul>
        <li><a href="/">Home</a></li>
        <hr>
        <li><a href="/about">About</a></li>
        <hr>
        <li><a href="/authors">Authors</a></li>
        <hr>
        <li><a href="/categories">Categories</a></li>
        <hr>
        <li><a href="/tags">Tags</a></li>
        <hr>
        </ul>
      </div>
      <div class="col-md-3">
        <h5>Contact Us</h5>
        <p>To get in touch, send an email to: perl.com-editor@perl.org</p>
        <p><a href="https://perl.org">
              <img src="/images/site/perl-onion_20.png" alt="Perl Onion"></a>
          <a href="https://twitter.com/intent/follow?screen_name=perlfoundation">
              <img src="/images/site/twitter_20.png" alt="twitter"></a>
          <a href="/index.xml" /><img src="/images/site/rss_20.png" alt="rss"></a>
          <a href="https://github.com/tpf/perldotcom">
              <img src="/images/site/github_light_20.png" alt="GitHub logo"></a></p>
      </div>
      <div class="col-md-2">
          <h5>License</h5>
          <p>This work is licensed under a <a rel="license" href="https://creativecommons.org/licenses/by-nc/3.0/">Creative Commons Attribution-NonCommercial 3.0 Unported License</a>.</p>
          <p><a rel="license" href="https://creativecommons.org/licenses/by-nc/3.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc/3.0/88x31.png" /></a></p>
      </div>
      <div class="col-md-5">
          <h5>Legal</h5>
          <p>Perl.com and the authors make no representations with respect to the accuracy or completeness of the contents of all work on this website and specifically disclaim all warranties, including without limitation warranties of fitness for a particular purpose. The information published on this website may not be suitable for every situation. All work on this website is provided with the understanding that Perl.com and the authors are not engaged in rendering professional services. Neither Perl.com nor the authors shall be liable for damages arising herefrom.</p>
      </div>
    </div>
  </div>
</div>
<script src="/javascript/jquery.min.js"></script>
<script src="/javascript/bootstrap.min.js"></script>
<script data-no-instant>document.write('<script src="/livereload.js?port=1313&mindelay=10"></' + 'script>')</script></body>
</html>

