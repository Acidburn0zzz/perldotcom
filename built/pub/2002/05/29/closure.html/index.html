<!DOCTYPE html>
<html lang="en-us">
  <head>
  <title> Achieving Closure </title>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Maybe you&#39;ve heard about closures; they&#39;re one of those aspects of Perl - like object-oriented programming - that everyone raves about and you can&#39;t really see the big deal until you play around with them and then they just click...."/>
  <meta name="robots" content="index, follow">
  <meta name="google-site-verification" content="TZowffo_LX2mmsw2DbeNNbukCMnIOA8T-6CMJPiYllI" />

<meta property="twitter:card" content="summary">
<meta property="twitter:site" content="@PerlFoundation">
<meta property="og:url" content="http://localhost:1313/pub/2002/05/29/closure.html/" />
<meta property="og:title" content="Achieving Closure" />
<meta property="og:description" content="Maybe you&#39;ve heard about closures; they&#39;re one of those aspects of Perl - like object-oriented programming - that everyone raves about and you can&#39;t really see the big deal until you play around with them and then they just click....">
<meta property="og:site_name" content="Perl.com" />

<meta property="og:type" content="article" />
<meta property="og:article:published_time" content="2002-05-05T05:05:05Z" />
<meta property="og:image" content="http://localhost:1313/images/_pub_2002_05_29_closure/111-achieve_closure.gif" />
<meta property="og:article:tag" content="closure" />


  <link rel="icon" href="/favicon.ico">
  <link href="/article/index.xml" rel="alternate" type="application/rss+xml" title="Perl.com - programming news, code and culture" />
  <link href="/article/index.xml" rel="feed" type="application/rss+xml" title="Perl.com - programming news, code and culture" />
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" type="text/css" href="/css/perldotcom.css"/>


<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-50555-22', 'auto');
ga('create', 'UA-85734801-2', 'auto', 'editor');
ga('send', 'pageview');
ga('editor.send', 'pageview');
</script>

</head>
<body>

<div class="container-fluid full-wdith antonio">
 <div class="row">
  <div class="navbar-inverse" style="border-radius:none !important" role="navigation">
    <div class="container-fluid">
      <ul class="nav navbar-nav pull-right follow">
          <li>MORE:</li>
          <li><a href="https://perl.org">
              <img src="/images/site/perl-onion_20.png" alt="Perl Onion"></a><li>
          <li><a href="https://twitter.com/intent/follow?screen_name=perlfoundation">
              <img src="/images/site/twitter_20.png" alt="twitter"></a><li>
          <li><a href="/article/index.xml" />
              <img src="/images/site/rss_20.png" alt="rss"></a></li>
          <li><a href="https://github.com/tpf/perldotcom" />
              <img src="/images/site/github_light_20.png" alt="GitHub logo"></a></li>
      </ul>
      <div class="navbar-header">
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
          <a class="navbar-nav" href="/">
            <div class="header-logo">Perl.com</div>
          </a>
      </div>
      <div class="navbar-collapse collapse">
        <ul class="nav navbar-nav">
          <li><a href="/about">
              <div class="circle">
                <img src="/images/site/perl-camel.png" alt="" />
              </div>
                  &nbsp;&nbsp;ABOUT</a>
          </li>
          <li><a href="/authors">
              <div class="circle">
                  <span class="glyphicon glyphicon-user txt-blue-major" aria-hidden="true"></span>
              </div>
                  &nbsp;&nbsp;AUTHORS</a>
          </li>
          <li><a href="/categories">
              <div class="circle">
                  <span class="glyphicon glyphicon-folder-open txt-blue-major" aria-hidden="true"></span>
              </div>
                  &nbsp;&nbsp;CATEGORIES</a>
          </li>
          <li><a href="/tags">
              <div class="circle">
                <span class="txt-blue-major" aria-hidden="true"><strong>#</strong></span>
              </div>
                  &nbsp;&nbsp;TAGS</a>
          </li>
          <li>
            <form class="search" name="ddg" action="https://duckduckgo.com/" method="get">
              <input type="text" name ="q" placeholder="SEARCH" />
              <input type="hidden" value="perl.com" name="sites" />
            </form>
          </li>
        </ul>
      </div>
    </div>
  </div>
 </div>
</div>


  <section id="content" role="main">
    <section class="entry-content">
      <div class="container">
        <div class="row">
          <div class="col-md-9">
            <div class="row">
              <article class="fulltext">
              <h1 class="blog-post-title">Achieving Closure</h1>
              <p class="blog-post-meta">May 29, 2002 by
              
              
                
                
                <a href="#author-bio-simon-cozens">Simon Cozens</a>
              
              </p>
              <img alt="" src=""/>
                <p>Maybe you&rsquo;ve heard about closures; they&rsquo;re one of those aspects of Perl &ndash; like object-oriented programming &ndash; that everyone raves about and you can&rsquo;t really see the big deal until you play around with them and then they just click. In this article, we&rsquo;re going to play around with some closures, in the hope that they&rsquo;ll just click for you.</p>

<p>The nice thing about playing around with closures is that you often don&rsquo;t realize you&rsquo;re doing it. Don&rsquo;t believe me? OK, here&rsquo;s an ordinary piece of Perl:</p>

<pre><code>    my $print_hello = sub { print &quot;Hello, world!&quot;; }

    $print_hello-&gt;();
</code></pre>

<p>We create a subroutine reference in <code>$print_hello</code>, and then we dereference it, calling the subroutine. I suppose we could put that into a subroutine:</p>

<pre><code>    sub make_hello_printer {
        return sub { print &quot;Hello, world!&quot;; }
    }

    my $print_hello = make_hello_printer();
    $print_hello-&gt;()
</code></pre>

<p>Still nothing magical going on here. And it shouldn&rsquo;t be any surprise to you that we can move the &ldquo;message&rdquo; to a separate variable, like this:</p>

<pre><code>    sub make_hello_printer {
        my $message = &quot;Hello, world!&quot;;
        return sub { print $message; }
    }

    my $print_hello = make_hello_printer();
    $print_hello-&gt;()
</code></pre>

<p>As you&rsquo;d expect, that prints out the <code>Hello, world!</code> message. Nothing special going on here, is there? Well, actually, there is. This is a closure. Did you notice?</p>

<p>What&rsquo;s special is that the subroutine reference we created refers to a lexical variable called <code>$message</code>. The lexical is defined in <code>make_hello_printer</code>, so by rights, it shouldn&rsquo;t be visible outside of <code>make_hello_printer</code>, right? We call <code>make_hello_printer</code>, <code>$message</code> gets created, we return the subroutine reference, and then <code>$message</code> goes away, out of scope.</p>

<p>Except it doesn&rsquo;t. When we call our subroutine reference, outside of <code>make_hello_printer</code>, it can still see and receive the correct value of <code>$message</code>. The subroutine reference forms a <em>closure</em>, ``enclosing&rdquo; the lexical variables it refers to.</p>

<p>Here&rsquo;s the canonical example of closures, that you&rsquo;ll find in practically every Perl book:</p>

<pre><code>    sub make_counter {
        my $start = shift;
        return sub { $start++ }
    }

    my $from_ten = make_counter(10);
    my $from_three = make_counter(3);

    print $from_ten-&gt;();       # 10
    print $from_ten-&gt;();       # 11
    print $from_three-&gt;();     # 3
    print $from_ten-&gt;();       # 12
    print $from_three-&gt;();     # 4
</code></pre>

<p>We&rsquo;ve created two &ldquo;counter&rdquo; subroutines, which have completely independent values. This happens because each time we call <code>make_counter</code>, Perl creates a new lexical for <code>$start</code>, which gets wrapped up in the closure we return. So <code>$from_ten</code> encloses one <code>$start</code> which is initialized to 10, and <code>$from_three</code> encloses a <strong>totally different</strong> <code>$start</code>, which starts at 3.</p>

<p>It&rsquo;s because of this property that Barrie Slaymaker calls closures &ldquo;inside-out objects:&rdquo; objects are data that have some subroutines attached to them, and closures are subroutines that have some data attached to them.</p>

<p>Now, I said that&rsquo;s used in practically every Perl book, because authors try and put off discussing closures until there&rsquo;s little time left and they run out of imagination. (Well, at least that&rsquo;s my excuse &hellip;) However, it&rsquo;s not an entirely practical example, to say the least. So let&rsquo;s try and find a better one.</p>

<p>This example is a bit more complex, but it demonstrates more clearly one extremely useful feature of closures: They can be used to bridge the gap between event-driven programs, which use callbacks extensively, and ordinary procedural code. I recently had to convert a bunch of XML files into an SQL database. Each file constituted a training course, so I wanted to build a data structure that contained the filename plus some of the details I&rsquo;d parsed from the XML. Here&rsquo;s what I ended up with:</p>

<pre><code>    use XML::Twig;
    my %courses;
    for (&lt;??.xml&gt;) {
        my $name = $_; $name =~ s/.xml//;
        my $t= XML::Twig-&gt;new( 
            TwigHandlers =&gt; {
                need =&gt; sub { 
                    push @{$courses{$name}{prereqs}}, $_-&gt;{'att'}-&gt;{course};
                },
                # ...
            }
        );
        $t-&gt;parsefile($_);
    }
</code></pre>

<p>What&rsquo;s going on here? <code>XML::Twig</code> is a handy module that can be used to create an XML parser &ndash; these parsers will call &ldquo;TwigHandlers&rdquo; when they meet various tags. We go through all the two-letter XML files in the current directory, and create a parser to parse the file. When we see something like this:</p>

<pre><code>    &lt;need course=&quot;AA&quot;/&gt;
</code></pre>

<p>our <code>need</code> handler is called to store the fact that the current course has a prerequisite of the course coded &ldquo;AA.&rdquo; (<code>$_-&gt;{'att'}-&gt;{...}</code> is <code>XML::Twig</code>-speak for &ldquo;retrieve the value of the attribute called &hellip;&rdquo;)</p>

<p>And that <code>need</code> handler is a closure &ndash; it wraps up the name of the current file we&rsquo;re parsing, <code>$name</code>, so that it can be referred to whenever <code>XML::Twig</code> decides to use it.</p>

<p>There are many other things you can do with closures &ndash; Tom Christiansen once recommended using them for &ldquo;data hiding&rdquo; in object-oriented code, since they rely on lexical variables that nothing outside of the closure can see. In fact, some of the most <a href="http://perl.plover.com/lambda/tpj.html">esoteric and advanced</a> applications of Perl make heavy use of closures.</p>

<p>But as we&rsquo;ve seen, some of the most useful uses of closures can happen without you noticing them at all &hellip;</p>

              </article>
              <p><strong>Tags</strong></p>
              <div class="tags">
                <div class="category"><a href="/categories/development">development</a></div>
                
                  <div class="tag"><a href="/tags/closure">closure</a></div>
                
              </div>
            </div>
            
              
                
<div class="row" id="author-bio-simon-cozens">
  <div class="col-sm-2">
    
    <a href="/authors/simon-cozens/"><div class="circle-avatar" style="background-image:url(/images/author/simon-cozens.jpg)"></div></a>
  </div>
  <div class="col-sm-10">
    <a href="/authors/simon-cozens/"><h3>Simon Cozens</h3></a>
    <p></p>
    <h5><a href="/authors/simon-cozens/">Browse their articles</a></h5>
  </div>
</div>

            
            <div class="row">
              <h3>Feedback</h3>
              <p>Something wrong with this article? Help us out by opening an issue or pull request on <a href="https://github.com/tpf/perldotcom/blob/master/content/legacy/_pub_2002_05_29_closure.md">GitHub</a></p>
            </div>
          </div>
          <div class="col-md-3">
            <div class="latest-sidebar">

  <div class="row">
    <div class="col-sm-12 centering">
      <span style="font-size:1.8em" class="antonio txt-blue-major">OUR LATEST ARTICLES</span>
    </div>
  </div>
  
    
    
    <div class="row">
        <a href="http://localhost:1313/article/the-perl-admbassador-curtis-poe/">
      <div class="col-sm-3">
        <div class="circle-avatar" style="background-image:url(/images/the-perl-ambassador-curtis-poe/curtis-poe.jpg)"></div>
      </div>
      <div class="col-sm-9">
          <h6>The Perl Ambassador: Curtis &#39;Ovid&#39; Poe</h6>
          <p style="line-height:1"><small>The person behind the news of Perl</small></p>
      </div>
        </a>
    </div>
  
    
    
    <div class="row">
        <a href="http://localhost:1313/article/a-tour-with-net-ftp/">
      <div class="col-sm-3">
        <div class="circle-avatar" style="background-image:url(/images/a-tour-with-net-ftp/thumb_kidyes.jpg)"></div>
      </div>
      <div class="col-sm-9">
          <h6>A tour with Net::FTP</h6>
          <p style="line-height:1"><small>How to write an FTP client in Perl</small></p>
      </div>
        </a>
    </div>
  
    
    
    <div class="row">
        <a href="http://localhost:1313/article/shortcode_test/">
      <div class="col-sm-3">
        <div class="circle-avatar" style="background-image:url(/images/author/brian-d-foy.jpg)"></div>
      </div>
      <div class="col-sm-9">
          <h6>shortcode_test</h6>
          <p style="line-height:1"><small></small></p>
      </div>
        </a>
    </div>
  
    
    
    <div class="row">
        <a href="http://localhost:1313/article/listen-to-larry-wall-s-state-of-the-onion-2000-on-youtube/">
      <div class="col-sm-3">
        <div class="circle-avatar" style="background-image:url(/images/listen-to-larry-wall-s-state-of-the-onion-2000-on-youtube/thumb_larry-wall.jpg)"></div>
      </div>
      <div class="col-sm-9">
          <h6>Listen to Larry Wall&#39;s State of the Onion 2000 on YouTube</h6>
          <p style="line-height:1"><small></small></p>
      </div>
        </a>
    </div>
  
    
    
    <div class="row">
        <a href="http://localhost:1313/article/announcing-perl-7/">
      <div class="col-sm-3">
        <div class="circle-avatar" style="background-image:url(/images/announcing-perl-7/thumb_seven_on_blue_wall.jpg)"></div>
      </div>
      <div class="col-sm-9">
          <h6>Announcing Perl 7</h6>
          <p style="line-height:1"><small>Perl 5 with modern defaults</small></p>
      </div>
        </a>
    </div>
  
</div>
<div class="row" style="margin-top:20px">
  <div class="col-sm-12 centering">
  <script async src="/widget/toplinks/toplinks.js" type="text/javascript"></script>
    <div id="toplinks"></div>
  </div>
</div>

<div class="row" style="margin-top:20px">
  <div class="col-sm-12 centering">
    <a class="twitter-timeline" data-height="640" data-dnt="true" data-theme="dark" href="https://twitter.com/perlfoundation?ref_src=twsrc%5Etfw">Tweets by perlfoundation</a> <script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>
  </div>
</div>

<div class="row" style="margin-top:20px">
  <div class="col-sm-12 centering">
    <script src="https://www.reddit.com/r/perl/hot/.embed?limit=10&t=all" type="text/javascript"></script>
  </div>
</div>



          </div>
        </div>
      </div>
    </section>
  </section>
<script>
 
var tables, i;
tables = document.getElementsByTagName('table');
for (i=0;i<tables.length;i++) {
  tables[i].className = 'table table-striped';
}
</script>
<div class="push"></div>
<div class="footer">
  <div class="container">
    <div class="row">
      <div class="col-md-1">
        <h5>Site Map</h5>
        <ul>
        <li><a href="/">Home</a></li>
        <hr>
        <li><a href="/about">About</a></li>
        <hr>
        <li><a href="/authors">Authors</a></li>
        <hr>
        <li><a href="/categories">Categories</a></li>
        <hr>
        <li><a href="/tags">Tags</a></li>
        <hr>
        </ul>
      </div>
      <div class="col-md-3">
        <h5>Contact Us</h5>
        <p>To get in touch, send an email to: perl.com-editor@perl.org</p>
        <p><a href="https://perl.org">
              <img src="/images/site/perl-onion_20.png" alt="Perl Onion"></a>
          <a href="https://twitter.com/intent/follow?screen_name=perlfoundation">
              <img src="/images/site/twitter_20.png" alt="twitter"></a>
          <a href="/index.xml" /><img src="/images/site/rss_20.png" alt="rss"></a>
          <a href="https://github.com/tpf/perldotcom">
              <img src="/images/site/github_light_20.png" alt="GitHub logo"></a></p>
      </div>
      <div class="col-md-2">
          <h5>License</h5>
          <p>This work is licensed under a <a rel="license" href="https://creativecommons.org/licenses/by-nc/3.0/">Creative Commons Attribution-NonCommercial 3.0 Unported License</a>.</p>
          <p><a rel="license" href="https://creativecommons.org/licenses/by-nc/3.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc/3.0/88x31.png" /></a></p>
      </div>
      <div class="col-md-5">
          <h5>Legal</h5>
          <p>Perl.com and the authors make no representations with respect to the accuracy or completeness of the contents of all work on this website and specifically disclaim all warranties, including without limitation warranties of fitness for a particular purpose. The information published on this website may not be suitable for every situation. All work on this website is provided with the understanding that Perl.com and the authors are not engaged in rendering professional services. Neither Perl.com nor the authors shall be liable for damages arising herefrom.</p>
      </div>
    </div>
  </div>
</div>
<script src="/javascript/jquery.min.js"></script>
<script src="/javascript/bootstrap.min.js"></script>
<script data-no-instant>document.write('<script src="/livereload.js?port=1313&mindelay=10"></' + 'script>')</script></body>
</html>

