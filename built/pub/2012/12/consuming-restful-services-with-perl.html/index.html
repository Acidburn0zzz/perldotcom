<!DOCTYPE html>
<html lang="en-us">
  <head>
  <title> Consuming RESTful Services with Perl </title>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="When JT Smith ported his web game The Lacuna Expanse to a board game, he used Perl to create the board game itself. Here&#39;s how he built the web service behind The Game Crafter."/>
  <meta name="robots" content="index, follow">
  <meta name="google-site-verification" content="TZowffo_LX2mmsw2DbeNNbukCMnIOA8T-6CMJPiYllI" />

<meta property="twitter:card" content="summary">
<meta property="twitter:site" content="@PerlFoundation">
<meta property="og:url" content="http://localhost:1313/pub/2012/12/consuming-restful-services-with-perl.html/" />
<meta property="og:title" content="Consuming RESTful Services with Perl" />
<meta property="og:description" content="When JT Smith ported his web game The Lacuna Expanse to a board game, he used Perl to create the board game itself. Here&#39;s how he built the web service behind The Game Crafter.">
<meta property="og:site_name" content="Perl.com" />

<meta property="og:type" content="article" />
<meta property="og:article:published_time" content="2012-12-12T12:12:12Z" />
<meta property="og:image" content="http://localhost:1313/images/author/jt-smith.jpg" />


  <link rel="icon" href="/favicon.ico">
  <link href="/article/index.xml" rel="alternate" type="application/rss+xml" title="Perl.com - programming news, code and culture" />
  <link href="/article/index.xml" rel="feed" type="application/rss+xml" title="Perl.com - programming news, code and culture" />
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" type="text/css" href="/css/perldotcom.css"/>


<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-50555-22', 'auto');
ga('create', 'UA-85734801-2', 'auto', 'editor');
ga('send', 'pageview');
ga('editor.send', 'pageview');
</script>

</head>
<body>

<div class="container-fluid full-wdith antonio">
 <div class="row">
  <div class="navbar-inverse" style="border-radius:none !important" role="navigation">
    <div class="container-fluid">
      <ul class="nav navbar-nav pull-right follow">
          <li>MORE:</li>
          <li><a href="https://perl.org">
              <img src="/images/site/perl-onion_20.png" alt="Perl Onion"></a><li>
          <li><a href="https://twitter.com/intent/follow?screen_name=perlfoundation">
              <img src="/images/site/twitter_20.png" alt="twitter"></a><li>
          <li><a href="/article/index.xml" />
              <img src="/images/site/rss_20.png" alt="rss"></a></li>
          <li><a href="https://github.com/tpf/perldotcom" />
              <img src="/images/site/github_light_20.png" alt="GitHub logo"></a></li>
      </ul>
      <div class="navbar-header">
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
          <a class="navbar-nav" href="/">
            <div class="header-logo">Perl.com</div>
          </a>
      </div>
      <div class="navbar-collapse collapse">
        <ul class="nav navbar-nav">
          <li><a href="/about">
              <div class="circle">
                <img src="/images/site/perl-camel.png" alt="" />
              </div>
                  &nbsp;&nbsp;ABOUT</a>
          </li>
          <li><a href="/authors">
              <div class="circle">
                  <span class="glyphicon glyphicon-user txt-blue-major" aria-hidden="true"></span>
              </div>
                  &nbsp;&nbsp;AUTHORS</a>
          </li>
          <li><a href="/categories">
              <div class="circle">
                  <span class="glyphicon glyphicon-folder-open txt-blue-major" aria-hidden="true"></span>
              </div>
                  &nbsp;&nbsp;CATEGORIES</a>
          </li>
          <li><a href="/tags">
              <div class="circle">
                <span class="txt-blue-major" aria-hidden="true"><strong>#</strong></span>
              </div>
                  &nbsp;&nbsp;TAGS</a>
          </li>
          <li>
            <form class="search" name="ddg" action="https://duckduckgo.com/" method="get">
              <input type="text" name ="q" placeholder="SEARCH" />
              <input type="hidden" value="perl.com" name="sites" />
            </form>
          </li>
        </ul>
      </div>
    </div>
  </div>
 </div>
</div>


  <section id="content" role="main">
    <section class="entry-content">
      <div class="container">
        <div class="row">
          <div class="col-md-9">
            <div class="row">
              <article class="fulltext">
              <h1 class="blog-post-title">Consuming RESTful Services with Perl</h1>
              <p class="blog-post-meta">Dec 31, 2012 by
              
              
                
                
                <a href="#author-bio-jt-smith">JT Smith</a>
              
              </p>
              <img alt="" src=""/>
                

<p>In my previous article I described <a href="/pub/2012/11/designing-board-games-with-perl.html">how to create board game images using <code>Image::Magick</code></a>, thus allowing you to design board games using Perl. This time I want to show you how to upload those images to <a href="https://www.thegamecrafter.com/">The Game Crafter</a> so you get get a professional copy of the game manufactured.</p>

<p>In the last article I <a href="https://www.thegamecrafter.com/games/lacuna-expanse:-a-new-empire">created a board game version</a> of the video game called <a href="http://www.lacunaexpanse.com">The Lacuna Expanse</a>. This time I&rsquo;ll show how to upload those images to the site to create a custom board game. Don&rsquo;t worry if you&rsquo;re not ready to create a board game or if you&rsquo;ll never be ready; the principles of designing a useful API and using it apply to all sorts of services you might want to use, from weather tracking to stocks to medical systems. I picked games for two reasons. One, me and I team just built this system, so it&rsquo;s shiny and new and I&rsquo;ve learned a lot. Two, games are more fun (and visual) than showing how to record invoice information in a RESTful ERP application.</p>

<h2 id="getting-ready">Getting Ready</h2>

<p>First, get yourself a copy of <a href="https://metacpan.org/pod/TheGameCrafter::Client">TheGameCrafter::Client</a>. It&rsquo;s a Perl module that makes it trivial to interact with The Game Crafter&rsquo;s RESTful web service API. When you <code>use TheGameCrafter::Client;</code> it imports <code>tgc_get()</code>, <code>tgc_post()</code>, <code>tgc_put()</code>, and <code>tgc_delete()</code> into your program for easy use. <em>Good APIs are descriptive and obvious.</em> From there you can have a look at The Game Crafter&rsquo;s <a href="https://www.thegamecrafter.com/developer/">developer documentation</a> to do any custom stuff you want. <em>Good APIs have useful documentation.</em></p>

<p>You&rsquo;ll also need to activate the <a href="https://www.thegamecrafter.com/account">developer setting in your TGC account</a>, and <a href="https://www.thegamecrafter.com/account/apikeys">request an API key</a>. <em>Good APIs demonstrate security in authorization and authentication.</em></p>

<h2 id="a-little-about-the-game-crafter-s-api">A Little about The Game Crafter&rsquo;s API</h2>

<p><code>TheGameCrafter::Client</code> is just a tiny wrapper around our RESTful web services. I designed the web services atop <a href="https://metacpan.org/pod/Dancer">Dancer</a> and <a href="https://metacpan.org/pod/DBIx::Class">DBIx::Class</a>. My goal with this was to build a very reliable and consistent API not only for external use but internal. You see, the <em>entire</em> TGC web site actually runs off these web services. Not only that, but these web services tie directly into our manufacturing facility, so they are controlling the physical world in addition to the virtual. <em>Good APIs allow you to build multiple clients with different uses.</em> (They don&rsquo;t <em>require</em> multiple clients, but they don&rsquo;t forbid it and do enable it.)</p>

<p>With Lacuna, I built <a href="https://metacpan.org/pod/JSON::RPC::Dispatcher">JSON::RPC::Dispatcher</a> (JRD), which is a JSON-RPC 2.0 web service handler on top of <a href="https://metacpan.org/pod/Plack">Plack</a>. I love JRD, but it has two weaknesses, one of them fatal. One weakness is that you must format parameters using JSON, which means that it&rsquo;s not easy to just call a URL and get a result with something like <code>curl</code>. (<em>Good RESTful APIs allow multiple clients.</em> If you can&rsquo;t use <code>curl</code>, you probably have a problem.) The fatal weakness of JSON-RPC 2.0 is that there is no way to do file uploads within the spec. The Game Crafter is all about file uploads, so that meant I either needed to handle those separately (aka inconsistently), or develop something new. I opted for the latter.</p>

<p>With TGC&rsquo;s web services I decided to adopt some of the things I really liked about JSON-RPC, namely the way it handles responses whether they be result sets or errors. So you always get a consistent return:</p>

<pre><code>{ &quot;result&quot; : { ... } }

{
   &quot;error&quot; : {
        &quot;code&quot; : 404,
        &quot;message&quot; : &quot;File not found.&quot;,
        &quot;data&quot; : &quot;file_id&quot;
   }
}
</code></pre>

<p>With TGC I also wanted a consistent and easy way of turning <code>DBIx::Class</code> into web services through Dancer. I looked into things like <a href="https://metacpan.org/pod/AutoCRUD">AutoCRUD</a>, but I&rsquo;m not a fan of Catalyst, and it also took too much configuration (in my opinion) to get it working. I wanted something simpler and faster, so I decided to roll my own. The result was a thin layer of glue between Dancer and <code>DBIx::Class</code> that allows you to define your web service interface in your normal <code>DBIx::Class</code> declarations. It automatically then generates the web services, databases tables, web form handling, and more for you. This little glue layer is now in use in all web app development within <a href="http://www.plainblack.com/">Plain Black</a>, and eventually we&rsquo;ll be releasing it onto CPAN for all to use for free. The best part of that is that you know you&rsquo;re getting a production-ready system because it&rsquo;s been running The Game Crafter and other sites for over a year now. (<em>Good APIs are often extracted from working systems.</em>) More on that in a future article.</p>

<h2 id="let-s-do-this-thing-already">Let&rsquo;s Do This Thing Already</h2>

<p>Before you can make any API calls, you need to authenticate.</p>

<pre><code> my $session = tgc_post('session',{
   username    =&gt; 'me',
   password    =&gt; '123qwe',
   api_key_id  =&gt; 'abcdefhij',
 });
</code></pre>

<p>Before you can start uploading, fetch your user account information. This contains several pieces of info that you can use.</p>

<pre><code> my $user = tgc_get('user', {
   session_id    =&gt; $session-&gt;{id},           # using our session to do stuff
});
</code></pre>

<p>Think of TGC projects like filesystems: you have folders which contain folders and files. First create a folder, then upload a file:</p>

<pre><code> my $folder = tgc_post('folder', {
  session_id  =&gt; $session-&gt;{id},
  name        =&gt; 'Lacuna',
  user_id     =&gt; $user-&gt;{id},
  parent_id   =&gt; $user-&gt;{root_folder_id},  # putting this in the home folder
 });

 my $file = tgc_post('file', {
  session_id  =&gt; $session-&gt;{id},
  name        =&gt; 'Mayhem Training',
  file        =&gt; ['mayhem.png'],         # the array ref signifies this is a file path
  folder_id   =&gt; $folder-&gt;{id},       # putting it in the just-created folder
 });
</code></pre>

<p>Assuming at this point you&rsquo;ve uploaded all of your files, you can now build out your game. The Game Crafter has this notion of a &ldquo;Designer&rdquo;, which is sort of like your very own publishing company. Games are attached to the designer, so first you must create the designer, then the game.</p>

<pre><code> my $designer = tgc_post('designer', {
  session_id  =&gt; $session-&gt;{id},
  user_id     =&gt; $user-&gt;{id},
  name        =&gt; 'Lacuna Expanse Corp',
 });

 my $game = tgc_post('game', {
  session_id  =&gt; $session-&gt;{id},
  designer_id =&gt; $designer-&gt;{id},
  name        =&gt; 'Lacuna Expanse: A New Empire',
 });
</code></pre>

<p>With a game created and assets uploaded, you can now create a deck of cards. This is pretty straight forward just like before.</p>

<pre><code> my $deck = tgc_post('minideck', {
  session_id =&gt; $session-&gt;{id},
  name       =&gt; 'Planet',
  game_id    =&gt; $game-&gt;{id},
 });

 my $card = tgc_post('minicard', {
  session_id =&gt; $session-&gt;{id},
  name       =&gt; 'Mayhem Training',
  face_id    =&gt; $file-&gt;{id},
  deck_id    =&gt; $deck-&gt;{id},
 });
</code></pre>

<p>You have probably noticed already how closely this resembles CRUD operations, because it does. Behind the scenes, who knows what TGC does with this information? (I do, but that&rsquo;s because I wrote it.) It doesn&rsquo;t matter to the API, because all of those details are hidden behind a good API. *Good APIs expose only the necessary details*—in this case, the relationships between folders and files and between designers and games.</p>

<p>You can also see that the API is as stateless as possible, where the session identifier is part of every API call. It&rsquo;s easy to imagine a more complicated API which hides this, but I stuck with the bare-bones REST for at least two reasons: it&rsquo;s simple, and it&rsquo;s easy to see what&rsquo;s happening. Someone could build over the top of this API if desired. <em>Good APIs allow extension and further abstraction.</em></p>

<p>Just like that, you&rsquo;ve created a game and added a deck of cards to it. There are of course lots of other fancy things you can do with the API, but this should get you started. I wouldn&rsquo;t leave you hanging there, however. I&rsquo;ve <a href="https://github.com/plainblack/Lacuna-Board-Game">open sourced the actual code</a> I used to create <a href="https://www.thegamecrafter.com/games/lacuna-expanse:-a-new-empire">the Lacuna Expanse board game</a> so you&rsquo;d have something to reference. There&rsquo;s also a <a href="https://community.thegamecrafter.com/forums/developers">developer&rsquo;s forum</a> if you have any questions. Good luck to you, and happy gaming!</p>

              </article>
              <p><strong>Tags</strong></p>
              <div class="tags">
                <div class="category"><a href="/categories/web">web</a></div>
                
              </div>
            </div>
            
              
                
<div class="row" id="author-bio-jt-smith">
  <div class="col-sm-2">
    
    <a href="/authors/jt-smith/"><div class="circle-avatar" style="background-image:url(/images/author/jt-smith.jpg)"></div></a>
  </div>
  <div class="col-sm-10">
    <a href="/authors/jt-smith/"><h3>JT Smith</h3></a>
    <p></p>
    <h5><a href="/authors/jt-smith/">Browse their articles</a></h5>
  </div>
</div>

            
            <div class="row">
              <h3>Feedback</h3>
              <p>Something wrong with this article? Help us out by opening an issue or pull request on <a href="https://github.com/tpf/perldotcom/blob/master/content/legacy/_pub_2012_12_consuming-restful-services-with-perl.md">GitHub</a></p>
            </div>
          </div>
          <div class="col-md-3">
            <div class="latest-sidebar">

  <div class="row">
    <div class="col-sm-12 centering">
      <span style="font-size:1.8em" class="antonio txt-blue-major">OUR LATEST ARTICLES</span>
    </div>
  </div>
  
    
    
    <div class="row">
        <a href="http://localhost:1313/article/the-perl-admbassador-curtis-poe/">
      <div class="col-sm-3">
        <div class="circle-avatar" style="background-image:url(/images/the-perl-ambassador-curtis-poe/curtis-poe.jpg)"></div>
      </div>
      <div class="col-sm-9">
          <h6>The Perl Ambassador: Curtis &#39;Ovid&#39; Poe</h6>
          <p style="line-height:1"><small>The person behind the news of Perl</small></p>
      </div>
        </a>
    </div>
  
    
    
    <div class="row">
        <a href="http://localhost:1313/article/a-tour-with-net-ftp/">
      <div class="col-sm-3">
        <div class="circle-avatar" style="background-image:url(/images/a-tour-with-net-ftp/thumb_kidyes.jpg)"></div>
      </div>
      <div class="col-sm-9">
          <h6>A tour with Net::FTP</h6>
          <p style="line-height:1"><small>How to write an FTP client in Perl</small></p>
      </div>
        </a>
    </div>
  
    
    
    <div class="row">
        <a href="http://localhost:1313/article/shortcode_test/">
      <div class="col-sm-3">
        <div class="circle-avatar" style="background-image:url(/images/author/brian-d-foy.jpg)"></div>
      </div>
      <div class="col-sm-9">
          <h6>shortcode_test</h6>
          <p style="line-height:1"><small></small></p>
      </div>
        </a>
    </div>
  
    
    
    <div class="row">
        <a href="http://localhost:1313/article/listen-to-larry-wall-s-state-of-the-onion-2000-on-youtube/">
      <div class="col-sm-3">
        <div class="circle-avatar" style="background-image:url(/images/listen-to-larry-wall-s-state-of-the-onion-2000-on-youtube/thumb_larry-wall.jpg)"></div>
      </div>
      <div class="col-sm-9">
          <h6>Listen to Larry Wall&#39;s State of the Onion 2000 on YouTube</h6>
          <p style="line-height:1"><small></small></p>
      </div>
        </a>
    </div>
  
    
    
    <div class="row">
        <a href="http://localhost:1313/article/announcing-perl-7/">
      <div class="col-sm-3">
        <div class="circle-avatar" style="background-image:url(/images/announcing-perl-7/thumb_seven_on_blue_wall.jpg)"></div>
      </div>
      <div class="col-sm-9">
          <h6>Announcing Perl 7</h6>
          <p style="line-height:1"><small>Perl 5 with modern defaults</small></p>
      </div>
        </a>
    </div>
  
</div>
<div class="row" style="margin-top:20px">
  <div class="col-sm-12 centering">
  <script async src="/widget/toplinks/toplinks.js" type="text/javascript"></script>
    <div id="toplinks"></div>
  </div>
</div>

<div class="row" style="margin-top:20px">
  <div class="col-sm-12 centering">
    <a class="twitter-timeline" data-height="640" data-dnt="true" data-theme="dark" href="https://twitter.com/perlfoundation?ref_src=twsrc%5Etfw">Tweets by perlfoundation</a> <script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>
  </div>
</div>

<div class="row" style="margin-top:20px">
  <div class="col-sm-12 centering">
    <script src="https://www.reddit.com/r/perl/hot/.embed?limit=10&t=all" type="text/javascript"></script>
  </div>
</div>



          </div>
        </div>
      </div>
    </section>
  </section>
<script>
 
var tables, i;
tables = document.getElementsByTagName('table');
for (i=0;i<tables.length;i++) {
  tables[i].className = 'table table-striped';
}
</script>
<div class="push"></div>
<div class="footer">
  <div class="container">
    <div class="row">
      <div class="col-md-1">
        <h5>Site Map</h5>
        <ul>
        <li><a href="/">Home</a></li>
        <hr>
        <li><a href="/about">About</a></li>
        <hr>
        <li><a href="/authors">Authors</a></li>
        <hr>
        <li><a href="/categories">Categories</a></li>
        <hr>
        <li><a href="/tags">Tags</a></li>
        <hr>
        </ul>
      </div>
      <div class="col-md-3">
        <h5>Contact Us</h5>
        <p>To get in touch, send an email to: perl.com-editor@perl.org</p>
        <p><a href="https://perl.org">
              <img src="/images/site/perl-onion_20.png" alt="Perl Onion"></a>
          <a href="https://twitter.com/intent/follow?screen_name=perlfoundation">
              <img src="/images/site/twitter_20.png" alt="twitter"></a>
          <a href="/index.xml" /><img src="/images/site/rss_20.png" alt="rss"></a>
          <a href="https://github.com/tpf/perldotcom">
              <img src="/images/site/github_light_20.png" alt="GitHub logo"></a></p>
      </div>
      <div class="col-md-2">
          <h5>License</h5>
          <p>This work is licensed under a <a rel="license" href="https://creativecommons.org/licenses/by-nc/3.0/">Creative Commons Attribution-NonCommercial 3.0 Unported License</a>.</p>
          <p><a rel="license" href="https://creativecommons.org/licenses/by-nc/3.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc/3.0/88x31.png" /></a></p>
      </div>
      <div class="col-md-5">
          <h5>Legal</h5>
          <p>Perl.com and the authors make no representations with respect to the accuracy or completeness of the contents of all work on this website and specifically disclaim all warranties, including without limitation warranties of fitness for a particular purpose. The information published on this website may not be suitable for every situation. All work on this website is provided with the understanding that Perl.com and the authors are not engaged in rendering professional services. Neither Perl.com nor the authors shall be liable for damages arising herefrom.</p>
      </div>
    </div>
  </div>
</div>
<script src="/javascript/jquery.min.js"></script>
<script src="/javascript/bootstrap.min.js"></script>
<script data-no-instant>document.write('<script src="/livereload.js?port=1313&mindelay=10"></' + 'script>')</script></body>
</html>

