<!DOCTYPE html>
<html lang="en-us">
  <head>
  <title> Writing on Walls with Facebook::Graph </title>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="JT Smith shows how to write Facebook applications with offline permissions to post to user walls with Perl and Facebook::Graph."/>
  <meta name="robots" content="index, follow">
  <meta name="google-site-verification" content="TZowffo_LX2mmsw2DbeNNbukCMnIOA8T-6CMJPiYllI" />

<meta property="twitter:card" content="summary">
<meta property="twitter:site" content="@PerlFoundation">
<meta property="og:url" content="http://localhost:1313/pub/2011/04/writing-on-walls-with-facebookgraph.html/" />
<meta property="og:title" content="Writing on Walls with Facebook::Graph" />
<meta property="og:description" content="JT Smith shows how to write Facebook applications with offline permissions to post to user walls with Perl and Facebook::Graph.">
<meta property="og:site_name" content="Perl.com" />

<meta property="og:type" content="article" />
<meta property="og:article:published_time" content="2011-04-04T04:04:04Z" />
<meta property="og:image" content="http://localhost:1313/images/author/jt-smith.jpg" />
<meta property="og:article:tag" content="cpan" />
<meta property="og:article:tag" content="dancer" />
<meta property="og:article:tag" content="facebook" />
<meta property="og:article:tag" content="facebook-graph" />
<meta property="og:article:tag" content="web-development" />


  <link rel="icon" href="/favicon.ico">
  <link href="/article/index.xml" rel="alternate" type="application/rss+xml" title="Perl.com - programming news, code and culture" />
  <link href="/article/index.xml" rel="feed" type="application/rss+xml" title="Perl.com - programming news, code and culture" />
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" type="text/css" href="/css/perldotcom.css"/>


<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-50555-22', 'auto');
ga('create', 'UA-85734801-2', 'auto', 'editor');
ga('send', 'pageview');
ga('editor.send', 'pageview');
</script>

</head>
<body>

<div class="container-fluid full-wdith antonio">
 <div class="row">
  <div class="navbar-inverse" style="border-radius:none !important" role="navigation">
    <div class="container-fluid">
      <ul class="nav navbar-nav pull-right follow">
          <li>MORE:</li>
          <li><a href="https://perl.org">
              <img src="/images/site/perl-onion_20.png" alt="Perl Onion"></a><li>
          <li><a href="https://twitter.com/intent/follow?screen_name=perlfoundation">
              <img src="/images/site/twitter_20.png" alt="twitter"></a><li>
          <li><a href="/article/index.xml" />
              <img src="/images/site/rss_20.png" alt="rss"></a></li>
          <li><a href="https://github.com/tpf/perldotcom" />
              <img src="/images/site/github_light_20.png" alt="GitHub logo"></a></li>
      </ul>
      <div class="navbar-header">
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
          <a class="navbar-nav" href="/">
            <div class="header-logo">Perl.com</div>
          </a>
      </div>
      <div class="navbar-collapse collapse">
        <ul class="nav navbar-nav">
          <li><a href="/about">
              <div class="circle">
                <img src="/images/site/perl-camel.png" alt="" />
              </div>
                  &nbsp;&nbsp;ABOUT</a>
          </li>
          <li><a href="/authors">
              <div class="circle">
                  <span class="glyphicon glyphicon-user txt-blue-major" aria-hidden="true"></span>
              </div>
                  &nbsp;&nbsp;AUTHORS</a>
          </li>
          <li><a href="/categories">
              <div class="circle">
                  <span class="glyphicon glyphicon-folder-open txt-blue-major" aria-hidden="true"></span>
              </div>
                  &nbsp;&nbsp;CATEGORIES</a>
          </li>
          <li><a href="/tags">
              <div class="circle">
                <span class="txt-blue-major" aria-hidden="true"><strong>#</strong></span>
              </div>
                  &nbsp;&nbsp;TAGS</a>
          </li>
          <li>
            <form class="search" name="ddg" action="https://duckduckgo.com/" method="get">
              <input type="text" name ="q" placeholder="SEARCH" />
              <input type="hidden" value="perl.com" name="sites" />
            </form>
          </li>
        </ul>
      </div>
    </div>
  </div>
 </div>
</div>


  <section id="content" role="main">
    <section class="entry-content">
      <div class="container">
        <div class="row">
          <div class="col-md-9">
            <div class="row">
              <article class="fulltext">
              <h1 class="blog-post-title">Writing on Walls with Facebook::Graph</h1>
              <p class="blog-post-meta">Apr 4, 2011 by
              
              
                
                
                <a href="#author-bio-jt-smith">JT Smith</a>
              
              </p>
              <img alt="" src=""/>
                <p>In my first article about <a href="https://metacpan.org/pod/Facebook::Graph">Facebook::Graph</a>, I showed you how to <a href="/pub/2011/03/facebook-authentication-with-perl-and-facebookgraph.html">use Facebook as an authentication mechanism for your site</a>. This time let me show you how to build on that authentication to post something to a user&rsquo;s Facebook wall.</p>

<p>First things first. The application needs additional permissions from the user. The previous app requested only basic rights to view the most basic of information about the user. Any app that wants to post to auser&rsquo;s wall needs to ask the user for permission to post to their wall. Replace the existing login method with:</p>

<pre><code>get '/facebook/login' =&gt; sub {
    my $fb = Facebook::Graph-&gt;new( config-&gt;{facebook} );
    redirect $fb
        -&gt;authorize
        -&gt;extend_permissions( qw(publish_stream) )
        -&gt;uri_as_string;
};
</code></pre>

<p>The only difference between this version and the original is the <code>extend_permissions</code> line which asks for <code>publish_stream</code> access. Facebook maintains <a href="http://developers.facebook.com/docs/authentication/permissions/">a table of Facebook application permissions</a> and their implications.</p>

<p>When a user grants this additional permission, the application can post almost anything to the user&rsquo;s wall. For example, if you have a shop of some kind, you could post something to a user&rsquo;s wall after a purchase:</p>

<pre><code>my $fb = Facebook::Graph-&gt;new( config-&gt;{facebook} );
$fb-&gt;add_post
  -&gt;set_message('I just bought Widget X from The Cool Shop for only $4.99.')
  -&gt;publish;
</code></pre>

<p>Or more descriptive:</p>

<pre><code>$fb-&gt;add_post
  -&gt;set_message('I just bought Widget X from The Cool Shop for only $4.99.')
  -&gt;set_picture_uri('http://images.coolshop.com/widgetx.jpg'),
  -&gt;link_uri('http://www.coolshop.com/products/widget-x'),
  -&gt;link_caption('Widget X')
  -&gt;publish;
</code></pre>

<p>If you publish links, do yourself a favor by making sure the page you are linking uses <a href="http://ogp.me/">Open Graph Protocol</a> meta tags. Facebook can refer to these tags, and will therefore link that metadata into your post, which means if anybody posts your link <em><a href="http://www.coolshop.com/products/widget-x">http://www.coolshop.com/products/widget-x</a></em> into a Facebook post, it will automatically pull in images, description, and other things.</p>

<p><strong>NOTE:</strong> Make sure whatever you post abides by <a href="http://developers.facebook.com/policy/">Facebook&rsquo;s Platform Polices</a>. If you don&rsquo;t, Facebook can and will ban your application.</p>

<p>This works well for posting something to Facebook when a logged-in user performs an action in your application, but but what if you want to post something <em>not</em> as the result of a direct user action? Maybe your site isn&rsquo;t a shop. Maybe it&rsquo;s a reminders site that posts stuff like &ldquo;Happy Birthday Maggie!&rdquo; or a random quote of the day. To post on behalf of the user even when they aren&rsquo;t logged in to your site, you must request offline access. This requires another update to the login page:</p>

<pre><code>get '/facebook/login' =&gt; sub {
    my $fb = Facebook::Graph-&gt;new( config-&gt;{facebook} );
    redirect $fb
        -&gt;authorize
        -&gt;extend_permissions( qw(offline_access publish_stream) )
        -&gt;uri_as_string;
};
</code></pre>

<p>You can see the <code>offline_access</code> permission in addition to <code>publish_stream</code> this time. Another necessary change is to store the resulting access token in something more robust than a Dancer session this time:</p>

<pre><code>get '/facebook/postback/' =&gt; sub {
    my $params = request-&gt;params;
    my $fb     = Facebook::Graph-&gt;new( config-&gt;{facebook} );

    $fb-&gt;request_access_token($params-&gt;{code});
    session access_token =&gt; $fb-&gt;access_token;

    my $user = $fb-&gt;fetch('me');

    database-&gt;quick_insert( 'facebook', {
        uid          =&gt; $user-&gt;{uid},=20
        name         =&gt; $user-&gt;{name},=20
        access_token =&gt; $fb-&gt;access_token,
       }
    );
    redirect '/';
};
</code></pre>

<p>In addition to storing the <code>access_token</code> in a Dancer session, the code also stores it in a database table for future reference (using <a href="https://metacpan.org/pod/Dancer::Plugin::Database">Dancer::Plugin::Database</a>, which is a wrapper around <a href="https://metacpan.org/pod/DBI">DBI</a>). This sort of thing can be good for other reasons too. For example, Facebook recommends caching data that you fetch from it for faster response times. If you want to display the user&rsquo;s name on every page, it&rsquo;s much faster to pull it out of the local database based upon the access token you have in your Dancer session than it is to request it from Facebook again.</p>

<p>As you can see, <code>Facebook::Graph</code> makes it quite easy to post to Facebook on behalf of your users. Stay tuned for Part III, where I&rsquo;ll show you how to publish calendar events and RSVP to them.</p>

              </article>
              <p><strong>Tags</strong></p>
              <div class="tags">
                <div class="category"><a href="/categories/web">web</a></div>
                
                  <div class="tag"><a href="/tags/cpan">cpan</a></div>
                
                  <div class="tag"><a href="/tags/dancer">dancer</a></div>
                
                  <div class="tag"><a href="/tags/facebook">facebook</a></div>
                
                  <div class="tag"><a href="/tags/facebook-graph">facebook-graph</a></div>
                
                  <div class="tag"><a href="/tags/web-development">web-development</a></div>
                
              </div>
            </div>
            
              
                
<div class="row" id="author-bio-jt-smith">
  <div class="col-sm-2">
    
    <a href="/authors/jt-smith/"><div class="circle-avatar" style="background-image:url(/images/author/jt-smith.jpg)"></div></a>
  </div>
  <div class="col-sm-10">
    <a href="/authors/jt-smith/"><h3>JT Smith</h3></a>
    <p></p>
    <h5><a href="/authors/jt-smith/">Browse their articles</a></h5>
  </div>
</div>

            
            <div class="row">
              <h3>Feedback</h3>
              <p>Something wrong with this article? Help us out by opening an issue or pull request on <a href="https://github.com/tpf/perldotcom/blob/master/content/legacy/_pub_2011_04_writing-on-walls-with-facebookgraph.md">GitHub</a></p>
            </div>
          </div>
          <div class="col-md-3">
            <div class="latest-sidebar">

  <div class="row">
    <div class="col-sm-12 centering">
      <span style="font-size:1.8em" class="antonio txt-blue-major">OUR LATEST ARTICLES</span>
    </div>
  </div>
  
    
    
    <div class="row">
        <a href="http://localhost:1313/article/the-perl-admbassador-curtis-poe/">
      <div class="col-sm-3">
        <div class="circle-avatar" style="background-image:url(/images/the-perl-ambassador-curtis-poe/curtis-poe.jpg)"></div>
      </div>
      <div class="col-sm-9">
          <h6>The Perl Ambassador: Curtis &#39;Ovid&#39; Poe</h6>
          <p style="line-height:1"><small>The person behind the news of Perl</small></p>
      </div>
        </a>
    </div>
  
    
    
    <div class="row">
        <a href="http://localhost:1313/article/a-tour-with-net-ftp/">
      <div class="col-sm-3">
        <div class="circle-avatar" style="background-image:url(/images/a-tour-with-net-ftp/thumb_kidyes.jpg)"></div>
      </div>
      <div class="col-sm-9">
          <h6>A tour with Net::FTP</h6>
          <p style="line-height:1"><small>How to write an FTP client in Perl</small></p>
      </div>
        </a>
    </div>
  
    
    
    <div class="row">
        <a href="http://localhost:1313/article/shortcode_test/">
      <div class="col-sm-3">
        <div class="circle-avatar" style="background-image:url(/images/author/brian-d-foy.jpg)"></div>
      </div>
      <div class="col-sm-9">
          <h6>shortcode_test</h6>
          <p style="line-height:1"><small></small></p>
      </div>
        </a>
    </div>
  
    
    
    <div class="row">
        <a href="http://localhost:1313/article/listen-to-larry-wall-s-state-of-the-onion-2000-on-youtube/">
      <div class="col-sm-3">
        <div class="circle-avatar" style="background-image:url(/images/listen-to-larry-wall-s-state-of-the-onion-2000-on-youtube/thumb_larry-wall.jpg)"></div>
      </div>
      <div class="col-sm-9">
          <h6>Listen to Larry Wall&#39;s State of the Onion 2000 on YouTube</h6>
          <p style="line-height:1"><small></small></p>
      </div>
        </a>
    </div>
  
    
    
    <div class="row">
        <a href="http://localhost:1313/article/announcing-perl-7/">
      <div class="col-sm-3">
        <div class="circle-avatar" style="background-image:url(/images/announcing-perl-7/thumb_seven_on_blue_wall.jpg)"></div>
      </div>
      <div class="col-sm-9">
          <h6>Announcing Perl 7</h6>
          <p style="line-height:1"><small>Perl 5 with modern defaults</small></p>
      </div>
        </a>
    </div>
  
</div>
<div class="row" style="margin-top:20px">
  <div class="col-sm-12 centering">
  <script async src="/widget/toplinks/toplinks.js" type="text/javascript"></script>
    <div id="toplinks"></div>
  </div>
</div>

<div class="row" style="margin-top:20px">
  <div class="col-sm-12 centering">
    <a class="twitter-timeline" data-height="640" data-dnt="true" data-theme="dark" href="https://twitter.com/perlfoundation?ref_src=twsrc%5Etfw">Tweets by perlfoundation</a> <script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>
  </div>
</div>

<div class="row" style="margin-top:20px">
  <div class="col-sm-12 centering">
    <script src="https://www.reddit.com/r/perl/hot/.embed?limit=10&t=all" type="text/javascript"></script>
  </div>
</div>



          </div>
        </div>
      </div>
    </section>
  </section>
<script>
 
var tables, i;
tables = document.getElementsByTagName('table');
for (i=0;i<tables.length;i++) {
  tables[i].className = 'table table-striped';
}
</script>
<div class="push"></div>
<div class="footer">
  <div class="container">
    <div class="row">
      <div class="col-md-1">
        <h5>Site Map</h5>
        <ul>
        <li><a href="/">Home</a></li>
        <hr>
        <li><a href="/about">About</a></li>
        <hr>
        <li><a href="/authors">Authors</a></li>
        <hr>
        <li><a href="/categories">Categories</a></li>
        <hr>
        <li><a href="/tags">Tags</a></li>
        <hr>
        </ul>
      </div>
      <div class="col-md-3">
        <h5>Contact Us</h5>
        <p>To get in touch, send an email to: perl.com-editor@perl.org</p>
        <p><a href="https://perl.org">
              <img src="/images/site/perl-onion_20.png" alt="Perl Onion"></a>
          <a href="https://twitter.com/intent/follow?screen_name=perlfoundation">
              <img src="/images/site/twitter_20.png" alt="twitter"></a>
          <a href="/index.xml" /><img src="/images/site/rss_20.png" alt="rss"></a>
          <a href="https://github.com/tpf/perldotcom">
              <img src="/images/site/github_light_20.png" alt="GitHub logo"></a></p>
      </div>
      <div class="col-md-2">
          <h5>License</h5>
          <p>This work is licensed under a <a rel="license" href="https://creativecommons.org/licenses/by-nc/3.0/">Creative Commons Attribution-NonCommercial 3.0 Unported License</a>.</p>
          <p><a rel="license" href="https://creativecommons.org/licenses/by-nc/3.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc/3.0/88x31.png" /></a></p>
      </div>
      <div class="col-md-5">
          <h5>Legal</h5>
          <p>Perl.com and the authors make no representations with respect to the accuracy or completeness of the contents of all work on this website and specifically disclaim all warranties, including without limitation warranties of fitness for a particular purpose. The information published on this website may not be suitable for every situation. All work on this website is provided with the understanding that Perl.com and the authors are not engaged in rendering professional services. Neither Perl.com nor the authors shall be liable for damages arising herefrom.</p>
      </div>
    </div>
  </div>
</div>
<script src="/javascript/jquery.min.js"></script>
<script src="/javascript/bootstrap.min.js"></script>
<script data-no-instant>document.write('<script src="/livereload.js?port=1313&mindelay=10"></' + 'script>')</script></body>
</html>

