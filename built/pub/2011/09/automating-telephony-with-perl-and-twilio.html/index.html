<!DOCTYPE html>
<html lang="en-us">
  <head>
  <title> Automating Telephony with Perl and Twilio </title>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Perl can make your phone ring. Scott Wiersdorf demonstrates how to use Twilio&#39;s API to make and receive phone calls and to automate SMS, all from Perl."/>
  <meta name="robots" content="index, follow">
  <meta name="google-site-verification" content="TZowffo_LX2mmsw2DbeNNbukCMnIOA8T-6CMJPiYllI" />

<meta property="twitter:card" content="summary">
<meta property="twitter:site" content="@PerlFoundation">
<meta property="og:url" content="http://localhost:1313/pub/2011/09/automating-telephony-with-perl-and-twilio.html/" />
<meta property="og:title" content="Automating Telephony with Perl and Twilio" />
<meta property="og:description" content="Perl can make your phone ring. Scott Wiersdorf demonstrates how to use Twilio&#39;s API to make and receive phone calls and to automate SMS, all from Perl.">
<meta property="og:site_name" content="Perl.com" />

<meta property="og:type" content="article" />
<meta property="og:article:published_time" content="2011-09-09T09:09:09Z" />
<meta property="og:image" content="http://localhost:1313/images/site/avatar.png" />
<meta property="og:article:tag" content="apis" />
<meta property="og:article:tag" content="telephony" />


  <link rel="icon" href="/favicon.ico">
  <link href="/article/index.xml" rel="alternate" type="application/rss+xml" title="Perl.com - programming news, code and culture" />
  <link href="/article/index.xml" rel="feed" type="application/rss+xml" title="Perl.com - programming news, code and culture" />
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" type="text/css" href="/css/perldotcom.css"/>


<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-50555-22', 'auto');
ga('create', 'UA-85734801-2', 'auto', 'editor');
ga('send', 'pageview');
ga('editor.send', 'pageview');
</script>

</head>
<body>

<div class="container-fluid full-wdith antonio">
 <div class="row">
  <div class="navbar-inverse" style="border-radius:none !important" role="navigation">
    <div class="container-fluid">
      <ul class="nav navbar-nav pull-right follow">
          <li>MORE:</li>
          <li><a href="https://perl.org">
              <img src="/images/site/perl-onion_20.png" alt="Perl Onion"></a><li>
          <li><a href="https://twitter.com/intent/follow?screen_name=perlfoundation">
              <img src="/images/site/twitter_20.png" alt="twitter"></a><li>
          <li><a href="/article/index.xml" />
              <img src="/images/site/rss_20.png" alt="rss"></a></li>
          <li><a href="https://github.com/tpf/perldotcom" />
              <img src="/images/site/github_light_20.png" alt="GitHub logo"></a></li>
      </ul>
      <div class="navbar-header">
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
          <a class="navbar-nav" href="/">
            <div class="header-logo">Perl.com</div>
          </a>
      </div>
      <div class="navbar-collapse collapse">
        <ul class="nav navbar-nav">
          <li><a href="/about">
              <div class="circle">
                <img src="/images/site/perl-camel.png" alt="" />
              </div>
                  &nbsp;&nbsp;ABOUT</a>
          </li>
          <li><a href="/authors">
              <div class="circle">
                  <span class="glyphicon glyphicon-user txt-blue-major" aria-hidden="true"></span>
              </div>
                  &nbsp;&nbsp;AUTHORS</a>
          </li>
          <li><a href="/categories">
              <div class="circle">
                  <span class="glyphicon glyphicon-folder-open txt-blue-major" aria-hidden="true"></span>
              </div>
                  &nbsp;&nbsp;CATEGORIES</a>
          </li>
          <li><a href="/tags">
              <div class="circle">
                <span class="txt-blue-major" aria-hidden="true"><strong>#</strong></span>
              </div>
                  &nbsp;&nbsp;TAGS</a>
          </li>
          <li>
            <form class="search" name="ddg" action="https://duckduckgo.com/" method="get">
              <input type="text" name ="q" placeholder="SEARCH" />
              <input type="hidden" value="perl.com" name="sites" />
            </form>
          </li>
        </ul>
      </div>
    </div>
  </div>
 </div>
</div>


  <section id="content" role="main">
    <section class="entry-content">
      <div class="container">
        <div class="row">
          <div class="col-md-9">
            <div class="row">
              <article class="fulltext">
              <h1 class="blog-post-title">Automating Telephony with Perl and Twilio</h1>
              <p class="blog-post-meta">Sep 21, 2011 by
              
              
                
                
                <a href="#author-bio-scott-wiersdorf">Scott Wiersdorf</a>
              
              </p>
              <img alt="" src=""/>
                

<p>Perl can make your phone ring.</p>

<p><a href="http://www.twilio.com/">Twilio</a> allows developers to write applications that can make and receive voice calls or SMS messages (though Twilio can do many other interesting telephony things). Twilio’s RESTful API, text-to-speech synthesizer, speech transcription services, and Javascript client make it easy to knock out a conference call application, an in-browser customer service voice application, a weather-by-SMS application, reminder by phone—anything, really—in minutes. This article shows how to make a couple of small applications, one to help you pronounce words correctly and the other to transcribe awkward condiment phone survey answers.</p>

<h2 id="twilio-setup"><strong>Twilio Setup</strong></h2>

<p>First, head over to <a href="http://www.twilio.com/">Twilio.com</a> and click the “Try Twilio Free” link. While inbound calls cost US $0.01 per minute and outbound calls cost US $0.02 per minute, Twilio has historically given new users a generous account balance to start with for free (currently US $30)—it’s plenty of credit to kick the tires and take it for a spin.</p>

<p>Go ahead and register (I’ll wait here). When you’ve finished, you’ll have an account SID (beginning with “AC”) and an auth token, available from your Twilio Dashboard. These are your Twilio API username and password; you’ll need them for any API application you write.</p>

<h2 id="twilio-basics"><strong>Twilio Basics</strong></h2>

<p>The Twilio website is full of well-organized documentation and sample applications. I recommend starting with “How It Works” (one of the main navigation links on the home page). Browse the documentation under “Docs” as well.</p>

<p>H. H. Munroe said, “A little inaccuracy sometimes saves tons of explanation.” Keeping that in mind, inbound calls (calls to a Twilio number) work like this:</p>

<p><img src="/images/_pub_2011_09_automating-telephony-with-perl-and-twilio/twilio-inbound.png" alt="" />
<em>Inbound calls to a Twilio number</em></p>

<p>1) the user calls “555-867-5309” on their phone</p>

<p>2) Twilio accepts the call, then makes an HTTP POST to <a href="http://example.com/jenny.xml">http://example.com/jenny.xml</a></p>

<p>3) example.com responds with a “TwiML” document (TwiML is a simple XML language that describes how Twilio will interact with callers):</p>

<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;
&lt;Response&gt;
  &lt;Say voice=&quot;woman&quot;&gt;This is Jenny!&lt;/Say&gt;
&lt;/Response&gt;
</code></pre>

<p>4) Twilio’s TwiML parser and text-to-speech synthesizer read this document and then says to the user (in a voice from the uncanny valley), “This is Jenny!”</p>

<p>When you setup a sandbox number, you tell Twilio to map a URL to that number. Twilio will GET/POST to that URL when receiving calls.</p>

<p>Outbound calls (calls from a Twilio number) work like this:</p>

<p><img src="/images/_pub_2011_09_automating-telephony-with-perl-and-twilio/twilio-outbound.png" alt="" />
<em>Outbound calls from a Twilio number</em></p>

<p>1) An application makes an HTTP POST to Twilio’s “Calls” API with the parameters:</p>

<pre><code>From=+15558675309
To=+19991234567
Url=http://example.com/jenny.xml
</code></pre>

<p>2) Twilio places the call and waits for an answer</p>

<p>3) Once the user answers, Twilio retrieves the URL specified in the POST (which should return a TwiML document)</p>

<p>4) Twilio parses the TwiML document and passes it to the text-to-speech synthesizer</p>

<p>5) The synthesizer says to the user “This is Jenny!”</p>

<p>Twilio can also record voice input, transcribe it, send and receive SMS messages, make conference calls, and a few other useful things, all using the same familiar RESTful API and TwiML.</p>

<h2 id="twilio-meet-perl"><strong>Twilio, meet Perl</strong></h2>

<p>CPAN makes writing Twilio applications easy, thanks to <a href="https://metacpan.org/pod/WWW::Twilio::API">WWW::Twilio::API</a>. My (current) favorite way to install CPAN modules comes from the Mojolicious project:</p>

<pre><code>curl -L cpanmin.us | perl - WWW::Twilio::API
</code></pre>

<p>cpanmin.us returns a Perl program which handles all of the build dependencies for you. If you’re leery of running code from a website directly on the command line, install <a href="https://metacpan.org/pod/App::cpanminus">App::cpanminus</a> and use its <code>cpanm</code> program instead.</p>

<p>If you’re like me and don’t want to mess up your clean development environment, tell cpanmin.us or <code>cpanm</code> to install things into a temporary location:</p>

<pre><code>$ mkdir ~/perl-test
$ export PERL5LIB=~/perl-test/lib/perl5
$ curl -L cpanmin.us | perl - --local-lib=~/perl-test WWW::Twilio::API
# or
$ cpanm --local-lib=~/perl-test WWW::Twilio::API
</code></pre>

<p>See <a href="http://www.cpan.org/modules/INSTALL.html">How to install CPAN modules</a> for more information and options.</p>

<h2 id="getting-all-the-necessary-twilio-information"><strong>Getting all the necessary Twilio information</strong></h2>

<p>After you install <a href="https://metacpan.org/pod/WWW::Twilio::API">WWW::Twilio::API</a>, but before you make your first call, you need several pieces of information from your Twilio Dashboard:</p>

<ul>
<li><p>AccountSid: this is a long string begining with “AC”</p></li>

<li><p>AuthToken: another long hex string, next to the AccountSid; you may have to click a lock icon to reveal it</p></li>

<li><p>Sandbox number: found on the bottom half of the Dashboard page under “Sandbox App”</p></li>
</ul>

<p>That’s all! Now you’re ready to go.</p>

<h2 id="your-first-phone-call"><strong>Your first phone call</strong></h2>

<p>Fire up your favorite editor:</p>

<pre><code>#!/usr/bin/env perl

use strict;
use warnings;
use WWW::Twilio::API;

my $twilio = WWW::Twilio::API-&gt;( AccountSid  =&gt; 'ACxxxxxxxxx',
                                 AuthToken   =&gt; 'xxxxxxxxxxx',
                                 API_VERSION =&gt; '2010-04-01' );

## A hollow voice says 'plugh'
my $response = $twilio-&gt;POST( 'Calls',
                              To   =&gt; '+15556667777', ## maybe your cell phone
                              From =&gt; '+12223334444', ## your Twilio sandbox
                              Url  =&gt; 'http://twimlets.com/message?'
                                    . 'Message%5B0%5D=plugh' );

print STDERR $response-&gt;{content};
</code></pre>

<p>That’s the entire application. Run it, and if all went well, you should see a long XML string returned which resembles:</p>

<pre><code>&lt;?xml version=&quot;1.0&quot;?&gt;
&lt;TwilioResponse&gt;
  &lt;Call&gt;
    &lt;To&gt;+15556667777&lt;/To&gt;
    &lt;From&gt;+12223334444&lt;/From&gt;
    &lt;Status&gt;queued&lt;/Status&gt;
    &lt;Direction&gt;outbound-api&lt;/Direction&gt;
  &lt;/Call&gt;
&lt;/TwilioResponse&gt;
</code></pre>

<p>… and then your phone should ring. I’ve always wondered how to pronounce “plugh”—now I know.</p>

<h2 id="what-could-possibly-go-wrong"><strong>What could possibly go wrong?</strong></h2>

<p>Early on in Twilio development, you’re likely to experience a few little gotchas. For example, you might get this message:</p>

<pre><code>LWP will support https URLs if the LWP::Protocol::https module
is installed.
</code></pre>

<p>That’s LWP telling you to install <a href="https://metacpan.org/pod/LWP::Protocol::https">LWP::Protocol::https</a>. (It will also install or update a few other modules, including <a href="https://metacpan.org/pod/Net::SSLeay">Net::SSLeay</a>).</p>

<p>If you see XML after running the script, your development environment is probably fine. You might instead see:</p>

<pre><code>&lt;TwilioResponse&gt;
  &lt;RestException&gt;
    &lt;Status&gt;401&lt;/Status&gt;
    &lt;Message&gt;Authenticate&lt;/Message&gt;
    &lt;Code&gt;20003&lt;/Code&gt;
    &lt;MoreInfo&gt;http://www.twilio.com/docs/errors/20003&lt;/MoreInfo&gt;
  &lt;/RestException&gt;
&lt;/TwilioResponse&gt;
</code></pre>

<p>Notice the “401”? If you’re familiar with <a href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html">HTTP status codes</a>, you might remember that 401 means “Unauthorized”. You either didn’t present any authorization information, or it was incorrect. In this case, it usually means the AccountSid or AuthToken are incorrect. Log into Twilio.com, go to the Dashboard and make sure your AccountSid and AuthToken are correct.</p>

<h2 id="what-else-can-we-do"><strong>What else can we do?</strong></h2>

<p>Everything depends on what you put in for the Url parameter. You can browse some of the free applications at <a href="http://labs.twilio.com/twimlets/">Twilio Labs</a>, though most of those are for inbound calls.</p>

<p>Here’s a silly example of using the voicemail Twimlet to conduct a brief phone survey and have the callee’s response transcribed and emailed. Start by changing the Url line in the POST:</p>

<pre><code>my $email    = 'you@example.com';  ## your email
my $msg      = 'Please+tell+us+what+you+think+of+Tabasco+sauce';
my $response = $twilio-&gt;POST( 'Calls',
                              To   =&gt; '+15556667777',
                              From =&gt; '+12223334444',
                              Url  =&gt; &quot;http://twimlets.com/voicemail?&quot;
                                    . &quot;Email=$email&amp;Message=$msg&quot; );
</code></pre>

<p>Note that this Twimlet’s arguments are case-sensitive. ‘Email’ and ‘Message’ are not the same as ‘email’ and ‘message’. Make sure you use the correct case.</p>

<p>Also, be sure to substitute your phone number for the To parameter and your Twilio Sandbox phone number (also found on your Twilio Dashboard) for the From parameter. Twilio phone numbers always use the international calling prefix (e.g., United States numbers use “+1” followed by the three digit area code followed by the seven digit phone number).</p>

<p>When you run this, you’ll get a call from Twilio asking you to share your insights into Tabasco sauce. Please be honest. Once you’ve given your opinion, Twilio will then transcribe your message and email it to the email address you specified.</p>

<h2 id="i-m-sending-out-an-sms"><strong>I’m sending out an SMS</strong></h2>

<p>SMS messages are even easier: no TwiML needed. Instead of the Calls API, use the <em>SMS/Messages</em> API:</p>

<pre><code>my $response = $twilio-&gt;POST( 'SMS/Messages',
                              To   =&gt; '+15556667777',
                              From =&gt; '+12223334444',
                              Body =&gt; 'Rescue me before '
                                   .  'I fall into despair' );
</code></pre>

<p>That’s all you have to do to send an SMS message using Twilio (though the 160 character limit applies).</p>

<h2 id="conclusion"><strong>Conclusion</strong></h2>

<p>Twilio and Perl make a potent pair: so much is possible with so little code. The next installment will cover writing larger applications with TwiML.</p>

              </article>
              <p><strong>Tags</strong></p>
              <div class="tags">
                <div class="category"><a href="/categories/networking">networking</a></div>
                
                  <div class="tag"><a href="/tags/apis">apis</a></div>
                
                  <div class="tag"><a href="/tags/telephony">telephony</a></div>
                
              </div>
            </div>
            
              
                
<div class="row" id="author-bio-scott-wiersdorf">
  <div class="col-sm-2">
    
    <a href="/authors/scott-wiersdorf/"><div class="circle-avatar" style="background-image:url(/images/site/avatar.png)"></div></a>
  </div>
  <div class="col-sm-10">
    <a href="/authors/scott-wiersdorf/"><h3>Scott Wiersdorf</h3></a>
    <p></p>
    <h5><a href="/authors/scott-wiersdorf/">Browse their articles</a></h5>
  </div>
</div>

            
            <div class="row">
              <h3>Feedback</h3>
              <p>Something wrong with this article? Help us out by opening an issue or pull request on <a href="https://github.com/tpf/perldotcom/blob/master/content/legacy/_pub_2011_09_automating-telephony-with-perl-and-twilio.md">GitHub</a></p>
            </div>
          </div>
          <div class="col-md-3">
            <div class="latest-sidebar">

  <div class="row">
    <div class="col-sm-12 centering">
      <span style="font-size:1.8em" class="antonio txt-blue-major">OUR LATEST ARTICLES</span>
    </div>
  </div>
  
    
    
    <div class="row">
        <a href="http://localhost:1313/article/the-perl-admbassador-curtis-poe/">
      <div class="col-sm-3">
        <div class="circle-avatar" style="background-image:url(/images/the-perl-ambassador-curtis-poe/curtis-poe.jpg)"></div>
      </div>
      <div class="col-sm-9">
          <h6>The Perl Ambassador: Curtis &#39;Ovid&#39; Poe</h6>
          <p style="line-height:1"><small>The person behind the news of Perl</small></p>
      </div>
        </a>
    </div>
  
    
    
    <div class="row">
        <a href="http://localhost:1313/article/a-tour-with-net-ftp/">
      <div class="col-sm-3">
        <div class="circle-avatar" style="background-image:url(/images/a-tour-with-net-ftp/thumb_kidyes.jpg)"></div>
      </div>
      <div class="col-sm-9">
          <h6>A tour with Net::FTP</h6>
          <p style="line-height:1"><small>How to write an FTP client in Perl</small></p>
      </div>
        </a>
    </div>
  
    
    
    <div class="row">
        <a href="http://localhost:1313/article/shortcode_test/">
      <div class="col-sm-3">
        <div class="circle-avatar" style="background-image:url(/images/author/brian-d-foy.jpg)"></div>
      </div>
      <div class="col-sm-9">
          <h6>shortcode_test</h6>
          <p style="line-height:1"><small></small></p>
      </div>
        </a>
    </div>
  
    
    
    <div class="row">
        <a href="http://localhost:1313/article/listen-to-larry-wall-s-state-of-the-onion-2000-on-youtube/">
      <div class="col-sm-3">
        <div class="circle-avatar" style="background-image:url(/images/listen-to-larry-wall-s-state-of-the-onion-2000-on-youtube/thumb_larry-wall.jpg)"></div>
      </div>
      <div class="col-sm-9">
          <h6>Listen to Larry Wall&#39;s State of the Onion 2000 on YouTube</h6>
          <p style="line-height:1"><small></small></p>
      </div>
        </a>
    </div>
  
    
    
    <div class="row">
        <a href="http://localhost:1313/article/announcing-perl-7/">
      <div class="col-sm-3">
        <div class="circle-avatar" style="background-image:url(/images/announcing-perl-7/thumb_seven_on_blue_wall.jpg)"></div>
      </div>
      <div class="col-sm-9">
          <h6>Announcing Perl 7</h6>
          <p style="line-height:1"><small>Perl 5 with modern defaults</small></p>
      </div>
        </a>
    </div>
  
</div>
<div class="row" style="margin-top:20px">
  <div class="col-sm-12 centering">
  <script async src="/widget/toplinks/toplinks.js" type="text/javascript"></script>
    <div id="toplinks"></div>
  </div>
</div>

<div class="row" style="margin-top:20px">
  <div class="col-sm-12 centering">
    <a class="twitter-timeline" data-height="640" data-dnt="true" data-theme="dark" href="https://twitter.com/perlfoundation?ref_src=twsrc%5Etfw">Tweets by perlfoundation</a> <script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>
  </div>
</div>

<div class="row" style="margin-top:20px">
  <div class="col-sm-12 centering">
    <script src="https://www.reddit.com/r/perl/hot/.embed?limit=10&t=all" type="text/javascript"></script>
  </div>
</div>



          </div>
        </div>
      </div>
    </section>
  </section>
<script>
 
var tables, i;
tables = document.getElementsByTagName('table');
for (i=0;i<tables.length;i++) {
  tables[i].className = 'table table-striped';
}
</script>
<div class="push"></div>
<div class="footer">
  <div class="container">
    <div class="row">
      <div class="col-md-1">
        <h5>Site Map</h5>
        <ul>
        <li><a href="/">Home</a></li>
        <hr>
        <li><a href="/about">About</a></li>
        <hr>
        <li><a href="/authors">Authors</a></li>
        <hr>
        <li><a href="/categories">Categories</a></li>
        <hr>
        <li><a href="/tags">Tags</a></li>
        <hr>
        </ul>
      </div>
      <div class="col-md-3">
        <h5>Contact Us</h5>
        <p>To get in touch, send an email to: perl.com-editor@perl.org</p>
        <p><a href="https://perl.org">
              <img src="/images/site/perl-onion_20.png" alt="Perl Onion"></a>
          <a href="https://twitter.com/intent/follow?screen_name=perlfoundation">
              <img src="/images/site/twitter_20.png" alt="twitter"></a>
          <a href="/index.xml" /><img src="/images/site/rss_20.png" alt="rss"></a>
          <a href="https://github.com/tpf/perldotcom">
              <img src="/images/site/github_light_20.png" alt="GitHub logo"></a></p>
      </div>
      <div class="col-md-2">
          <h5>License</h5>
          <p>This work is licensed under a <a rel="license" href="https://creativecommons.org/licenses/by-nc/3.0/">Creative Commons Attribution-NonCommercial 3.0 Unported License</a>.</p>
          <p><a rel="license" href="https://creativecommons.org/licenses/by-nc/3.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc/3.0/88x31.png" /></a></p>
      </div>
      <div class="col-md-5">
          <h5>Legal</h5>
          <p>Perl.com and the authors make no representations with respect to the accuracy or completeness of the contents of all work on this website and specifically disclaim all warranties, including without limitation warranties of fitness for a particular purpose. The information published on this website may not be suitable for every situation. All work on this website is provided with the understanding that Perl.com and the authors are not engaged in rendering professional services. Neither Perl.com nor the authors shall be liable for damages arising herefrom.</p>
      </div>
    </div>
  </div>
</div>
<script src="/javascript/jquery.min.js"></script>
<script src="/javascript/bootstrap.min.js"></script>
<script data-no-instant>document.write('<script src="/livereload.js?port=1313&mindelay=10"></' + 'script>')</script></body>
</html>

