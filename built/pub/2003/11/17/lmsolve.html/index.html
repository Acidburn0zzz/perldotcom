<!DOCTYPE html>
<html lang="en-us">
  <head>
  <title> Solving Puzzles with LM-Solve </title>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content=" Suppose you encounter a (single-player) riddle or a puzzle that you don&#39;t know how to solve. Let&#39;s also suppose that this puzzle involves moving between several states of the board with an enumerable number of moves emerging from one..."/>
  <meta name="robots" content="index, follow">
  <meta name="google-site-verification" content="TZowffo_LX2mmsw2DbeNNbukCMnIOA8T-6CMJPiYllI" />

<meta property="twitter:card" content="summary">
<meta property="twitter:site" content="@PerlFoundation">
<meta property="og:url" content="http://localhost:1313/pub/2003/11/17/lmsolve.html/" />
<meta property="og:title" content="Solving Puzzles with LM-Solve" />
<meta property="og:description" content=" Suppose you encounter a (single-player) riddle or a puzzle that you don&#39;t know how to solve. Let&#39;s also suppose that this puzzle involves moving between several states of the board with an enumerable number of moves emerging from one...">
<meta property="og:site_name" content="Perl.com" />

<meta property="og:type" content="article" />
<meta property="og:article:published_time" content="2003-11-11T11:11:11Z" />
<meta property="og:image" content="http://localhost:1313/images/_pub_2003_11_17_lmsolve/111-games.gif" />
<meta property="og:article:tag" content="games-puzzles-logic-maze" />


  <link rel="icon" href="/favicon.ico">
  <link href="/article/index.xml" rel="alternate" type="application/rss+xml" title="Perl.com - programming news, code and culture" />
  <link href="/article/index.xml" rel="feed" type="application/rss+xml" title="Perl.com - programming news, code and culture" />
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" type="text/css" href="/css/perldotcom.css"/>


<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-50555-22', 'auto');
ga('create', 'UA-85734801-2', 'auto', 'editor');
ga('send', 'pageview');
ga('editor.send', 'pageview');
</script>

</head>
<body>

<div class="container-fluid full-wdith antonio">
 <div class="row">
  <div class="navbar-inverse" style="border-radius:none !important" role="navigation">
    <div class="container-fluid">
      <ul class="nav navbar-nav pull-right follow">
          <li>MORE:</li>
          <li><a href="https://perl.org">
              <img src="/images/site/perl-onion_20.png" alt="Perl Onion"></a><li>
          <li><a href="https://twitter.com/intent/follow?screen_name=perlfoundation">
              <img src="/images/site/twitter_20.png" alt="twitter"></a><li>
          <li><a href="/article/index.xml" />
              <img src="/images/site/rss_20.png" alt="rss"></a></li>
          <li><a href="https://github.com/tpf/perldotcom" />
              <img src="/images/site/github_light_20.png" alt="GitHub logo"></a></li>
      </ul>
      <div class="navbar-header">
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
          <a class="navbar-nav" href="/">
            <div class="header-logo">Perl.com</div>
          </a>
      </div>
      <div class="navbar-collapse collapse">
        <ul class="nav navbar-nav">
          <li><a href="/about">
              <div class="circle">
                <img src="/images/site/perl-camel.png" alt="" />
              </div>
                  &nbsp;&nbsp;ABOUT</a>
          </li>
          <li><a href="/authors">
              <div class="circle">
                  <span class="glyphicon glyphicon-user txt-blue-major" aria-hidden="true"></span>
              </div>
                  &nbsp;&nbsp;AUTHORS</a>
          </li>
          <li><a href="/categories">
              <div class="circle">
                  <span class="glyphicon glyphicon-folder-open txt-blue-major" aria-hidden="true"></span>
              </div>
                  &nbsp;&nbsp;CATEGORIES</a>
          </li>
          <li><a href="/tags">
              <div class="circle">
                <span class="txt-blue-major" aria-hidden="true"><strong>#</strong></span>
              </div>
                  &nbsp;&nbsp;TAGS</a>
          </li>
          <li>
            <form class="search" name="ddg" action="https://duckduckgo.com/" method="get">
              <input type="text" name ="q" placeholder="SEARCH" />
              <input type="hidden" value="perl.com" name="sites" />
            </form>
          </li>
        </ul>
      </div>
    </div>
  </div>
 </div>
</div>


  <section id="content" role="main">
    <section class="entry-content">
      <div class="container">
        <div class="row">
          <div class="col-md-9">
            <div class="row">
              <article class="fulltext">
              <h1 class="blog-post-title">Solving Puzzles with LM-Solve</h1>
              <p class="blog-post-meta">Nov 17, 2003 by
              
              
                
                
                <a href="#author-bio-shlomi-fish">Shlomi Fish</a>
              
              </p>
              <img alt="" src=""/>
                

<p>Suppose you encounter a (single-player) riddle or a puzzle that you don&rsquo;t know how to solve. Let&rsquo;s also suppose that this puzzle involves moving between several states of the board with an enumerable number of moves emerging from one state. In this case, <a href="http://vipe.technion.ac.il/~shlomif/lm-solve/">LM-Solve</a> (or Games::LMSolve on CPAN) may be of help.</p>

<p>LM-Solve was originally written to tackle various types of the so-called <a href="http://www.logicmazes.com/">logic mazes</a> that can be found online. Nevertheless, it can be extended to support many other types of single-player puzzles.</p>

<p>In this article, I will demonstrate how to use LM-Solve to solve a type of puzzle that it does not know yet to solve.</p>

<h2 id="installation">Installation</h2>

<p>Use the CPAN.pm module <code>install Games::LMSolve</code> command to install LM-Solve. For instance, invoke the following command on the command line:</p>

<pre><code>$ perl -MCPAN -e 'install Games::LMSolve'
</code></pre>

<p>That&rsquo;s it! (LM-Solve does not require any non-base modules, and should run on all recent versions of Perl.)</p>

<h2 id="the-puzzle-in-question">The Puzzle in Question</h2>

<p>The puzzle in question is called &ldquo;Jumping Cards&rdquo; and is taken from the <a href="http://mathforum.org/wagon/spring02/p949.html">Macalester College Problem of the Week No. 949</a>. In this puzzle, we start with eight cards in a row (labeled 1 to 8). We have to transform it into the 8 to 1 sequence, by swapping two cards at a time, as long as the following condition is met: at any time, two neighboring cards must be in one, two, or three spaces of each other.</p>

<p>Let&rsquo;s experience with this puzzle a bit. We start with the following formation:</p>

<pre><code>1 2 3 4 5 6 7 8
</code></pre>

<p>Let&rsquo;s swap 1 and 3, and see what it gives us:</p>

<pre><code>3 2 1 4 5 6 7 8
</code></pre>

<p>Now, we cannot exchange 1 and 4, because then, 1 would be close to the 5, and 5-1 is 4, which is more than 3. So let&rsquo;s exchange 2 and 1:</p>

<pre><code>3 1 2 4 5 6 7 8
</code></pre>

<p>Now we can exchange 2 and 4:</p>

<pre><code>3 1 4 2 5 6 7 8
</code></pre>

<p>And so on.</p>

<h2 id="let-s-start-coding">Let&rsquo;s Start &hellip; Coding!</h2>

<p>The <code>Games::LMSolve::Base</code> class tries to solve a game by iterating through its various positions, recording every one it passes through, and trying to reach the solution. However, it does not know in advance what the games rules are, and what the meaning of the positions and moves are. In order for it to know that, we need to inherit it and code several methods that are abstract in the base class.</p>

<p>We will code a derived class that will implement the logic specific to the Jumping Cards game. It will implement the following methods, which, together with the methods of the base class, enable the solver to solve the game:</p>

<ol>
<li><code>input_board</code></li>
<li><code>pack_state</code></li>
<li><code>unpack_state</code></li>
<li><code>display_state</code></li>
<li><code>check_if_final_state</code></li>
<li><code>enumerate_moves</code></li>
<li><code>perform_move</code></li>
<li><code>render_move</code></li>
</ol>

<p>Here&rsquo;s the beginning of the file where we put the script:</p>

<pre><code>package Jumping::Cards;

use strict;

use Games::LMSolve::Base;

use vars qw(@ISA);

@ISA=qw(Games::LMSolve::Base);
</code></pre>

<p>As can be seen, we declared a new package, <code>Jumping::Cards</code>, imported the <code>Games::LMSolve::Base</code> namespace, and inherited from it. Now let&rsquo;s start declaring the methods. First, a method to input the board in question.</p>

<p>Since our board is constant, we just return an array reference that contains the initial sequence.</p>

<pre><code>sub input_board
{
    my $self = shift;

    my $filename = shift;

    return [ 1 .. 8 ];
}
</code></pre>

<p>When <code>Games::LMSolve::Base</code> iterates over the states, it stores data about each state in a hash. This means we&rsquo;re going to have to provide a way to convert each state from its expanded form into a uniquely identifying string. The <code>pack_state</code> method does this, and in our case, it will look like this:</p>

<pre><code># A function that accepts the expanded state (as an array ref)
# and returns an atom that represents it.
sub pack_state
{
    my $self = shift;
    my $state_vector = shift;
    return join(&quot;,&quot;, @$state_vector);
}
</code></pre>

<p>It is a good idea to use functions like <code>pack</code>, <code>join</code> or any other serialization mechanism here. In our case, we simply used <code>join</code>.</p>

<p>It is not very convenient to manipulate a packed state, and so we need another function to expand it. <code>unpack_state</code> does the opposite of <code>pack_state</code> and expands a packed state.</p>

<pre><code># A function that accepts an atom that represents a state 
# and returns an array ref that represents it.
sub unpack_state
{
    my $self = shift;
    my $state = shift;
    return [ split(/,/, $state) ];
}
</code></pre>

<p><code>display_state()</code> converts a packed state to a user-readable string. This is so that it can be displayed to the user. In our case, the comma-delimited notation is already readable, so we leave it as that.</p>

<pre><code># Accept an atom that represents a state and output a 
# user-readable string that describes it.
sub display_state
{
    my $self = shift;
    my $state = shift;
    return $state;
}
</code></pre>

<p>We need to determine when we have reached our goal and can terminate the search with a success. The <code>check_if_final_state</code> function accepts an expanded state and checks if it qualifies as a final state. In our case, it is final if it&rsquo;s the 8-to-1 sequence.</p>

<pre><code>sub check_if_final_state
{
    my $self = shift;

    my $coords = shift;
    return join(&quot;,&quot;, @$coords) eq &quot;8,7,6,5,4,3,2,1&quot;;
}
</code></pre>

<p>Now we need a function that will tell the solver what subsequent states are available from each state. This is done by enumerating a set of moves that can be performed on the state. The <code>enumerate_moves</code> function does exactly that.</p>

<pre><code># This function enumerates the moves accessible to the state.
sub enumerate_moves
{
    my $self = shift;

    my $state = shift;

    my (@moves);
    for my $i (0 .. 6)
    {
        for my $j (($i+1) .. 7)
        {
            my @new = @$state;
            @new[$i,$j]=@new[$j,$i];
            my $is_ok = 1;
            for my $t (0 .. 6)
            {
                if (abs($new[$t]-$new[$t+1]) &gt; 3)
                {
                    $is_ok = 0;
                    last;
                }
            }
            if ($is_ok)
            {
                push @moves, [$i,$j];
            }
        }
    }
    return @moves;
}
</code></pre>

<p>What <code>enumerate_moves</code> does is iterate over the indices of the locations twice, and checks every move for the validity of the resultant board. If it&rsquo;s OK, it pushes the exchanged indices to the array <code>@moves</code>, which is returned at the end.</p>

<p>We also need a function that will translate an origin state and a move to a resultant state. The <code>perform_move</code> function performs a move on a state and returns the new state. In our case, it simply swaps the cards in the two indices specified by the move.</p>

<pre><code># This function accepts a state and a move. It tries to perform the
# move on the state. If it is successful, it returns the new state.
sub perform_move
{
    my $self = shift;

    my $state = shift;
    my $m = shift;

    my @new = @$state;

    my ($i,$j) = @$m;
    @new[$i,$j]=@new[$j,$i];
    return \@new;
}
</code></pre>

<p>Finally, we need a function that will render a move into a user-readable string, so it can be displayed to the user.</p>

<pre><code>sub render_move
{
    my $self = shift;

    my $move = shift;

    if (defined($move))
    {
        return join(&quot; &lt;=&gt; &quot;, @$move);
    }
    else
    {
        return &quot;&quot;;
    }
}
</code></pre>

<h2 id="invoking-the-solver">Invoking the Solver</h2>

<p>To make the solver invokable, create an instance of it in the main namespace, and call its <code>main()</code> function. This will turn it into a script that will solve the board. The code is this:</p>

<pre><code>package main;

my $solver = Jumping::Cards-&gt;new();
$solver-&gt;main();
</code></pre>

<p>Now save everything to a file, <em>jumping_cards.pl</em> (or download <a href="http://t2.technion.ac.il/~shlomif/solving-with-lms/jumping_cards.pl">the complete one</a>), and invoke it like this: <code>perl jumping_cards.pl --norle --output-states</code>. The <code>--norle</code> option means not to run-length encode the moves. In our case, run-length encoding will do no good, because a move can appear only once (or else its effect will be reversed). <code>--output-states</code> causes the states to be displayed in the solution.</p>

<p>The program thinks a little and then outputs:</p>

<pre><code>solved
solved
1,2,3,4,5,6,7,8: Move = 0 &lt;=&gt; 1
2,1,3,4,5,6,7,8: Move = 1 &lt;=&gt; 2
2,3,1,4,5,6,7,8: Move = 1 &lt;=&gt; 3
2,4,1,3,5,6,7,8: Move = 4 &lt;=&gt; 5
2,4,1,3,6,5,7,8: Move = 0 &lt;=&gt; 4
6,4,1,3,2,5,7,8: Move = 2 &lt;=&gt; 3
6,4,3,1,2,5,7,8: Move = 0 &lt;=&gt; 1
4,6,3,1,2,5,7,8: Move = 0 &lt;=&gt; 7
8,6,3,1,2,5,7,4: Move = 6 &lt;=&gt; 7
8,6,3,1,2,5,4,7: Move = 3 &lt;=&gt; 5
8,6,3,5,2,1,4,7: Move = 2 &lt;=&gt; 7
8,6,7,5,2,1,4,3: Move = 1 &lt;=&gt; 2
8,7,6,5,2,1,4,3: Move = 4 &lt;=&gt; 6
8,7,6,5,4,1,2,3: Move = 5 &lt;=&gt; 7
8,7,6,5,4,3,2,1
</code></pre>

<p>Which is a correct solution to the problem. If you want to see a run-time display of the solving process, add the <code>--rtd</code> switch.</p>

<h2 id="conclusion">Conclusion</h2>

<p>LM-Solve is a usable and flexible framework for writing your own solvers for various kind of puzzles such as the above. Puzzles that are good candidates for implementing solvers have a relatively limited number of states and a small number of states emerging from each origin state.</p>

<p>I found several solitaire games, such as Freecell, to be solvable by methods similar to the above. On the other hand, Klondike and other games with <code>talon</code>, are very hard to solve using such methods, because the <code>talon</code> expands the number of states a great deal.</p>

<p>Still, for most &ldquo;simple-minded&rdquo; puzzles, LM-Solve is very attractive as a solver framework. Have fun!</p>

              </article>
              <p><strong>Tags</strong></p>
              <div class="tags">
                <div class="category"><a href="/categories/games">games</a></div>
                
                  <div class="tag"><a href="/tags/games-puzzles-logic-maze">games-puzzles-logic-maze</a></div>
                
              </div>
            </div>
            
              
                
<div class="row" id="author-bio-shlomi-fish">
  <div class="col-sm-2">
    
    <a href="/authors/shlomi-fish/"><div class="circle-avatar" style="background-image:url(/images/site/avatar.png)"></div></a>
  </div>
  <div class="col-sm-10">
    <a href="/authors/shlomi-fish/"><h3>Shlomi Fish</h3></a>
    <p></p>
    <h5><a href="/authors/shlomi-fish/">Browse their articles</a></h5>
  </div>
</div>

            
            <div class="row">
              <h3>Feedback</h3>
              <p>Something wrong with this article? Help us out by opening an issue or pull request on <a href="https://github.com/tpf/perldotcom/blob/master/content/legacy/_pub_2003_11_17_lmsolve.md">GitHub</a></p>
            </div>
          </div>
          <div class="col-md-3">
            <div class="latest-sidebar">

  <div class="row">
    <div class="col-sm-12 centering">
      <span style="font-size:1.8em" class="antonio txt-blue-major">OUR LATEST ARTICLES</span>
    </div>
  </div>
  
    
    
    <div class="row">
        <a href="http://localhost:1313/article/the-perl-admbassador-curtis-poe/">
      <div class="col-sm-3">
        <div class="circle-avatar" style="background-image:url(/images/the-perl-ambassador-curtis-poe/curtis-poe.jpg)"></div>
      </div>
      <div class="col-sm-9">
          <h6>The Perl Ambassador: Curtis &#39;Ovid&#39; Poe</h6>
          <p style="line-height:1"><small>The person behind the news of Perl</small></p>
      </div>
        </a>
    </div>
  
    
    
    <div class="row">
        <a href="http://localhost:1313/article/a-tour-with-net-ftp/">
      <div class="col-sm-3">
        <div class="circle-avatar" style="background-image:url(/images/a-tour-with-net-ftp/thumb_kidyes.jpg)"></div>
      </div>
      <div class="col-sm-9">
          <h6>A tour with Net::FTP</h6>
          <p style="line-height:1"><small>How to write an FTP client in Perl</small></p>
      </div>
        </a>
    </div>
  
    
    
    <div class="row">
        <a href="http://localhost:1313/article/shortcode_test/">
      <div class="col-sm-3">
        <div class="circle-avatar" style="background-image:url(/images/author/brian-d-foy.jpg)"></div>
      </div>
      <div class="col-sm-9">
          <h6>shortcode_test</h6>
          <p style="line-height:1"><small></small></p>
      </div>
        </a>
    </div>
  
    
    
    <div class="row">
        <a href="http://localhost:1313/article/listen-to-larry-wall-s-state-of-the-onion-2000-on-youtube/">
      <div class="col-sm-3">
        <div class="circle-avatar" style="background-image:url(/images/listen-to-larry-wall-s-state-of-the-onion-2000-on-youtube/thumb_larry-wall.jpg)"></div>
      </div>
      <div class="col-sm-9">
          <h6>Listen to Larry Wall&#39;s State of the Onion 2000 on YouTube</h6>
          <p style="line-height:1"><small></small></p>
      </div>
        </a>
    </div>
  
    
    
    <div class="row">
        <a href="http://localhost:1313/article/announcing-perl-7/">
      <div class="col-sm-3">
        <div class="circle-avatar" style="background-image:url(/images/announcing-perl-7/thumb_seven_on_blue_wall.jpg)"></div>
      </div>
      <div class="col-sm-9">
          <h6>Announcing Perl 7</h6>
          <p style="line-height:1"><small>Perl 5 with modern defaults</small></p>
      </div>
        </a>
    </div>
  
</div>
<div class="row" style="margin-top:20px">
  <div class="col-sm-12 centering">
  <script async src="/widget/toplinks/toplinks.js" type="text/javascript"></script>
    <div id="toplinks"></div>
  </div>
</div>

<div class="row" style="margin-top:20px">
  <div class="col-sm-12 centering">
    <a class="twitter-timeline" data-height="640" data-dnt="true" data-theme="dark" href="https://twitter.com/perlfoundation?ref_src=twsrc%5Etfw">Tweets by perlfoundation</a> <script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>
  </div>
</div>

<div class="row" style="margin-top:20px">
  <div class="col-sm-12 centering">
    <script src="https://www.reddit.com/r/perl/hot/.embed?limit=10&t=all" type="text/javascript"></script>
  </div>
</div>



          </div>
        </div>
      </div>
    </section>
  </section>
<script>
 
var tables, i;
tables = document.getElementsByTagName('table');
for (i=0;i<tables.length;i++) {
  tables[i].className = 'table table-striped';
}
</script>
<div class="push"></div>
<div class="footer">
  <div class="container">
    <div class="row">
      <div class="col-md-1">
        <h5>Site Map</h5>
        <ul>
        <li><a href="/">Home</a></li>
        <hr>
        <li><a href="/about">About</a></li>
        <hr>
        <li><a href="/authors">Authors</a></li>
        <hr>
        <li><a href="/categories">Categories</a></li>
        <hr>
        <li><a href="/tags">Tags</a></li>
        <hr>
        </ul>
      </div>
      <div class="col-md-3">
        <h5>Contact Us</h5>
        <p>To get in touch, send an email to: perl.com-editor@perl.org</p>
        <p><a href="https://perl.org">
              <img src="/images/site/perl-onion_20.png" alt="Perl Onion"></a>
          <a href="https://twitter.com/intent/follow?screen_name=perlfoundation">
              <img src="/images/site/twitter_20.png" alt="twitter"></a>
          <a href="/index.xml" /><img src="/images/site/rss_20.png" alt="rss"></a>
          <a href="https://github.com/tpf/perldotcom">
              <img src="/images/site/github_light_20.png" alt="GitHub logo"></a></p>
      </div>
      <div class="col-md-2">
          <h5>License</h5>
          <p>This work is licensed under a <a rel="license" href="https://creativecommons.org/licenses/by-nc/3.0/">Creative Commons Attribution-NonCommercial 3.0 Unported License</a>.</p>
          <p><a rel="license" href="https://creativecommons.org/licenses/by-nc/3.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc/3.0/88x31.png" /></a></p>
      </div>
      <div class="col-md-5">
          <h5>Legal</h5>
          <p>Perl.com and the authors make no representations with respect to the accuracy or completeness of the contents of all work on this website and specifically disclaim all warranties, including without limitation warranties of fitness for a particular purpose. The information published on this website may not be suitable for every situation. All work on this website is provided with the understanding that Perl.com and the authors are not engaged in rendering professional services. Neither Perl.com nor the authors shall be liable for damages arising herefrom.</p>
      </div>
    </div>
  </div>
</div>
<script src="/javascript/jquery.min.js"></script>
<script src="/javascript/bootstrap.min.js"></script>
<script data-no-instant>document.write('<script src="/livereload.js?port=1313&mindelay=10"></' + 'script>')</script></body>
</html>

