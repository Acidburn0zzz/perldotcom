<!DOCTYPE html>
<html lang="en-us">
  <head>
  <title> Screen-scraping with WWW::Mechanize </title>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content=" Screen-scraping is the process of emulating an interaction with a Web site - not just downloading pages, but filling out forms, navigating around the site, and dealing with the HTML received as a result. As well as for traditional..."/>
  <meta name="robots" content="index, follow">
  <meta name="google-site-verification" content="TZowffo_LX2mmsw2DbeNNbukCMnIOA8T-6CMJPiYllI" />

<meta property="twitter:card" content="summary">
<meta property="twitter:site" content="@PerlFoundation">
<meta property="og:url" content="http://localhost:1313/pub/2003/01/22/mechanize.html/" />
<meta property="og:title" content="Screen-scraping with WWW::Mechanize" />
<meta property="og:description" content=" Screen-scraping is the process of emulating an interaction with a Web site - not just downloading pages, but filling out forms, navigating around the site, and dealing with the HTML received as a result. As well as for traditional...">
<meta property="og:site_name" content="Perl.com" />

<meta property="og:type" content="article" />
<meta property="og:article:published_time" content="2003-01-01T01:01:01Z" />
<meta property="og:image" content="http://localhost:1313/images/_pub_2003_01_22_mechanize/111-mechanize.gif" />
<meta property="og:article:tag" content="screen-scraping-web-mechanize" />


  <link rel="icon" href="/favicon.ico">
  <link href="/article/index.xml" rel="alternate" type="application/rss+xml" title="Perl.com - programming news, code and culture" />
  <link href="/article/index.xml" rel="feed" type="application/rss+xml" title="Perl.com - programming news, code and culture" />
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" type="text/css" href="/css/perldotcom.css"/>


<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-50555-22', 'auto');
ga('create', 'UA-85734801-2', 'auto', 'editor');
ga('send', 'pageview');
ga('editor.send', 'pageview');
</script>

</head>
<body>

<div class="container-fluid full-wdith antonio">
 <div class="row">
  <div class="navbar-inverse" style="border-radius:none !important" role="navigation">
    <div class="container-fluid">
      <ul class="nav navbar-nav pull-right follow">
          <li>MORE:</li>
          <li><a href="https://perl.org">
              <img src="/images/site/perl-onion_20.png" alt="Perl Onion"></a><li>
          <li><a href="https://twitter.com/intent/follow?screen_name=perlfoundation">
              <img src="/images/site/twitter_20.png" alt="twitter"></a><li>
          <li><a href="/article/index.xml" />
              <img src="/images/site/rss_20.png" alt="rss"></a></li>
          <li><a href="https://github.com/tpf/perldotcom" />
              <img src="/images/site/github_light_20.png" alt="GitHub logo"></a></li>
      </ul>
      <div class="navbar-header">
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
          <a class="navbar-nav" href="/">
            <div class="header-logo">Perl.com</div>
          </a>
      </div>
      <div class="navbar-collapse collapse">
        <ul class="nav navbar-nav">
          <li><a href="/about">
              <div class="circle">
                <img src="/images/site/perl-camel.png" alt="" />
              </div>
                  &nbsp;&nbsp;ABOUT</a>
          </li>
          <li><a href="/authors">
              <div class="circle">
                  <span class="glyphicon glyphicon-user txt-blue-major" aria-hidden="true"></span>
              </div>
                  &nbsp;&nbsp;AUTHORS</a>
          </li>
          <li><a href="/categories">
              <div class="circle">
                  <span class="glyphicon glyphicon-folder-open txt-blue-major" aria-hidden="true"></span>
              </div>
                  &nbsp;&nbsp;CATEGORIES</a>
          </li>
          <li><a href="/tags">
              <div class="circle">
                <span class="txt-blue-major" aria-hidden="true"><strong>#</strong></span>
              </div>
                  &nbsp;&nbsp;TAGS</a>
          </li>
          <li>
            <form class="search" name="ddg" action="https://duckduckgo.com/" method="get">
              <input type="text" name ="q" placeholder="SEARCH" />
              <input type="hidden" value="perl.com" name="sites" />
            </form>
          </li>
        </ul>
      </div>
    </div>
  </div>
 </div>
</div>


  <section id="content" role="main">
    <section class="entry-content">
      <div class="container">
        <div class="row">
          <div class="col-md-9">
            <div class="row">
              <article class="fulltext">
              <h1 class="blog-post-title">Screen-scraping with WWW::Mechanize</h1>
              <p class="blog-post-meta">Jan 22, 2003 by
              
              
                
                
                <a href="#author-bio-chris-ball">Chris Ball</a>
              
              </p>
              <img alt="" src=""/>
                <p>Screen-scraping is the process of emulating an interaction with a Web site - not just downloading pages, but filling out forms, navigating around the site, and dealing with the HTML received as a result. As well as for traditional lookups of information - like the example we&rsquo;ll be exploring in this article - we can use screen-scraping to enhance a Web service into doing something the designers hadn&rsquo;t given us the power to do in the first place. Here&rsquo;s an example:</p>

<p>I do my banking online, but get quickly bored with having to go to my bank&rsquo;s site, log in, navigate around to my accounts and check the balance on each of them. One quick Perl module (<a href="https://metacpan.org/pod/Finance::Bank::HSBC"><code>Finance::Bank::HSBC</code></a>) later, and now I can loop through each of my accounts and print their balances, all from a shell prompt. Some more code, and I can do something the bank&rsquo;s site doesn&rsquo;t ordinarily let me - I can treat my accounts as a whole instead of individual accounts, and find out how much money I have, could possibly spend, and owe, all in total. Another step forward would be to schedule a <em>crontab</em> every day to use the HSBC option to download a copy of my transactions in Quicken&rsquo;s QIF format, and use Simon Cozens&rsquo; <a href="https://metacpan.org/pod/Finance::QIF"><code>Finance::QIF</code></a> module to interpret the file and run those transactions against a budget, letting me know whether I&rsquo;m spending too much lately. This takes a simple Web-based system from being merely useful to being automated and bespoke; if you can think of how to write the code, then you can do it. (It&rsquo;s probably wise for me to add the caveat, though, that you should be extremely careful working with banking information programatically, and even more careful if you&rsquo;re storing your login details in a Perl script somewhere.)</p>

<p>Back to screen-scrapers, and introducing <a href="https://metacpan.org/pod/WWW::Mechanize"><code>WWW::Mechanize</code></a>, written by Andy Lester and based on Skud&rsquo;s [](https://metacpan.org/pod/WWW::Automate)<code>WWW::Automate</code>. Mechanize allows you to go to a URL and explore the site, following links by name, taking cookies, filling in forms and clicking &ldquo;submit&rdquo; buttons. We&rsquo;re also going to use <a href="https://metacpan.org/pod/HTML::TokeParser"><code>HTML::TokeParser</code></a> to process the HTML we&rsquo;re given back, which is a process I&rsquo;ve written about <a href="/pub/2001/11/15/creatingrss.html">previously</a>.</p>

<p>The site I&rsquo;ve chosen to demonstrate on is the BBC&rsquo;s <a href="http://www.radiotimes.beeb.com">Radio Times</a> site, which allows users to create a &ldquo;Diary&rdquo; for their favorite TV programs, and will tell you whenever any of the programs is showing on any channel. Being a <a href="http://london.pm.org/">London Perl M[ou]nger</a>, I have an obsession with Buffy the Vampire Slayer. If I tell this to the BBC&rsquo;s site, then it&rsquo;ll tell me when the next episode is, and what the episode name is - so I can check whether it&rsquo;s one I&rsquo;ve seen before. I&rsquo;d have to remember to log into their site every few days to check whether there was a new episode coming along, though. Perl to the rescue! Our script will check to see when the next episode is and let us know, along with the name of the episode being shown.</p>

<p>Here&rsquo;s the code:</p>

<pre><code>  #!/usr/bin/perl -w
  use strict;

  use WWW::Mechanize;
  use HTML::TokeParser;
</code></pre>

<p>If you&rsquo;re going to run the script yourself, then you should register with the Radio Times site and create a diary, before giving the e-mail address you used to do so below.</p>

<pre><code>  my $email = &quot;;
  die &quot;Must provide an e-mail address&quot; unless $email ne &quot;;
</code></pre>

<p>We create a WWW::Mechanize object, and tell it the address of the site we&rsquo;ll be working from. The Radio Times&rsquo; front page has an image link with an ALT text of &ldquo;My Diary&rdquo;, so we can use that to get to the right section of the site:</p>

<pre><code>  my $agent = WWW::Mechanize-&gt;new();
  $agent-&gt;get(&quot;http://www.radiotimes.beeb.com/&quot;);
  $agent-&gt;follow(&quot;My Diary&quot;);
</code></pre>

<p>The returned page contains two forms - one to allow you to choose from a list box of program types, and then a login form for the diary function. We tell WWW::Mechanize to use the second form for input. (Something to remember here is that WWW::Mechanize&rsquo;s list of forms, unlike an array in Perl, is indexed starting at 1 rather than 0. Our index is, therefore,&lsquo;2.&rsquo;)</p>

<pre><code>  $agent-&gt;form(2);
</code></pre>

<p>Now we can fill in our e-mail address for the &lsquo;&lt;INPUT name=&ldquo;email&rdquo; type=&ldquo;text&rdquo;&gt;&rsquo; field, and click the submit button. Nothing too complicated.</p>

<pre><code>  $agent-&gt;field(&quot;email&quot;, $email);
  $agent-&gt;click();
</code></pre>

<p>WWW::Mechanize moves us to our diary page. This is the page we need to process to find the date details from. Upon looking at the HTML source for this page, we can see that the HTML we need to work through is something like:</p>

<pre><code>  &lt;input&gt;
  &lt;tr&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;
  &lt;tr&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td class=&quot;bluetext&quot;&gt;Date of episode&lt;/td&gt;&lt;/tr&gt;
  &lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;
  &lt;td class=&quot;bluetext&quot;&gt;&lt;b&gt;Time of episode&lt;/b&gt;&lt;/td&gt;&lt;/tr&gt;
  &lt;a href=&quot;page_with_episode_info&quot;&gt;&lt;/a&gt;
</code></pre>

<p>This can be modeled with <code>HTML::TokeParser</code> as below. The important methods to note are <code>get_tag</code> - which will move the stream on to the next opening for the tag given - and <code>get_trimmed_text</code>, which returns the text between the current and given tags. For example, for the HTML code &ldquo;&lt;b&gt;Bold text here&lt;/b&gt;&rdquo;, <code>my $tag = get_trimmed_text(&quot;/b&quot;)</code> would return <code>&quot;Bold text here&quot;</code> to <code>$tag</code>.</p>

<p>Also note that we&rsquo;re initializing HTML::TokeParser on &lsquo;\$agent-&gt;{content}&rsquo; - this is an internal variable for WWW::Mechanize, exposing the HTML content of the current page.</p>

<pre><code>  my $stream = HTML::TokeParser-&gt;new(\$agent-&gt;{content});
  my $date;

  # &lt;input&gt;
  $stream-&gt;get_tag(&quot;input&quot;);

  # &lt;tr&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;
  $stream-&gt;get_tag(&quot;tr&quot;); $stream-&gt;get_tag(&quot;tr&quot;);

  # &lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;
  $stream-&gt;get_tag(&quot;td&quot;); $stream-&gt;get_tag(&quot;td&quot;);

  # &lt;td class=&quot;bluetext&quot;&gt;Date of episode&lt;/td&gt;&lt;/tr&gt;
  my $tag = $stream-&gt;get_tag(&quot;td&quot;);
  if ($tag-&gt;[1]{class} and $tag-&gt;[1]{class} eq &quot;bluetext&quot;) {
      $date = $stream-&gt;get_trimmed_text(&quot;/td&quot;);
      # The date contains '&amp;nbsp;', which we'll translate to a space.
      $date =~ s/\xa0/ /g;
  }

  # &lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;
  $stream-&gt;get_tag(&quot;td&quot;);

  # &lt;td class=&quot;bluetext&quot;&gt;&lt;b&gt;Time of episode&lt;/b&gt;  
  $tag = $stream-&gt;get_tag(&quot;td&quot;);

  if ($tag-&gt;[1]{class} eq &quot;bluetext&quot;) {
      $stream-&gt;get_tag(&quot;b&quot;);
      # This concatenates the time of the showing to the date.
      $date .= &quot;, from &quot; . $stream-&gt;get_trimmed_text(&quot;/b&quot;);
  }

  # &lt;/td&gt;&lt;/tr&gt;&lt;a href=&quot;page_with_episode_info&quot;&gt;&lt;/a&gt;
  $tag = $stream-&gt;get_tag(&quot;a&quot;);

  # Match the URL to find the page giving episode information.
  $tag-&gt;[1]{href} =~ m!src=(http://.*?)'!;
</code></pre>

<p>We have a scalar, $date, containing a string that looks something like &ldquo;Thursday 23 January, from 6:45pm to 7:30pm.&ldquo;, and we have an URL, in $1, that will tell us more about that episode. We tell WWW::Mechanize to go to the URL:</p>

<pre><code>  $agent-&gt;get($1);
</code></pre>

<p>The navigation we want to perform on this page is far less complex than on the last page, so we can avoid using a TokeParser for it - a regular expression should suffice. The HTML we want to parse looks something like this:</p>

<pre><code>  &lt;br&gt;&lt;b&gt;Episode&lt;/b&gt;&lt;br&gt;  The Episode Title&lt;br&gt;
</code></pre>

<p>We use a regex delimited with &lsquo;!&rsquo; in order to avoid having to escape the slashes present in the HTML, and store any number of alphanumeric characters after some whitespace, all between &lt;br&gt; tags after the Episode header:</p>

<pre><code>  $agent-&gt;{content} =~ m!&lt;br&gt;&lt;b&gt;Episode&lt;/b&gt;&lt;br&gt;\s+?(\w+?)&lt;br&gt;!;
</code></pre>

<p>$1 now contains our episode, and all that&rsquo;s left to do is print out what we&rsquo;ve found:</p>

<pre><code>  my $episode = $1;
  print &quot;The next Buffy episode ($episode) is on $date.\n&quot;;
</code></pre>

<p>And we&rsquo;re all set. We can run our script from the shell:</p>

<pre><code>  $ perl radiotimes.pl
  The next Buffy episode (Gone) is Thursday Jan. 23, from 6:45 to 7:30 p.m.
</code></pre>

<p>I hope this gives a light-hearted introduction to the usefulness of the modules involved. As a note for your own experiments, WWW::Mechanize supports cookies - in that the requestor is a normal LWP::UserAgent object - but they aren&rsquo;t enabled by default. If you need to support cookies, then your script should call &ldquo;<code>use HTTP::Cookies;</code> <code>$agent-&gt;cookie_jar(HTTP::Cookies-&gt;new)</code>;&rdquo; on your agent object in order to enable session-volatile cookies for your own code.</p>

<p>Happy screen-scraping, and may you never miss a Buffy episode again.</p>

              </article>
              <p><strong>Tags</strong></p>
              <div class="tags">
                <div class="category"><a href="/categories/web">web</a></div>
                
                  <div class="tag"><a href="/tags/screen-scraping-web-mechanize">screen-scraping-web-mechanize</a></div>
                
              </div>
            </div>
            
              
                
<div class="row" id="author-bio-chris-ball">
  <div class="col-sm-2">
    
    <a href="/authors/chris-ball/"><div class="circle-avatar" style="background-image:url(/images/site/avatar.png)"></div></a>
  </div>
  <div class="col-sm-10">
    <a href="/authors/chris-ball/"><h3>Chris Ball</h3></a>
    <p></p>
    <h5><a href="/authors/chris-ball/">Browse their articles</a></h5>
  </div>
</div>

            
            <div class="row">
              <h3>Feedback</h3>
              <p>Something wrong with this article? Help us out by opening an issue or pull request on <a href="https://github.com/tpf/perldotcom/blob/master/content/legacy/_pub_2003_01_22_mechanize.md">GitHub</a></p>
            </div>
          </div>
          <div class="col-md-3">
            <div class="latest-sidebar">

  <div class="row">
    <div class="col-sm-12 centering">
      <span style="font-size:1.8em" class="antonio txt-blue-major">OUR LATEST ARTICLES</span>
    </div>
  </div>
  
    
    
    <div class="row">
        <a href="http://localhost:1313/article/the-perl-admbassador-curtis-poe/">
      <div class="col-sm-3">
        <div class="circle-avatar" style="background-image:url(/images/the-perl-ambassador-curtis-poe/curtis-poe.jpg)"></div>
      </div>
      <div class="col-sm-9">
          <h6>The Perl Ambassador: Curtis &#39;Ovid&#39; Poe</h6>
          <p style="line-height:1"><small>The person behind the news of Perl</small></p>
      </div>
        </a>
    </div>
  
    
    
    <div class="row">
        <a href="http://localhost:1313/article/a-tour-with-net-ftp/">
      <div class="col-sm-3">
        <div class="circle-avatar" style="background-image:url(/images/a-tour-with-net-ftp/thumb_kidyes.jpg)"></div>
      </div>
      <div class="col-sm-9">
          <h6>A tour with Net::FTP</h6>
          <p style="line-height:1"><small>How to write an FTP client in Perl</small></p>
      </div>
        </a>
    </div>
  
    
    
    <div class="row">
        <a href="http://localhost:1313/article/shortcode_test/">
      <div class="col-sm-3">
        <div class="circle-avatar" style="background-image:url(/images/author/brian-d-foy.jpg)"></div>
      </div>
      <div class="col-sm-9">
          <h6>shortcode_test</h6>
          <p style="line-height:1"><small></small></p>
      </div>
        </a>
    </div>
  
    
    
    <div class="row">
        <a href="http://localhost:1313/article/listen-to-larry-wall-s-state-of-the-onion-2000-on-youtube/">
      <div class="col-sm-3">
        <div class="circle-avatar" style="background-image:url(/images/listen-to-larry-wall-s-state-of-the-onion-2000-on-youtube/thumb_larry-wall.jpg)"></div>
      </div>
      <div class="col-sm-9">
          <h6>Listen to Larry Wall&#39;s State of the Onion 2000 on YouTube</h6>
          <p style="line-height:1"><small></small></p>
      </div>
        </a>
    </div>
  
    
    
    <div class="row">
        <a href="http://localhost:1313/article/announcing-perl-7/">
      <div class="col-sm-3">
        <div class="circle-avatar" style="background-image:url(/images/announcing-perl-7/thumb_seven_on_blue_wall.jpg)"></div>
      </div>
      <div class="col-sm-9">
          <h6>Announcing Perl 7</h6>
          <p style="line-height:1"><small>Perl 5 with modern defaults</small></p>
      </div>
        </a>
    </div>
  
</div>
<div class="row" style="margin-top:20px">
  <div class="col-sm-12 centering">
  <script async src="/widget/toplinks/toplinks.js" type="text/javascript"></script>
    <div id="toplinks"></div>
  </div>
</div>

<div class="row" style="margin-top:20px">
  <div class="col-sm-12 centering">
    <a class="twitter-timeline" data-height="640" data-dnt="true" data-theme="dark" href="https://twitter.com/perlfoundation?ref_src=twsrc%5Etfw">Tweets by perlfoundation</a> <script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>
  </div>
</div>

<div class="row" style="margin-top:20px">
  <div class="col-sm-12 centering">
    <script src="https://www.reddit.com/r/perl/hot/.embed?limit=10&t=all" type="text/javascript"></script>
  </div>
</div>



          </div>
        </div>
      </div>
    </section>
  </section>
<script>
 
var tables, i;
tables = document.getElementsByTagName('table');
for (i=0;i<tables.length;i++) {
  tables[i].className = 'table table-striped';
}
</script>
<div class="push"></div>
<div class="footer">
  <div class="container">
    <div class="row">
      <div class="col-md-1">
        <h5>Site Map</h5>
        <ul>
        <li><a href="/">Home</a></li>
        <hr>
        <li><a href="/about">About</a></li>
        <hr>
        <li><a href="/authors">Authors</a></li>
        <hr>
        <li><a href="/categories">Categories</a></li>
        <hr>
        <li><a href="/tags">Tags</a></li>
        <hr>
        </ul>
      </div>
      <div class="col-md-3">
        <h5>Contact Us</h5>
        <p>To get in touch, send an email to: perl.com-editor@perl.org</p>
        <p><a href="https://perl.org">
              <img src="/images/site/perl-onion_20.png" alt="Perl Onion"></a>
          <a href="https://twitter.com/intent/follow?screen_name=perlfoundation">
              <img src="/images/site/twitter_20.png" alt="twitter"></a>
          <a href="/index.xml" /><img src="/images/site/rss_20.png" alt="rss"></a>
          <a href="https://github.com/tpf/perldotcom">
              <img src="/images/site/github_light_20.png" alt="GitHub logo"></a></p>
      </div>
      <div class="col-md-2">
          <h5>License</h5>
          <p>This work is licensed under a <a rel="license" href="https://creativecommons.org/licenses/by-nc/3.0/">Creative Commons Attribution-NonCommercial 3.0 Unported License</a>.</p>
          <p><a rel="license" href="https://creativecommons.org/licenses/by-nc/3.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc/3.0/88x31.png" /></a></p>
      </div>
      <div class="col-md-5">
          <h5>Legal</h5>
          <p>Perl.com and the authors make no representations with respect to the accuracy or completeness of the contents of all work on this website and specifically disclaim all warranties, including without limitation warranties of fitness for a particular purpose. The information published on this website may not be suitable for every situation. All work on this website is provided with the understanding that Perl.com and the authors are not engaged in rendering professional services. Neither Perl.com nor the authors shall be liable for damages arising herefrom.</p>
      </div>
    </div>
  </div>
</div>
<script src="/javascript/jquery.min.js"></script>
<script src="/javascript/bootstrap.min.js"></script>
<script data-no-instant>document.write('<script src="/livereload.js?port=1313&mindelay=10"></' + 'script>')</script></body>
</html>

