<!DOCTYPE html>
<html lang="en-us">
  <head>
  <title> Cooking with Perl </title>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content=" Editor&#39;s note: The new edition of Perl Cookbook is about to hit store shelves, so to trumpet its release, we offer some recipes-new to the second edition-for your sampling pleasure. This week&#39;s excerpts include recipes from Chapter 6 (&#34;Pattern..."/>
  <meta name="robots" content="index, follow">
  <meta name="google-site-verification" content="TZowffo_LX2mmsw2DbeNNbukCMnIOA8T-6CMJPiYllI" />

<meta property="twitter:card" content="summary">
<meta property="twitter:site" content="@PerlFoundation">
<meta property="og:url" content="http://localhost:1313/pub/2003/08/21/perlcookbook.html/" />
<meta property="og:title" content="Cooking with Perl" />
<meta property="og:description" content=" Editor&#39;s note: The new edition of Perl Cookbook is about to hit store shelves, so to trumpet its release, we offer some recipes-new to the second edition-for your sampling pleasure. This week&#39;s excerpts include recipes from Chapter 6 (&#34;Pattern...">
<meta property="og:site_name" content="Perl.com" />

<meta property="og:type" content="article" />
<meta property="og:article:published_time" content="2003-08-08T08:08:08Z" />
<meta property="og:image" content="http://localhost:1313/images/author/tom-christiansen.jpg" />
<meta property="og:article:tag" content="cooking-with-perl" />
<meta property="og:article:tag" content="file-contents" />
<meta property="og:article:tag" content="matching-nested-patterns" />
<meta property="og:article:tag" content="patterns" />
<meta property="og:article:tag" content="perl" />
<meta property="og:article:tag" content="perl-cookbook" />
<meta property="og:article:tag" content="pretending-a-string-is-a-file" />


  <link rel="icon" href="/favicon.ico">
  <link href="/article/index.xml" rel="alternate" type="application/rss+xml" title="Perl.com - programming news, code and culture" />
  <link href="/article/index.xml" rel="feed" type="application/rss+xml" title="Perl.com - programming news, code and culture" />
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" type="text/css" href="/css/perldotcom.css"/>


<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-50555-22', 'auto');
ga('create', 'UA-85734801-2', 'auto', 'editor');
ga('send', 'pageview');
ga('editor.send', 'pageview');
</script>

</head>
<body>

<div class="container-fluid full-wdith antonio">
 <div class="row">
  <div class="navbar-inverse" style="border-radius:none !important" role="navigation">
    <div class="container-fluid">
      <ul class="nav navbar-nav pull-right follow">
          <li>MORE:</li>
          <li><a href="https://perl.org">
              <img src="/images/site/perl-onion_20.png" alt="Perl Onion"></a><li>
          <li><a href="https://twitter.com/intent/follow?screen_name=perlfoundation">
              <img src="/images/site/twitter_20.png" alt="twitter"></a><li>
          <li><a href="/article/index.xml" />
              <img src="/images/site/rss_20.png" alt="rss"></a></li>
          <li><a href="https://github.com/tpf/perldotcom" />
              <img src="/images/site/github_light_20.png" alt="GitHub logo"></a></li>
      </ul>
      <div class="navbar-header">
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
          <a class="navbar-nav" href="/">
            <div class="header-logo">Perl.com</div>
          </a>
      </div>
      <div class="navbar-collapse collapse">
        <ul class="nav navbar-nav">
          <li><a href="/about">
              <div class="circle">
                <img src="/images/site/perl-camel.png" alt="" />
              </div>
                  &nbsp;&nbsp;ABOUT</a>
          </li>
          <li><a href="/authors">
              <div class="circle">
                  <span class="glyphicon glyphicon-user txt-blue-major" aria-hidden="true"></span>
              </div>
                  &nbsp;&nbsp;AUTHORS</a>
          </li>
          <li><a href="/categories">
              <div class="circle">
                  <span class="glyphicon glyphicon-folder-open txt-blue-major" aria-hidden="true"></span>
              </div>
                  &nbsp;&nbsp;CATEGORIES</a>
          </li>
          <li><a href="/tags">
              <div class="circle">
                <span class="txt-blue-major" aria-hidden="true"><strong>#</strong></span>
              </div>
                  &nbsp;&nbsp;TAGS</a>
          </li>
          <li>
            <form class="search" name="ddg" action="https://duckduckgo.com/" method="get">
              <input type="text" name ="q" placeholder="SEARCH" />
              <input type="hidden" value="perl.com" name="sites" />
            </form>
          </li>
        </ul>
      </div>
    </div>
  </div>
 </div>
</div>


  <section id="content" role="main">
    <section class="entry-content">
      <div class="container">
        <div class="row">
          <div class="col-md-9">
            <div class="row">
              <article class="fulltext">
              <h1 class="blog-post-title">Cooking with Perl</h1>
              <p class="blog-post-meta">Aug 21, 2003 by
              
              
                
                
                <a href="#author-bio-tom-christiansen">Tom Christiansen</a> and 
              
                
                
                <a href="#author-bio-nathan-torkington">Nathan Torkington</a>
              
              </p>
              <img alt="" src=""/>
                

<p><em>Editor&rsquo;s note: The new edition of <a href="http://www.oreilly.com/catalog/perlckbk2/">Perl Cookbook</a> is about to hit store shelves, so to trumpet its release, we offer some recipes&ndash;new to the second edition&ndash;for your sampling pleasure. This week&rsquo;s excerpts include recipes from Chapter 6 (&ldquo;Pattern Matching&rdquo;) and Chapter 8 (&ldquo;File Contents&rdquo;). And be sure to check back here in the coming weeks for more new recipes on topics such as using SQL without a database server, extracting table data, templating with HTML::Mason, and more.</em></p>

<h2 id="sample-recipe-matching-nested-patterns">Sample Recipe: Matching Nested Patterns</h2>

<h3 id="problem">Problem</h3>

<p>You want to match a nested set of enclosing delimiters, such as the arguments to a function call.</p>

<h3 id="solution">Solution</h3>

<p>Use match-time pattern interpolation, recursively:</p>

<pre><code>my $np;
$np = qr{
           \(
           (?:
              (?&gt; [^(  )]+ )    # Non-capture group w/o backtracking
            |
              (??{ $np })     # Group with matching parens
           )*
           \)
        }x;
</code></pre>

<p>Or use the Text::Balanced module&rsquo;s <code>extract_bracketed</code> function.</p>

<h3 id="discussion">Discussion</h3>

<p>The <code>$(??{</code><em>CODE</em><code>})</code> construct runs the code and interpolates the string that the code returns right back into the pattern. A simple, non-recursive example that matches palindromes demonstrates this:</p>

<pre><code>if ($word =~ /^(\w+)\w?(??{reverse $1})$/ ) {
    print &quot;$word is a palindrome.\n&quot;;
}
</code></pre>

<p>Consider a word like &ldquo;reviver&rdquo;, which this pattern correctly reports as a palindrome. The <code>$1</code> variable contains <code>&quot;rev&quot;</code> partway through the match. The optional word character following catches the <code>&quot;i&quot;</code>. Then the code <code>reverse $1</code> runs and produces <code>&quot;ver&quot;</code>, and that result is interpolated into the pattern.</p>

<p>For matching something balanced, you need to recurse, which is a bit tricker. A compiled pattern that uses <code>(??{</code><em>CODE</em><code>})</code> can refer to itself. The pattern given in the Solution matches a set of nested parentheses, however deep they may go. Given the value of <code>$np</code> in that pattern, you could use it like this to match a function call:</p>

<pre><code>$text = &quot;myfunfun(1,(2*(3+4)),5)&quot;;
$funpat = qr/\w+$np/;   # $np as above
$text =~ /^$funpat$/;   # Matches!
</code></pre>

<p>You&rsquo;ll find many CPAN modules that help with matching (parsing) nested strings. The Regexp::Common module supplies canned patterns that match many of the tricker strings. For example:</p>

<pre><code>use Regexp::Common;
$text = &quot;myfunfun(1,(2*(3+4)),5)&quot;;
if ($text =~ /(\w+\s*$RE{balanced}{-parens=&gt;'(  )'})/o) {
  print &quot;Got function call: $1\n&quot;;
}
</code></pre>

<p>Other patterns provided by that module match numbers in various notations and quote-delimited strings:</p>

<pre><code>$RE{num}{int}
$RE{num}{real}
$RE{num}{real}{'-base=2'}{'-sep=,'}{'-group=3'}
$RE{quoted}
$RE{delimited}{-delim=&gt;'/'}
</code></pre>

<p>The standard (as of v5.8) Text::Balanced module provides a general solution to this problem.</p>

<pre><code>use Text::Balanced qw/extract_bracketed/;
$text = &quot;myfunfun(1,(2*(3+4)),5)&quot;;
if (($before, $found, $after)  = extract_bracketed($text, &quot;(&quot;)) {
    print &quot;answer is $found\n&quot;;
} else {
    print &quot;FAILED\n&quot;;
}
</code></pre>

<h3 id="see-also">See Also</h3>

<p>The section on &ldquo;Match-Time Pattern Interpolation&rdquo; in Chapter 5, &ldquo;Pattern Matching,&rdquo; of <a href="http://www.oreilly.com/catalog/pperl3/">Programming Perl, 3rd Edition</a>; the documentation for the Regexp::Common CPAN module and the standard Text::Balanced module.</p>

<h2 id="sample-recipe-pretending-a-string-is-a-file">Sample Recipe: Pretending a String Is a File</h2>

<h2 id="problem-1">Problem</h2>

<p>You have data in string, but would like to treat it as a file. For example, you have a subroutine that expects a filehandle as an argument, but you would like that subroutine to work directly on the data in your string instead. Additionally, you don&rsquo;t want to write the data to a temporary file.</p>

<h3 id="solution-1">Solution</h3>

<p>Use the scalar I/O in Perl v5.8:</p>

<pre><code>open($fh, &quot;+&lt;&quot;, \$string);   # read and write contents of $string
</code></pre>

<h3 id="discussion-1">Discussion</h3>

<p>Perl&rsquo;s I/O layers include support for input and output from a scalar. When you read a record with <code>&lt;$fh&gt;</code>, you are reading the next line from <code>$string</code>. When you write a record with <code>print</code>, you change <code>$string</code>. You can pass <code>$fh</code> to a function that expects a filehandle, and that subroutine need never know that it&rsquo;s really working with data in a string.</p>

<p>Perl respects the various access modes in <code>open</code> for strings, so you can specify that the strings be opened as read-only, with truncation, in append mode, and so on:</p>

<pre><code>open($fh, &quot;&lt;&quot;,  \$string);   # read only
open($fh, &quot;&gt;&quot;,  \$string);   # write only, discard original contents
open($fh, &quot;+&gt;&quot;, \$string);   # read and write, discard original contents
open($fh, &quot;+&lt;&quot;, \$string);   # read and write, preserve original contents
</code></pre>

<p>These handles behave in all respects like regular filehandles, so all I/O functions work, such as <code>seek</code>, <code>truncate</code>, <code>sysread</code>, and friends.</p>

<h3 id="see-also-1">See Also</h3>

<p>The <code>open</code> function in <em>perlfunc</em>(1) and in Chapter 29 (&ldquo;Functions&rdquo;) of <a href="http://www.oreilly.com/catalog/pperl3/">Programming Perl, 3rd Edition</a>; &ldquo;Using Random-Access I/O;&rdquo; and &ldquo;Setting the Default I/O Layers&rdquo;</p>

<hr />

<p>O&rsquo;Reilly &amp; Associates will soon release (August 2003) <a href="http://www.oreilly.com/catalog/perlckbk2/">Perl Cookbook, 2nd Edition.</a></p>

<ul>
<li><a href="http://www.oreilly.com/catalog/perlckbk2/chapter/index.html">Sample Chapter 1, Strings</a> is available free online.</li>
<li>You can also look at the <a href="http://www.oreilly.com/catalog/perlckbk2/toc.html">Table of Contents</a>, the <a href="http://www.oreilly.com/catalog/perlckbk2/inx.html">Index</a>, and the <a href="http://www.oreilly.com/catalog/perlckbk2/desc.html">full description</a> of the book.</li>
<li>For more information, or to order the book, <a href="http://www.oreilly.com/catalog/perlckbk2/">click here</a>.</li>
</ul>

<hr />

              </article>
              <p><strong>Tags</strong></p>
              <div class="tags">
                <div class="category"><a href="/categories/development">development</a></div>
                
                  <div class="tag"><a href="/tags/cooking-with-perl">cooking-with-perl</a></div>
                
                  <div class="tag"><a href="/tags/file-contents">file-contents</a></div>
                
                  <div class="tag"><a href="/tags/matching-nested-patterns">matching-nested-patterns</a></div>
                
                  <div class="tag"><a href="/tags/patterns">patterns</a></div>
                
                  <div class="tag"><a href="/tags/perl">perl</a></div>
                
                  <div class="tag"><a href="/tags/perl-cookbook">perl-cookbook</a></div>
                
                  <div class="tag"><a href="/tags/pretending-a-string-is-a-file">pretending-a-string-is-a-file</a></div>
                
              </div>
            </div>
            
              
                
<div class="row" id="author-bio-tom-christiansen">
  <div class="col-sm-2">
    
    <a href="/authors/tom-christiansen/"><div class="circle-avatar" style="background-image:url(/images/author/tom-christiansen.jpg)"></div></a>
  </div>
  <div class="col-sm-10">
    <a href="/authors/tom-christiansen/"><h3>Tom Christiansen</h3></a>
    <p></p>
    <h5><a href="/authors/tom-christiansen/">Browse their articles</a></h5>
  </div>
</div>

            
              
                
<div class="row" id="author-bio-nathan-torkington">
  <div class="col-sm-2">
    
    <a href="/authors/nathan-torkington/"><div class="circle-avatar" style="background-image:url(/images/author/nat-torkington.jpg)"></div></a>
  </div>
  <div class="col-sm-10">
    <a href="/authors/nathan-torkington/"><h3>Nathan Torkington</h3></a>
    <p></p>
    <h5><a href="/authors/nathan-torkington/">Browse their articles</a></h5>
  </div>
</div>

            
            <div class="row">
              <h3>Feedback</h3>
              <p>Something wrong with this article? Help us out by opening an issue or pull request on <a href="https://github.com/tpf/perldotcom/blob/master/content/legacy/_pub_2003_08_21_perlcookbook.md">GitHub</a></p>
            </div>
          </div>
          <div class="col-md-3">
            <div class="latest-sidebar">

  <div class="row">
    <div class="col-sm-12 centering">
      <span style="font-size:1.8em" class="antonio txt-blue-major">OUR LATEST ARTICLES</span>
    </div>
  </div>
  
    
    
    <div class="row">
        <a href="http://localhost:1313/article/the-perl-admbassador-curtis-poe/">
      <div class="col-sm-3">
        <div class="circle-avatar" style="background-image:url(/images/the-perl-ambassador-curtis-poe/curtis-poe.jpg)"></div>
      </div>
      <div class="col-sm-9">
          <h6>The Perl Ambassador: Curtis &#39;Ovid&#39; Poe</h6>
          <p style="line-height:1"><small>The person behind the news of Perl</small></p>
      </div>
        </a>
    </div>
  
    
    
    <div class="row">
        <a href="http://localhost:1313/article/a-tour-with-net-ftp/">
      <div class="col-sm-3">
        <div class="circle-avatar" style="background-image:url(/images/a-tour-with-net-ftp/thumb_kidyes.jpg)"></div>
      </div>
      <div class="col-sm-9">
          <h6>A tour with Net::FTP</h6>
          <p style="line-height:1"><small>How to write an FTP client in Perl</small></p>
      </div>
        </a>
    </div>
  
    
    
    <div class="row">
        <a href="http://localhost:1313/article/shortcode_test/">
      <div class="col-sm-3">
        <div class="circle-avatar" style="background-image:url(/images/author/brian-d-foy.jpg)"></div>
      </div>
      <div class="col-sm-9">
          <h6>shortcode_test</h6>
          <p style="line-height:1"><small></small></p>
      </div>
        </a>
    </div>
  
    
    
    <div class="row">
        <a href="http://localhost:1313/article/listen-to-larry-wall-s-state-of-the-onion-2000-on-youtube/">
      <div class="col-sm-3">
        <div class="circle-avatar" style="background-image:url(/images/listen-to-larry-wall-s-state-of-the-onion-2000-on-youtube/thumb_larry-wall.jpg)"></div>
      </div>
      <div class="col-sm-9">
          <h6>Listen to Larry Wall&#39;s State of the Onion 2000 on YouTube</h6>
          <p style="line-height:1"><small></small></p>
      </div>
        </a>
    </div>
  
    
    
    <div class="row">
        <a href="http://localhost:1313/article/announcing-perl-7/">
      <div class="col-sm-3">
        <div class="circle-avatar" style="background-image:url(/images/announcing-perl-7/thumb_seven_on_blue_wall.jpg)"></div>
      </div>
      <div class="col-sm-9">
          <h6>Announcing Perl 7</h6>
          <p style="line-height:1"><small>Perl 5 with modern defaults</small></p>
      </div>
        </a>
    </div>
  
</div>
<div class="row" style="margin-top:20px">
  <div class="col-sm-12 centering">
  <script async src="/widget/toplinks/toplinks.js" type="text/javascript"></script>
    <div id="toplinks"></div>
  </div>
</div>

<div class="row" style="margin-top:20px">
  <div class="col-sm-12 centering">
    <a class="twitter-timeline" data-height="640" data-dnt="true" data-theme="dark" href="https://twitter.com/perlfoundation?ref_src=twsrc%5Etfw">Tweets by perlfoundation</a> <script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>
  </div>
</div>

<div class="row" style="margin-top:20px">
  <div class="col-sm-12 centering">
    <script src="https://www.reddit.com/r/perl/hot/.embed?limit=10&t=all" type="text/javascript"></script>
  </div>
</div>



          </div>
        </div>
      </div>
    </section>
  </section>
<script>
 
var tables, i;
tables = document.getElementsByTagName('table');
for (i=0;i<tables.length;i++) {
  tables[i].className = 'table table-striped';
}
</script>
<div class="push"></div>
<div class="footer">
  <div class="container">
    <div class="row">
      <div class="col-md-1">
        <h5>Site Map</h5>
        <ul>
        <li><a href="/">Home</a></li>
        <hr>
        <li><a href="/about">About</a></li>
        <hr>
        <li><a href="/authors">Authors</a></li>
        <hr>
        <li><a href="/categories">Categories</a></li>
        <hr>
        <li><a href="/tags">Tags</a></li>
        <hr>
        </ul>
      </div>
      <div class="col-md-3">
        <h5>Contact Us</h5>
        <p>To get in touch, send an email to: perl.com-editor@perl.org</p>
        <p><a href="https://perl.org">
              <img src="/images/site/perl-onion_20.png" alt="Perl Onion"></a>
          <a href="https://twitter.com/intent/follow?screen_name=perlfoundation">
              <img src="/images/site/twitter_20.png" alt="twitter"></a>
          <a href="/index.xml" /><img src="/images/site/rss_20.png" alt="rss"></a>
          <a href="https://github.com/tpf/perldotcom">
              <img src="/images/site/github_light_20.png" alt="GitHub logo"></a></p>
      </div>
      <div class="col-md-2">
          <h5>License</h5>
          <p>This work is licensed under a <a rel="license" href="https://creativecommons.org/licenses/by-nc/3.0/">Creative Commons Attribution-NonCommercial 3.0 Unported License</a>.</p>
          <p><a rel="license" href="https://creativecommons.org/licenses/by-nc/3.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc/3.0/88x31.png" /></a></p>
      </div>
      <div class="col-md-5">
          <h5>Legal</h5>
          <p>Perl.com and the authors make no representations with respect to the accuracy or completeness of the contents of all work on this website and specifically disclaim all warranties, including without limitation warranties of fitness for a particular purpose. The information published on this website may not be suitable for every situation. All work on this website is provided with the understanding that Perl.com and the authors are not engaged in rendering professional services. Neither Perl.com nor the authors shall be liable for damages arising herefrom.</p>
      </div>
    </div>
  </div>
</div>
<script src="/javascript/jquery.min.js"></script>
<script src="/javascript/bootstrap.min.js"></script>
<script data-no-instant>document.write('<script src="/livereload.js?port=1313&mindelay=10"></' + 'script>')</script></body>
</html>

