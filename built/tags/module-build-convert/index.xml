<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Module Build Convert on Perl.com - programming news, code and culture</title>
    <link>http://localhost:1313/tags/module-build-convert/</link>
    <description>Recent content in Module Build Convert on Perl.com - programming news, code and culture</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-us</language>
    <lastBuildDate>Thu, 13 Jul 2006 00:00:00 -0800</lastBuildDate>
    <atom:link href="/tags/module-build-convert/" rel="self" type="application/rss+xml" />
    
    <item>
      <title>Still More Perl Lightning Articles</title>
      <link>http://localhost:1313/pub/2006/07/13/lightning-articles.html/</link>
      <pubDate>Thu, 13 Jul 2006 00:00:00 -0800</pubDate>
      
      <guid>http://localhost:1313/pub/2006/07/13/lightning-articles.html/</guid>
      <description>

&lt;p&gt;It has been common practice within the Perl community for ages to ship distributions with a &lt;em&gt;Makefile.PL&lt;/em&gt; so that the user will be able to install the packages when he retrieves them, either via the shell which the &lt;code&gt;CPAN/CPANPLUS&lt;/code&gt; modules offer or via manual CPAN download.&lt;/p&gt;

&lt;p&gt;The &lt;em&gt;Makefile.PL&lt;/em&gt; consists of meta-information, which in the case of the distribution &lt;a href=&#34;https://metacpan.org/pod/HTML::Tagset&#34;&gt;&lt;code&gt;HTML::Tagset&lt;/code&gt;&lt;/a&gt; is:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt; # This -*-perl-*- program writes the Makefile for installing this distribution.
 #
 # See &amp;quot;perldoc perlmodinstall&amp;quot; or &amp;quot;perldoc ExtUtils::MakeMaker&amp;quot; for
 # info on how to control how the installation goes.

 require 5.004;
 use strict;
 use ExtUtils::MakeMaker;

 WriteMakefile(
     NAME            =&amp;gt; &#39;HTML::Tagset&#39;,
     AUTHOR          =&amp;gt; &#39;Andy Lester &amp;lt;andy@petdance.com&amp;gt;&#39;,
     VERSION_FROM    =&amp;gt; &#39;Tagset.pm&#39;, # finds $VERSION
     ABSTRACT_FROM   =&amp;gt; &#39;Tagset.pm&#39;, # retrieve abstract from module
     PMLIBDIRS       =&amp;gt; [qw(lib/)],
     dist            =&amp;gt; { COMPRESS =&amp;gt; &#39;gzip -9f&#39;, SUFFIX =&amp;gt; &#39;gz&#39;, },
     clean           =&amp;gt; { FILES =&amp;gt; &#39;HTML-Tagset-*&#39; },
 );
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Of interest are the arguments to &lt;code&gt;WriteMakefile()&lt;/code&gt;, because they influence the &lt;em&gt;Makefile&lt;/em&gt; written by &lt;code&gt;ExtUtils::MakeMaker&lt;/code&gt; after the user has invoked the usual build and install procedure:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt; % perl Makefile.PL
 % make
 % make test
 # make install
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;module-build-successor-of-extutils-makemaker&#34;&gt;&lt;code&gt;Module::Build&lt;/code&gt;, Successor of &lt;code&gt;ExtUtils::MakeMaker&lt;/code&gt;?&lt;/h3&gt;

&lt;p&gt;As Ken Williams grew tired of &lt;a href=&#34;https://metacpan.org/pod/ExtUtils::MakeMaker&#34;&gt;&lt;code&gt;ExtUtils::MakeMaker&lt;/code&gt;&lt;/a&gt; and its portability issues, he invented &lt;a href=&#34;https://metacpan.org/pod/Module::Build&#34;&gt;&lt;code&gt;Module::Build&lt;/code&gt;&lt;/a&gt;, a successor of &lt;code&gt;ExtUtils::MakeMaker&lt;/code&gt;. One goal of &lt;code&gt;Module::Build&lt;/code&gt; is to run smoothly on most operating systems, because it takes advantage of creating Perl-valid syntax files only and does not rely upon crufty &lt;em&gt;Makefiles&lt;/em&gt;, which are often subject to misinterpretation, because so many incompatible flavors of &lt;code&gt;make&lt;/code&gt; exist in the wild.&lt;/p&gt;

&lt;p&gt;The current maintainer of &lt;code&gt;ExtUtils::MakeMaker&lt;/code&gt;, Michael G. Schwern, elaborated about this problem in his talk reachable via &amp;ldquo;&lt;a href=&#34;http://mungus.schwern.org/~schwern/talks/MakeMaker_Is_DOOMED/slides/&#34;&gt;MakeMaker is DOOMED&lt;/a&gt;.&amp;rdquo;&lt;/p&gt;

&lt;h3 id=&#34;module-build-distribution-skeleton&#34;&gt;&lt;code&gt;Module::Build&lt;/code&gt; Distribution &amp;ldquo;Skeleton&amp;rdquo;&lt;/h3&gt;

&lt;p&gt;If you take in consideration the distribution &lt;code&gt;HTML::Tagset&lt;/code&gt; again, the rough skeleton suitable for &lt;code&gt;Module::Build&lt;/code&gt; having converted the &lt;em&gt;Makefile.PL&lt;/em&gt; by &lt;a href=&#34;https://metacpan.org/pod/Module::Build::Convert&#34;&gt;&lt;code&gt;Module::Build::Convert&lt;/code&gt;&lt;/a&gt; into a &lt;em&gt;Build.PL&lt;/em&gt;, the output would be:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt; # This -*-perl-*- program writes the Makefile for installing this distribution.
 #
 # See &amp;quot;perldoc perlmodinstall&amp;quot; or &amp;quot;perldoc ExtUtils::MakeMaker&amp;quot; for
 # info on how to control how the installation goes.
 # Note: this file has been initially generated by Module::Build::Convert 0.24_01

 require 5.004;
 use strict;
 use warnings;

 use Module::Build;

 my $build = Module::Build-&amp;gt;new
   (
    module_name =&amp;gt; &#39;HTML::Tagset&#39;,
    dist_author =&amp;gt; &#39;Andy Lester &amp;lt;andy@petdance.com&amp;gt;&#39;,
    dist_version_from =&amp;gt; &#39;Tagset.pm&#39;,
    add_to_cleanup =&amp;gt; [
                        &#39;HTML-Tagset-*&#39;
                      ],
    license =&amp;gt; &#39;unknown&#39;,
    create_readme =&amp;gt; 1,
    create_makefile_pl =&amp;gt; &#39;traditional&#39;,
   );

 $build-&amp;gt;create_build_script;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;As you can see, while &lt;code&gt;ExtUtils::MakeMaker&lt;/code&gt; prefers uppercased arguments, &lt;code&gt;Module::Build&lt;/code&gt; goes by entirely lowercased arguments, which obey the rule of least surprise by being as intuitive as a description can be.&lt;/p&gt;

&lt;p&gt;The build and installation procedure for a &lt;code&gt;Module::Build&lt;/code&gt; distribution is:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt; % perl Build.PL
 % perl Build
 % perl Build test
 # perl Build install
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;module-build-convert-s-state-of-operation&#34;&gt;&lt;code&gt;Module::Build::Convert&lt;/code&gt;&amp;rsquo;s State of Operation&lt;/h3&gt;

&lt;p&gt;&lt;code&gt;Module::Build::Convert&lt;/code&gt; actually does all of the background work and can be safely considered the back end, whereas &lt;code&gt;make2build&lt;/code&gt; is the practical front-end utility. &lt;code&gt;Module::Build::Convert&lt;/code&gt; currently exposes two kinds of operation: static approach and dynamic execution. The static approach parses the arguments contained within the &lt;em&gt;Makefile.PL&amp;rsquo;s&lt;/em&gt; &lt;code&gt;WriteMakefile()&lt;/code&gt; call, whereas dynamic execution runs the &lt;em&gt;Makefile.PL&lt;/em&gt; and captures the arguments provided to &lt;code&gt;WriteMakefile()&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;&lt;code&gt;Module::Build::Convert&lt;/code&gt; parses statically by default, because the dynamic execution has the downside that code will be interpreted and the interpreted output will be written to the &lt;em&gt;Build.PL&lt;/em&gt;, so you have to conclude that the user of the distribution will end up with predefined values computed on the author&amp;rsquo;s system. This is something to avoid, whenever possible! If the parsing approach fails, perhaps looping endlessly on input, &lt;code&gt;Module::Build::Convert&lt;/code&gt; will reinitialize to perform dynamic execution of the &lt;em&gt;Makefile.PL&lt;/em&gt; instead.&lt;/p&gt;

&lt;h3 id=&#34;span-id-data-section-data-section-span&#34;&gt;&lt;span id=&#34;data_section&#34;&gt;Data Section&lt;/span&gt;&lt;/h3&gt;

&lt;p&gt;&lt;code&gt;Module::Build::Convert&lt;/code&gt; comes with a rather huge data section containing the argument conversion table, default arguments, sorting order, and begin and end code. If you wish to change this data, consider making a &lt;em&gt;~/.make2buildrc&lt;/em&gt; file by launching &lt;code&gt;make2build&lt;/code&gt; with the &lt;code&gt;-rc&lt;/code&gt; switch. &lt;em&gt;Do not&lt;/em&gt; edit the &lt;code&gt;Data&lt;/code&gt; section within &lt;code&gt;Module::Build::Convert&lt;/code&gt; directly, unless you are sure you want to submit a patch.&lt;/p&gt;

&lt;h4 id=&#34;argument-conversion&#34;&gt;Argument Conversion&lt;/h4&gt;

&lt;p&gt;On the left-hand side is the &lt;code&gt;MakeMaker&lt;/code&gt;&amp;rsquo;s argument name, and on the right-hand side the &lt;code&gt;Module::Build&lt;/code&gt;&amp;rsquo;s equivalent.&lt;/p&gt;

&lt;pre&gt;&lt;code&gt; NAME                  module_name
 DISTNAME              dist_name
 ABSTRACT              dist_abstract
 AUTHOR                dist_author
 VERSION               dist_version
 VERSION_FROM          dist_version_from
 PREREQ_PM             requires
 PL_FILES              PL_files
 PM                    pm_files
 MAN1PODS              pod_files
 XS                    xs_files
 INC                   include_dirs
 INSTALLDIRS           installdirs
 DESTDIR               destdir
 CCFLAGS               extra_compiler_flags
 EXTRA_META            meta_add
 SIGN                  sign
 LICENSE               license
 clean.FILES           @add_to_cleanup
&lt;/code&gt;&lt;/pre&gt;

&lt;h4 id=&#34;default-arguments&#34;&gt;Default Arguments&lt;/h4&gt;

&lt;p&gt;These are default &lt;code&gt;Module::Build&lt;/code&gt; arguments to added. Arguments with a leading &lt;code&gt;#&lt;/code&gt; are ignored.&lt;/p&gt;

&lt;pre&gt;&lt;code&gt; #build_requires       HASH
 #recommends           HASH
 #conflicts            HASH
 license               unknown
 create_readme         1
 create_makefile_pl    traditional
&lt;/code&gt;&lt;/pre&gt;

&lt;h4 id=&#34;sorting-order&#34;&gt;Sorting Order&lt;/h4&gt;

&lt;p&gt;This is the sorting order for &lt;code&gt;Module::Build&lt;/code&gt; arguments.&lt;/p&gt;

&lt;pre&gt;&lt;code&gt; module_name
 dist_name
 dist_abstract
 dist_author
 dist_version
 dist_version_from
 requires
 build_requires
 recommends
 conflicts
 PL_files
 pm_files
 pod_files
 xs_files
 include_dirs
 installdirs
 destdir
 add_to_cleanup
 extra_compiler_flags
 meta_add
 sign
 license
 create_readme
 create_makefile_pl
&lt;/code&gt;&lt;/pre&gt;

&lt;h4 id=&#34;begin-code&#34;&gt;Begin Code&lt;/h4&gt;

&lt;p&gt;Code that precedes converted &lt;code&gt;Module::Build&lt;/code&gt; arguments. &lt;code&gt;$(UPPERCASE)&lt;/code&gt; are stubs being substituted by &lt;code&gt;Module::Build&lt;/code&gt; code.&lt;/p&gt;

&lt;pre&gt;&lt;code&gt; use strict;
 use warnings;

 use Module::Build;

 $MAKECODE

 my $b = Module::Build-&amp;gt;new
 $INDENT(
&lt;/code&gt;&lt;/pre&gt;

&lt;h4 id=&#34;end-code&#34;&gt;End Code&lt;/h4&gt;

&lt;p&gt;Code that follows converted &lt;code&gt;Module::Build&lt;/code&gt; arguments. &lt;code&gt;$(UPPERCASE)&lt;/code&gt; are stubs being substituted by &lt;code&gt;Module::Build&lt;/code&gt; code.&lt;/p&gt;

&lt;pre&gt;&lt;code&gt; $INDENT);

 $b-&amp;gt;create_build_script;

 $MAKECODE
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;make2build-basic-usage&#34;&gt;&lt;code&gt;make2build&lt;/code&gt; Basic Usage&lt;/h3&gt;

&lt;p&gt;Using &lt;code&gt;make2build&lt;/code&gt; is as easy as launching it in the directory of the distribution of which &lt;em&gt;Makefile.PL&lt;/em&gt; you wish to convert.&lt;/p&gt;

&lt;p&gt;For example:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;% make2build
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;You may also provide the full path to the distribution, assuming, for example, you didn&amp;rsquo;t &lt;code&gt;cd&lt;/code&gt; directly into the distribution directory.&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;% make2build /path/to/HTML-Tagset*
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;In both cases, the command will convert any found &lt;em&gt;Makefile.PL&lt;/em&gt; files and will generate no output because &lt;code&gt;make2build&lt;/code&gt; acts quiet by default.&lt;/p&gt;

&lt;h3 id=&#34;make2build-switches&#34;&gt;&lt;code&gt;make2build&lt;/code&gt; Switches&lt;/h3&gt;

&lt;p&gt;As &lt;code&gt;make2build&lt;/code&gt; aims to be a proper script, it of course, provides both the &lt;code&gt;-h&lt;/code&gt; (help screen) and &lt;code&gt;-V&lt;/code&gt; (version) switches.&lt;/p&gt;

&lt;pre&gt;&lt;code&gt; % make2build -h
 % make2build -V
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;In case you end up with a mangled &lt;em&gt;Build.PL&lt;/em&gt; written, you can examine the parsing process by launching &lt;code&gt;make2build&lt;/code&gt; with the &lt;code&gt;-d&lt;/code&gt; switch, enabling the pseudo-interactive debugging mode.&lt;/p&gt;

&lt;pre&gt;&lt;code&gt; % make2build -d
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Should you not like the indentation length or judge it to be too small, increase it via the &lt;code&gt;-l&lt;/code&gt; switch followed by an integer.&lt;/p&gt;

&lt;pre&gt;&lt;code&gt; % make2build -l length
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;If you don&amp;rsquo;t agree with the sorting order predefined in &lt;code&gt;Module::Build::Convert&lt;/code&gt;, you may enforce the native sorting order, which strives to arrange standard arguments with those seen available in the &lt;code&gt;Makefile.PL&lt;/code&gt;.&lt;/p&gt;

&lt;pre&gt;&lt;code&gt; % make2build -n
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;The argument conversion table, default arguments to add, the sorting order of the arguments, and the begin and end code aren&amp;rsquo;t absolute, either. Change them by invoking &lt;code&gt;make2build&lt;/code&gt; with the &lt;code&gt;-rc&lt;/code&gt; switch to create a resource configuration file in the home directory of the current user; that is likely &lt;em&gt;~/.make2build.rc&lt;/em&gt;.&lt;/p&gt;

&lt;pre&gt;&lt;code&gt; % make2build -rc
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;While &lt;code&gt;make2build&lt;/code&gt; is quiet by default, there are two verbosity levels. To enforce verbosity level 1, launch &lt;code&gt;make2build&lt;/code&gt; with &lt;code&gt;-v&lt;/code&gt;. To enforce verbosity level 2, use &lt;code&gt;-vv&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;With &lt;code&gt;-v&lt;/code&gt;, the code will warn about &lt;em&gt;Makefile.PL&lt;/em&gt; options it does not understand or skips. With &lt;code&gt;-vv&lt;/code&gt;, it will accumulate &lt;code&gt;-v&lt;/code&gt; output and the entire generated &lt;em&gt;Build.PL&lt;/em&gt;.&lt;/p&gt;

&lt;pre&gt;&lt;code&gt; % make2build -v
 % make2build -vv
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;You may execute the &lt;em&gt;Makefile.PL&lt;/em&gt; in first place, but such usage is deprecated because &lt;code&gt;Module::Build::Convert&lt;/code&gt; downgrades automatically when needed.&lt;/p&gt;

&lt;pre&gt;&lt;code&gt; % make2build -x (deprecated)
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;swinging-with-perl&#34;&gt;Swinging with Perl&lt;/h3&gt;

&lt;p&gt;Phil Crow&lt;/p&gt;

&lt;p&gt;Perl does not have a native graphical user interface (GUI) toolkit. So we use all manner of existing GUI tools in front of our Perl applications. Often we use a web browser. We have long had Perl/Tk and other libraries based on C/C++. Now we can also use Java&amp;rsquo;s Swing toolkit with similar ease.&lt;/p&gt;

&lt;p&gt;In my sample application, when the user presses a button, Perl evaluates an arithmetic expression from the input text box. The result appears in another text box. I&amp;rsquo;ll show the code for this application a piece at a time with a discussion after each piece. To see the whole thing, look in the examples directory of the &lt;a href=&#34;https://metacpan.org/pod/Java::Swing&#34;&gt;&lt;code&gt;Java::Swing&lt;/code&gt;&lt;/a&gt; distribution.&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;    #!/usr/bin/perl
    use strict; use warnings;

    BEGIN {
        $ENV{CLASSPATH} .= &#39;:/path/to/Java/Swing/java&#39;
    }
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;code&gt;Java::Swing&lt;/code&gt; needs certain Java classes to be in the class path before it loads, so I&amp;rsquo;ve appended a path to those classes in a &lt;code&gt;BEGIN&lt;/code&gt; block (this block must come before using &lt;code&gt;Java::Swing&lt;/code&gt;).&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;    use Java::Swing;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;This innocuous statement magically sets up namespaces for each Java Swing component, among other things.&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;    my $expression  = JTextField-&amp;gt;new();
    my $answer      = JTextField-&amp;gt;new( { columns =&amp;gt; 10 } );
    my $submit      = JButton   -&amp;gt;new(&amp;quot;Evaluate&amp;quot;);
    my $frame       = JFrame    -&amp;gt;new();
    my $root_pane   = $frame-&amp;gt;getContentPane();
    my $south_panel = JPanel-&amp;gt;new();
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;After using &lt;code&gt;Java::Swing&lt;/code&gt;, you can refer to Swing components as Perl classes. You can even pass named parameters to their constructors, as shown for the second &lt;code&gt;JTextField&lt;/code&gt;.&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;    $south_panel-&amp;gt;add(JLabel-&amp;gt;new(&amp;quot;Answer:&amp;quot;), &amp;quot;West&amp;quot;);
    $south_panel-&amp;gt;add($answer,                &amp;quot;Center&amp;quot;);
    $south_panel-&amp;gt;add($submit,                &amp;quot;East&amp;quot;);

    $root_pane-&amp;gt;add($expression,  &amp;quot;North&amp;quot;);
    $root_pane-&amp;gt;add($south_panel, &amp;quot;South&amp;quot;);

    $frame-&amp;gt;setSize(300, 100);
    $frame-&amp;gt;show();
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Most work with the components is the same as in any Java program. If you don&amp;rsquo;t understand the above code, consult a good book on Swing (like the one from O&amp;rsquo;Reilly).&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;    my $swinger = Java::Swing-&amp;gt;new();
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;This creates a &lt;code&gt;Java::Swing&lt;/code&gt; instance to connect event listeners and to control the event loop.&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;    $swinger-&amp;gt;connect(
        &amp;quot;ActionListener&amp;quot;, $submit, { actionPerformed =&amp;gt; \&amp;amp;evaluate }
    );

    $swinger-&amp;gt;connect(
        &amp;quot;WindowListener&amp;quot;, $frame, { windowClosing =&amp;gt; \&amp;amp;ending }
    );
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Connection is simple. Pass the listener type, the object to listen to, and a hash of code references to call back as events arrive.&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;    $swinger-&amp;gt;start();
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Start the event loop. After this, the program passively waits for event callbacks. It stops when one of the callbacks stops the event loop.&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;    sub evaluate {
        my $sender_name = shift;
        my $event       = shift;

        $answer-&amp;gt;setText(eval $expression-&amp;gt;getText());
    }
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;My evaluation is simple. I retrieve the text from the expression &lt;code&gt;JTextField&lt;/code&gt;, &lt;code&gt;eval&lt;/code&gt; it, and pass the result to &lt;code&gt;setText&lt;/code&gt; on the answer &lt;code&gt;JTextField&lt;/code&gt;. Using &lt;code&gt;eval&lt;/code&gt; raises possible security concerns, so use it wisely.&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;    sub ending {
        $swinger-&amp;gt;stop();
    }
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;When the user closes the window, I stop the event loop by calling &lt;code&gt;stop&lt;/code&gt; on the &lt;code&gt;Java::Swing&lt;/code&gt; instance gained earlier. This kills the program.&lt;/p&gt;

&lt;p&gt;With &lt;code&gt;Java::Swing&lt;/code&gt;, you can build Swing apps in Perl with some important bits of syntactic sugar. First, you don&amp;rsquo;t need to have separate Java files or inline sections. Second, you can pass named arguments to constructors. Finally, you can easily connect event listeners to Perl callback code.&lt;/p&gt;

&lt;h3 id=&#34;scriptify-your-module&#34;&gt;Scriptify Your Module&lt;/h3&gt;

&lt;p&gt;Josh McAdams&lt;/p&gt;

&lt;p&gt;Recently during an MJD talk at Chicago.pm, I saw a little Perl trick that was so amazingly simple and yet so useful that it was hard to believe that more mongers in the crowd hadn&amp;rsquo;t heard of it. The trick involved taking your module and adding a driver routine to it so the module could run as a script.&lt;/p&gt;

&lt;p&gt;To illustrate, start with an example module that contains two utility subroutines that convert weights between pounds and kilograms. The subroutines accept some number and multiplies it by a conversion factor.&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;  package WeightConverter;

  use strict;
  use warnings;
  use constant LB_PER_KG =&amp;gt; 2.20462262;
  use constant KG_PER_LB =&amp;gt; 1/LB_PER_KG;

  sub kilograms_to_pounds { $_[0] * LB_PER_KG; }

  sub pounds_to_kilograms { $_[0] * KG_PER_LB; }
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Assuming that the real module has a little error checking and POD, this module would serve you just fine. However, what if you decided that we needed to be able to easily do weight conversions from the command line? One option would be to write a Perl script that used &lt;code&gt;WeightConverter&lt;/code&gt;. If that seems like too much effort, there is a one-liner that would do conversions.&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;  perl -MWeightConverter -e &#39;print WeightConverter::kilograms_to_pounds(1),&amp;quot;\n&amp;quot;&#39;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;This would do the trick, but it is a lot to remember and isn&amp;rsquo;t very fun to type. There is a lot of benefit available from saving some form of script, and believe it or not, the module can hold that script. All that you have to do is write some driver subroutine and then call that subroutine if the module is not being used by another script. Here is an example driver for &lt;code&gt;WeightConverter&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;This example driver script just loops through the command-line arguments and tries to find instances where the argument contains either a &lt;code&gt;k&lt;/code&gt; or &lt;code&gt;p&lt;/code&gt; equal to some value. Based on whether or not you are starting with pounds or kilograms, it calls the appropriate subroutine and prints the results.&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;  sub run {
    for (@ARGV) {
      if(/^[-]{0,2}(k|p)\w*=(.+)$/) {
        $1 eq &#39;k&#39; ?
          print &amp;quot;$2 kilograms is &amp;quot;, kilograms_to_pounds($2), &amp;quot; pounds\n&amp;quot; :
          print &amp;quot;$2 pounds is &amp;quot;, pounds_to_kilograms($2), &amp;quot; kilograms\n&amp;quot; ;
      }
    }
  }
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Now all that is left is to tell the module to run the &lt;code&gt;run&lt;/code&gt; subroutine if someone has run the module on its own. This is as easy as adding one line somewhere in the main body of the module.&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;  run unless caller;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;All this statement does is execute the &lt;code&gt;run&lt;/code&gt; subroutine unless the &lt;code&gt;caller&lt;/code&gt; function returns a value. &lt;code&gt;caller&lt;/code&gt; will only return true if &lt;code&gt;WeightConverter&lt;/code&gt; is being used in another script. Now, this module is usable in other scripts as well as on the command line.&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;  $&amp;gt; perl WeightConverter.pm -kilos=2 -pounds=145 -k=.345
  2 kilograms is 4.40924524 pounds
  145 pounds is 65.7708937051548 kilograms
  .345 kilograms is 0.7605948039 pounds
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;mocks-in-your-test-fixtures&#34;&gt;Mocks in Your Test Fixtures&lt;/h3&gt;

&lt;p&gt;by chromatic&lt;/p&gt;

&lt;p&gt;Since writing &lt;code&gt;Test::MockObject&lt;/code&gt;, I&amp;rsquo;ve used it in nearly every complex test file I&amp;rsquo;ve written. It makes my life much easier to be able to control only what I need for the current group of tests.&lt;/p&gt;

&lt;p&gt;I wish I&amp;rsquo;d written &lt;code&gt;Test::MockObject::Extends&lt;/code&gt; earlier than I did; that module allows you to decorate an existing object with a mockable wrapper. It works just as the wrapped object does, but if you add any mocked methods, it will work like a regular mock object.&lt;/p&gt;

&lt;p&gt;This is very useful when you don&amp;rsquo;t want to go through all of the overhead of setting up your own mock object but do want to override one or two methods. (It&amp;rsquo;s almost always the right thing to do instead of using &lt;code&gt;Test::MockObject.&lt;/code&gt;.)&lt;/p&gt;

&lt;p&gt;Another very useful test module is &lt;code&gt;Test::Class&lt;/code&gt;. It takes more work to understand and to use than &lt;code&gt;Test::More&lt;/code&gt;, but it pays back that investment by allowing you to group, reuse, and organize tests in the same way you would group, reuse, and organize objects in your code. Instead of writing your tests procedurally, from the start to the end of a test file, you organize them into classes.&lt;/p&gt;

&lt;p&gt;This is most useful when you&amp;rsquo;ve organized your code along similar lines. If you have a base class with a lot of behavior and a handful of subclasses that add and override a little bit of behavior, write a &lt;code&gt;Test::Class&lt;/code&gt;-based test for the base class and smaller tests that inherit from the base test for the subclasses.&lt;/p&gt;

&lt;p&gt;Goodbye, duplicate code.&lt;/p&gt;

&lt;h4 id=&#34;fixtures&#34;&gt;Fixtures&lt;/h4&gt;

&lt;p&gt;&lt;code&gt;Test::Class&lt;/code&gt; encourages you to group related tests into test methods. This allows you to override and extend those groups of tests in test subclasses. (Good OO design principles apply here; tests are still just code, after all.) One of the benefits of grouping tests in this way is that you can use test fixtures.&lt;/p&gt;

&lt;p&gt;A test fixture is another method that runs before every test method. You can use them to set up the test environment&amp;ndash;creating a new object to test, resetting test data, and generally making sure that tests don&amp;rsquo;t interfere with each other.&lt;/p&gt;

&lt;p&gt;A standard test fixture might resemble:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;  sub make_fixture :Test( setup )
  {
      my $self        = shift;
      $self-&amp;gt;{object} = $self-&amp;gt;test_class()-&amp;gt;new();
  }
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Assuming that there&amp;rsquo;s a &lt;code&gt;test_class()&lt;/code&gt; method that returns the name of the class being tested, this fixture creates a new instance before every test method and stores it as the &lt;code&gt;object&lt;/code&gt; attribute. The test methods can then fetch this as normal.&lt;/p&gt;

&lt;h4 id=&#34;putting-them-together&#34;&gt;Putting Them Together&lt;/h4&gt;

&lt;p&gt;I recently built some tests for a large system using &lt;code&gt;Test::Class&lt;/code&gt;. Some of the tests had mockable features&amp;ndash;they dealt with file or database errors, for example. I found myself creating a lot of little &lt;code&gt;Test::MockObject::Extends&lt;/code&gt; instances within most of the tests.&lt;/p&gt;

&lt;p&gt;Then inspiration struck. Duplication is bad. Repetition is bad. Factor it out into one place.&lt;/p&gt;

&lt;p&gt;The insight was quick and sudden. If &lt;code&gt;Test::MockObject::Extends&lt;/code&gt; is transparent (and if it isn&amp;rsquo;t, please file a bug&amp;ndash;I&amp;rsquo;ll fix it), I can use it in the test fixture all the time and then be able to mock whenever I want without doing any setup. I changed my fixture to:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;  sub make_fixture :Test( setup )
  {
      my $self        = shift;
          my $object      = $self-&amp;gt;test_class()-&amp;gt;new();
      $self-&amp;gt;{object} = Test::MockObject::Extends-&amp;gt;new( $object );
  }
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;The rest of my code remained unchanged, except that now I could delete several identical lines from several test methods.&lt;/p&gt;

&lt;p&gt;Do note that, for this to work, you must adhere to good OO design principles in the code being tested. Don&amp;rsquo;t assume that &lt;code&gt;ref&lt;/code&gt; is always what you think it should be (and use the &lt;code&gt;isa()&lt;/code&gt; method instead).&lt;/p&gt;

&lt;p&gt;Sure, this is a one-line trick, but it removed a lot of busy work from my life and it illustrates two interesting techniques for managing tests. If you need simpler, more precise mocks, use &lt;code&gt;Test::MockObject::Extends&lt;/code&gt;. If you need better organization and less duplication in your test files, use &lt;code&gt;Test::Class&lt;/code&gt;. Like all good test modules, they work together almost flawlessly.&lt;/p&gt;
</description>
    </item>
    
  </channel>
</rss>

