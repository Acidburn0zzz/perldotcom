<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Perl Server on Perl.com - programming news, code and culture</title>
    <link>http://localhost:1313/tags/perl-server/</link>
    <description>Recent content in Perl Server on Perl.com - programming news, code and culture</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-us</language>
    <lastBuildDate>Thu, 18 Nov 2004 00:00:00 -0800</lastBuildDate>
    <atom:link href="/tags/perl-server/" rel="self" type="application/rss+xml" />
    
    <item>
      <title>Cross-Language Remoting with mod_perlservice</title>
      <link>http://localhost:1313/pub/2004/11/18/mod_perlservice.html/</link>
      <pubDate>Thu, 18 Nov 2004 00:00:00 -0800</pubDate>
      
      <guid>http://localhost:1313/pub/2004/11/18/mod_perlservice.html/</guid>
      <description>

&lt;h3 id=&#34;mod-perlservice-what-is-that&#34;&gt;Mod_perlservice? What is That?&lt;/h3&gt;

&lt;p&gt;&lt;code&gt;Mod_perlservice&lt;/code&gt; is a cool, new way to do remoting &amp;ndash; sharing data between server and client processes &amp;ndash; with Perl and Apache. Let&amp;rsquo;s start by breaking that crazy name apart: mod + perl + service.&lt;/p&gt;

&lt;p&gt;&lt;em&gt;Mod&lt;/em&gt; means that it&amp;rsquo;s a module for the popular and ubiquitous Apache HTTP Server. &lt;em&gt;Perl&lt;/em&gt; represents the popular and ubiquitous programming language. &lt;em&gt;Service&lt;/em&gt; is the unique part. It&amp;rsquo;s the new ingredient that unifies Apache, Perl, and XML into an easy-to-use web services system.&lt;/p&gt;

&lt;p&gt;With mod_perlservice, you can write Perl subs and packages on your server and call them over the internet from client code. Clients can pass scalars, arrays, and hashes to the server-side subroutines and obtain the return value (scalar, array, or hash) back from the remote code. Some folks refer to this functionality as &amp;ldquo;remoting&amp;rdquo; or &amp;ldquo;RPC,&amp;rdquo; so if you like you can say mod_perlservice is remoting with Perl and Apache. You can write client programs in a variety of languages; libraries for C, Perl, and Flash Action Script are all ready to go.&lt;/p&gt;

&lt;p&gt;Now that you know what mod_perlservice is, let&amp;rsquo;s look at why it is. I believe that mod_perlservice has a very clean, easy-to-use interface when compared with other RPC systems. Also, because it builds on the Apache platform it benefits from Apache&amp;rsquo;s ubiquity, security, and status as a standard. Mod_perlservice sports an embedded Perl interpreter to offer high performance for demanding applications.&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;http://localhost:1313/images/_pub_2004_11_18_mod_perlservice/mod_perlservicelogo.jpg&#34; alt=&#34;mod_perlservice&#34; width=&#34;200&#34; height=&#34;120&#34; /&gt;&lt;/p&gt;

&lt;h3 id=&#34;how-can-i-use-mod-perlservice&#34;&gt;How Can I Use mod_perlservice?&lt;/h3&gt;

&lt;p&gt;Mod_perlservice helps create networked applications that require client-server communication, information processing, and sharing. Mod_perlservice is for applications, not for creating dynamic content for your HTML pages. However, you surely can use it for Flash remoting with Perl. Here are some usage examples:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;A desktop application (written using your favorite C++ GUI library) that records the current local air temperature and sends it to an online database every 10 minutes. Any client can query the server to obtain the current and historical local air temperature of any other participating client.&lt;/li&gt;
&lt;li&gt;A Flash-based stock portfolio management system. You can create model stock portfolios and retrieve real-time stock quote information and news.&lt;/li&gt;
&lt;li&gt;A command-line utility in Perl that accepts English sentences on standard input and outputs the sentences in French. Translation occurs in server-side Perl code. If the sentence is idiomatic and the translation is incorrect, the user has the option of sending the server a correct translation to store in an online idiom database.&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;how-do-i-start&#34;&gt;How Do I Start?&lt;/h3&gt;

&lt;p&gt;Let&amp;rsquo;s move on to the fun stuff and set up a working installation. Before we begin, make sure you have everything you need! You need &lt;a href=&#34;http://httpd.apache.org/&#34;&gt;Apache HTTPD&lt;/a&gt;, &lt;a href=&#34;http://www.perl.org/&#34;&gt;Perl&lt;/a&gt;, &lt;a href=&#34;https://libexpat.github.io/&#34;&gt;Expat&lt;/a&gt;, &lt;a href=&#34;http://www.ivorycity.com/mod_perlservice/&#34;&gt;mod_perlservice&lt;/a&gt;, and a mod_perlservice client library (&lt;a href=&#34;http://www.ivorycity.com/mod_perlservice/perl_client.html&#34;&gt;Perl Client&lt;/a&gt; | &lt;a href=&#34;http://www.ivorycity.com/mod_perlservice/c_client.html&#34;&gt;C Client&lt;/a&gt; | &lt;a href=&#34;http://www.ivorycity.com/mod_perlservice/flash_client.html&#34;&gt;Flash Client&lt;/a&gt;). You must download a client library separately, as the distribution does not include any clients! In your build directory:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;myhost$ tar -xvzf mod_perlservice.tar.gz
myhost$ cd mod_perlservice
myhost$ ./configure
myhost$ make
myhost$ make install
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;If everything goes to plan, you&amp;rsquo;ll end up with a fresh &lt;em&gt;mod_perlservice.so&lt;/em&gt; in your Apache modules directory, (usually &lt;em&gt;/etc/apache/modules&lt;/em&gt;). Now it&amp;rsquo;s time to configure Apache to use mod_perlservice. &lt;code&gt;cd&lt;/code&gt; into your Apache configuration directory (usually &lt;em&gt;/etc/apache/conf&lt;/em&gt;) Add the following lines to the file &lt;em&gt;apache.conf&lt;/em&gt; (or &lt;em&gt;httpd.conf&lt;/em&gt;, if you have only a single configuration file):&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;LoadModule perlservice_module modules/mod_perlservice.so
AddModule mod_perlservice.c
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Add the following lines to &lt;em&gt;commonapache.conf&lt;/em&gt;, if you have it and &lt;em&gt;httpd.conf&lt;/em&gt; if you don&amp;rsquo;t:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;lt;IfModule mod_perlservice.c&amp;gt;
&amp;lt;Location /perlservice&amp;gt;   SetHandler
mod_perlservice
   Allow From All PerlApp
   myappname /my/app/dir
   #Examples
   PerlApp stockmarket /home/services/stockmarket
   PerlApp temperature /home/services/temperature
&amp;lt;/Location&amp;gt;
&amp;lt;/IfModule&amp;gt;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;em&gt;Pay close attention to the &lt;code&gt;PerlApp&lt;/code&gt; directive.&lt;/em&gt; For every mod_perlservice application you want to run, you need a &lt;code&gt;PerlApp&lt;/code&gt; directive. If I were creating a stock market application, I might create a directory: &lt;em&gt;/home/services/stockmarket&lt;/em&gt; and add the following &lt;code&gt;PerlApp&lt;/code&gt; directive:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;PerlApp stockmarket /home/services/stockmarket
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;This tells mod_perlservice to host an application called &lt;code&gt;stockmarket&lt;/code&gt; with the Perl code files located in the &lt;em&gt;/home/services/stockmarket&lt;/em&gt; directory. You may run as many service applications as you wish and you may organize them however you wish.&lt;/p&gt;

&lt;p&gt;With the configuration files updated, the next step is to restart Apache:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;myhost$ /etc/init.d/apache restart
or
myhost$ apachectl restart
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Now if everything went as planned, mod_perlservice should be installed. Congratulations!&lt;/p&gt;

&lt;h3 id=&#34;an-example&#34;&gt;An Example&lt;/h3&gt;

&lt;p&gt;Let&amp;rsquo;s create that stock portfolio example mentioned earlier. It won&amp;rsquo;t support real-time quotes, but will instead create a static database of common stock names and historical prices. The application will support stock information for General Electric (GE), Red Hat (RHAT), Coca-Cola (KO), and Caterpillar (CAT).&lt;/p&gt;

&lt;p&gt;The application will be &lt;em&gt;stockmarket&lt;/em&gt; and will keep all of the Perl files in the stock market application directory (&lt;em&gt;/home/services/stockmarket&lt;/em&gt;). The first file will be &lt;em&gt;quotes.pm&lt;/em&gt;, reading as follows:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;our $lookups = {
    &amp;quot;General Electric&amp;quot; =&amp;gt; &amp;quot;GE&amp;quot;,
    &amp;quot;Red Hat&amp;quot;          =&amp;gt; &amp;quot;RHAT&amp;quot;,
    &amp;quot;Coca Cola&amp;quot;        =&amp;gt; &amp;quot;KO&amp;quot;,
    &amp;quot;Caterpillar Inc&amp;quot;  =&amp;gt; &amp;quot;CAT&amp;quot;
};
our $stocksymbols = {
    &amp;quot;GE&amp;quot; =&amp;gt; {
        &amp;quot;Price&amp;quot;            =&amp;gt; 33.91,
        &amp;quot;EarningsPerShare&amp;quot; =&amp;gt; 1.544
    },
    &amp;quot;RHAT&amp;quot; =&amp;gt; {
        &amp;quot;Price&amp;quot; =&amp;gt; 14.96,
        &amp;quot;EarningsPerShare&amp;quot; =&amp;gt; 0.129
    },
    &amp;quot;KO&amp;quot;   =&amp;gt; {
        &amp;quot;Price&amp;quot;            =&amp;gt; 42.84,
        &amp;quot;EarningsPerShare&amp;quot; =&amp;gt; 1.984
    },
    &amp;quot;CAT&amp;quot; =&amp;gt; {
        &amp;quot;Price&amp;quot;            =&amp;gt; 75.74,
        &amp;quot;EarningsPerShare&amp;quot; =&amp;gt; 4.306
    }
};

package quotes;

sub lookupSymbol {
    my $companyname = shift;
    return $lookups-&amp;gt;{$company_name};
}

sub getLookupTable {
    return $lookups;
}

sub getStockPrice {
    my $stocksymbol = shift;
    return $stocksymbols-&amp;gt;{$stocksymbol}-&amp;gt;{&amp;quot;Price&amp;quot;};
}
sub getAllStockInfo {
    my $stocksymbol = shift;
    return $stocksymbols{$stocksymbol};
}
1;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;That&amp;rsquo;s the example of the server-side program. Basically, two static &amp;ldquo;databases&amp;rdquo; (&lt;code&gt;$lookups&lt;/code&gt; and &lt;code&gt;$stocksymbols&lt;/code&gt;) provide information about a limited universe of stocks. The above methods query the static databases; the behavior should be fairly self-explanatory.&lt;/p&gt;

&lt;p&gt;You may have as many &lt;em&gt;.pm&lt;/em&gt; files in your application as you wish and you may also define as many packages within a &lt;em&gt;.pm&lt;/em&gt; file as you wish. An extension to this application might be a file called &lt;em&gt;news.pm&lt;/em&gt; that enables you to fetch current and historical news about your favorite stocks.&lt;/p&gt;

&lt;p&gt;Now let&amp;rsquo;s talk some security. As it stands, this code won&amp;rsquo;t work; mod_perlservice will restrict access to any file and method you don&amp;rsquo;t explicitly export for public use. Use the &lt;em&gt;.serviceaccess&lt;/em&gt; file to export things. Create this file in each application directory you declare with mod_perlservice or you&amp;rsquo;ll have no access. An example file might read:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;lt;ServiceAccess&amp;gt;
  &amp;lt;AllowFile name=&amp;quot;quotes.pm&amp;quot;&amp;gt;
    Allow quotes::*
  &amp;lt;/AllowFile&amp;gt;
&amp;lt;/ServiceAccess&amp;gt;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;In the stock market example, this file should be &lt;em&gt;/home/services/stockmarket/.serviceaccess&lt;/em&gt;. Be sure that the &lt;code&gt;apache&lt;/code&gt; user does not own this file; that could be bad for security. This file allows access to the file &lt;em&gt;quotes.pm&lt;/em&gt; and allows public access to all (&lt;code&gt;*&lt;/code&gt;) the methods in package &lt;em&gt;quotes&lt;/em&gt;.&lt;/p&gt;

&lt;p&gt;If I want to restrict access only to &lt;code&gt;getStockPrice&lt;/code&gt;, I would have written &lt;code&gt;Allow quotes::getStockPrice&lt;/code&gt;. After that, I could add access to &lt;code&gt;lookupSymbol&lt;/code&gt; with &lt;code&gt;Allow quotes::lookupSymbol&lt;/code&gt;. To make &lt;em&gt;quotes.pm&lt;/em&gt; public carte blanche, use &lt;em&gt;Allow *&lt;/em&gt;. You won&amp;rsquo;t need to restart Apache when you make changes to this file as it reloads automatically.&lt;/p&gt;

&lt;h3 id=&#34;client-code&#34;&gt;Client Code&lt;/h3&gt;

&lt;p&gt;Well, so far I&amp;rsquo;ve only shown you half the story. It&amp;rsquo;s time to create some client-side code. This client example uses the Flash &amp;ldquo;PerlService&amp;rdquo; library, just one of the client-side interfaces to mod_perlservice. The Flash client works well for browser interfaces while the Perl and C clients can create command-line or GUI (ie, GTK or Qt) applications. This article is on the web, so we&amp;rsquo;ll give the Flash interface a spin and then go through an example in Perl.&lt;/p&gt;

&lt;p&gt;The first code smidgen should go in the first root frame of your Flash application. It instantiates the global &lt;code&gt;PerlService&lt;/code&gt; object and creates event handlers for when remote method calls return from the server. The event handlers output the requested stock information to the display box.&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;#include &amp;quot;PerlService-0.0.2.as&amp;quot;
// Create a global PerlService object
// Tell the PerlService object about the remote code we want to use:
// arg1) host: www.ivorycity.com
// arg2) application: stockmarket
// arg3) file: quotes.pm
// arg4) package: quotes
_global.ps = new PerlService(&amp;quot;www.ivorycity.com&amp;quot;,&amp;quot;stockmarket&amp;quot;,&amp;quot;quotes.pm&amp;quot;,&amp;quot;quotes&amp;quot;);
// First declare three callback functions to handle return values
function onStockPrice(val) {
    output.text = &amp;quot;StockPrice: &amp;quot; + symbolInput.text + &amp;quot; &amp;quot; + val + &amp;quot;\n&amp;quot; + output.text;
}

function onAllStockInfo(val) {
    output.text = &amp;quot;Stock Info: &amp;quot; + allInfoInput.text + &amp;quot;\n&amp;quot; + &amp;quot;\tPrice: &amp;quot;
                  + val.Price + &amp;quot;\n&amp;quot; + &amp;quot;\tEarnings Per Share: &amp;quot;
                  + val.EarningsPerShare + &amp;quot;\n&amp;quot; + output.text;
}

function onLookupSymbol(val) {
    output.text = &amp;quot;Lookup Result: &amp;quot; + symbolInput.text + &amp;quot; &amp;quot; + val + &amp;quot;\n&amp;quot;
                  + output.text;
}

// Register callback handlers for managing return values from remote  methods
// ie, onStockPrice receives the return value from remote method getStockPrice

ps.registerReplyHandler( &amp;quot;getStockPrice&amp;quot;, onStockPrice );
ps.registerReplyHandler( &amp;quot;getAllStockInfo&amp;quot;, onAllStockInfo );
ps.registerReplyHandler( &amp;quot;lookupSymbol&amp;quot;, onLookupSymbol );
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Now for the code that makes things happen. The following code attaches to three separate buttons. When clicked, the buttons call the remote Perl methods using the global &lt;code&gt;PerlService&lt;/code&gt; object. Flash Action Script is an event-driven system, so click event-handlers will call the remote code and return event-handlers will do something with those values.&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;http://localhost:1313/images/_pub_2004_11_18_mod_perlservice/flashclientdgm.jpg&#34; alt=&#34;buttons and code associations&#34; width=&#34;400&#34; height=&#34;206&#34; /&gt;
&lt;em&gt;Figure 1. Button and code associations.&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;When a user presses Button 1, call the remote method &lt;code&gt;getStockPrice&lt;/code&gt; and pass the text in the first input box as an argument.&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;on (release) {
    ps.getStockPrice(box1.text);
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;When the user presses Button 2, call the remote method &lt;code&gt;getAllStockInfo&lt;/code&gt; and pass the text in the second input box as an argument.&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;on (release) {
    ps.getAllStockInfo(box2.text);
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;When the user presses Button 3, call the remote method &lt;code&gt;lookupSymbol&lt;/code&gt; and pass the text in the third input box as an argument.&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;on (release) {
    ps.lookupSymbol(box3.text);
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;That&amp;rsquo;s the entire Flash example. Here is the finished product.&lt;/p&gt;

&lt;h4 id=&#34;perl-client&#34;&gt;Perl Client&lt;/h4&gt;

&lt;p&gt;Not everyone uses Flash, especially in the Free Software community. The great thing about mod_perlservice is that everyone can join the party. Here&amp;rsquo;s a Perl Client that uses the same server-side stock market API.&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;use PService;

my $hostname = &amp;quot;www.ivorycity.com&amp;quot;;
my $appname  = &amp;quot;stockmarket&amp;quot;;
my $filename = &amp;quot;quotes.pm&amp;quot;;
my $package  = &amp;quot;quotes&amp;quot;;

#Create the client object with following arguments:
#1) The host you want to use
#2) The application on the host
#3) The perl module file name
#4) The package you want to use

my $ps = PSClient-&amp;gt;new( $hostname, $appname, $filename, $package );

# Just call those remote methods and get the return value
my $price  = $ps-&amp;gt;getStockPrice(&amp;quot;GE&amp;quot;);
my $info   = $ps-&amp;gt;getAllStockInfo(&amp;quot;RHAT&amp;quot;);
my $lookup = $ps-&amp;gt;lookupSymbol(&amp;quot;Coca Cola&amp;quot;);

#Share your exciting new information with standard output
print &amp;quot;GE Price: &amp;quot; . $price . &amp;quot;\n&amp;quot;;
print &amp;quot;Red Hat Price: &amp;quot; . $info-&amp;gt;{Price} . &amp;quot;\n&amp;quot;;
print &amp;quot;Red Hat EPS: &amp;quot; . $info-&amp;gt;{EarningsPerShare} . &amp;quot;\n&amp;quot;;
print &amp;quot;Coca-Cola&#39;s ticker symbol is &amp;quot; . $lookup . &amp;quot;\n&amp;quot;;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Using the &lt;em&gt;PSClient&lt;/em&gt; object to call remote methods might feel a little awkward if you expect to call them via &lt;code&gt;quotes::getStockPrice()&lt;/code&gt;, but think of the &lt;code&gt;$ps&lt;/code&gt; instance as a proxy class to your remote methods, if you like.&lt;/p&gt;

&lt;p&gt;If things don&amp;rsquo;t work, use &lt;code&gt;print $ps-&amp;gt;get_errmsg();&lt;/code&gt; to print an error message. $ps-&amp;gt;get_errmsg(); That&amp;rsquo;s a local reserved function, so it doesn&amp;rsquo;t call the server. It&amp;rsquo;s one of a few reserved functions detailed in the &lt;a href=&#34;http://www.ivorycity.com/mod_perlservice/perl_client.html&#34;&gt;Perl client reference&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;As you can see, it requires much less work to create an example with the Perl client. You simply instantiate the PSClient object, call the remote methods, and do something with the return values. That&amp;rsquo;s it. There is no protocol decoding, dealing with HTTP, CGI arguments, or any of the old annoyances. Your remote code may as well be local code.&lt;/p&gt;

&lt;h3 id=&#34;thanks-for-taking-the-tour&#34;&gt;Thanks for Taking the Tour&lt;/h3&gt;

&lt;p&gt;That&amp;rsquo;s mod_perlservice. I&amp;rsquo;m sure many of you who are developing client-server applications can see the advantages of this system. Personally, I&amp;rsquo;ve always found the existing technologies to be inflexible and/or too cumbersome. The mod_perlservice system offers a clean, simple, and scalable interface that unites client-side and server-side code in the most sensible way yet.&lt;/p&gt;

&lt;p&gt;What&amp;rsquo;s next? mod_parrotservice!&lt;/p&gt;
</description>
    </item>
    
  </channel>
</rss>

