<!DOCTYPE html>
<html lang="en-us">
  <head>
  <title> How to benchmark Perl code for speed </title>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Benchmarking is easy with the Benchmark module"/>
  <meta name="robots" content="index, follow">
  <meta name="google-site-verification" content="TZowffo_LX2mmsw2DbeNNbukCMnIOA8T-6CMJPiYllI" />

<meta property="twitter:card" content="summary">
<meta property="twitter:site" content="@PerlFoundation">
<meta property="og:url" content="http://localhost:1313/article/40/2013/9/29/How-to-benchmark-Perl-code-for-speed/" />
<meta property="og:title" content="How to benchmark Perl code for speed" />
<meta property="og:description" content="Benchmarking is easy with the Benchmark module">
<meta property="og:site_name" content="Perl.com" />

<meta property="og:type" content="article" />
<meta property="og:article:published_time" content="2013-09-09T09:09:09Z" />
<meta property="og:image" content="http://localhost:1313/images/author/david-farrell.jpg" />
<meta property="og:article:tag" content="benchmarking" />
<meta property="og:article:tag" content="module" />
<meta property="og:article:tag" content="core" />


  <link rel="icon" href="/favicon.ico">
  <link href="/article/index.xml" rel="alternate" type="application/rss+xml" title="Perl.com - programming news, code and culture" />
  <link href="/article/index.xml" rel="feed" type="application/rss+xml" title="Perl.com - programming news, code and culture" />
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" type="text/css" href="/css/perldotcom.css"/>


<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-50555-22', 'auto');
ga('create', 'UA-85734801-2', 'auto', 'editor');
ga('send', 'pageview');
ga('editor.send', 'pageview');
</script>

</head>
<body>

<div class="container-fluid full-wdith antonio">
 <div class="row">
  <div class="navbar-inverse" style="border-radius:none !important" role="navigation">
    <div class="container-fluid">
      <ul class="nav navbar-nav pull-right follow">
          <li>MORE:</li>
          <li><a href="https://perl.org">
              <img src="/images/site/perl-onion_20.png" alt="Perl Onion"></a><li>
          <li><a href="https://twitter.com/intent/follow?screen_name=perlfoundation">
              <img src="/images/site/twitter_20.png" alt="twitter"></a><li>
          <li><a href="/article/index.xml" />
              <img src="/images/site/rss_20.png" alt="rss"></a></li>
          <li><a href="https://github.com/tpf/perldotcom" />
              <img src="/images/site/github_light_20.png" alt="GitHub logo"></a></li>
      </ul>
      <div class="navbar-header">
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
          <a class="navbar-nav" href="/">
            <div class="header-logo">Perl.com</div>
          </a>
      </div>
      <div class="navbar-collapse collapse">
        <ul class="nav navbar-nav">
          <li><a href="/about">
              <div class="circle">
                <img src="/images/site/perl-camel.png" alt="" />
              </div>
                  &nbsp;&nbsp;ABOUT</a>
          </li>
          <li><a href="/authors">
              <div class="circle">
                  <span class="glyphicon glyphicon-user txt-blue-major" aria-hidden="true"></span>
              </div>
                  &nbsp;&nbsp;AUTHORS</a>
          </li>
          <li><a href="/categories">
              <div class="circle">
                  <span class="glyphicon glyphicon-folder-open txt-blue-major" aria-hidden="true"></span>
              </div>
                  &nbsp;&nbsp;CATEGORIES</a>
          </li>
          <li><a href="/tags">
              <div class="circle">
                <span class="txt-blue-major" aria-hidden="true"><strong>#</strong></span>
              </div>
                  &nbsp;&nbsp;TAGS</a>
          </li>
          <li>
            <form class="search" name="ddg" action="https://duckduckgo.com/" method="get">
              <input type="text" name ="q" placeholder="SEARCH" />
              <input type="hidden" value="perl.com" name="sites" />
            </form>
          </li>
        </ul>
      </div>
    </div>
  </div>
 </div>
</div>


  <section id="content" role="main">
    <section class="entry-content">
      <div class="container">
        <div class="row">
          <div class="col-md-9">
            <div class="row">
              <article class="fulltext">
              <h1 class="blog-post-title">How to benchmark Perl code for speed</h1>
              <p class="blog-post-meta">Sep 29, 2013 by
              
              
                
                
                <a href="#author-bio-david-farrell">David Farrell</a>
              
              </p>
              <img alt="" src=""/>
                

<p>Benchmarking Perl code speed is easy with the <a href="https://metacpan.org/pod/Benchmark">Benchmark</a> module. This article discusses benchmarking in general and how to use the <a href="https://metacpan.org/pod/Benchmark">Benchmark</a> module.</p>

<h3 id="what-is-a-benchmark">What is a benchmark?</h3>

<p>In programming a benchmark is a point-in-time measurement of the performance of a some code. Any aspect of the code performance can be benchmarked: speed, memory use and IO frequency are some common metrics.</p>

<h3 id="benchmark-limitations">Benchmark limitations</h3>

<p>One thing to keep in mind with benchmarks is that they are affected by the environment: the operating system, hardware, software and current machine state can all affect the benchmark. For Perl code the current Perl version and the compile options that Perl was installed with can have significant affects on code performance. For example if Perl was compiled with iThreads enabled, this increases the overhead of all Perl programs. Therefore benchmark comparisons are only meaningful when the benchmark environments are the same.</p>

<h3 id="perl-s-benchmark-module">Perl&rsquo;s Benchmark Module</h3>

<p><a href="https://metacpan.org/pod/Benchmark">Benchmark</a> comes installed in Perl core so if you have Perl installed you should already have Benchmark installed as well. If you are on a UNIX-like system then consider installing <a href="https://metacpan.org/pod/Benchmark::Forking">Benchmark::Forking</a> as it can improve the accuracy of benchmarks. <a href="https://metacpan.org/pod/Benchmark::Forking">Benchmark::Forking</a> is a drop-in replacement for <a href="https://metacpan.org/pod/Benchmark">Benchmark</a> and all of the following code examples will work with either module.</p>

<h3 id="timing-perl-code">Timing Perl Code</h3>

<p>Benchmarks are most interesting when comparing performance of code - so we&rsquo;re going to focus on methods that do that. Benchmark provides a <code>timethese</code> subroutine which continuously executes sets of Perl code for a number of CPU seconds and then prints out the results. Let&rsquo;s compare the speed difference of two common Perl operations: array assignment using the shift built in function and direct array assignment using equals:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-perl" data-lang="perl"><span style="color:#66d9ef">use</span> strict;
<span style="color:#66d9ef">use</span> warnings;
<span style="color:#66d9ef">use</span> Benchmark <span style="color:#e6db74">qw/cmpthese timethese/</span>;

timethese(<span style="color:#f92672">-</span><span style="color:#ae81ff">10</span>, {
        shiftAssign <span style="color:#f92672">=&gt;</span> <span style="color:#66d9ef">sub</span> {    <span style="color:#66d9ef">my</span> @alphabet <span style="color:#f92672">=</span> (<span style="color:#e6db74">&#39;A&#39;</span><span style="color:#f92672">..</span><span style="color:#e6db74">&#39;Z&#39;</span>);
                                <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">my</span> $i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; $i <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">26</span>; $i<span style="color:#f92672">++</span>){
                                    <span style="color:#66d9ef">my</span> $letter <span style="color:#f92672">=</span> shift @alphabet;
                                }
                           },
        equalsAssign <span style="color:#f92672">=&gt;</span> <span style="color:#66d9ef">sub</span> {   <span style="color:#66d9ef">my</span> @alphabet <span style="color:#f92672">=</span> (<span style="color:#e6db74">&#39;A&#39;</span><span style="color:#f92672">..</span><span style="color:#e6db74">&#39;Z&#39;</span>);
                                <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">my</span> $i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; $i <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">26</span>; $i<span style="color:#f92672">++</span>){
                                    <span style="color:#66d9ef">my</span> $letter <span style="color:#f92672">=</span> $alphabet[$i];
                                }
                            },
});</code></pre></div>
<p>Running the code above yielded the following results:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-perl" data-lang="perl">Benchmark: running equalsAssign, shiftAssign <span style="color:#66d9ef">for</span> at least <span style="color:#ae81ff">10</span> CPU seconds<span style="color:#f92672">...</span>
equalsAssign: <span style="color:#ae81ff">10</span> wallclock secs (<span style="color:#ae81ff">10.32</span> usr <span style="color:#f92672">+</span>  <span style="color:#ae81ff">0.00</span> sys <span style="color:#f92672">=</span> <span style="color:#ae81ff">10.32</span> CPU) @ 150112<span style="color:#ae81ff">.98</span><span style="color:#f92672">/</span>s (n<span style="color:#f92672">=</span><span style="color:#ae81ff">1549166</span>)
shiftAssign: <span style="color:#ae81ff">11</span> wallclock secs (<span style="color:#ae81ff">10.43</span> usr <span style="color:#f92672">+</span>  <span style="color:#ae81ff">0.00</span> sys <span style="color:#f92672">=</span> <span style="color:#ae81ff">10.43</span> CPU) @ 148529<span style="color:#ae81ff">.82</span><span style="color:#f92672">/</span>s (n<span style="color:#f92672">=</span><span style="color:#ae81ff">1549166</span>)</code></pre></div>
<p>The key metric to focus on is the rate per CPU second. This shows that the shiftAssign code block was executed 148,529.82/s and the equalsAssign block was slightly faster, executing 150,112.98/s. Note that the testing of each block ran for different amounts of time - so the other numbers in the output are not directly comparable.</p>

<h3 id="comparing-perl-code">Comparing Perl Code</h3>

<p>The <code>cmpthese</code> subroutine provided the Benchmark module accepts the same arguments and <code>timethese</code> shown above, but prints out a useful comparison grid of the results to show which code block was faster by %. Helpfully it also includes the rate per CPU second.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-perl" data-lang="perl"><span style="color:#66d9ef">use</span> strict;
<span style="color:#66d9ef">use</span> warnings;
<span style="color:#66d9ef">use</span> Benchmark <span style="color:#e6db74">qw/cmpthese timethese/</span>;

cmpthese(<span style="color:#f92672">-</span><span style="color:#ae81ff">10</span>, {
        shiftAssign <span style="color:#f92672">=&gt;</span> <span style="color:#66d9ef">sub</span> {    <span style="color:#66d9ef">my</span> @alphabet <span style="color:#f92672">=</span> (<span style="color:#e6db74">&#39;A&#39;</span><span style="color:#f92672">..</span><span style="color:#e6db74">&#39;Z&#39;</span>);
                                <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">my</span> $i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; $i <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">26</span>; $i<span style="color:#f92672">++</span>){
                                    <span style="color:#66d9ef">my</span> $letter <span style="color:#f92672">=</span> shift @alphabet;
                                }
                           },
        equalsAssign <span style="color:#f92672">=&gt;</span> <span style="color:#66d9ef">sub</span> {   <span style="color:#66d9ef">my</span> @alphabet <span style="color:#f92672">=</span> (<span style="color:#e6db74">&#39;A&#39;</span><span style="color:#f92672">..</span><span style="color:#e6db74">&#39;Z&#39;</span>);
                                <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">my</span> $i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; $i <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">26</span>; $i<span style="color:#f92672">++</span>){
                                    <span style="color:#66d9ef">my</span> $letter <span style="color:#f92672">=</span> $alphabet[$i];
                                }
                            },
});</code></pre></div>
<p>Executing this code returned the following results:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-perl" data-lang="perl">                 Rate  shiftAssign equalsAssign
shiftAssign  <span style="color:#ae81ff">142529</span><span style="color:#f92672">/</span>s           <span style="color:#f92672">--</span>          <span style="color:#f92672">-</span><span style="color:#ae81ff">4</span>%
equalsAssign <span style="color:#ae81ff">148159</span><span style="color:#f92672">/</span>s           <span style="color:#ae81ff">4</span>%           <span style="color:#960050;background-color:#1e0010">--</span></code></pre></div>
<p>The results above are ordered from slowest to fastest (as seen by the rate/s measurement). This benchmark shows that the equalsAssign code block was 4% faster than the shiftAssign code block.</p>

<h3 id="additional-tips">Additional Tips</h3>

<ul>
<li>Try to use the minimum set of code required for the behavior required - this will increase the accuracy of the benchmark pertaining to operations being benchmarked.</li>
<li>Use a negative number as the CPU seconds count for <code>timethese</code> or <code>cmpthese</code>. This specifies the minimum number of CPU seconds to run. <a href="http://www.perlmonks.org/?node_id=8745">Some sources</a> recommend at least -5 seconds to avoid inaccurate benchmarks.</li>
<li>Sanity check your results: if you&rsquo;re not sure try comparing two code blocks with one obviously slower than the other to check that Benchmark is returning sensible results.</li>
<li>Compare code examples rather than time individual ones: the actual execution time of a block of code is usually not that important; knowing which set of code is faster than the other however is useful as this will generally be a repeatable occurrence.</li>
<li>If you require more in depth benchmarking consider using <a href="https://metacpan.org/pod/Devel::NYTProf">Devel::NYTProf</a>.</li>
</ul>

<h3 id="sources">Sources</h3>

<p>This article drew on information from a few sources in particular: brian d foy&rsquo;s <a href="http://www252.pair.com/comdog/Talks/benchmarking_perl.pdf">Benchmarking Perl</a> talk notes and David Golden&rsquo;s <a href="http://www.dagolden.com/index.php/1849/adventures-in-benchmarking-part-1/">Adventures in Benchmarking</a> post.</p>

<p><br />
<em>This article was originally posted on <a href="http://perltricks.com">PerlTricks.com</a>.</em></p>

              </article>
              <p><strong>Tags</strong></p>
              <div class="tags">
                <div class="category"><a href="/categories/development">development</a></div>
                
                  <div class="tag"><a href="/tags/benchmarking">benchmarking</a></div>
                
                  <div class="tag"><a href="/tags/module">module</a></div>
                
                  <div class="tag"><a href="/tags/core">core</a></div>
                
              </div>
            </div>
            
              
                
<div class="row" id="author-bio-david-farrell">
  <div class="col-sm-2">
    
    <a href="/authors/david-farrell/"><div class="circle-avatar" style="background-image:url(/images/author/david-farrell.jpg)"></div></a>
  </div>
  <div class="col-sm-10">
    <a href="/authors/david-farrell/"><h3>David Farrell</h3></a>
    <p>David is the editor of Perl.com. An organizer of the <a href="http://www.meetup.com/The-New-York-Perl-Meetup-Group/">New York Perl Meetup</a>, he works for ZipRecruiter as a software developer, and sometimes <a href="https://twitter.com/perltricks">tweets</a> about Perl and Open Source.</p>
    <h5><a href="/authors/david-farrell/">Browse their articles</a></h5>
  </div>
</div>

            
            <div class="row">
              <h3>Feedback</h3>
              <p>Something wrong with this article? Help us out by opening an issue or pull request on <a href="https://github.com/tpf/perldotcom/blob/master/content/article/how-to-benchmark-perl-code-for-speed.md">GitHub</a></p>
            </div>
          </div>
          <div class="col-md-3">
            <div class="latest-sidebar">

  <div class="row">
    <div class="col-sm-12 centering">
      <span style="font-size:1.8em" class="antonio txt-blue-major">OUR LATEST ARTICLES</span>
    </div>
  </div>
  
    
    
    <div class="row">
        <a href="http://localhost:1313/article/the-perl-admbassador-curtis-poe/">
      <div class="col-sm-3">
        <div class="circle-avatar" style="background-image:url(/images/the-perl-ambassador-curtis-poe/curtis-poe.jpg)"></div>
      </div>
      <div class="col-sm-9">
          <h6>The Perl Ambassador: Curtis &#39;Ovid&#39; Poe</h6>
          <p style="line-height:1"><small>The person behind the news of Perl</small></p>
      </div>
        </a>
    </div>
  
    
    
    <div class="row">
        <a href="http://localhost:1313/article/a-tour-with-net-ftp/">
      <div class="col-sm-3">
        <div class="circle-avatar" style="background-image:url(/images/a-tour-with-net-ftp/thumb_kidyes.jpg)"></div>
      </div>
      <div class="col-sm-9">
          <h6>A tour with Net::FTP</h6>
          <p style="line-height:1"><small>How to write an FTP client in Perl</small></p>
      </div>
        </a>
    </div>
  
    
    
    <div class="row">
        <a href="http://localhost:1313/article/shortcode_test/">
      <div class="col-sm-3">
        <div class="circle-avatar" style="background-image:url(/images/author/brian-d-foy.jpg)"></div>
      </div>
      <div class="col-sm-9">
          <h6>shortcode_test</h6>
          <p style="line-height:1"><small></small></p>
      </div>
        </a>
    </div>
  
    
    
    <div class="row">
        <a href="http://localhost:1313/article/listen-to-larry-wall-s-state-of-the-onion-2000-on-youtube/">
      <div class="col-sm-3">
        <div class="circle-avatar" style="background-image:url(/images/listen-to-larry-wall-s-state-of-the-onion-2000-on-youtube/thumb_larry-wall.jpg)"></div>
      </div>
      <div class="col-sm-9">
          <h6>Listen to Larry Wall&#39;s State of the Onion 2000 on YouTube</h6>
          <p style="line-height:1"><small></small></p>
      </div>
        </a>
    </div>
  
    
    
    <div class="row">
        <a href="http://localhost:1313/article/announcing-perl-7/">
      <div class="col-sm-3">
        <div class="circle-avatar" style="background-image:url(/images/announcing-perl-7/thumb_seven_on_blue_wall.jpg)"></div>
      </div>
      <div class="col-sm-9">
          <h6>Announcing Perl 7</h6>
          <p style="line-height:1"><small>Perl 5 with modern defaults</small></p>
      </div>
        </a>
    </div>
  
</div>
<div class="row" style="margin-top:20px">
  <div class="col-sm-12 centering">
  <script async src="/widget/toplinks/toplinks.js" type="text/javascript"></script>
    <div id="toplinks"></div>
  </div>
</div>

<div class="row" style="margin-top:20px">
  <div class="col-sm-12 centering">
    <a class="twitter-timeline" data-height="640" data-dnt="true" data-theme="dark" href="https://twitter.com/perlfoundation?ref_src=twsrc%5Etfw">Tweets by perlfoundation</a> <script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>
  </div>
</div>

<div class="row" style="margin-top:20px">
  <div class="col-sm-12 centering">
    <script src="https://www.reddit.com/r/perl/hot/.embed?limit=10&t=all" type="text/javascript"></script>
  </div>
</div>



          </div>
        </div>
      </div>
    </section>
  </section>
<script>
 
var tables, i;
tables = document.getElementsByTagName('table');
for (i=0;i<tables.length;i++) {
  tables[i].className = 'table table-striped';
}
</script>
<div class="push"></div>
<div class="footer">
  <div class="container">
    <div class="row">
      <div class="col-md-1">
        <h5>Site Map</h5>
        <ul>
        <li><a href="/">Home</a></li>
        <hr>
        <li><a href="/about">About</a></li>
        <hr>
        <li><a href="/authors">Authors</a></li>
        <hr>
        <li><a href="/categories">Categories</a></li>
        <hr>
        <li><a href="/tags">Tags</a></li>
        <hr>
        </ul>
      </div>
      <div class="col-md-3">
        <h5>Contact Us</h5>
        <p>To get in touch, send an email to: perl.com-editor@perl.org</p>
        <p><a href="https://perl.org">
              <img src="/images/site/perl-onion_20.png" alt="Perl Onion"></a>
          <a href="https://twitter.com/intent/follow?screen_name=perlfoundation">
              <img src="/images/site/twitter_20.png" alt="twitter"></a>
          <a href="/index.xml" /><img src="/images/site/rss_20.png" alt="rss"></a>
          <a href="https://github.com/tpf/perldotcom">
              <img src="/images/site/github_light_20.png" alt="GitHub logo"></a></p>
      </div>
      <div class="col-md-2">
          <h5>License</h5>
          <p>This work is licensed under a <a rel="license" href="https://creativecommons.org/licenses/by-nc/3.0/">Creative Commons Attribution-NonCommercial 3.0 Unported License</a>.</p>
          <p><a rel="license" href="https://creativecommons.org/licenses/by-nc/3.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc/3.0/88x31.png" /></a></p>
      </div>
      <div class="col-md-5">
          <h5>Legal</h5>
          <p>Perl.com and the authors make no representations with respect to the accuracy or completeness of the contents of all work on this website and specifically disclaim all warranties, including without limitation warranties of fitness for a particular purpose. The information published on this website may not be suitable for every situation. All work on this website is provided with the understanding that Perl.com and the authors are not engaged in rendering professional services. Neither Perl.com nor the authors shall be liable for damages arising herefrom.</p>
      </div>
    </div>
  </div>
</div>
<script src="/javascript/jquery.min.js"></script>
<script src="/javascript/bootstrap.min.js"></script>
<script data-no-instant>document.write('<script src="/livereload.js?port=1313&mindelay=10"></' + 'script>')</script></body>
</html>

