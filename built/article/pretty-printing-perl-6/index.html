<!DOCTYPE html>
<html lang="en-us">
  <head>
  <title> Pretty Printing Perl 6 </title>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="When .Str is not good enough"/>
  <meta name="robots" content="index, follow">
  <meta name="google-site-verification" content="TZowffo_LX2mmsw2DbeNNbukCMnIOA8T-6CMJPiYllI" />

<meta property="twitter:card" content="summary">
<meta property="twitter:site" content="@PerlFoundation">
<meta property="og:url" content="http://localhost:1313/article/pretty-printing-perl-6/" />
<meta property="og:title" content="Pretty Printing Perl 6" />
<meta property="og:description" content="When .Str is not good enough">
<meta property="og:site_name" content="Perl.com" />

<meta property="og:type" content="article" />
<meta property="og:article:published_time" content="2017-07-07T07:07:07Z" />
<meta property="og:image" content="http://localhost:1313/images/author/brian-d-foy.jpg" />
<meta property="og:article:tag" content="prettydump" />
<meta property="og:article:tag" content="data-dumper" />
<meta property="og:article:tag" content="pretty-printer" />


  <link rel="icon" href="/favicon.ico">
  <link href="/article/index.xml" rel="alternate" type="application/rss+xml" title="Perl.com - programming news, code and culture" />
  <link href="/article/index.xml" rel="feed" type="application/rss+xml" title="Perl.com - programming news, code and culture" />
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" type="text/css" href="/css/perldotcom.css"/>


<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-50555-22', 'auto');
ga('create', 'UA-85734801-2', 'auto', 'editor');
ga('send', 'pageview');
ga('editor.send', 'pageview');
</script>

</head>
<body>

<div class="container-fluid full-wdith antonio">
 <div class="row">
  <div class="navbar-inverse" style="border-radius:none !important" role="navigation">
    <div class="container-fluid">
      <ul class="nav navbar-nav pull-right follow">
          <li>MORE:</li>
          <li><a href="https://perl.org">
              <img src="/images/site/perl-onion_20.png" alt="Perl Onion"></a><li>
          <li><a href="https://twitter.com/intent/follow?screen_name=perlfoundation">
              <img src="/images/site/twitter_20.png" alt="twitter"></a><li>
          <li><a href="/article/index.xml" />
              <img src="/images/site/rss_20.png" alt="rss"></a></li>
          <li><a href="https://github.com/tpf/perldotcom" />
              <img src="/images/site/github_light_20.png" alt="GitHub logo"></a></li>
      </ul>
      <div class="navbar-header">
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
          <a class="navbar-nav" href="/">
            <div class="header-logo">Perl.com</div>
          </a>
      </div>
      <div class="navbar-collapse collapse">
        <ul class="nav navbar-nav">
          <li><a href="/about">
              <div class="circle">
                <img src="/images/site/perl-camel.png" alt="" />
              </div>
                  &nbsp;&nbsp;ABOUT</a>
          </li>
          <li><a href="/authors">
              <div class="circle">
                  <span class="glyphicon glyphicon-user txt-blue-major" aria-hidden="true"></span>
              </div>
                  &nbsp;&nbsp;AUTHORS</a>
          </li>
          <li><a href="/categories">
              <div class="circle">
                  <span class="glyphicon glyphicon-folder-open txt-blue-major" aria-hidden="true"></span>
              </div>
                  &nbsp;&nbsp;CATEGORIES</a>
          </li>
          <li><a href="/tags">
              <div class="circle">
                <span class="txt-blue-major" aria-hidden="true"><strong>#</strong></span>
              </div>
                  &nbsp;&nbsp;TAGS</a>
          </li>
          <li>
            <form class="search" name="ddg" action="https://duckduckgo.com/" method="get">
              <input type="text" name ="q" placeholder="SEARCH" />
              <input type="hidden" value="perl.com" name="sites" />
            </form>
          </li>
        </ul>
      </div>
    </div>
  </div>
 </div>
</div>


  <section id="content" role="main">
    <section class="entry-content">
      <div class="container">
        <div class="row">
          <div class="col-md-9">
            <div class="row">
              <article class="fulltext">
              <h1 class="blog-post-title">Pretty Printing Perl 6</h1>
              <p class="blog-post-meta">Jul 26, 2017 by
              
              
                
                
                <a href="#author-bio-brian-d-foy">brian d foy</a>
              
              </p>
              <img alt="" src=""/>
                <p>As I was working on <a href="https://www.learningperl6.com/">Learning Perl 6</a>, I wanted a way to pretty print a hash to show the reader what happened. I didn&rsquo;t want to output from the builtin routines and a module I found was a good start but needed more work. So I created the <a href="https://github.com/briandfoy/perl6-PrettyDump">PrettyDump module</a>.</p>

<p>Before I get to my module, Perl 6 already has some nice ways to summarize objects. My first task was to dump a match object to see what it matched. Here&rsquo;s a bit of code that matches a string against a regex and saves the result in <code>$match</code>. That&rsquo;s a <a href="https://docs.perl6.org/type/Match">Match</a> object:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-perl" data-lang="perl"><span style="color:#66d9ef">my</span> $rx <span style="color:#f92672">=</span> rx<span style="color:#e6db74">/ &lt;[ a .. z ]&gt; &lt;[ 1 .. 9 ]&gt; /</span>;
<span style="color:#66d9ef">my</span> $string <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;:::abc123::&#39;</span>;
<span style="color:#66d9ef">my</span> $match <span style="color:#f92672">=</span> $string <span style="color:#f92672">~~</span> $rx;

put $match;</code></pre></div>
<p>When I output that with <a href="https://docs.perl6.org/routine/put">put</a>, I get the part of the string that matched:</p>

<pre><code>c1
</code></pre>

<p>I could change the code slightly to use <a href="https://docs.perl6.org/routine/say">say</a>. That&rsquo;s like <code>put</code> but calls the <a href="https://docs.perl6.org/routine/gist">.gist</a> method on the object first to provide a human-compatible version of the object. Each object can decide on it&rsquo;s own what that means.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-perl" data-lang="perl">say $match;  <span style="color:#75715e"># put $match.gist</span></code></pre></div>
<p>In this case, the output is almost the same. There are some fancy quotes around it:</p>

<pre><code>｢c1｣
</code></pre>

<p>Instead of <code>.gist</code>, which <code>say</code> gives me for free, I could call the <a href="https://docs.perl6.org/routine/perl">perl</a> method explicitly.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-perl" data-lang="perl">put $match<span style="color:#f92672">.</span>perl;</code></pre></div>
<p>This produces a string that represents what Perl 6 thinks the data structure is:</p>

<pre><code>Match.new(list =&gt; (), made =&gt; Any, pos =&gt; 7, hash =&gt; Map.new(()), orig =&gt; &quot;:::abc123::&quot;, from =&gt; 5)
</code></pre>

<p>I could also use <a href="https://docs.perl6.org/programs/01-debugging#Dumper_function_dd">dd</a>, a Rakudo-specific dumping feature:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-perl" data-lang="perl">dd $match;</code></pre></div>
<p>The output is similar to the string for <code>.perl</code>, but also slightly different:</p>

<pre><code>Match $match = Match.new(list =&gt; (), made =&gt; Any, pos =&gt; 7, hash =&gt; Map.new(()), orig =&gt; &quot;:::abc123::&quot;, from =&gt; 5)
</code></pre>

<p>I didn&rsquo;t particularly like any of formats because they are squished together and rather ugly to my eyes (but being pleasing to me personally shows up in exactly zero designs). I looked for a module, and even though the Perl 6 module ecosystem is fairly young, I found <a href="https://github.com/drforr/perl6-pp">Pretty::Printer</a> from Jeff Goff:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-perl" data-lang="perl"><span style="color:#66d9ef">use</span> Pretty::Printer; <span style="color:#75715e"># From Jeff Goff</span>

<span style="color:#66d9ef">my</span> $rx <span style="color:#f92672">=</span> rx<span style="color:#e6db74">/ &lt;[ a .. z ]&gt; &lt;[ 1 .. 9 ]&gt; /</span>;
<span style="color:#66d9ef">my</span> $string <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;:::abc123::&#39;</span>;
<span style="color:#66d9ef">my</span> $match <span style="color:#f92672">=</span> $string <span style="color:#f92672">~~</span> $rx;

Pretty::Printer<span style="color:#f92672">.</span><span style="color:#66d9ef">new</span><span style="color:#f92672">.</span>pp: $match;</code></pre></div>
<p>When I tried this, I didn&rsquo;t get anything (or, more exactly, I got literally &ldquo;anything&rdquo;):</p>

<pre><code>Any
</code></pre>

<p><code>Pretty::Printer</code> was nice for the few data types that it handled, but not a <code>Match</code> object. It had some builtin handlers that it selected with a <code>given-when</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-perl" data-lang="perl">method _pp($ds,$depth)
  {
  <span style="color:#66d9ef">my</span> Str $str;
  given $ds<span style="color:#f92672">.</span>WHAT
    {
    when Hash    { $str <span style="color:#f92672">~=</span> self<span style="color:#f92672">.</span>Hash($ds,$depth) }
    when Array   { $str <span style="color:#f92672">~=</span> self<span style="color:#f92672">.</span>Array($ds,$depth) }
    when Pair    { $str <span style="color:#f92672">~=</span> self<span style="color:#f92672">.</span>Pair($ds,$depth) }
    when Str     { $str <span style="color:#f92672">~=</span> $ds<span style="color:#f92672">.</span>perl }
    when Numeric { $str <span style="color:#f92672">~=</span> <span style="color:#f92672">~</span>$ds }
    when Nil     { $str <span style="color:#f92672">~=</span> <span style="color:#e6db74">q{Nil}</span> }
    when Any     { $str <span style="color:#f92672">~=</span> <span style="color:#e6db74">q{Any}</span> }
    }
  <span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>indent<span style="color:#f92672">-</span>string($str,$depth);
  }</code></pre></div>
<p>I started to work on <code>Pretty::Printer</code> to add a <code>Match</code> handler, and then a few others, but I quickly realized I was getting far away from Jeff&rsquo;s original code. Not only that, but I didn&rsquo;t want to add more and more branches to the <code>given-when</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-perl" data-lang="perl">method _pp($ds,$depth)
  {
  <span style="color:#66d9ef">my</span> Str $str;
  given $ds<span style="color:#f92672">.</span>WHAT
    {
    <span style="color:#75715e"># Check more derived types first.</span>
    when Match   { $str <span style="color:#f92672">~=</span> self<span style="color:#f92672">.</span>Match($ds,$depth) }
    when Hash    { $str <span style="color:#f92672">~=</span> self<span style="color:#f92672">.</span>Hash($ds,$depth)  }
    when Array   { $str <span style="color:#f92672">~=</span> self<span style="color:#f92672">.</span>Array($ds,$depth) }
    when Map     { $str <span style="color:#f92672">~=</span> self<span style="color:#f92672">.</span>Map($ds,$depth) }
    when List    { $str <span style="color:#f92672">~=</span> self<span style="color:#f92672">.</span>List($ds,$depth) }
    when Pair    { $str <span style="color:#f92672">~=</span> self<span style="color:#f92672">.</span>Pair($ds,$depth)  }
    when Str     { $str <span style="color:#f92672">~=</span> $ds<span style="color:#f92672">.</span>perl }
    when Numeric { $str <span style="color:#f92672">~=</span> <span style="color:#f92672">~</span>$ds }
    when Nil     { $str <span style="color:#f92672">~=</span> <span style="color:#e6db74">q{Nil}</span> }
    when Any     { $str <span style="color:#f92672">~=</span> <span style="color:#e6db74">q{Any}</span> }
    }
  <span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>indent<span style="color:#f92672">-</span>string($str,$depth);
  }</code></pre></div>
<p>I changed my module name to <a href="https://github.com/briandfoy/perl6-PrettyDump">PrettyDump</a> and ended up with this:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-perl" data-lang="perl"><span style="color:#66d9ef">use</span> PrettyDump;

<span style="color:#66d9ef">my</span> $rx <span style="color:#f92672">=</span> rx<span style="color:#e6db74">/ &lt;[ a .. z ]&gt; &lt;[ 1 .. 9 ]&gt; /</span>;
<span style="color:#66d9ef">my</span> $string <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;:::abc123::&#39;</span>;
<span style="color:#66d9ef">my</span> $match <span style="color:#f92672">=</span> $string <span style="color:#f92672">~~</span> $rx;

put PrettyDump<span style="color:#f92672">.</span><span style="color:#66d9ef">new</span><span style="color:#f92672">.</span>dump: $match;</code></pre></div>
<p>I was much more pleased with the output which allowed me easily pick out the part of the object I wanted to inspect:</p>

<pre><code>Match.new(
  :from(5),
  :hash(Map.new()),
  :list($()),
  :made(Mu),
  :orig(&quot;:::abc123::&quot;),
  :pos(7),
  :to(7)
)
</code></pre>

<p>That solves that problem. But what about all the other types? One of my first improvements was a way to dump a class that my module did not know about. I knew about the <code>TO_JSON</code> method that the Perl 5 <a href="https://metacpan.org/pod/JSON">JSON</a> module. With that, a class could decide its own JSON representation. I could do that with <code>PrettyDump</code>. If a class or object has a <code>PrettyDump</code> method, my module will use that preferentially:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-perl" data-lang="perl">class SomeClass {
    <span style="color:#960050;background-color:#1e0010">…</span>
    method PrettyDump ( $pretty, $ds, $depth ) {
        <span style="color:#960050;background-color:#1e0010">…</span>
        }
    }

<span style="color:#66d9ef">my</span> $pretty <span style="color:#f92672">=</span> PrettyDump<span style="color:#f92672">.</span><span style="color:#66d9ef">new</span>;

<span style="color:#66d9ef">my</span> $some<span style="color:#f92672">-</span>object <span style="color:#f92672">=</span> SomeClass<span style="color:#f92672">.</span><span style="color:#66d9ef">new</span>;

put $pretty<span style="color:#f92672">.</span>dump: $some<span style="color:#f92672">-</span>object;</code></pre></div>
<p>The class doesn&rsquo;t need to define that method. I could decorate an object with a <code>PrettyDump</code> method through a role. The <a href="https://docs.perl6.org/language/operators#infix_but">but</a> operator can do that for me by creating a new object in a new class that includes that role mixed into the original class:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-perl" data-lang="perl"><span style="color:#66d9ef">use</span> PrettyDump;

<span style="color:#66d9ef">my</span> $pretty <span style="color:#f92672">=</span> PrettyDump<span style="color:#f92672">.</span><span style="color:#66d9ef">new</span>;

<span style="color:#66d9ef">my</span> Int $a <span style="color:#f92672">=</span> <span style="color:#ae81ff">137</span>;
put $pretty<span style="color:#f92672">.</span>dump: $a;

<span style="color:#66d9ef">my</span> $b <span style="color:#f92672">=</span> $a but role {
  method PrettyDump ( $pretty, $depth <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span> ) {
    <span style="color:#e6db74">&#34;({self.^name}) {self}&#34;</span>;
    }
  };
put $pretty<span style="color:#f92672">.</span>dump: $b;</code></pre></div>
<p>My code looks different from Jeff&rsquo;s, but it&rsquo;s not that different. Instead of a <code>given-when</code>, I have an <code>if</code> structure. I collapsed Jeff&rsquo;s branches into <code>self.can: $ds.^name</code> to look for a matching method to the object type (and introduced a bug while doing it. See it?). The first branch looks for the <code>PrettyDump</code> method. The second does some special handling for numeric things. If none of those work, I <code>die</code>, which is another stupid thing I did at first.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-perl" data-lang="perl">method dump ( $ds, $depth <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span> ) {
  put <span style="color:#e6db74">&#34;In dump. Got &#34;</span>, $ds<span style="color:#f92672">.^</span>name;
  <span style="color:#66d9ef">my</span> Str $str;

  <span style="color:#66d9ef">if</span> $ds<span style="color:#f92672">.</span>can: <span style="color:#e6db74">&#39;PrettyDump&#39;</span> {
    $str <span style="color:#f92672">~=</span> $ds<span style="color:#f92672">.</span>PrettyDump: self;
    }
  <span style="color:#66d9ef">elsif</span> $ds <span style="color:#f92672">~~</span> Numeric {
    $str <span style="color:#f92672">~=</span> self<span style="color:#f92672">.</span>Numeric: $ds, $depth;
    }
  <span style="color:#66d9ef">elsif</span> self<span style="color:#f92672">.</span>can: $ds<span style="color:#f92672">.^</span>name {
    <span style="color:#66d9ef">my</span> $what <span style="color:#f92672">=</span> $ds<span style="color:#f92672">.^</span>name;
    $str <span style="color:#f92672">~=</span> self<span style="color:#f92672">.</span><span style="color:#e6db74">&#34;$what&#34;</span>( $ds, $depth );
    }
  <span style="color:#66d9ef">else</span> {
    die <span style="color:#e6db74">&#34;Could not handle &#34;</span> <span style="color:#f92672">~</span> $ds<span style="color:#f92672">.</span>perl;
    }

  <span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>indent<span style="color:#f92672">-</span>string: $str, $depth;
  }</code></pre></div>
<p>So, I kept going. I wanted a way to add (and remove) handlers to a <code>PrettyDump</code> object. I could add those as roles, but I thought about doing this repeatedly and often and didn&rsquo;t like the idea of the frankenclass that would create. I added a way to do it on my own (although I might change my mind later):</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-perl" data-lang="perl"><span style="color:#66d9ef">my</span> $pretty <span style="color:#f92672">=</span> PrettyDump<span style="color:#f92672">.</span><span style="color:#66d9ef">new</span>;

class SomeClass { <span style="color:#960050;background-color:#1e0010">…</span> }

<span style="color:#66d9ef">my</span> $handler <span style="color:#f92672">=</span> <span style="color:#66d9ef">sub</span> ( $pretty, $ds, Int $depth = 0 ) {
  <span style="color:#f92672">...</span>
  }

$pretty<span style="color:#f92672">.</span>add<span style="color:#f92672">-</span>handler: <span style="color:#e6db74">&#39;SomeClass&#39;</span>, $handler;

put $pretty<span style="color:#f92672">.</span>dump: $SomeClass<span style="color:#f92672">-</span>object;</code></pre></div>
<p>My code added a couple more branches (and some code comments to elucidate the process). First, I&rsquo;d look for a handler. If I&rsquo;d defined one of those, I&rsquo;d use it. Otherwise, I went through the same process. I did add some more checks at the end. If nothing else worked, I try a <code>.Str</code> method. Instead of <code>die</code>-ing at the end, I add an &ldquo;unhandled thingy&rdquo; string for that object. That way I know that I didn&rsquo;t handle something and the rest of the program keeps going. That turned out to be more important than I thought. I use this to peek at a program as it executes. It&rsquo;s not part of the program flow and shouldn&rsquo;t interrupt it because my dumping code is incomplete:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-perl" data-lang="perl">method dump ( $ds, Int $depth <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">--&gt;</span> Str ) {
  <span style="color:#66d9ef">my</span> Str $str <span style="color:#f92672">=</span> <span style="color:#66d9ef">do</span> {
    <span style="color:#75715e"># If the PrettyDump object has a user-defined handler</span>
    <span style="color:#75715e"># for this type, prefer that one</span>
    <span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>handles: $ds<span style="color:#f92672">.^</span>name {
      self<span style="color:#f92672">!</span>handle: $ds, $depth;
      }
    <span style="color:#75715e"># The object might have its own method to dump</span>
    <span style="color:#75715e"># its structure</span>
    <span style="color:#66d9ef">elsif</span> $ds<span style="color:#f92672">.</span>can: <span style="color:#e6db74">&#39;PrettyDump&#39;</span> {
      $ds<span style="color:#f92672">.</span>PrettyDump: self;
      }
    <span style="color:#75715e"># If it&#39;s any sort of Numeric, we&#39;ll handle it</span>
    <span style="color:#75715e"># and dispatch further</span>
    <span style="color:#66d9ef">elsif</span> $ds <span style="color:#f92672">~~</span> Numeric {
      self<span style="color:#f92672">!</span>Numeric: $ds, $depth;
      }
    <span style="color:#75715e"># If we have a method name that matches the class, we&#39;ll</span>
    <span style="color:#75715e"># use that.</span>
    <span style="color:#66d9ef">elsif</span> self<span style="color:#f92672">.</span>can: $ds<span style="color:#f92672">.^</span>name {
      <span style="color:#66d9ef">my</span> $what <span style="color:#f92672">=</span> $ds<span style="color:#f92672">.^</span>name;
      self<span style="color:#f92672">.</span><span style="color:#e6db74">&#34;$what&#34;</span>( $ds, $depth );
      }
    <span style="color:#75715e"># If the class inherits from something that we know</span>
    <span style="color:#75715e"># about, use the most specific one that we know about</span>
    <span style="color:#66d9ef">elsif</span> $ds<span style="color:#f92672">.^</span>parents<span style="color:#f92672">.</span>grep( { self<span style="color:#f92672">.</span>can: $_<span style="color:#f92672">.^</span>name } )<span style="color:#f92672">.</span>elems <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span> {
      <span style="color:#66d9ef">my</span> Str $str <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&#39;</span>;
      <span style="color:#66d9ef">for</span> $ds<span style="color:#f92672">.^</span>parents <span style="color:#f92672">-&gt;</span> $type {
        <span style="color:#66d9ef">my</span> $what <span style="color:#f92672">=</span> $type<span style="color:#f92672">.^</span>name;
        <span style="color:#66d9ef">next</span> <span style="color:#66d9ef">unless</span> self<span style="color:#f92672">.</span>can( $what );
        $str <span style="color:#f92672">~=</span> self<span style="color:#f92672">.</span><span style="color:#e6db74">&#34;$what&#34;</span>(
         $ds, $depth, <span style="color:#e6db74">&#34;{$ds.^name}.new(&#34;</span>, <span style="color:#e6db74">&#39;)&#39;</span> );
        <span style="color:#66d9ef">last</span>;
        }
      $str;
      }
    <span style="color:#75715e"># If we&#39;re this far and the object has a .Str method,</span>
    <span style="color:#75715e"># we&#39;ll use that:</span>
    <span style="color:#66d9ef">elsif</span> $ds<span style="color:#f92672">.</span>can: <span style="color:#e6db74">&#39;Str&#39;</span> {
      <span style="color:#e6db74">&#34;({$ds.^name}): &#34;</span> <span style="color:#f92672">~</span> $ds<span style="color:#f92672">.</span>Str;
      }
    <span style="color:#75715e"># Finally, we&#39;ll put a placeholder method there</span>
    <span style="color:#66d9ef">else</span> {
      <span style="color:#e6db74">&#34;(Unhandled {$ds.^name})&#34;</span>
      }
    };

  <span style="color:#66d9ef">return</span> self<span style="color:#f92672">!</span>indent<span style="color:#f92672">-</span>string: $str, $depth;
  }</code></pre></div>
<p>As I got further into this code, I looked at Perl 5&rsquo;s <a href="https://metacpan.org/pod/Data::Dumper">Data::Dumper</a>, but discovered that this isn&rsquo;t the same sort of thing. That module outputs Perl code that I could <a href="https://perldoc.perl.org/functions/eval.html">eval</a> to get back the same data structure. I didn&rsquo;t want that <a href="https://www.masteringperl.org/2012/12/the-storable-security-problem/">can of worms</a> in my module.</p>

<p>Beyond what I&rsquo;ve shown here, I&rsquo;ve been fiddling with formatting and other minor things as I run into problems. If there&rsquo;s something that you&rsquo;d like to do with the code, you can contribute through the <a href="https://github.com/briandfoy/perl6-PrettyDump">PrettyDump GitHub repo</a>, or even fork my code as the basis for your own experiments.</p>

<p>(Part of this work was supported by a travel grant from <a href="http://www.perlfoundation.org">The Perl Foundation</a>. I presented talks about my work at <a href="https://www.slideshare.net/brian_d_foy/pretty-dump-perl-6">Amsterdam.pm</a>, <a href="https://www.slideshare.net/brian_d_foy/dumping-perl-6-french-perl-workshop">French Perl Workshop 2017</a>, and <a href="https://www.slideshare.net/brian_d_foy/prettydump-perl-6-londonpm">London.pm</a>.)</p>

<p><br />
<em>This article was originally posted on <a href="http://perltricks.com">PerlTricks.com</a>.</em></p>

              </article>
              <p><strong>Tags</strong></p>
              <div class="tags">
                <div class="category"><a href="/categories/perl-6">perl-6</a></div>
                
                  <div class="tag"><a href="/tags/prettydump">prettydump</a></div>
                
                  <div class="tag"><a href="/tags/data-dumper">data-dumper</a></div>
                
                  <div class="tag"><a href="/tags/pretty-printer">pretty-printer</a></div>
                
              </div>
            </div>
            
              
                
<div class="row" id="author-bio-brian-d-foy">
  <div class="col-sm-2">
    
    <a href="/authors/brian-d-foy/"><div class="circle-avatar" style="background-image:url(/images/author/brian-d-foy.jpg)"></div></a>
  </div>
  <div class="col-sm-10">
    <a href="/authors/brian-d-foy/"><h3>brian d foy</h3></a>
    <p><a href="http://www.pair.com/~comdog/">brian d foy</a> is a Perl trainer and writer, and a senior editor at Perl.com. He&rsquo;s the author of <a href="https://www.masteringperl.org">Mastering Perl</a>, <a href="https://leanpub.com/mojo_web_clients">Mojolicious Web Clients</a>, <a href="https://leanpub.com/learning_perl_exercises">Learning Perl Exercises</a>, and co-author of <a href="https://www.programmingperl.org">Programming Perl</a>, <a href="https://www.learning-perl.com">Learning Perl</a>, <a href="https://www.intermediateperl.com">Intermediate Perl</a> and <a href="https://www.effectiveperlprogramming.com">Effective Perl Programming</a>.</p>
    <h5><a href="/authors/brian-d-foy/">Browse their articles</a></h5>
  </div>
</div>

            
            <div class="row">
              <h3>Feedback</h3>
              <p>Something wrong with this article? Help us out by opening an issue or pull request on <a href="https://github.com/tpf/perldotcom/blob/master/content/article/pretty-printing-perl-6.md">GitHub</a></p>
            </div>
          </div>
          <div class="col-md-3">
            <div class="latest-sidebar">

  <div class="row">
    <div class="col-sm-12 centering">
      <span style="font-size:1.8em" class="antonio txt-blue-major">OUR LATEST ARTICLES</span>
    </div>
  </div>
  
    
    
    <div class="row">
        <a href="http://localhost:1313/article/the-perl-admbassador-curtis-poe/">
      <div class="col-sm-3">
        <div class="circle-avatar" style="background-image:url(/images/the-perl-ambassador-curtis-poe/curtis-poe.jpg)"></div>
      </div>
      <div class="col-sm-9">
          <h6>The Perl Ambassador: Curtis &#39;Ovid&#39; Poe</h6>
          <p style="line-height:1"><small>The person behind the news of Perl</small></p>
      </div>
        </a>
    </div>
  
    
    
    <div class="row">
        <a href="http://localhost:1313/article/a-tour-with-net-ftp/">
      <div class="col-sm-3">
        <div class="circle-avatar" style="background-image:url(/images/a-tour-with-net-ftp/thumb_kidyes.jpg)"></div>
      </div>
      <div class="col-sm-9">
          <h6>A tour with Net::FTP</h6>
          <p style="line-height:1"><small>How to write an FTP client in Perl</small></p>
      </div>
        </a>
    </div>
  
    
    
    <div class="row">
        <a href="http://localhost:1313/article/shortcode_test/">
      <div class="col-sm-3">
        <div class="circle-avatar" style="background-image:url(/images/author/brian-d-foy.jpg)"></div>
      </div>
      <div class="col-sm-9">
          <h6>shortcode_test</h6>
          <p style="line-height:1"><small></small></p>
      </div>
        </a>
    </div>
  
    
    
    <div class="row">
        <a href="http://localhost:1313/article/listen-to-larry-wall-s-state-of-the-onion-2000-on-youtube/">
      <div class="col-sm-3">
        <div class="circle-avatar" style="background-image:url(/images/listen-to-larry-wall-s-state-of-the-onion-2000-on-youtube/thumb_larry-wall.jpg)"></div>
      </div>
      <div class="col-sm-9">
          <h6>Listen to Larry Wall&#39;s State of the Onion 2000 on YouTube</h6>
          <p style="line-height:1"><small></small></p>
      </div>
        </a>
    </div>
  
    
    
    <div class="row">
        <a href="http://localhost:1313/article/announcing-perl-7/">
      <div class="col-sm-3">
        <div class="circle-avatar" style="background-image:url(/images/announcing-perl-7/thumb_seven_on_blue_wall.jpg)"></div>
      </div>
      <div class="col-sm-9">
          <h6>Announcing Perl 7</h6>
          <p style="line-height:1"><small>Perl 5 with modern defaults</small></p>
      </div>
        </a>
    </div>
  
</div>
<div class="row" style="margin-top:20px">
  <div class="col-sm-12 centering">
  <script async src="/widget/toplinks/toplinks.js" type="text/javascript"></script>
    <div id="toplinks"></div>
  </div>
</div>

<div class="row" style="margin-top:20px">
  <div class="col-sm-12 centering">
    <a class="twitter-timeline" data-height="640" data-dnt="true" data-theme="dark" href="https://twitter.com/perlfoundation?ref_src=twsrc%5Etfw">Tweets by perlfoundation</a> <script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>
  </div>
</div>

<div class="row" style="margin-top:20px">
  <div class="col-sm-12 centering">
    <script src="https://www.reddit.com/r/perl/hot/.embed?limit=10&t=all" type="text/javascript"></script>
  </div>
</div>



          </div>
        </div>
      </div>
    </section>
  </section>
<script>
 
var tables, i;
tables = document.getElementsByTagName('table');
for (i=0;i<tables.length;i++) {
  tables[i].className = 'table table-striped';
}
</script>
<div class="push"></div>
<div class="footer">
  <div class="container">
    <div class="row">
      <div class="col-md-1">
        <h5>Site Map</h5>
        <ul>
        <li><a href="/">Home</a></li>
        <hr>
        <li><a href="/about">About</a></li>
        <hr>
        <li><a href="/authors">Authors</a></li>
        <hr>
        <li><a href="/categories">Categories</a></li>
        <hr>
        <li><a href="/tags">Tags</a></li>
        <hr>
        </ul>
      </div>
      <div class="col-md-3">
        <h5>Contact Us</h5>
        <p>To get in touch, send an email to: perl.com-editor@perl.org</p>
        <p><a href="https://perl.org">
              <img src="/images/site/perl-onion_20.png" alt="Perl Onion"></a>
          <a href="https://twitter.com/intent/follow?screen_name=perlfoundation">
              <img src="/images/site/twitter_20.png" alt="twitter"></a>
          <a href="/index.xml" /><img src="/images/site/rss_20.png" alt="rss"></a>
          <a href="https://github.com/tpf/perldotcom">
              <img src="/images/site/github_light_20.png" alt="GitHub logo"></a></p>
      </div>
      <div class="col-md-2">
          <h5>License</h5>
          <p>This work is licensed under a <a rel="license" href="https://creativecommons.org/licenses/by-nc/3.0/">Creative Commons Attribution-NonCommercial 3.0 Unported License</a>.</p>
          <p><a rel="license" href="https://creativecommons.org/licenses/by-nc/3.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc/3.0/88x31.png" /></a></p>
      </div>
      <div class="col-md-5">
          <h5>Legal</h5>
          <p>Perl.com and the authors make no representations with respect to the accuracy or completeness of the contents of all work on this website and specifically disclaim all warranties, including without limitation warranties of fitness for a particular purpose. The information published on this website may not be suitable for every situation. All work on this website is provided with the understanding that Perl.com and the authors are not engaged in rendering professional services. Neither Perl.com nor the authors shall be liable for damages arising herefrom.</p>
      </div>
    </div>
  </div>
</div>
<script src="/javascript/jquery.min.js"></script>
<script src="/javascript/bootstrap.min.js"></script>
<script data-no-instant>document.write('<script src="/livereload.js?port=1313&mindelay=10"></' + 'script>')</script></body>
</html>

