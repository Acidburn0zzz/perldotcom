<!DOCTYPE html>
<html lang="en-us">
  <head>
  <title> How to test for exceptions in Perl </title>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Does your code blow up the way you expect it to?"/>
  <meta name="robots" content="index, follow">
  <meta name="google-site-verification" content="TZowffo_LX2mmsw2DbeNNbukCMnIOA8T-6CMJPiYllI" />

<meta property="twitter:card" content="summary">
<meta property="twitter:site" content="@PerlFoundation">
<meta property="og:url" content="http://localhost:1313/article/157/2015/3/5/How-to-test-for-exceptions-in-Perl/" />
<meta property="og:title" content="How to test for exceptions in Perl" />
<meta property="og:description" content="Does your code blow up the way you expect it to?">
<meta property="og:site_name" content="Perl.com" />

<meta property="og:type" content="article" />
<meta property="og:article:published_time" content="2015-03-03T03:03:03Z" />
<meta property="og:image" content="http://localhost:1313/images/157/thumb_95B8DF42-C33B-11E4-8714-11450EA848F6.jpeg" />
<meta property="og:article:tag" content="test_more" />
<meta property="og:article:tag" content="test" />
<meta property="og:article:tag" content="unit_test" />
<meta property="og:article:tag" content="test_exception" />
<meta property="og:article:tag" content="tap" />


  <link rel="icon" href="/favicon.ico">
  <link href="/article/index.xml" rel="alternate" type="application/rss+xml" title="Perl.com - programming news, code and culture" />
  <link href="/article/index.xml" rel="feed" type="application/rss+xml" title="Perl.com - programming news, code and culture" />
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" type="text/css" href="/css/perldotcom.css"/>


<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-50555-22', 'auto');
ga('create', 'UA-85734801-2', 'auto', 'editor');
ga('send', 'pageview');
ga('editor.send', 'pageview');
</script>

</head>
<body>

<div class="container-fluid full-wdith antonio">
 <div class="row">
  <div class="navbar-inverse" style="border-radius:none !important" role="navigation">
    <div class="container-fluid">
      <ul class="nav navbar-nav pull-right follow">
          <li>MORE:</li>
          <li><a href="https://perl.org">
              <img src="/images/site/perl-onion_20.png" alt="Perl Onion"></a><li>
          <li><a href="https://twitter.com/intent/follow?screen_name=perlfoundation">
              <img src="/images/site/twitter_20.png" alt="twitter"></a><li>
          <li><a href="/article/index.xml" />
              <img src="/images/site/rss_20.png" alt="rss"></a></li>
          <li><a href="https://github.com/tpf/perldotcom" />
              <img src="/images/site/github_light_20.png" alt="GitHub logo"></a></li>
      </ul>
      <div class="navbar-header">
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
          <a class="navbar-nav" href="/">
            <div class="header-logo">Perl.com</div>
          </a>
      </div>
      <div class="navbar-collapse collapse">
        <ul class="nav navbar-nav">
          <li><a href="/about">
              <div class="circle">
                <img src="/images/site/perl-camel.png" alt="" />
              </div>
                  &nbsp;&nbsp;ABOUT</a>
          </li>
          <li><a href="/authors">
              <div class="circle">
                  <span class="glyphicon glyphicon-user txt-blue-major" aria-hidden="true"></span>
              </div>
                  &nbsp;&nbsp;AUTHORS</a>
          </li>
          <li><a href="/categories">
              <div class="circle">
                  <span class="glyphicon glyphicon-folder-open txt-blue-major" aria-hidden="true"></span>
              </div>
                  &nbsp;&nbsp;CATEGORIES</a>
          </li>
          <li><a href="/tags">
              <div class="circle">
                <span class="txt-blue-major" aria-hidden="true"><strong>#</strong></span>
              </div>
                  &nbsp;&nbsp;TAGS</a>
          </li>
          <li>
            <form class="search" name="ddg" action="https://duckduckgo.com/" method="get">
              <input type="text" name ="q" placeholder="SEARCH" />
              <input type="hidden" value="perl.com" name="sites" />
            </form>
          </li>
        </ul>
      </div>
    </div>
  </div>
 </div>
</div>


  <section id="content" role="main">
    <section class="entry-content">
      <div class="container">
        <div class="row">
          <div class="col-md-9">
            <div class="row">
              <article class="fulltext">
              <h1 class="blog-post-title">How to test for exceptions in Perl</h1>
              <p class="blog-post-meta">Mar 5, 2015 by
              
              
                
                
                <a href="#author-bio-david-farrell">David Farrell</a>
              
              </p>
              <img alt="" src="/images/157/95B8DF42-C33B-11E4-8714-11450EA848F6.jpeg"/>
                

<p>Most Perl programmers are familiar with <a href="https://metacpan.org/pod/Test::More">Test::More</a>; it&rsquo;s the go-to library for writing unit tests in Perl. But Test::More doesn&rsquo;t provide functions for testing exceptions. For that you&rsquo;ll need <a href="https://metacpan.org/pod/Test::Exception">Test::Exception</a>. And good code throws exceptions - Paul Fenwick <a href="http://perltraining.com.au/tips/2008-08-20.html">once</a> summed this approach nicely:</p>

<pre><code>bIlujDI' yIchegh()Qo'; yIHegh()!

It is better to die() than to return() in failure.

    -- Klingon programming proverb.
</code></pre>

<p>The simplest way to throw an exception is with Perl&rsquo;s built-in <code>die</code> function. Just like Test::More makes it easy to test that subroutines return the right values, Test::Exception makes it easy to check the code is <em>dying</em> in the right way (and <a href="https://metacpan.org/pod/Test::Fatal">Test::Fatal</a> is a good alternative).</p>

<h3 id="did-my-code-die-ok">Did my code die ok?</h3>

<p>Let&rsquo;s say we&rsquo;re writing unit tests for the following package which exports the <code>double_integer</code> subroutine:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-perl" data-lang="perl"><span style="color:#66d9ef">package</span> Double;
<span style="color:#66d9ef">use</span> Exporter;
@ISA <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;Exporter&#39;</span>;
@EXPORT <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;double_integer&#39;</span>;

<span style="color:#66d9ef">sub</span> <span style="color:#a6e22e">double_integer</span>
{
  <span style="color:#66d9ef">my</span> ($number) <span style="color:#f92672">=</span> @_;
  die <span style="color:#e6db74">&#39;double_integer() requires a positive integer as an argument&#39;</span>
    <span style="color:#66d9ef">unless</span> defined $number <span style="color:#f92672">&amp;&amp;</span> $number <span style="color:#f92672">=~</span> <span style="color:#e6db74">/^\d+$/</span>;

  <span style="color:#66d9ef">return</span> $number <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span>;
}

<span style="color:#ae81ff">1</span>;</code></pre></div>
<p>This code will <code>die</code> unless the double_integer subroutine is called with a positive integer. I&rsquo;ll save this package as <code>Double.pm</code>. Let&rsquo;s write a test script for this package. Test::Exception exports the <code>dies_ok</code> function that checks the code dies as expected:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-perl" data-lang="perl"><span style="color:#66d9ef">use</span> Test::Exception tests <span style="color:#f92672">=&gt;</span> <span style="color:#ae81ff">1</span>;
<span style="color:#66d9ef">use</span> Double;

dies_ok { double_integer() } <span style="color:#e6db74">&#39;double_integer() dies with no number&#39;</span>;</code></pre></div>
<p><code>dies_ok</code> is clever, it won&rsquo;t actually let your code die and the program exit, as that would interrupt testing! Instead it catches any thrown exceptions so testing can continue. My program should also die if <code>double_integer</code> is called with a non-number as an argument. I can add more tests for some common scenarios:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-perl" data-lang="perl"><span style="color:#66d9ef">use</span> Test::Exception test <span style="color:#f92672">=&gt;</span> <span style="color:#ae81ff">6</span>;
<span style="color:#66d9ef">use</span> Double;

dies_ok { double_integer() } <span style="color:#e6db74">&#39;double_integer() dies with no number&#39;</span>;
dies_ok { double_integer(undef) } <span style="color:#e6db74">&#39;double_integer() dies with undef&#39;</span>;
dies_ok { double_integer(<span style="color:#e6db74">&#39;abc&#39;</span>) } <span style="color:#e6db74">&#39;double_integer() dies with text&#39;</span>;
dies_ok { double_integer(<span style="color:#e6db74">&#39;1 two&#39;</span>) } <span style="color:#e6db74">&#39;double_integer() dies with mixed&#39;</span>;
dies_ok { double_integer(<span style="color:#e6db74">&#39;-7&#39;</span>) } <span style="color:#e6db74">&#39;double_integer() dies with a negative&#39;</span>;
dies_ok { double_integer(<span style="color:#e6db74">&#39;2.5&#39;</span>) } <span style="color:#e6db74">&#39;double_integer() dies with a decimal&#39;</span>;</code></pre></div>
<p>I can also check the code throws the right exception with <code>throws_ok</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-perl" data-lang="perl"><span style="color:#66d9ef">use</span> Test::Exception tests <span style="color:#f92672">=&gt;</span> <span style="color:#ae81ff">1</span>;
<span style="color:#66d9ef">use</span> Double;

throws_ok { double_integer() } <span style="color:#e6db74">qr/requires a positive integer/</span>, 
  <span style="color:#e6db74">&#39;double_integer() requires a positive integer&#39;</span>;</code></pre></div>
<p>The <code>throws_ok</code> function checks that the code throws an exception, but also that the exception message matches a regex. This is useful if you have several different conditions that may throw different types of exceptions: imagine with a web application, you&rsquo;d want to throw a different exception code if the user requested a page they didn&rsquo;t have permission to access (403) versus requesting a non-existent page (404).</p>

<p>Test::Exception is fully compatible with Test::More so you can combine functions from both libraries in the same file:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-perl" data-lang="perl"><span style="color:#66d9ef">use</span> Test::More;
<span style="color:#66d9ef">use</span> Test::Exception;
<span style="color:#66d9ef">use</span> Double;

<span style="color:#75715e"># test arg validation works</span>
dies_ok { double_integer() } <span style="color:#e6db74">&#39;double_integer() dies with no number&#39;</span>;
dies_ok { double_integer(undef) } <span style="color:#e6db74">&#39;double_integer() dies with undef&#39;</span>;
dies_ok { double_integer(<span style="color:#e6db74">&#39;abc&#39;</span>) } <span style="color:#e6db74">&#39;double_integer() dies with text&#39;</span>;
dies_ok { double_integer(<span style="color:#e6db74">&#39;1 two&#39;</span>) } <span style="color:#e6db74">&#39;double_integer() dies with mixed&#39;</span>;
dies_ok { double_integer(<span style="color:#e6db74">&#39;-7&#39;</span>) } <span style="color:#e6db74">&#39;double_integer() dies with a negative&#39;</span>;
dies_ok { double_integer(<span style="color:#e6db74">&#39;2.5&#39;</span>) } <span style="color:#e6db74">&#39;double_integer() dies with a decimal&#39;</span>;

<span style="color:#75715e"># test exception message</span>
throws_ok { double_integer() } <span style="color:#e6db74">qr/requires a positive integer/</span>, 
  <span style="color:#e6db74">&#39;double_integer() requires a positive integer&#39;</span>;

<span style="color:#75715e"># test double_integer works</span>
lives_ok { double_integer(<span style="color:#ae81ff">1</span>) } <span style="color:#e6db74">&#39;calling double() with a number lives&#39;</span>;
is double_integer(<span style="color:#ae81ff">0</span>), <span style="color:#ae81ff">0</span>, <span style="color:#e6db74">&#39;zero doubled is zero&#39;</span>;
is double_integer(<span style="color:#ae81ff">2</span>), <span style="color:#ae81ff">4</span>, <span style="color:#e6db74">&#39;two doubled is four&#39;</span>;
is double_integer(<span style="color:#ae81ff">999</span>), <span style="color:#ae81ff">1998</span>, 
  <span style="color:#e6db74">&#39;nine nine nine doubled is one nine nine eight&#39;</span>;

done_testing();</code></pre></div>
<p>Now the test script checks both that the function throws the appropriate exception when the argument is wrong, and it returns the argument doubled when the argument is valid. If I save this test file as <code>Double.t</code> I can run the tests at the terminal:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-perl" data-lang="perl">$ perl Double<span style="color:#f92672">.</span>t
ok <span style="color:#ae81ff">1</span> <span style="color:#f92672">-</span> double_integer() dies with <span style="color:#66d9ef">no</span> number
ok <span style="color:#ae81ff">2</span> <span style="color:#f92672">-</span> double_integer() dies with undef
ok <span style="color:#ae81ff">3</span> <span style="color:#f92672">-</span> double_integer() dies with text
ok <span style="color:#ae81ff">4</span> <span style="color:#f92672">-</span> double_integer() dies with mixed
ok <span style="color:#ae81ff">5</span> <span style="color:#f92672">-</span> double_integer() dies with a negative
ok <span style="color:#ae81ff">6</span> <span style="color:#f92672">-</span> double_integer() dies with a decimal
ok <span style="color:#ae81ff">7</span> <span style="color:#f92672">-</span> double_integer() requires a positive integer
ok <span style="color:#ae81ff">8</span> <span style="color:#f92672">-</span> calling double() with a number lives
ok <span style="color:#ae81ff">9</span> <span style="color:#f92672">-</span> zero doubled is zero
ok <span style="color:#ae81ff">10</span> <span style="color:#f92672">-</span> two doubled is four
ok <span style="color:#ae81ff">11</span> <span style="color:#f92672">-</span> nine nine nine doubled is one nine nine eight
<span style="color:#ae81ff">1</span><span style="color:#f92672">..</span><span style="color:#ae81ff">11</span></code></pre></div>
<p>All the tests pass. <a href="https://metacpan.org/pod/Test::Exception">Test::Exception</a> has great documentation and is easy to use, so add exception testing to your code today!</p>

<p><strong>Updated:</strong> <em>Added Test::Fatal reference 2015-03-10</em></p>

<p><br />
<em>This article was originally posted on <a href="http://perltricks.com">PerlTricks.com</a>.</em></p>

              </article>
              <p><strong>Tags</strong></p>
              <div class="tags">
                <div class="category"><a href="/categories/testing">testing</a></div>
                
                  <div class="tag"><a href="/tags/test_more">test_more</a></div>
                
                  <div class="tag"><a href="/tags/test">test</a></div>
                
                  <div class="tag"><a href="/tags/unit_test">unit_test</a></div>
                
                  <div class="tag"><a href="/tags/test_exception">test_exception</a></div>
                
                  <div class="tag"><a href="/tags/tap">tap</a></div>
                
              </div>
            </div>
            
              
                
<div class="row" id="author-bio-david-farrell">
  <div class="col-sm-2">
    
    <a href="/authors/david-farrell/"><div class="circle-avatar" style="background-image:url(/images/author/david-farrell.jpg)"></div></a>
  </div>
  <div class="col-sm-10">
    <a href="/authors/david-farrell/"><h3>David Farrell</h3></a>
    <p>David is the editor of Perl.com. An organizer of the <a href="http://www.meetup.com/The-New-York-Perl-Meetup-Group/">New York Perl Meetup</a>, he works for ZipRecruiter as a software developer, and sometimes <a href="https://twitter.com/perltricks">tweets</a> about Perl and Open Source.</p>
    <h5><a href="/authors/david-farrell/">Browse their articles</a></h5>
  </div>
</div>

            
            <div class="row">
              <h3>Feedback</h3>
              <p>Something wrong with this article? Help us out by opening an issue or pull request on <a href="https://github.com/tpf/perldotcom/blob/master/content/article/how-to-test-for-exceptions-in-perl.md">GitHub</a></p>
            </div>
          </div>
          <div class="col-md-3">
            <div class="latest-sidebar">

  <div class="row">
    <div class="col-sm-12 centering">
      <span style="font-size:1.8em" class="antonio txt-blue-major">OUR LATEST ARTICLES</span>
    </div>
  </div>
  
    
    
    <div class="row">
        <a href="http://localhost:1313/article/the-perl-admbassador-curtis-poe/">
      <div class="col-sm-3">
        <div class="circle-avatar" style="background-image:url(/images/the-perl-ambassador-curtis-poe/curtis-poe.jpg)"></div>
      </div>
      <div class="col-sm-9">
          <h6>The Perl Ambassador: Curtis &#39;Ovid&#39; Poe</h6>
          <p style="line-height:1"><small>The person behind the news of Perl</small></p>
      </div>
        </a>
    </div>
  
    
    
    <div class="row">
        <a href="http://localhost:1313/article/a-tour-with-net-ftp/">
      <div class="col-sm-3">
        <div class="circle-avatar" style="background-image:url(/images/a-tour-with-net-ftp/thumb_kidyes.jpg)"></div>
      </div>
      <div class="col-sm-9">
          <h6>A tour with Net::FTP</h6>
          <p style="line-height:1"><small>How to write an FTP client in Perl</small></p>
      </div>
        </a>
    </div>
  
    
    
    <div class="row">
        <a href="http://localhost:1313/article/shortcode_test/">
      <div class="col-sm-3">
        <div class="circle-avatar" style="background-image:url(/images/author/brian-d-foy.jpg)"></div>
      </div>
      <div class="col-sm-9">
          <h6>shortcode_test</h6>
          <p style="line-height:1"><small></small></p>
      </div>
        </a>
    </div>
  
    
    
    <div class="row">
        <a href="http://localhost:1313/article/listen-to-larry-wall-s-state-of-the-onion-2000-on-youtube/">
      <div class="col-sm-3">
        <div class="circle-avatar" style="background-image:url(/images/listen-to-larry-wall-s-state-of-the-onion-2000-on-youtube/thumb_larry-wall.jpg)"></div>
      </div>
      <div class="col-sm-9">
          <h6>Listen to Larry Wall&#39;s State of the Onion 2000 on YouTube</h6>
          <p style="line-height:1"><small></small></p>
      </div>
        </a>
    </div>
  
    
    
    <div class="row">
        <a href="http://localhost:1313/article/announcing-perl-7/">
      <div class="col-sm-3">
        <div class="circle-avatar" style="background-image:url(/images/announcing-perl-7/thumb_seven_on_blue_wall.jpg)"></div>
      </div>
      <div class="col-sm-9">
          <h6>Announcing Perl 7</h6>
          <p style="line-height:1"><small>Perl 5 with modern defaults</small></p>
      </div>
        </a>
    </div>
  
</div>
<div class="row" style="margin-top:20px">
  <div class="col-sm-12 centering">
  <script async src="/widget/toplinks/toplinks.js" type="text/javascript"></script>
    <div id="toplinks"></div>
  </div>
</div>

<div class="row" style="margin-top:20px">
  <div class="col-sm-12 centering">
    <a class="twitter-timeline" data-height="640" data-dnt="true" data-theme="dark" href="https://twitter.com/perlfoundation?ref_src=twsrc%5Etfw">Tweets by perlfoundation</a> <script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>
  </div>
</div>

<div class="row" style="margin-top:20px">
  <div class="col-sm-12 centering">
    <script src="https://www.reddit.com/r/perl/hot/.embed?limit=10&t=all" type="text/javascript"></script>
  </div>
</div>



          </div>
        </div>
      </div>
    </section>
  </section>
<script>
 
var tables, i;
tables = document.getElementsByTagName('table');
for (i=0;i<tables.length;i++) {
  tables[i].className = 'table table-striped';
}
</script>
<div class="push"></div>
<div class="footer">
  <div class="container">
    <div class="row">
      <div class="col-md-1">
        <h5>Site Map</h5>
        <ul>
        <li><a href="/">Home</a></li>
        <hr>
        <li><a href="/about">About</a></li>
        <hr>
        <li><a href="/authors">Authors</a></li>
        <hr>
        <li><a href="/categories">Categories</a></li>
        <hr>
        <li><a href="/tags">Tags</a></li>
        <hr>
        </ul>
      </div>
      <div class="col-md-3">
        <h5>Contact Us</h5>
        <p>To get in touch, send an email to: perl.com-editor@perl.org</p>
        <p><a href="https://perl.org">
              <img src="/images/site/perl-onion_20.png" alt="Perl Onion"></a>
          <a href="https://twitter.com/intent/follow?screen_name=perlfoundation">
              <img src="/images/site/twitter_20.png" alt="twitter"></a>
          <a href="/index.xml" /><img src="/images/site/rss_20.png" alt="rss"></a>
          <a href="https://github.com/tpf/perldotcom">
              <img src="/images/site/github_light_20.png" alt="GitHub logo"></a></p>
      </div>
      <div class="col-md-2">
          <h5>License</h5>
          <p>This work is licensed under a <a rel="license" href="https://creativecommons.org/licenses/by-nc/3.0/">Creative Commons Attribution-NonCommercial 3.0 Unported License</a>.</p>
          <p><a rel="license" href="https://creativecommons.org/licenses/by-nc/3.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc/3.0/88x31.png" /></a></p>
      </div>
      <div class="col-md-5">
          <h5>Legal</h5>
          <p>Perl.com and the authors make no representations with respect to the accuracy or completeness of the contents of all work on this website and specifically disclaim all warranties, including without limitation warranties of fitness for a particular purpose. The information published on this website may not be suitable for every situation. All work on this website is provided with the understanding that Perl.com and the authors are not engaged in rendering professional services. Neither Perl.com nor the authors shall be liable for damages arising herefrom.</p>
      </div>
    </div>
  </div>
</div>
<script src="/javascript/jquery.min.js"></script>
<script src="/javascript/bootstrap.min.js"></script>
<script data-no-instant>document.write('<script src="/livereload.js?port=1313&mindelay=10"></' + 'script>')</script></body>
</html>

