<!DOCTYPE html>
<html lang="en-us">
  <head>
  <title> Save space with bit arrays </title>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="An old school data structure that efficiently stores data"/>
  <meta name="robots" content="index, follow">
  <meta name="google-site-verification" content="TZowffo_LX2mmsw2DbeNNbukCMnIOA8T-6CMJPiYllI" />

<meta property="twitter:card" content="summary">
<meta property="twitter:site" content="@PerlFoundation">
<meta property="og:url" content="http://localhost:1313/article/save-space-with-bit-arrays/" />
<meta property="og:title" content="Save space with bit arrays" />
<meta property="og:description" content="An old school data structure that efficiently stores data">
<meta property="og:site_name" content="Perl.com" />

<meta property="og:type" content="article" />
<meta property="og:article:published_time" content="2016-08-08T08:08:08Z" />
<meta property="og:image" content="http://localhost:1313/images/save-space-with-bit-arrays/thumb_binary-msg.png" />
<meta property="og:article:tag" content="bit-array" />
<meta property="og:article:tag" content="bitwise" />
<meta property="og:article:tag" content="binary" />
<meta property="og:article:tag" content="boolean" />
<meta property="og:article:tag" content="bigint" />
<meta property="og:article:tag" content="integer" />


  <link rel="icon" href="/favicon.ico">
  <link href="/article/index.xml" rel="alternate" type="application/rss+xml" title="Perl.com - programming news, code and culture" />
  <link href="/article/index.xml" rel="feed" type="application/rss+xml" title="Perl.com - programming news, code and culture" />
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" type="text/css" href="/css/perldotcom.css"/>


<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-50555-22', 'auto');
ga('create', 'UA-85734801-2', 'auto', 'editor');
ga('send', 'pageview');
ga('editor.send', 'pageview');
</script>

</head>
<body>

<div class="container-fluid full-wdith antonio">
 <div class="row">
  <div class="navbar-inverse" style="border-radius:none !important" role="navigation">
    <div class="container-fluid">
      <ul class="nav navbar-nav pull-right follow">
          <li>MORE:</li>
          <li><a href="https://perl.org">
              <img src="/images/site/perl-onion_20.png" alt="Perl Onion"></a><li>
          <li><a href="https://twitter.com/intent/follow?screen_name=perlfoundation">
              <img src="/images/site/twitter_20.png" alt="twitter"></a><li>
          <li><a href="/article/index.xml" />
              <img src="/images/site/rss_20.png" alt="rss"></a></li>
          <li><a href="https://github.com/tpf/perldotcom" />
              <img src="/images/site/github_light_20.png" alt="GitHub logo"></a></li>
      </ul>
      <div class="navbar-header">
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
          <a class="navbar-nav" href="/">
            <div class="header-logo">Perl.com</div>
          </a>
      </div>
      <div class="navbar-collapse collapse">
        <ul class="nav navbar-nav">
          <li><a href="/about">
              <div class="circle">
                <img src="/images/site/perl-camel.png" alt="" />
              </div>
                  &nbsp;&nbsp;ABOUT</a>
          </li>
          <li><a href="/authors">
              <div class="circle">
                  <span class="glyphicon glyphicon-user txt-blue-major" aria-hidden="true"></span>
              </div>
                  &nbsp;&nbsp;AUTHORS</a>
          </li>
          <li><a href="/categories">
              <div class="circle">
                  <span class="glyphicon glyphicon-folder-open txt-blue-major" aria-hidden="true"></span>
              </div>
                  &nbsp;&nbsp;CATEGORIES</a>
          </li>
          <li><a href="/tags">
              <div class="circle">
                <span class="txt-blue-major" aria-hidden="true"><strong>#</strong></span>
              </div>
                  &nbsp;&nbsp;TAGS</a>
          </li>
          <li>
            <form class="search" name="ddg" action="https://duckduckgo.com/" method="get">
              <input type="text" name ="q" placeholder="SEARCH" />
              <input type="hidden" value="perl.com" name="sites" />
            </form>
          </li>
        </ul>
      </div>
    </div>
  </div>
 </div>
</div>


  <section id="content" role="main">
    <section class="entry-content">
      <div class="container">
        <div class="row">
          <div class="col-md-9">
            <div class="row">
              <article class="fulltext">
              <h1 class="blog-post-title">Save space with bit arrays</h1>
              <p class="blog-post-meta">Aug 23, 2016 by
              
              
                
                
                <a href="#author-bio-david-farrell">David Farrell</a>
              
              </p>
              <img alt="" src="/images/save-space-with-bit-arrays/binary-msg.png"/>
                

<p>&ldquo;Big data&rdquo; is an overused term, but when you&rsquo;re actually working with big data, every bit can count. Shaving several bits from data structure used billions of times can save a lot of space. A few months ago I was working on a job distribution system; it would send millions of jobs out every day. We wanted to capture every decision made by the system, so that a user could later query the system to understand <em>why</em> a job had or hadn&rsquo;t been sent to a partner.</p>

<p>The problem was that the system was making billions of decisions a day, so we needed a way to pack those decisions as efficiently as possible. A colleague of mine had the bright idea to use a <a href="https://en.wikipedia.org/wiki/Bit_array">bit array</a>, and it worked very well - we were able to compress the data by a factor of 18 or more. If you&rsquo;re not familiar with bit arrays, or a little rusty on the code, keep reading and I&rsquo;ll show you how to use them with Perl.</p>

<h3 id="bit-array-basics">Bit array basics</h3>

<p>Bit arrays are a way of storing multiple booleans in single number. Consider the number 0 as a byte/octet represented as bits:</p>

<pre><code>00000000
</code></pre>

<p>Instead of treating it like a number, using <a href="https://en.wikipedia.org/wiki/Bitwise_operation">bitwise operators</a> we can treat each bit as a separate column. As this is an 8 bit number, we can store up to 8 booleans in it:</p>

<pre><code>0|0|0|0|0|0|0|0
</code></pre>

<p>To store a boolean in the first bit of the array, we can use bitwise or equals (<code>|=</code>). Here&rsquo;s how that looks in C pseudocode:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-perl" data-lang="perl">short bit_array <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
bit_array <span style="color:#f92672">|=</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">6</span>;</code></pre></div>
<p>Let&rsquo;s take this one step at a time. First I initialize an 8 bit integer called <code>bit_array</code>. Next, I create a binary number with the bit set that I wish to set in <code>bit_array</code>. I do this with the left bitshift code <code>1 &lt;&lt; 6</code>. This means, &ldquo;shift the bits in the number on the left, 6 places to the left&rdquo;, which does this:</p>

<pre><code>00000001 &lt;&lt; 6;
01000000
</code></pre>

<p>This is called a bitmask. Next I use or equals to update <code>bit_array</code> with the bitmask <code>01000000</code>. Bitwise or (<code>|</code>) works by setting any bit to 1 in its left operand that is set to 1 in its right operand. Adding a equals sign on the end simply assigns the resulting value to <code>bit_array</code>.</p>

<p>If we wanted to store a boolean in the fourth bit, we&rsquo;d do this:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-perl" data-lang="perl">bit_array <span style="color:#f92672">|=</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">3</span>;</code></pre></div>
<p>So now the <code>bit_array</code> looks like this:</p>

<pre><code>01001000
</code></pre>

<p>To test if a particular bit is set, I can use bitwise and (<code>&amp;</code>):</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-perl" data-lang="perl"><span style="color:#66d9ef">if</span> (bit_array <span style="color:#f92672">&amp;</span> (<span style="color:#ae81ff">1</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">6</span>)) {
  <span style="color:#e6db74">/* the seventh column is true */</span>
}</code></pre></div>
<p>Bitwise and returns a number with every bit set to 0 in its left operand which is 0 in its right operand. So the code <code>1 &lt;&lt; 6</code> bitshifts a number that only has one particular bit set to 1 (<code>01000000</code>). This is the bitmask. If the bit array has that bit set to 1, it will return non-zero (true), else it returns zero (false).</p>

<h3 id="bit-arrays-in-perl">Bit arrays in Perl</h3>

<p>I&rsquo;m going to use a contrived example to show how bit arrays work in Perl. Imagine we&rsquo;re working on an ordering system at a pizza restaurant. We need to store all the toppings required for the pizza. In Perl we store numbers in scalars, which are usually 32 or 64 bits long; that&rsquo;s a lot of toppings we can pack into a single number!</p>

<p>Here is the class:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-perl" data-lang="perl"><span style="color:#66d9ef">package</span> Pizza::Order;
<span style="color:#66d9ef">use</span> utf8;

<span style="color:#66d9ef">my</span> %toppings <span style="color:#f92672">=</span> (
  tomato        <span style="color:#f92672">=&gt;</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">0</span>,
  cheese        <span style="color:#f92672">=&gt;</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">1</span>,
  onion         <span style="color:#f92672">=&gt;</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">2</span>,
  sausage       <span style="color:#f92672">=&gt;</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">3</span>,
  pepperoni     <span style="color:#f92672">=&gt;</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">4</span>,
  ham           <span style="color:#f92672">=&gt;</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">5</span>,
  chicken       <span style="color:#f92672">=&gt;</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">6</span>,
  bbq_chicken   <span style="color:#f92672">=&gt;</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">7</span>,
  olives        <span style="color:#f92672">=&gt;</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">8</span>,
  vegetables    <span style="color:#f92672">=&gt;</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">9</span>,
  jalapeńo      <span style="color:#f92672">=&gt;</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">10</span>,
  ranch         <span style="color:#f92672">=&gt;</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">11</span>,
  eggplant      <span style="color:#f92672">=&gt;</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">12</span>,
  garlic        <span style="color:#f92672">=&gt;</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">13</span>,
);

<span style="color:#66d9ef">sub</span> <span style="color:#a6e22e">new</span> {
  <span style="color:#66d9ef">my</span> $class <span style="color:#f92672">=</span> shift;
  <span style="color:#66d9ef">my</span> $self <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
  <span style="color:#66d9ef">return</span> bless <span style="color:#f92672">\</span>$self, $class;
}

<span style="color:#66d9ef">sub</span> <span style="color:#a6e22e">print_state</span> {
  <span style="color:#66d9ef">my</span> $self <span style="color:#f92672">=</span> shift;
  printf <span style="color:#e6db74">&#34;%014b\n&#34;</span>, $$self;
}

<span style="color:#66d9ef">sub</span> <span style="color:#a6e22e">available_toppings</span> {
  <span style="color:#66d9ef">return</span> keys %toppings;
}

<span style="color:#66d9ef">sub</span> <span style="color:#a6e22e">add_topping</span> {
  <span style="color:#66d9ef">my</span> ($self, $topping) <span style="color:#f92672">=</span> @_;
  <span style="color:#75715e"># bitwise OR equals to set a bit field</span>
  <span style="color:#66d9ef">return</span> $$self <span style="color:#f92672">|=</span> $toppings{ $topping };
}

<span style="color:#66d9ef">sub</span> <span style="color:#a6e22e">remove_topping</span> {
  <span style="color:#66d9ef">my</span> ($self, $topping) <span style="color:#f92672">=</span> @_;
  <span style="color:#75715e"># bitwise NOT to invert a field and bitwise AND equals to unset it</span>
  <span style="color:#66d9ef">return</span> $$self <span style="color:#f92672">&amp;=</span> <span style="color:#f92672">~</span>$toppings{ $topping };
}

<span style="color:#66d9ef">sub</span> <span style="color:#a6e22e">get_toppings</span> {
  <span style="color:#66d9ef">my</span> $self <span style="color:#f92672">=</span> shift;
  <span style="color:#66d9ef">my</span> @ordered_toppings <span style="color:#f92672">=</span> ();
  <span style="color:#66d9ef">for</span> <span style="color:#66d9ef">my</span> $topping (keys %toppings) {
    push @ordered_toppings, $topping
      <span style="color:#75715e"># bitwise AND to test if this bit is set</span>
      <span style="color:#66d9ef">if</span> $$self <span style="color:#f92672">&amp;</span> $toppings{ $topping };
  }
  <span style="color:#66d9ef">return</span> @ordered_toppings;
}
<span style="color:#ae81ff">1</span>;</code></pre></div>
<p>I create a class called <code>Pizza::Order</code>. The <code>%toppings</code> hash stores names of pizza toppings and their associated bitmask. I could only think of 14 toppings, leaving 18 spare slots for the future (if we want to stick to 32 bit integers). The <code>new</code> subroutine is a constructor which creates a blessed scalar as the <code>Pizza::Order</code> object.</p>

<p>The <code>print_state</code> method uses <a href="https://perldoc.perl.org/functions/printf.html">printf</a> to print the Pizza::Order object state as a binary number. This is a really useful feature of <code>printf</code> which many other languages don&rsquo;t have (C &amp; Python for example). Both <code>add_topping</code> and <code>get_toppings</code> use the techniques described earlier to set and check for set bits.</p>

<p>More interesting perhaps, is the <code>remove_topping</code> method. This uses bitwise not (<code>~</code>) to invert a bitmask and then bitwise and (<code>&amp;</code>) equals to unset it. Pretty nifty, huh? Here&rsquo;s a quick script to test it:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-perl" data-lang="perl"><span style="color:#75715e">#!/usr/bin/perl</span>
<span style="color:#66d9ef">use</span> Pizza::Order;

<span style="color:#66d9ef">my</span> $order <span style="color:#f92672">=</span> Pizza::Order<span style="color:#f92672">-&gt;</span><span style="color:#66d9ef">new</span>();
$order<span style="color:#f92672">-&gt;</span>add_topping(<span style="color:#e6db74">&#39;cheese&#39;</span>);
$order<span style="color:#f92672">-&gt;</span>add_topping(<span style="color:#e6db74">&#39;eggplant&#39;</span>);
$order<span style="color:#f92672">-&gt;</span>remove_topping(<span style="color:#e6db74">&#39;cheese&#39;</span>);
$order<span style="color:#f92672">-&gt;</span>add_topping(<span style="color:#e6db74">&#39;tomato&#39;</span>);
$order<span style="color:#f92672">-&gt;</span>print_state();
<span style="color:#66d9ef">print</span> <span style="color:#e6db74">&#34;$_\n&#34;</span> <span style="color:#66d9ef">for</span> $order<span style="color:#f92672">-&gt;</span>get_toppings();</code></pre></div>
<p>This prints:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-perl" data-lang="perl"><span style="color:#ae81ff">01000000000001</span>
eggplant
tomato</code></pre></div>
<p>The first line is the current state of the <code>$order</code> object. It shows the first, and second-to-last bits set, which correspond to the tomato and eggplant bitmasks. It then prints out those toppings. Yay, it works!</p>

<h3 id="bit-array-limitations">Bit array limitations</h3>

<p>One thing to watch out for when storing bit arrays on disk is code change. Imagine if I had several years&rsquo; worth of pizza orders saved in a database. Then one day, we stopped offering bbq chicken. It would be tempting to update the toppings hash like this:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-perl" data-lang="perl"><span style="color:#66d9ef">my</span> %toppings <span style="color:#f92672">=</span> (
  tomato        <span style="color:#f92672">=&gt;</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">0</span>,
  cheese        <span style="color:#f92672">=&gt;</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">1</span>,
  onion         <span style="color:#f92672">=&gt;</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">2</span>,
  sausage       <span style="color:#f92672">=&gt;</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">3</span>,
  pepperoni     <span style="color:#f92672">=&gt;</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">4</span>,
  ham           <span style="color:#f92672">=&gt;</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">5</span>,
  chicken       <span style="color:#f92672">=&gt;</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">6</span>,
  olives        <span style="color:#f92672">=&gt;</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">7</span>, <span style="color:#75715e"># deleted bbq_chicken</span>
  vegetables    <span style="color:#f92672">=&gt;</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">8</span>,
  jalapeńo      <span style="color:#f92672">=&gt;</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">9</span>,
  ranch         <span style="color:#f92672">=&gt;</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">10</span>,
  eggplant      <span style="color:#f92672">=&gt;</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">11</span>,
  garlic        <span style="color:#f92672">=&gt;</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">12</span>,
);</code></pre></div>
<p>I deleted the <code>bbq_chicken</code> entry and bumped up the remaining toppings bitmasks. The problem is compatibility: in all the historical pizza orders, <code>olives</code> (for example) had a bitmask of <code>00000010000000</code> but in the new code, its bitmask is one lower. So if I tried to load a historical order with this class, the toppings data would be wrong. One way to handle this is remove, but not reuse, the bitmask for the deleted entry.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-perl" data-lang="perl"><span style="color:#66d9ef">my</span> %toppings <span style="color:#f92672">=</span> (
  tomato        <span style="color:#f92672">=&gt;</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">0</span>,
  cheese        <span style="color:#f92672">=&gt;</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">1</span>,
  onion         <span style="color:#f92672">=&gt;</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">2</span>,
  sausage       <span style="color:#f92672">=&gt;</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">3</span>,
  pepperoni     <span style="color:#f92672">=&gt;</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">4</span>,
  ham           <span style="color:#f92672">=&gt;</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">5</span>,
  chicken       <span style="color:#f92672">=&gt;</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">6</span>,
  <span style="color:#75715e"># reserved</span>
  olives        <span style="color:#f92672">=&gt;</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">8</span>,
  vegetables    <span style="color:#f92672">=&gt;</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">9</span>,
  jalapeńo      <span style="color:#f92672">=&gt;</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">10</span>,
  ranch         <span style="color:#f92672">=&gt;</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">11</span>,
  eggplant      <span style="color:#f92672">=&gt;</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">12</span>,
  garlic        <span style="color:#f92672">=&gt;</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">13</span>,
);</code></pre></div>
<p>This limitation makes bitmasks less useful for long-term storage of data, unless the existing bitmasks are unlikely to change. Note that it&rsquo;s fine to add additional toppings and bitmasks, it&rsquo;s just re-using existing bitmasks that causes issues.</p>

<p>Another thing to consider is upper limits (update - see <a href="http://perltricks.com/article/using-bitmasks-with-large-integers/">using bit arrays with large integers</a>). If you want your Perl code to be compatible with 32 bit and 64 bit Perls, you should probably stick to a maximum of 32 bitmasks (using a module like <a href="https://metacpan.org/pod/bigint">bigint</a> may <em>not</em> work because of addressable memory limitations). You can see the settings your Perl has been compiled with by typing <code>perl -V | grep longsize</code> at the command line. The longsize value is the number of bytes your Perl can store in an integer natively.</p>

<p>Finally, in order to get the data back out of a bit array it needs to be tested with all the available bitmasks. Consider the <code>get_toppings</code> method in <code>Pizza::Order</code>. To find out what toppings are set, the code has to check every topping&rsquo;s bitmask. This is pretty inefficient. So bitmasks are good for compact data storage, but not fast access.</p>

<h3 id="references">References</h3>

<ul>
<li>Wikipedia has useful entries on <a href="https://en.wikipedia.org/wiki/Bit_array">bit arrays</a> and <a href="https://en.wikipedia.org/wiki/Bitwise_operation">bitwise operators</a></li>
<li>Perl&rsquo;s official <a href="https://perldoc.perl.org/perlop.html">operator documentation</a> covers the bitwise operators. You can read it in the terminal with the command <code>perldoc perlop</code></li>
<li>Use Perl&rsquo;s builtin functions <a href="https://perldoc.perl.org/functions/sprintf.html">sprintf</a> (<code>perldoc -f sprintf</code>) and <a href="https://perldoc.perl.org/functions/printf.html">printf</a> (<code>perldoc -f printf</code>) to inspect binary values</li>
<li>Stringifying / printing numbers as binary isn&rsquo;t the only nice binary feature Perl has over other languages. Another is the ability to write binary numbers inline, just like octal and hexadecimal numbers, for example: <code>0b00001000</code>. This is great for comparing binary numbers</li>
<li><a href="https://metacpan.org/pod/bigint">bigint</a> is one of several modules on CPAN for working with large integers, see <a href="http://perltricks.com/article/using-bitmasks-with-large-integers/">using bit arrays with large integers</a></li>
</ul>

<p><br />
<em>This article was originally posted on <a href="http://perltricks.com">PerlTricks.com</a>.</em></p>

              </article>
              <p><strong>Tags</strong></p>
              <div class="tags">
                <div class="category"><a href="/categories/data">data</a></div>
                
                  <div class="tag"><a href="/tags/bit-array">bit-array</a></div>
                
                  <div class="tag"><a href="/tags/bitwise">bitwise</a></div>
                
                  <div class="tag"><a href="/tags/binary">binary</a></div>
                
                  <div class="tag"><a href="/tags/boolean">boolean</a></div>
                
                  <div class="tag"><a href="/tags/bigint">bigint</a></div>
                
                  <div class="tag"><a href="/tags/integer">integer</a></div>
                
              </div>
            </div>
            
              
                
<div class="row" id="author-bio-david-farrell">
  <div class="col-sm-2">
    
    <a href="/authors/david-farrell/"><div class="circle-avatar" style="background-image:url(/images/author/david-farrell.jpg)"></div></a>
  </div>
  <div class="col-sm-10">
    <a href="/authors/david-farrell/"><h3>David Farrell</h3></a>
    <p>David is the editor of Perl.com. An organizer of the <a href="http://www.meetup.com/The-New-York-Perl-Meetup-Group/">New York Perl Meetup</a>, he works for ZipRecruiter as a software developer, and sometimes <a href="https://twitter.com/perltricks">tweets</a> about Perl and Open Source.</p>
    <h5><a href="/authors/david-farrell/">Browse their articles</a></h5>
  </div>
</div>

            
            <div class="row">
              <h3>Feedback</h3>
              <p>Something wrong with this article? Help us out by opening an issue or pull request on <a href="https://github.com/tpf/perldotcom/blob/master/content/article/save-space-with-bit-arrays.md">GitHub</a></p>
            </div>
          </div>
          <div class="col-md-3">
            <div class="latest-sidebar">

  <div class="row">
    <div class="col-sm-12 centering">
      <span style="font-size:1.8em" class="antonio txt-blue-major">OUR LATEST ARTICLES</span>
    </div>
  </div>
  
    
    
    <div class="row">
        <a href="http://localhost:1313/article/the-perl-admbassador-curtis-poe/">
      <div class="col-sm-3">
        <div class="circle-avatar" style="background-image:url(/images/the-perl-ambassador-curtis-poe/curtis-poe.jpg)"></div>
      </div>
      <div class="col-sm-9">
          <h6>The Perl Ambassador: Curtis &#39;Ovid&#39; Poe</h6>
          <p style="line-height:1"><small>The person behind the news of Perl</small></p>
      </div>
        </a>
    </div>
  
    
    
    <div class="row">
        <a href="http://localhost:1313/article/a-tour-with-net-ftp/">
      <div class="col-sm-3">
        <div class="circle-avatar" style="background-image:url(/images/a-tour-with-net-ftp/thumb_kidyes.jpg)"></div>
      </div>
      <div class="col-sm-9">
          <h6>A tour with Net::FTP</h6>
          <p style="line-height:1"><small>How to write an FTP client in Perl</small></p>
      </div>
        </a>
    </div>
  
    
    
    <div class="row">
        <a href="http://localhost:1313/article/shortcode_test/">
      <div class="col-sm-3">
        <div class="circle-avatar" style="background-image:url(/images/author/brian-d-foy.jpg)"></div>
      </div>
      <div class="col-sm-9">
          <h6>shortcode_test</h6>
          <p style="line-height:1"><small></small></p>
      </div>
        </a>
    </div>
  
    
    
    <div class="row">
        <a href="http://localhost:1313/article/listen-to-larry-wall-s-state-of-the-onion-2000-on-youtube/">
      <div class="col-sm-3">
        <div class="circle-avatar" style="background-image:url(/images/listen-to-larry-wall-s-state-of-the-onion-2000-on-youtube/thumb_larry-wall.jpg)"></div>
      </div>
      <div class="col-sm-9">
          <h6>Listen to Larry Wall&#39;s State of the Onion 2000 on YouTube</h6>
          <p style="line-height:1"><small></small></p>
      </div>
        </a>
    </div>
  
    
    
    <div class="row">
        <a href="http://localhost:1313/article/announcing-perl-7/">
      <div class="col-sm-3">
        <div class="circle-avatar" style="background-image:url(/images/announcing-perl-7/thumb_seven_on_blue_wall.jpg)"></div>
      </div>
      <div class="col-sm-9">
          <h6>Announcing Perl 7</h6>
          <p style="line-height:1"><small>Perl 5 with modern defaults</small></p>
      </div>
        </a>
    </div>
  
</div>
<div class="row" style="margin-top:20px">
  <div class="col-sm-12 centering">
  <script async src="/widget/toplinks/toplinks.js" type="text/javascript"></script>
    <div id="toplinks"></div>
  </div>
</div>

<div class="row" style="margin-top:20px">
  <div class="col-sm-12 centering">
    <a class="twitter-timeline" data-height="640" data-dnt="true" data-theme="dark" href="https://twitter.com/perlfoundation?ref_src=twsrc%5Etfw">Tweets by perlfoundation</a> <script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>
  </div>
</div>

<div class="row" style="margin-top:20px">
  <div class="col-sm-12 centering">
    <script src="https://www.reddit.com/r/perl/hot/.embed?limit=10&t=all" type="text/javascript"></script>
  </div>
</div>



          </div>
        </div>
      </div>
    </section>
  </section>
<script>
 
var tables, i;
tables = document.getElementsByTagName('table');
for (i=0;i<tables.length;i++) {
  tables[i].className = 'table table-striped';
}
</script>
<div class="push"></div>
<div class="footer">
  <div class="container">
    <div class="row">
      <div class="col-md-1">
        <h5>Site Map</h5>
        <ul>
        <li><a href="/">Home</a></li>
        <hr>
        <li><a href="/about">About</a></li>
        <hr>
        <li><a href="/authors">Authors</a></li>
        <hr>
        <li><a href="/categories">Categories</a></li>
        <hr>
        <li><a href="/tags">Tags</a></li>
        <hr>
        </ul>
      </div>
      <div class="col-md-3">
        <h5>Contact Us</h5>
        <p>To get in touch, send an email to: perl.com-editor@perl.org</p>
        <p><a href="https://perl.org">
              <img src="/images/site/perl-onion_20.png" alt="Perl Onion"></a>
          <a href="https://twitter.com/intent/follow?screen_name=perlfoundation">
              <img src="/images/site/twitter_20.png" alt="twitter"></a>
          <a href="/index.xml" /><img src="/images/site/rss_20.png" alt="rss"></a>
          <a href="https://github.com/tpf/perldotcom">
              <img src="/images/site/github_light_20.png" alt="GitHub logo"></a></p>
      </div>
      <div class="col-md-2">
          <h5>License</h5>
          <p>This work is licensed under a <a rel="license" href="https://creativecommons.org/licenses/by-nc/3.0/">Creative Commons Attribution-NonCommercial 3.0 Unported License</a>.</p>
          <p><a rel="license" href="https://creativecommons.org/licenses/by-nc/3.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc/3.0/88x31.png" /></a></p>
      </div>
      <div class="col-md-5">
          <h5>Legal</h5>
          <p>Perl.com and the authors make no representations with respect to the accuracy or completeness of the contents of all work on this website and specifically disclaim all warranties, including without limitation warranties of fitness for a particular purpose. The information published on this website may not be suitable for every situation. All work on this website is provided with the understanding that Perl.com and the authors are not engaged in rendering professional services. Neither Perl.com nor the authors shall be liable for damages arising herefrom.</p>
      </div>
    </div>
  </div>
</div>
<script src="/javascript/jquery.min.js"></script>
<script src="/javascript/bootstrap.min.js"></script>
<script data-no-instant>document.write('<script src="/livereload.js?port=1313&mindelay=10"></' + 'script>')</script></body>
</html>

