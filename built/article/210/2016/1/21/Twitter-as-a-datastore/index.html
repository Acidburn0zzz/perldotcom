<!DOCTYPE html>
<html lang="en-us">
  <head>
  <title> Twitter as a datastore </title>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Using social media platforms for computing applications"/>
  <meta name="robots" content="index, follow">
  <meta name="google-site-verification" content="TZowffo_LX2mmsw2DbeNNbukCMnIOA8T-6CMJPiYllI" />

<meta property="twitter:card" content="summary">
<meta property="twitter:site" content="@PerlFoundation">
<meta property="og:url" content="http://localhost:1313/article/210/2016/1/21/Twitter-as-a-datastore/" />
<meta property="og:title" content="Twitter as a datastore" />
<meta property="og:description" content="Using social media platforms for computing applications">
<meta property="og:site_name" content="Perl.com" />

<meta property="og:type" content="article" />
<meta property="og:article:published_time" content="2016-01-01T01:01:01Z" />
<meta property="og:image" content="http://localhost:1313/images/210/thumb_B6ABE53E-C045-11E5-B2C3-641B7A54B0AF.png" />
<meta property="og:article:tag" content="math" />
<meta property="og:article:tag" content="social_media" />
<meta property="og:article:tag" content="net_twitter" />


  <link rel="icon" href="/favicon.ico">
  <link href="/article/index.xml" rel="alternate" type="application/rss+xml" title="Perl.com - programming news, code and culture" />
  <link href="/article/index.xml" rel="feed" type="application/rss+xml" title="Perl.com - programming news, code and culture" />
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" type="text/css" href="/css/perldotcom.css"/>


<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-50555-22', 'auto');
ga('create', 'UA-85734801-2', 'auto', 'editor');
ga('send', 'pageview');
ga('editor.send', 'pageview');
</script>

</head>
<body>

<div class="container-fluid full-wdith antonio">
 <div class="row">
  <div class="navbar-inverse" style="border-radius:none !important" role="navigation">
    <div class="container-fluid">
      <ul class="nav navbar-nav pull-right follow">
          <li>MORE:</li>
          <li><a href="https://perl.org">
              <img src="/images/site/perl-onion_20.png" alt="Perl Onion"></a><li>
          <li><a href="https://twitter.com/intent/follow?screen_name=perlfoundation">
              <img src="/images/site/twitter_20.png" alt="twitter"></a><li>
          <li><a href="/article/index.xml" />
              <img src="/images/site/rss_20.png" alt="rss"></a></li>
          <li><a href="https://github.com/tpf/perldotcom" />
              <img src="/images/site/github_light_20.png" alt="GitHub logo"></a></li>
      </ul>
      <div class="navbar-header">
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
          <a class="navbar-nav" href="/">
            <div class="header-logo">Perl.com</div>
          </a>
      </div>
      <div class="navbar-collapse collapse">
        <ul class="nav navbar-nav">
          <li><a href="/about">
              <div class="circle">
                <img src="/images/site/perl-camel.png" alt="" />
              </div>
                  &nbsp;&nbsp;ABOUT</a>
          </li>
          <li><a href="/authors">
              <div class="circle">
                  <span class="glyphicon glyphicon-user txt-blue-major" aria-hidden="true"></span>
              </div>
                  &nbsp;&nbsp;AUTHORS</a>
          </li>
          <li><a href="/categories">
              <div class="circle">
                  <span class="glyphicon glyphicon-folder-open txt-blue-major" aria-hidden="true"></span>
              </div>
                  &nbsp;&nbsp;CATEGORIES</a>
          </li>
          <li><a href="/tags">
              <div class="circle">
                <span class="txt-blue-major" aria-hidden="true"><strong>#</strong></span>
              </div>
                  &nbsp;&nbsp;TAGS</a>
          </li>
          <li>
            <form class="search" name="ddg" action="https://duckduckgo.com/" method="get">
              <input type="text" name ="q" placeholder="SEARCH" />
              <input type="hidden" value="perl.com" name="sites" />
            </form>
          </li>
        </ul>
      </div>
    </div>
  </div>
 </div>
</div>


  <section id="content" role="main">
    <section class="entry-content">
      <div class="container">
        <div class="row">
          <div class="col-md-9">
            <div class="row">
              <article class="fulltext">
              <h1 class="blog-post-title">Twitter as a datastore</h1>
              <p class="blog-post-meta">Jan 21, 2016 by
              
              
                
                
                <a href="#author-bio-brian-d-foy">brian d foy</a>
              
              </p>
              <img alt="" src="/images/210/B6ABE53E-C045-11E5-B2C3-641B7A54B0AF.png"/>
                <p>Why doesn&rsquo;t anyone talk about Twitter as a data store? It&rsquo;s a free account, they mostly have uptime, and you can easily control who can see the information. If you can do it in 140 characters (and <a href="http://www.theverge.com/2015/8/12/9134175/twitter-direct-message-character-limit">soon to be 10,000</a>), it&rsquo;s an easy way to store data.</p>

<p><a href="https://twitter.com/excellent_nums">Tweets by @excellent_nums</a></p>

<p>I&rsquo;m doing this for my <a href="http://www.excellentnums.com">excellent numbers project</a> that does quite a bit of computing to find numbers with a particular property. This isn&rsquo;t the only way I&rsquo;m storing the numbers, but I had the idea of tweeting them as soon as I found them in case every other method failed. If I accidentally deleted the output files (did that), truncated and overwrote files (did that), or somehow screwed it up in another way (did that), the numbers are still on Twitter.</p>

<p>I had another compelling reason, though. I wanted to get an alert on my phone when my program found another excellent number. Unfortunately, I&rsquo;ve hitched my wagon to the iPhone. There are all sorts of complicated ways for me to get an alert but I already use Twitter and get alerts for that. So, I can have a backup store and an alert system using stuff I already have installed. I can spend more time on the math and less time on installing and managing Redis (which is easy too and deserves an article here) then coming up with a way to send new entries to my phone.</p>

<p>I wrote about my setup in nonspecific terms in <a href="http://www.masteringperl.org/2015/12/ive-found-over-200-excellent-numbers/">Mastering Perl</a>. I didn&rsquo;t show any code, although it&rsquo;s all in <a href="https://github.com/briandfoy/excellent_numbers">the excellent_numbers GitHub repository</a>.</p>

<p>Before you start, you need some Twitter credentials to use their API through the <a href="https://metacpan.org/pod/Net::Twitter">Net::Twitter</a> module. Start at <a href="http://apps.twitter.com">Twitter Application Management</a> to get the four special strings you&rsquo;ll need (<a href="http://iag.me/socialmedia/how-to-create-a-twitter-app-in-8-easy-steps/">&ldquo;How to Register a Twitter App in 8 Easy Steps&rdquo; has a good description of the steps</a>:</p>

<p>Consumer Key (API Key)</p>

<p>Consumer Secret (API Secret)</p>

<p>Access Token</p>

<p>Access Token Secret</p>

<p>The Net::Twitter module needs these strings to create its object. The module handles all of the OAuth details without me having to think about them:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-perl" data-lang="perl"><span style="color:#66d9ef">use</span> Net::Twitter;

<span style="color:#66d9ef">my</span> $nt <span style="color:#f92672">=</span> Net::Twitter<span style="color:#f92672">-&gt;</span><span style="color:#66d9ef">new</span>(
   traits   <span style="color:#f92672">=&gt;</span> [<span style="color:#e6db74">qw/OAuth API::RESTv1_1/</span>],
   map { $_ <span style="color:#f92672">=&gt;</span> $ENV{<span style="color:#e6db74">&#34;$_&#34;</span>} <span style="color:#f92672">||</span> die <span style="color:#e6db74">&#34;ENV $_ not set&#34;</span> }
           <span style="color:#e6db74">qw(     
</span><span style="color:#e6db74">                consumer_secret
</span><span style="color:#e6db74">                consumer_key
</span><span style="color:#e6db74">                access_token
</span><span style="color:#e6db74">                access_token_secret
</span><span style="color:#e6db74">                )</span>
   );</code></pre></div>
<p>In my excellent number program, I wanted to be as simple as possible. I didn&rsquo;t want to re-tweet numbers I already tweeted so I fetched everything I&rsquo;ve tweeted so far and stored it in a hash. Twitter pages in groups of 200 tweets maximum, and this didn&rsquo;t seem like it would be a problem a couple of months ago but I&rsquo;m now up to over 350 of them.</p>

<p>It&rsquo;s easy to fetch a bunch of statuses with the <code>user_timeline</code> method. I need to tell it where to start (<code>min_id</code> or <code>since_id</code>). Twitter returns huge JSON structures with lots of information, but Net::Twitter turns that into a Perl data structure for me. I dump what they send and pull out the parts I want:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-perl" data-lang="perl"><span style="color:#66d9ef">my</span> %tweets;
STATUSES: <span style="color:#66d9ef">while</span>( <span style="color:#ae81ff">1</span> ) {
  state $min_id <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;
  state $fetch_size <span style="color:#f92672">=</span> <span style="color:#ae81ff">200</span>;

  <span style="color:#66d9ef">my</span> $max_key <span style="color:#f92672">=</span> $min_id <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span> ? <span style="color:#e6db74">&#39;since_id&#39;</span> : <span style="color:#e6db74">&#39;max_id&#39;</span>;

  <span style="color:#66d9ef">my</span> $statuses <span style="color:#f92672">=</span> $nt<span style="color:#f92672">-&gt;</span>user_timeline({
          count       <span style="color:#f92672">=&gt;</span> $fetch_size,
          screen_name <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#39;excellent_nums&#39;</span>,
          $max_key    <span style="color:#f92672">=&gt;</span> $min_id,
          });     

  say { interactive } <span style="color:#e6db74">&#34;Found &#34;</span> <span style="color:#f92672">.</span> @$statuses <span style="color:#f92672">.</span> <span style="color:#e6db74">&#34; statuses&#34;</span>;
  $min_id <span style="color:#f92672">=</span> $statuses<span style="color:#f92672">-&gt;</span>[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]{id} <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span> <span style="color:#66d9ef">if</span> $min_id <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span>;

  <span style="color:#66d9ef">foreach</span> <span style="color:#66d9ef">my</span> $status ( @$statuses ) {
          $min_id <span style="color:#f92672">=</span> $status<span style="color:#f92672">-&gt;</span>{id} <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span> <span style="color:#66d9ef">if</span> $min_id <span style="color:#f92672">&gt;</span> $status<span style="color:#f92672">-&gt;</span>{id};
          <span style="color:#66d9ef">my</span>( $number ) <span style="color:#f92672">=</span> $status<span style="color:#f92672">-&gt;</span>{text} <span style="color:#f92672">=~</span> <span style="color:#e6db74">m/(\d+)/</span>;
          warn <span style="color:#e6db74">&#34;[$number] has more than one tweet!\n&#34;</span> <span style="color:#66d9ef">if</span> exists $tweets{$number};
          $tweets{$number} <span style="color:#f92672">=</span> undef;
          <span style="color:#66d9ef">unless</span>( is_excellent( $number ) ) {
                  warn <span style="color:#e6db74">&#34;Tweet for [$number] is an unexcellent error\n&#34;</span>;
                  }       
          }       

  <span style="color:#66d9ef">last</span> <span style="color:#66d9ef">if</span> @$statuses <span style="color:#f92672">&lt;</span> $fetch_size; <span style="color:#75715e"># must be last page</span>
  }</code></pre></div>
<p>This part is complicated for another reason. At the start of the project I was generating the excellent numbers sequentially. When that&rsquo;s the case I only needed to look at the previous tweet to see if it was less than the number I just discovered. When I got to the big numbers, I went wide and worked on different parts of the range in parallel and sometimes on several computers simultaneously. I started to discover the numbers out of order and tweet them out of order. Hence, the paging. I could store the list of tweeted numbers locally, but that&rsquo;s a hassle to manage too since that can be out of sync. I still might do that when this method runs out of steam. I&rsquo;m not likely to get far beyond 500 numbers though.</p>

<p>Notice that I also <code>warn</code> if I run into a tweet with a number that I think is a duplicate:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-perl" data-lang="perl">warn <span style="color:#e6db74">&#34;[$number] has more than one tweet!\n&#34;</span> <span style="color:#66d9ef">if</span> exists $tweets{$number};</code></pre></div>
<p>If this was a bigger problem (and it&rsquo;s not anymore), I could use the <code>destroy_status</code> method to automatically get rid of it:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-perl" data-lang="perl">$nt<span style="color:#f92672">-&gt;</span>destroy_status( $status<span style="color:#f92672">-&gt;</span>{id} ) <span style="color:#66d9ef">if</span> exists $tweets{$number};</code></pre></div>
<p>I decided not to delete automatically from the program. It&rsquo;s not a problem to have duplicates. It&rsquo;s a bit messy, but it&rsquo;s more messy to delete stuff I want to keep and to retweet it. That risk makes it not worth it for me. I don&rsquo;t want another possible automated mess to clean up.</p>

<p>Now I know everything I&rsquo;ve tweeted previously and I&rsquo;ve put them in <code>%tweets</code>. The next part is to tweet what I&rsquo;ve found and haven&rsquo;t stored yet. I also store that in a local file (but remember I want the alerts and the backup!) that I used to populate <code>%numbers</code>. I skip the numbers I already tweeted and use <code>update</code> to make the new tweets. Storing new numbers is easy, and when I do it I want to tweet the new numbers in ascending order:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-perl" data-lang="perl">NUMBER: <span style="color:#66d9ef">foreach</span> <span style="color:#66d9ef">my</span> $number ( sort { $a <span style="color:#e6db74">&lt;=&gt;</span> $b } keys %numbers ) {
  <span style="color:#66d9ef">next</span> NUMBER <span style="color:#66d9ef">if</span> exists $tweets{$number};

  $nt<span style="color:#f92672">-&gt;</span>update( <span style="color:#e6db74">&#34;$number is excellent&#34;</span> );
  }</code></pre></div>
<p>This used to be part of the program that found the excellent numbers, but I switched to C for a huge performance bump. I still wanted to tweet from Perl, which is easy. Perl&rsquo;s become the glue holding together lots of different things.</p>

<p>Once I can read from, post to, and delete from twitter, other applications (or even real people) can follow it. It can be public or private. It&rsquo;s not sophisticated. It&rsquo;s uptime isn&rsquo;t going to win any awards. But it&rsquo;s free and easy for my small task.</p>

<p><br />
<em>This article was originally posted on <a href="http://perltricks.com">PerlTricks.com</a>.</em></p>

              </article>
              <p><strong>Tags</strong></p>
              <div class="tags">
                <div class="category"><a href="/categories/web">web</a></div>
                
                  <div class="tag"><a href="/tags/math">math</a></div>
                
                  <div class="tag"><a href="/tags/social_media">social_media</a></div>
                
                  <div class="tag"><a href="/tags/net_twitter">net_twitter</a></div>
                
              </div>
            </div>
            
              
                
<div class="row" id="author-bio-brian-d-foy">
  <div class="col-sm-2">
    
    <a href="/authors/brian-d-foy/"><div class="circle-avatar" style="background-image:url(/images/author/brian-d-foy.jpg)"></div></a>
  </div>
  <div class="col-sm-10">
    <a href="/authors/brian-d-foy/"><h3>brian d foy</h3></a>
    <p><a href="http://www.pair.com/~comdog/">brian d foy</a> is a Perl trainer and writer, and a senior editor at Perl.com. He&rsquo;s the author of <a href="https://www.masteringperl.org">Mastering Perl</a>, <a href="https://leanpub.com/mojo_web_clients">Mojolicious Web Clients</a>, <a href="https://leanpub.com/learning_perl_exercises">Learning Perl Exercises</a>, and co-author of <a href="https://www.programmingperl.org">Programming Perl</a>, <a href="https://www.learning-perl.com">Learning Perl</a>, <a href="https://www.intermediateperl.com">Intermediate Perl</a> and <a href="https://www.effectiveperlprogramming.com">Effective Perl Programming</a>.</p>
    <h5><a href="/authors/brian-d-foy/">Browse their articles</a></h5>
  </div>
</div>

            
            <div class="row">
              <h3>Feedback</h3>
              <p>Something wrong with this article? Help us out by opening an issue or pull request on <a href="https://github.com/tpf/perldotcom/blob/master/content/article/twitter-as-a-datastore.md">GitHub</a></p>
            </div>
          </div>
          <div class="col-md-3">
            <div class="latest-sidebar">

  <div class="row">
    <div class="col-sm-12 centering">
      <span style="font-size:1.8em" class="antonio txt-blue-major">OUR LATEST ARTICLES</span>
    </div>
  </div>
  
    
    
    <div class="row">
        <a href="http://localhost:1313/article/the-perl-admbassador-curtis-poe/">
      <div class="col-sm-3">
        <div class="circle-avatar" style="background-image:url(/images/the-perl-ambassador-curtis-poe/curtis-poe.jpg)"></div>
      </div>
      <div class="col-sm-9">
          <h6>The Perl Ambassador: Curtis &#39;Ovid&#39; Poe</h6>
          <p style="line-height:1"><small>The person behind the news of Perl</small></p>
      </div>
        </a>
    </div>
  
    
    
    <div class="row">
        <a href="http://localhost:1313/article/a-tour-with-net-ftp/">
      <div class="col-sm-3">
        <div class="circle-avatar" style="background-image:url(/images/a-tour-with-net-ftp/thumb_kidyes.jpg)"></div>
      </div>
      <div class="col-sm-9">
          <h6>A tour with Net::FTP</h6>
          <p style="line-height:1"><small>How to write an FTP client in Perl</small></p>
      </div>
        </a>
    </div>
  
    
    
    <div class="row">
        <a href="http://localhost:1313/article/shortcode_test/">
      <div class="col-sm-3">
        <div class="circle-avatar" style="background-image:url(/images/author/brian-d-foy.jpg)"></div>
      </div>
      <div class="col-sm-9">
          <h6>shortcode_test</h6>
          <p style="line-height:1"><small></small></p>
      </div>
        </a>
    </div>
  
    
    
    <div class="row">
        <a href="http://localhost:1313/article/listen-to-larry-wall-s-state-of-the-onion-2000-on-youtube/">
      <div class="col-sm-3">
        <div class="circle-avatar" style="background-image:url(/images/listen-to-larry-wall-s-state-of-the-onion-2000-on-youtube/thumb_larry-wall.jpg)"></div>
      </div>
      <div class="col-sm-9">
          <h6>Listen to Larry Wall&#39;s State of the Onion 2000 on YouTube</h6>
          <p style="line-height:1"><small></small></p>
      </div>
        </a>
    </div>
  
    
    
    <div class="row">
        <a href="http://localhost:1313/article/announcing-perl-7/">
      <div class="col-sm-3">
        <div class="circle-avatar" style="background-image:url(/images/announcing-perl-7/thumb_seven_on_blue_wall.jpg)"></div>
      </div>
      <div class="col-sm-9">
          <h6>Announcing Perl 7</h6>
          <p style="line-height:1"><small>Perl 5 with modern defaults</small></p>
      </div>
        </a>
    </div>
  
</div>
<div class="row" style="margin-top:20px">
  <div class="col-sm-12 centering">
  <script async src="/widget/toplinks/toplinks.js" type="text/javascript"></script>
    <div id="toplinks"></div>
  </div>
</div>

<div class="row" style="margin-top:20px">
  <div class="col-sm-12 centering">
    <a class="twitter-timeline" data-height="640" data-dnt="true" data-theme="dark" href="https://twitter.com/perlfoundation?ref_src=twsrc%5Etfw">Tweets by perlfoundation</a> <script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>
  </div>
</div>

<div class="row" style="margin-top:20px">
  <div class="col-sm-12 centering">
    <script src="https://www.reddit.com/r/perl/hot/.embed?limit=10&t=all" type="text/javascript"></script>
  </div>
</div>



          </div>
        </div>
      </div>
    </section>
  </section>
<script>
 
var tables, i;
tables = document.getElementsByTagName('table');
for (i=0;i<tables.length;i++) {
  tables[i].className = 'table table-striped';
}
</script>
<div class="push"></div>
<div class="footer">
  <div class="container">
    <div class="row">
      <div class="col-md-1">
        <h5>Site Map</h5>
        <ul>
        <li><a href="/">Home</a></li>
        <hr>
        <li><a href="/about">About</a></li>
        <hr>
        <li><a href="/authors">Authors</a></li>
        <hr>
        <li><a href="/categories">Categories</a></li>
        <hr>
        <li><a href="/tags">Tags</a></li>
        <hr>
        </ul>
      </div>
      <div class="col-md-3">
        <h5>Contact Us</h5>
        <p>To get in touch, send an email to: perl.com-editor@perl.org</p>
        <p><a href="https://perl.org">
              <img src="/images/site/perl-onion_20.png" alt="Perl Onion"></a>
          <a href="https://twitter.com/intent/follow?screen_name=perlfoundation">
              <img src="/images/site/twitter_20.png" alt="twitter"></a>
          <a href="/index.xml" /><img src="/images/site/rss_20.png" alt="rss"></a>
          <a href="https://github.com/tpf/perldotcom">
              <img src="/images/site/github_light_20.png" alt="GitHub logo"></a></p>
      </div>
      <div class="col-md-2">
          <h5>License</h5>
          <p>This work is licensed under a <a rel="license" href="https://creativecommons.org/licenses/by-nc/3.0/">Creative Commons Attribution-NonCommercial 3.0 Unported License</a>.</p>
          <p><a rel="license" href="https://creativecommons.org/licenses/by-nc/3.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc/3.0/88x31.png" /></a></p>
      </div>
      <div class="col-md-5">
          <h5>Legal</h5>
          <p>Perl.com and the authors make no representations with respect to the accuracy or completeness of the contents of all work on this website and specifically disclaim all warranties, including without limitation warranties of fitness for a particular purpose. The information published on this website may not be suitable for every situation. All work on this website is provided with the understanding that Perl.com and the authors are not engaged in rendering professional services. Neither Perl.com nor the authors shall be liable for damages arising herefrom.</p>
      </div>
    </div>
  </div>
</div>
<script src="/javascript/jquery.min.js"></script>
<script src="/javascript/bootstrap.min.js"></script>
<script data-no-instant>document.write('<script src="/livereload.js?port=1313&mindelay=10"></' + 'script>')</script></body>
</html>

