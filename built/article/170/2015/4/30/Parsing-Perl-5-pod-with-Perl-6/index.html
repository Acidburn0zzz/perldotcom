<!DOCTYPE html>
<html lang="en-us">
  <head>
  <title> Parsing Perl 5 pod with Perl 6 </title>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Grammars, action classes, code!"/>
  <meta name="robots" content="index, follow">
  <meta name="google-site-verification" content="TZowffo_LX2mmsw2DbeNNbukCMnIOA8T-6CMJPiYllI" />

<meta property="twitter:card" content="summary">
<meta property="twitter:site" content="@PerlFoundation">
<meta property="og:url" content="http://localhost:1313/article/170/2015/4/30/Parsing-Perl-5-pod-with-Perl-6/" />
<meta property="og:title" content="Parsing Perl 5 pod with Perl 6" />
<meta property="og:description" content="Grammars, action classes, code!">
<meta property="og:site_name" content="Perl.com" />

<meta property="og:type" content="article" />
<meta property="og:article:published_time" content="2015-04-04T04:04:04Z" />
<meta property="og:image" content="http://localhost:1313/images/170/thumb_AA60EE46-EF3A-11E4-98F4-3C044E9B8265.png" />
<meta property="og:article:tag" content="pod" />
<meta property="og:article:tag" content="perl-6" />
<meta property="og:article:tag" content="grammar" />
<meta property="og:article:tag" content="pegex" />
<meta property="og:article:tag" content="parser" />


  <link rel="icon" href="/favicon.ico">
  <link href="/article/index.xml" rel="alternate" type="application/rss+xml" title="Perl.com - programming news, code and culture" />
  <link href="/article/index.xml" rel="feed" type="application/rss+xml" title="Perl.com - programming news, code and culture" />
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" type="text/css" href="/css/perldotcom.css"/>


<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-50555-22', 'auto');
ga('create', 'UA-85734801-2', 'auto', 'editor');
ga('send', 'pageview');
ga('editor.send', 'pageview');
</script>

</head>
<body>

<div class="container-fluid full-wdith antonio">
 <div class="row">
  <div class="navbar-inverse" style="border-radius:none !important" role="navigation">
    <div class="container-fluid">
      <ul class="nav navbar-nav pull-right follow">
          <li>MORE:</li>
          <li><a href="https://perl.org">
              <img src="/images/site/perl-onion_20.png" alt="Perl Onion"></a><li>
          <li><a href="https://twitter.com/intent/follow?screen_name=perlfoundation">
              <img src="/images/site/twitter_20.png" alt="twitter"></a><li>
          <li><a href="/article/index.xml" />
              <img src="/images/site/rss_20.png" alt="rss"></a></li>
          <li><a href="https://github.com/tpf/perldotcom" />
              <img src="/images/site/github_light_20.png" alt="GitHub logo"></a></li>
      </ul>
      <div class="navbar-header">
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
          <a class="navbar-nav" href="/">
            <div class="header-logo">Perl.com</div>
          </a>
      </div>
      <div class="navbar-collapse collapse">
        <ul class="nav navbar-nav">
          <li><a href="/about">
              <div class="circle">
                <img src="/images/site/perl-camel.png" alt="" />
              </div>
                  &nbsp;&nbsp;ABOUT</a>
          </li>
          <li><a href="/authors">
              <div class="circle">
                  <span class="glyphicon glyphicon-user txt-blue-major" aria-hidden="true"></span>
              </div>
                  &nbsp;&nbsp;AUTHORS</a>
          </li>
          <li><a href="/categories">
              <div class="circle">
                  <span class="glyphicon glyphicon-folder-open txt-blue-major" aria-hidden="true"></span>
              </div>
                  &nbsp;&nbsp;CATEGORIES</a>
          </li>
          <li><a href="/tags">
              <div class="circle">
                <span class="txt-blue-major" aria-hidden="true"><strong>#</strong></span>
              </div>
                  &nbsp;&nbsp;TAGS</a>
          </li>
          <li>
            <form class="search" name="ddg" action="https://duckduckgo.com/" method="get">
              <input type="text" name ="q" placeholder="SEARCH" />
              <input type="hidden" value="perl.com" name="sites" />
            </form>
          </li>
        </ul>
      </div>
    </div>
  </div>
 </div>
</div>


  <section id="content" role="main">
    <section class="entry-content">
      <div class="container">
        <div class="row">
          <div class="col-md-9">
            <div class="row">
              <article class="fulltext">
              <h1 class="blog-post-title">Parsing Perl 5 pod with Perl 6</h1>
              <p class="blog-post-meta">Apr 30, 2015 by
              
              
                
                
                <a href="#author-bio-david-farrell">David Farrell</a>
              
              </p>
              <img alt="" src="/images/170/AA60EE46-EF3A-11E4-98F4-3C044E9B8265.png"/>
                

<p>I&rsquo;ve just finished developing a Perl 5 pod <a href="https://github.com/dnmfarrell/Pod-Perl5">parser</a> written in Perl 6. Developing the grammar was surprisingly easy, which is a testament to Perl 6 as I&rsquo;m no genius coder. With help from the folks at #perl6, I did learn some interesting things along the way, and wanted to share them. Plus, code!</p>

<p>By the way, if you haven&rsquo;t read my <a href="http://perltricks.com/article/144/2015/1/13/How-to-create-a-grammar-in-Perl-6">introduction</a> to Perl 6 grammars, check it out first, and the rest of this article should make more sense.</p>

<h3 id="developing-the-grammar">Developing the grammar</h3>

<p>In Perl 6 a grammar is a special type of class for parsing text. The idea is to declare a series of regexes using the <code>token</code> method, which are then used to parse input. For <a href="https://github.com/dnmfarrell/Pod-Perl5/blob/master/lib/Pod/Perl5/Grammar.pm">Pod::Perl5::Grammar</a> I literally worked my way through <a href="https://perldoc.perl.org/perlpod.html">perlpod</a>, the Perl 5 pod specification, writing tokens as I went.</p>

<p>There were a few challenges. First, consider how would you define a regex for lists? In pod, lists can contain lists, so can a definition include itself? The answer is yes, a recursive definition is fine, as long as it doesn&rsquo;t match a zero length string, which leads to an infinite loop. Here&rsquo;s the definition:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-perl" data-lang="perl">token over_back { <span style="color:#e6db74">&lt;over&gt;</span>
                    [
                      <span style="color:#e6db74">&lt;_item&gt;</span> <span style="color:#f92672">|</span> <span style="color:#e6db74">&lt;paragraph&gt;</span> <span style="color:#f92672">|</span> <span style="color:#e6db74">&lt;verbatim_paragraph&gt;</span> <span style="color:#f92672">|</span> <span style="color:#e6db74">&lt;blank_line&gt;</span> <span style="color:#f92672">|</span>
                      <span style="color:#e6db74">&lt;_for&gt;</span> <span style="color:#f92672">|</span> <span style="color:#e6db74">&lt;begin_end&gt;</span> <span style="color:#f92672">|</span> <span style="color:#e6db74">&lt;pod&gt;</span> <span style="color:#f92672">|</span> <span style="color:#e6db74">&lt;encoding&gt;</span> <span style="color:#f92672">|</span> <span style="color:#e6db74">&lt;over_back&gt;</span>
                    ]<span style="color:#f92672">*</span>
                    <span style="color:#e6db74">&lt;back&gt;</span>
                  }

token over      { <span style="color:#f92672">^^\=</span>over [<span style="color:#f92672">\</span>h<span style="color:#f92672">+</span> <span style="color:#e6db74">&lt;[0..9]&gt;</span><span style="color:#f92672">+</span> ]? <span style="color:#f92672">\</span>n }
token _item     { <span style="color:#f92672">^^\=</span>item <span style="color:#f92672">\</span>h<span style="color:#f92672">+</span> <span style="color:#e6db74">&lt;name&gt;</span>
                    [
                        [ <span style="color:#f92672">\</span>h<span style="color:#f92672">+</span> <span style="color:#e6db74">&lt;paragraph&gt;</span>  ]
                      <span style="color:#f92672">|</span> [ <span style="color:#f92672">\</span>h<span style="color:#f92672">*</span> <span style="color:#f92672">\</span>n <span style="color:#e6db74">&lt;blank_line&gt;</span> <span style="color:#e6db74">&lt;paragraph&gt;</span>? ]
                    ]
                  }
token back      { <span style="color:#f92672">^^\=</span>back <span style="color:#f92672">\</span>h<span style="color:#f92672">*</span> <span style="color:#f92672">\</span>n }</code></pre></div>
<p>The token <code>over_back</code> describes an entire list from start to finish. It basically says that a list must begin with an <code>=over</code> and end with <code>=back</code>, and can have a whole bunch of things in between, including another <code>over_back</code>!</p>

<p>For simplicity&rsquo;s sake, I tried to name the tokens the same as how they&rsquo;re written in pod. In some cases this wasn&rsquo;t possible, for instance <code>item</code> causes a namespace clash with another method that the Grammar class inherits. So watch out for those cases, you&rsquo;ll get weird errors (this is a <a href="https://rt.perl.org/rt3//Public/Bug/Display.html?id=77350">bug</a>).</p>

<p>This is one pattern I really love and used over and over in the grammar:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-perl" data-lang="perl">[ <span style="color:#e6db74">&lt;pod_section&gt;</span> <span style="color:#f92672">|</span> <span style="color:#f92672">&lt;</span>?<span style="color:#f92672">!</span>before <span style="color:#e6db74">&lt;pod_section&gt;</span> <span style="color:#f92672">&gt;</span> <span style="color:#f92672">.</span>]<span style="color:#f92672">*</span></code></pre></div>
<p>The pattern is useful when you have a pattern to capture, but if there&rsquo;s no matching pattern ignore everything else. In this case, <code>pod_section</code> is a token that defines a section of pod, but pod is often written inline with Perl code, which the grammar should ignore. So the second half of the definition uses a negative lookahead <code>?!before</code> to check the next character is not a <code>pod_section</code>, and uses a period <code>.</code> to match everything else (including newlines). Both conditions are grouped in square brackets with an asterisk placed <strong>outside</strong> the group in order to check one character at a time.</p>

<p>The grammar can be used to parse standalone and inline pod. It will extract every pod section it finds into match object (basically a Perl data structure), ready for processing. It&rsquo;s easy to use:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-perl" data-lang="perl"><span style="color:#66d9ef">use</span> Pod::Perl5::Grammar;

<span style="color:#66d9ef">my</span> $match <span style="color:#f92672">=</span> Pod::Perl5::Grammar<span style="color:#f92672">.</span>parse($pod);

<span style="color:#75715e"># or</span>

<span style="color:#66d9ef">my</span> $match <span style="color:#f92672">=</span> Pod::Perl5::Grammar<span style="color:#f92672">.</span>parsefile(<span style="color:#e6db74">&#34;/path/to/some.pod&#34;</span>);</code></pre></div>
<h3 id="action-classes">Action classes</h3>

<p>So far so cool, but we can do more. Action classes are regular Perl 6 classes that can be given to the grammar at parse time. They provide behavior (actions) for token matching events. Just name the methods in the action class the same as the token they should be executed on. I wrote a pod-to-HTML action <a href="https://github.com/dnmfarrell/Pod-Perl5/blob/master/lib/Pod/Perl5/ToHTML.pm">class</a>. Here is the method for converting <code>=head1</code> to HTML:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-perl" data-lang="perl">method head1 ($/)
{
  self<span style="color:#f92672">.</span>add_to_html(<span style="color:#e6db74">&#39;body&#39;</span>, <span style="color:#e6db74">&#34;&lt;h1&gt;{$/&lt;singleline_text&gt;.Str}&lt;/h1&gt;\n&#34;</span>);
}</code></pre></div>
<p>Every time the grammar matches a head1 token, this method executes. It&rsquo;s passed the regex capture variable <code>$/</code>, which contains the head1 regex capture, from which it extracts the text string.</p>

<p>Here&rsquo;s a cool fact: action classes are even easier to write than grammars. It would be trivial to write a pod to markdown converter using Pod::Perl5::Grammar, unless someone beats me to it (hint, hint). That said, I did encounter a few challenges along the way.</p>

<p>Essentially for HTML conversion, each action class method can just extract the text from it&rsquo;s matching token, reformat it as required, and print it out. This approach worked great until I encountered nested tokens like formatting codes, which sit within a paragraph of text. You don&rsquo;t want to go from this:</p>

<pre><code>There are different ways to emphasize text, I&lt;this is in italics&gt; and  B&lt;this is in bold&gt;
</code></pre>

<p>To this:</p>

<pre><code>&lt;i&gt;this is in italics&lt;/i&gt;
&lt;b&gt;this is in bold&lt;/b&gt;
&lt;p&gt;There are different ways to emphasize text, I&lt;this is in italics&gt; and  B&lt;this is in bold&gt;&lt;/p&gt;
</code></pre>

<p>This can happen because the italics and bold token regexes match first. So to get around this issue, I used a buffer to store the HTML from the transformed sub-tokens, and then when a paragraph token is matched, it substitutes its own text with the contents of the buffer. The action class code for this looks like this:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-perl" data-lang="perl">method paragraph ($/ is copy)
{
  <span style="color:#66d9ef">my</span> $original_text <span style="color:#f92672">=</span> $/<span style="color:#e6db74">&lt;text&gt;</span><span style="color:#f92672">.</span>Str<span style="color:#f92672">.</span>chomp;
  <span style="color:#66d9ef">my</span> $para_text <span style="color:#f92672">=</span> $/<span style="color:#e6db74">&lt;text&gt;</span><span style="color:#f92672">.</span>Str<span style="color:#f92672">.</span>chomp;

  <span style="color:#66d9ef">for</span> self<span style="color:#f92672">.</span>get_buffer(<span style="color:#e6db74">&#39;paragraph&#39;</span>)<span style="color:#f92672">.</span>reverse <span style="color:#f92672">-&gt;</span> $pair <span style="color:#75715e"># reverse as we&#39;re working outside in</span>
  {
    $para_text <span style="color:#f92672">=</span> $para_text<span style="color:#f92672">.</span>subst($pair<span style="color:#f92672">.</span>key, {$pair<span style="color:#f92672">.</span>value});
  }
  self<span style="color:#f92672">.</span>add_to_html(<span style="color:#e6db74">&#39;body&#39;</span>, <span style="color:#e6db74">&#34;&lt;p&gt;{$para_text}&lt;/p&gt;\n&#34;</span>);
  self<span style="color:#f92672">.</span>clear_buffer(<span style="color:#e6db74">&#39;paragraph&#39;</span>);
  }

method italic ($/)
{
  self<span style="color:#f92672">.</span>add_to_buffer(<span style="color:#e6db74">&#39;paragraph&#39;</span>, $/<span style="color:#f92672">.</span>Str <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#34;&lt;i&gt;{$/&lt;multiline_text&gt;.Str}&lt;/i&gt;&#34;</span>);
}

method bold ($/)
{
  self<span style="color:#f92672">.</span>add_to_buffer(<span style="color:#e6db74">&#39;paragraph&#39;</span>, $/<span style="color:#f92672">.</span>Str <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#34;&lt;b&gt;{$/&lt;multiline_text&gt;.Str}&lt;/b&gt;&#34;</span>);
}</code></pre></div>
<p>One thing to watch out for with action classes is regex handling. <strong>Every</strong> action class example I&rsquo;ve seen uses <code>$/</code> in the method signature. This is a mistake, as guess what this does:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-perl" data-lang="perl">method head1 ($/)
{
  <span style="color:#66d9ef">if</span> $/<span style="color:#f92672">.</span>Str <span style="color:#f92672">~~</span> <span style="color:#e6db74">m/foobar/</span> <span style="color:#75715e"># silly example</span>
  {
    self<span style="color:#f92672">.</span>add_to_html(<span style="color:#e6db74">&#39;body&#39;</span>, <span style="color:#e6db74">&#34;&lt;h1&gt;{$/&lt;singleline_text&gt;.Str}\n&#34;</span>);
  }
}</code></pre></div>
<pre><code>Cannot assign to a readonly variable or a value
</code></pre>

<p>Mushroom cloud-style boom. When <code>$/</code> is passed to <code>head1</code> it is read only. Executing <strong>any</strong> regex in the same lexical scope will attempt to overwrite <code>$/</code>. This bit me a few times and with help from #perl6, I ended up using this pattern:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-perl" data-lang="perl">method head1 ($/ is copy)
{
  <span style="color:#66d9ef">my</span> $match <span style="color:#f92672">=</span> $/;
  <span style="color:#66d9ef">if</span> $match<span style="color:#f92672">.</span>Str <span style="color:#f92672">~~</span> <span style="color:#e6db74">m/foobar/</span>
  {
    self<span style="color:#f92672">.</span>add_to_html(<span style="color:#e6db74">&#39;body&#39;</span>, <span style="color:#e6db74">&#34;&lt;h1&gt;{$match&lt;singleline_text&gt;.Str}&lt;/h1&gt;\n&#34;</span>);
  }
}</code></pre></div>
<p>Adding <code>is copy</code> to the signature creates a copy instead of a reference for <code>$/</code>. I then copy the match variable into <code>$match</code>, so that the following regex can clobber <code>$/</code>. I *think* a better solution is this:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-perl" data-lang="perl">method head1 ($match)
{
  <span style="color:#66d9ef">if</span> $match<span style="color:#f92672">.</span>Str <span style="color:#f92672">~~</span> <span style="color:#e6db74">m/foobar/</span>
  {
    self<span style="color:#f92672">.</span>add_to_html(<span style="color:#e6db74">&#39;body&#39;</span>, <span style="color:#e6db74">&#34;&lt;h1&gt;{$match&lt;singleline_text&gt;.Str}&lt;/h1&gt;\n&#34;</span>);
  }
}</code></pre></div>
<p>I think it&rsquo;s that simple, just don&rsquo;t name the signature parameter <code>$/</code> and all the headaches disappear. I haven&rsquo;t tested this extensively&hellip;</p>

<p>To use an action class, just pass it to the grammar:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-perl" data-lang="perl"><span style="color:#66d9ef">use</span> Pod::Perl5::Grammar;
<span style="color:#66d9ef">use</span> Pod::Perl5::ToHTML;

<span style="color:#66d9ef">my</span> $actions <span style="color:#f92672">=</span> Pod::Perl5::ToHTML<span style="color:#f92672">.</span><span style="color:#66d9ef">new</span>;
<span style="color:#66d9ef">my</span> $match <span style="color:#f92672">=</span> Pod::Perl5::Grammar<span style="color:#f92672">.</span>parse($pod, :$actions);

<span style="color:#75715e"># or</span>
<span style="color:#66d9ef">my</span> $match <span style="color:#f92672">=</span> Pod::Perl5::Grammar<span style="color:#f92672">.</span>parse($pod, :actions($actions));</code></pre></div>
<p>In the first example I used a named positional argument <code>:$actions</code>. This <strong>must</strong> be called actions to work. In the second example I named the argument like this: <code>:actions($actions)</code>, in which case the action class object can be called whatever you want.</p>

<h3 id="improving-pod">Improving pod</h3>

<p>PerlTricks.com articles are written in HTML. Special snowflake style HTML with class names and <code>span</code> tags. This is a pain for writers to use and a pain to edit. I&rsquo;d love to use pod as the source - it would be easier for writers to use and faster for me to edit. That said, I&rsquo;d like to extend pod with some useful features for blogging. For instance, you may be familiar with formatting codes like <code>B&lt;...&gt;</code> for bold and the like. Well, what about <code>@&lt; ... &gt;</code> for a Twitter references, or <code>M&lt; ... &gt;</code> for <a href="https://metacpan.org/">MetaCPAN</a> links?</p>

<p>As Perl 6 grammars are classes, they can be inherited and overridden. So I can add my Twitter and Metacpan formatting codes to the grammar like this:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-perl" data-lang="perl">grammar Pod::Perl5::Grammar::PerlTricks is Pod::Perl5::Grammar
{
  token twitter  { @<span style="color:#960050;background-color:#1e0010">\&lt;</span> <span style="color:#960050;background-color:#1e0010">&lt;</span>name<span style="color:#f92672">&gt;</span> <span style="color:#f92672">\&gt;</span> }
  token metacpan { M<span style="color:#f92672">\&lt;</span> <span style="color:#e6db74">&lt;name&gt;</span> <span style="color:#f92672">\&gt;</span> }
}</code></pre></div>
<p>I&rsquo;ll also need to override the <code>format_codes</code> token to include the new tokens:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-perl" data-lang="perl">token format_codes  {
  [
    <span style="color:#e6db74">&lt;italic&gt;</span><span style="color:#f92672">|</span><span style="color:#e6db74">&lt;bold&gt;</span><span style="color:#f92672">|</span><span style="color:#e6db74">&lt;code&gt;</span><span style="color:#f92672">|</span><span style="color:#e6db74">&lt;link&gt;</span>
    <span style="color:#f92672">|</span><span style="color:#e6db74">&lt;escape&gt;</span><span style="color:#f92672">|</span><span style="color:#e6db74">&lt;filename&gt;</span><span style="color:#f92672">|</span><span style="color:#e6db74">&lt;singleline&gt;</span>
    <span style="color:#f92672">|</span><span style="color:#e6db74">&lt;index&gt;</span><span style="color:#f92672">|</span><span style="color:#e6db74">&lt;zeroeffect&gt;</span><span style="color:#f92672">|</span><span style="color:#e6db74">&lt;twitter|&lt;metacpan&gt;</span>
  ]
}</code></pre></div>
<p>It&rsquo;s that easy. The new grammar will parse all pod, plus my two new formatting codes. Of course the action class Pod::Perl5::Pod can be extended and overridden too, and would look something like this:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-perl" data-lang="perl">Pod::Perl5::ToHTML::PerlTricks is Pod::Perl5::ToHTML
{
  method twitter ($match)
  {
    self<span style="color:#f92672">.</span>add_to_buffer(<span style="color:#e6db74">&#39;paragraph&#39;</span>,
      $match<span style="color:#f92672">.</span>Str <span style="color:#f92672">=&gt;</span>
<span style="color:#e6db74">&#34;&lt;a href=&#34;</span>http:<span style="color:#e6db74">//</span>twitter<span style="color:#f92672">.</span>com<span style="color:#e6db74">/{$match&lt;name&gt;.Str}&#34;&gt;{$match&lt;name&gt;.Str}&lt;/</span>a<span style="color:#f92672">&gt;</span><span style="color:#e6db74">&#34;);
</span><span style="color:#e6db74">  }
</span><span style="color:#e6db74">  method metacpan ($match)
</span><span style="color:#e6db74">  {
</span><span style="color:#e6db74">    self.add_to_buffer(&#39;paragraph&#39;,
</span><span style="color:#e6db74">      $match.Str =&gt;
</span><span style="color:#e6db74">&#34;</span><span style="color:#f92672">&lt;</span>a href<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;{$match&lt;name&gt;.Str}&#34;</span><span style="color:#f92672">&gt;</span>{$match<span style="color:#e6db74">&lt;name&gt;</span><span style="color:#f92672">.</span>Str}<span style="color:#e6db74">&lt;/a&gt;</span><span style="color:#e6db74">&#34;&#34;</span> <span style="color:#f92672">&gt;</span>);
  }
}</code></pre></div>
<h3 id="wait-there-s-more">Wait, there&rsquo;s more</h3>

<p>There&rsquo;s a cleaner way to manage groups of tokens, it&rsquo;s called <a href="http://design.perl6.org/S06.html#Routine_modifiers">multi-dispatch</a>. Instead of defining <code>format_codes</code> as a list of alternative tokens it can match against, we declare a prototype method, and declare each formatting method as a <code>multi</code> of the prototype. Check this out:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-perl" data-lang="perl">proto token format_codes  { <span style="color:#f92672">*</span> }
multi token format_codes:italic { I<span style="color:#f92672">\&lt;</span> <span style="color:#e6db74">&lt;multiline_text&gt;</span>  <span style="color:#f92672">\&gt;</span>  }
multi token format_codes:bold   { B<span style="color:#f92672">\&lt;</span> <span style="color:#e6db74">&lt;multiline_text&gt;</span>  <span style="color:#f92672">\&gt;</span>  }
multi token format_codes:code   { C<span style="color:#f92672">\&lt;</span> <span style="color:#e6db74">&lt;multiline_text&gt;</span>  <span style="color:#f92672">\&gt;</span>  }
<span style="color:#f92672">...</span></code></pre></div>
<p>Now when this grammar is inherited, there is no need to override <code>format_codes</code>. Instead I can declare the new tokens as multis:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-perl" data-lang="perl">grammar Pod::Perl5::Grammar::PerlTricks is Pod::Perl5::Grammar
{
  token format_codes:twitter  { @<span style="color:#960050;background-color:#1e0010">\&lt;</span> <span style="color:#960050;background-color:#1e0010">&lt;</span>name<span style="color:#f92672">&gt;</span> <span style="color:#f92672">\&gt;</span> }
  token format_codes:metacpan { M<span style="color:#f92672">\&lt;</span> <span style="color:#e6db74">&lt;name&gt;</span> <span style="color:#f92672">\&gt;</span> }
}</code></pre></div>
<p>Using multi-dispatch also has the modest benefit of simplifying the data extraction path when working with a match object. For instance, these code extracts the link section from the 3rd paragraph of a pod block:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-perl" data-lang="perl">is $match<span style="color:#e6db74">&lt;pod_section&gt;</span>[<span style="color:#ae81ff">0</span>]<span style="color:#e6db74">&lt;paragraph&gt;</span>[<span style="color:#ae81ff">2</span>]<span style="color:#e6db74">&lt;text&gt;&lt;format_codes&gt;</span>[<span style="color:#ae81ff">0</span>]<span style="color:#e6db74">&lt;link&gt;&lt;section&gt;</span><span style="color:#f92672">.</span>Str <span style="color:#75715e"># regular version</span>
is $match<span style="color:#e6db74">&lt;pod_section&gt;</span>[<span style="color:#ae81ff">0</span>]<span style="color:#e6db74">&lt;paragraph&gt;</span>[<span style="color:#ae81ff">2</span>]<span style="color:#e6db74">&lt;text&gt;&lt;format_codes&gt;</span>[<span style="color:#ae81ff">0</span>]<span style="color:#e6db74">&lt;section&gt;</span><span style="color:#f92672">.</span>Str <span style="color:#75715e"># multi dispatch equivalent</span></code></pre></div>
<p>In the first example, the format token name <code>link</code> is required. But with multi-dispatch, we can remove that, as shown in the second example.</p>

<h3 id="conclusion">Conclusion</h3>

<p>So that&rsquo;s what I learned; overall writing a pod parser in Perl 6 was straightforward. If you&rsquo;re programming in Perl 6 and have questions, I&rsquo;d highly recommend the <a href="http://perl6.org/community/irc">#perl6</a> irc channel on freenode, the people there were friendly and responsive.</p>

<p><strong>Update:</strong> <em>Multi-dispatch example added. Thanks to Jonathan Scott Duff for providing the multi-dispatch explanation and code. 2015-05-01</em></p>

<p><br />
<em>This article was originally posted on <a href="http://perltricks.com">PerlTricks.com</a>.</em></p>

              </article>
              <p><strong>Tags</strong></p>
              <div class="tags">
                <div class="category"><a href="/categories/perl-6">perl-6</a></div>
                
                  <div class="tag"><a href="/tags/pod">pod</a></div>
                
                  <div class="tag"><a href="/tags/perl-6">perl-6</a></div>
                
                  <div class="tag"><a href="/tags/grammar">grammar</a></div>
                
                  <div class="tag"><a href="/tags/pegex">pegex</a></div>
                
                  <div class="tag"><a href="/tags/parser">parser</a></div>
                
              </div>
            </div>
            
              
                
<div class="row" id="author-bio-david-farrell">
  <div class="col-sm-2">
    
    <a href="/authors/david-farrell/"><div class="circle-avatar" style="background-image:url(/images/author/david-farrell.jpg)"></div></a>
  </div>
  <div class="col-sm-10">
    <a href="/authors/david-farrell/"><h3>David Farrell</h3></a>
    <p>David is the editor of Perl.com. An organizer of the <a href="http://www.meetup.com/The-New-York-Perl-Meetup-Group/">New York Perl Meetup</a>, he works for ZipRecruiter as a software developer, and sometimes <a href="https://twitter.com/perltricks">tweets</a> about Perl and Open Source.</p>
    <h5><a href="/authors/david-farrell/">Browse their articles</a></h5>
  </div>
</div>

            
            <div class="row">
              <h3>Feedback</h3>
              <p>Something wrong with this article? Help us out by opening an issue or pull request on <a href="https://github.com/tpf/perldotcom/blob/master/content/article/parsing-perl-5-pod-with-perl-6.md">GitHub</a></p>
            </div>
          </div>
          <div class="col-md-3">
            <div class="latest-sidebar">

  <div class="row">
    <div class="col-sm-12 centering">
      <span style="font-size:1.8em" class="antonio txt-blue-major">OUR LATEST ARTICLES</span>
    </div>
  </div>
  
    
    
    <div class="row">
        <a href="http://localhost:1313/article/the-perl-admbassador-curtis-poe/">
      <div class="col-sm-3">
        <div class="circle-avatar" style="background-image:url(/images/the-perl-ambassador-curtis-poe/curtis-poe.jpg)"></div>
      </div>
      <div class="col-sm-9">
          <h6>The Perl Ambassador: Curtis &#39;Ovid&#39; Poe</h6>
          <p style="line-height:1"><small>The person behind the news of Perl</small></p>
      </div>
        </a>
    </div>
  
    
    
    <div class="row">
        <a href="http://localhost:1313/article/a-tour-with-net-ftp/">
      <div class="col-sm-3">
        <div class="circle-avatar" style="background-image:url(/images/a-tour-with-net-ftp/thumb_kidyes.jpg)"></div>
      </div>
      <div class="col-sm-9">
          <h6>A tour with Net::FTP</h6>
          <p style="line-height:1"><small>How to write an FTP client in Perl</small></p>
      </div>
        </a>
    </div>
  
    
    
    <div class="row">
        <a href="http://localhost:1313/article/shortcode_test/">
      <div class="col-sm-3">
        <div class="circle-avatar" style="background-image:url(/images/author/brian-d-foy.jpg)"></div>
      </div>
      <div class="col-sm-9">
          <h6>shortcode_test</h6>
          <p style="line-height:1"><small></small></p>
      </div>
        </a>
    </div>
  
    
    
    <div class="row">
        <a href="http://localhost:1313/article/listen-to-larry-wall-s-state-of-the-onion-2000-on-youtube/">
      <div class="col-sm-3">
        <div class="circle-avatar" style="background-image:url(/images/listen-to-larry-wall-s-state-of-the-onion-2000-on-youtube/thumb_larry-wall.jpg)"></div>
      </div>
      <div class="col-sm-9">
          <h6>Listen to Larry Wall&#39;s State of the Onion 2000 on YouTube</h6>
          <p style="line-height:1"><small></small></p>
      </div>
        </a>
    </div>
  
    
    
    <div class="row">
        <a href="http://localhost:1313/article/announcing-perl-7/">
      <div class="col-sm-3">
        <div class="circle-avatar" style="background-image:url(/images/announcing-perl-7/thumb_seven_on_blue_wall.jpg)"></div>
      </div>
      <div class="col-sm-9">
          <h6>Announcing Perl 7</h6>
          <p style="line-height:1"><small>Perl 5 with modern defaults</small></p>
      </div>
        </a>
    </div>
  
</div>
<div class="row" style="margin-top:20px">
  <div class="col-sm-12 centering">
  <script async src="/widget/toplinks/toplinks.js" type="text/javascript"></script>
    <div id="toplinks"></div>
  </div>
</div>

<div class="row" style="margin-top:20px">
  <div class="col-sm-12 centering">
    <a class="twitter-timeline" data-height="640" data-dnt="true" data-theme="dark" href="https://twitter.com/perlfoundation?ref_src=twsrc%5Etfw">Tweets by perlfoundation</a> <script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>
  </div>
</div>

<div class="row" style="margin-top:20px">
  <div class="col-sm-12 centering">
    <script src="https://www.reddit.com/r/perl/hot/.embed?limit=10&t=all" type="text/javascript"></script>
  </div>
</div>



          </div>
        </div>
      </div>
    </section>
  </section>
<script>
 
var tables, i;
tables = document.getElementsByTagName('table');
for (i=0;i<tables.length;i++) {
  tables[i].className = 'table table-striped';
}
</script>
<div class="push"></div>
<div class="footer">
  <div class="container">
    <div class="row">
      <div class="col-md-1">
        <h5>Site Map</h5>
        <ul>
        <li><a href="/">Home</a></li>
        <hr>
        <li><a href="/about">About</a></li>
        <hr>
        <li><a href="/authors">Authors</a></li>
        <hr>
        <li><a href="/categories">Categories</a></li>
        <hr>
        <li><a href="/tags">Tags</a></li>
        <hr>
        </ul>
      </div>
      <div class="col-md-3">
        <h5>Contact Us</h5>
        <p>To get in touch, send an email to: perl.com-editor@perl.org</p>
        <p><a href="https://perl.org">
              <img src="/images/site/perl-onion_20.png" alt="Perl Onion"></a>
          <a href="https://twitter.com/intent/follow?screen_name=perlfoundation">
              <img src="/images/site/twitter_20.png" alt="twitter"></a>
          <a href="/index.xml" /><img src="/images/site/rss_20.png" alt="rss"></a>
          <a href="https://github.com/tpf/perldotcom">
              <img src="/images/site/github_light_20.png" alt="GitHub logo"></a></p>
      </div>
      <div class="col-md-2">
          <h5>License</h5>
          <p>This work is licensed under a <a rel="license" href="https://creativecommons.org/licenses/by-nc/3.0/">Creative Commons Attribution-NonCommercial 3.0 Unported License</a>.</p>
          <p><a rel="license" href="https://creativecommons.org/licenses/by-nc/3.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc/3.0/88x31.png" /></a></p>
      </div>
      <div class="col-md-5">
          <h5>Legal</h5>
          <p>Perl.com and the authors make no representations with respect to the accuracy or completeness of the contents of all work on this website and specifically disclaim all warranties, including without limitation warranties of fitness for a particular purpose. The information published on this website may not be suitable for every situation. All work on this website is provided with the understanding that Perl.com and the authors are not engaged in rendering professional services. Neither Perl.com nor the authors shall be liable for damages arising herefrom.</p>
      </div>
    </div>
  </div>
</div>
<script src="/javascript/jquery.min.js"></script>
<script src="/javascript/bootstrap.min.js"></script>
<script data-no-instant>document.write('<script src="/livereload.js?port=1313&mindelay=10"></' + 'script>')</script></body>
</html>

